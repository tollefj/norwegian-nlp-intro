Summary,Description,Custom field (Epic Link),Component/s,Component/s
Mulighet til Ã¥ bytte operasjon,"Som bruker av Datafangst

Ã¸nsker jeg Ã¥ kunne bytte type operasjon for et NVDB-objektet som er hentet inn i kontrakten

sÃ¥ jeg slipper Ã¥ fjerne det og sÃ¥ importere pÃ¥ nytt dersom det er feil operasjon eller importere i flere runder dersom jeg skal ha ulik operasjon pÃ¥ ulike objekter som importeres samtidig",NVDB-6938,Datafangst,
"""Tilkoblingslekasje"" mot oracle databasen","Jeg lager en sak her for Ã¥ ha en utviklersak som har tilknytning til problemet diskutert her: https://www.vegvesen.no/jira/browse/NVDBFOR-514 .

Det er altsÃ¥ slik at tilkoblingspoolen til databasen jevnlig blir stÃ¸rre. Det er altsÃ¥ slik at vi bruker koblinger direkte til databasen / via spÃ¸rredatabasen i noen sammenhenger selv om de aller fleste spÃ¸rringer gÃ¥r mot solr. Det finnes to databasekonfigurasjoner i utilities repoet (https://git.vegvesen.no/projects/NVDBDATA/repos/nvdb-utils/browse), den ene er basert pÃ¥ HikariCP mens den andre er en mer standard oracle tilkobling ( ? ). Ut i fra testing virker det som at det er Hikari som blir brukt, men konfigurasjonen som forteller at det skal vÃ¦re maks 10 tilkoblinger blir ikke respektert. Vi vet ikke hvorfor. 

Det kan vÃ¦re interessant Ã¥ ta opp trÃ¥den med Ã¥ sjekke debugloggingen fra noe som heter Dbix. Det virker som at den blir initialisert med nye datakilder ganske ofte. Her kan man feks. sÃ¸ke pÃ¥ ""ORIGIN=""Dbix"" NOT (""Removing session"" OR ""Opening new connection"" OR ""Calling openSession"") index=svvpnvdbapil"" i splunk.

Ut over dette tror vi at det kan ha noe med mengde trafikk Ã¥ gjÃ¸re, da antall koblinger vokser betydelig fortere i PROD-miljÃ¸et.

FÃ¸r vi fÃ¥r lÃ¸st denne saken bÃ¸r vi kjÃ¸re restart av prod-poddene med jevne mellomrom slik at vi fÃ¥r resatt mengden koblinger.
Da kan man feks. kjÃ¸re ""ac perform rolling restart b-nvdbapi-v3 -e produksjon-v3 -i nvdbapil""",NVDB-6937,Les-API,
Importere sensitive data over API,"Ved import av objekter med sensitive egenskaper fra API-lenke i Vegkart kommer disse inn som tomme felter i det importere objektet.

Sensitive egenskaper mÃ¥ kunne importeres.

Dersom brukeren mangler rettigheter til disse mÃ¥ det vises et varsel om dette (og valg om det skal importeres uten eller avbryte import).

Hva skjer dersom objektet importeres og sendes tilbake med tomme felt? Blir NVDB oppdatert med ny versjon uten disse egenskapene?",NVDB-6937,Datafangst,
NVDB-ID retur pÃ¥ status-endepunkt i API,,NVDB-6938,Datafangst,
Feil i SOSI-format,"Som bruker av Vegkart-eskport

opplever jeg at SOSI-eksporten i Vegkart ikke har samme format som eksport fra Datafangst eller GisLine.

Se Vedlagt sammestilling.

Standardene mÃ¥ vÃ¦re like i alle verktÃ¸y sÃ¥ de kan importeres og benyttes likt i alle vertÃ¸y.",NVDB-6937,Eksport,
ForespÃ¸rsel fra Nye Veier/Prevas,"Ã…rsaken til at vi ser etter en mÃ¥te Ã¥ fÃ¥ et komplett uttrekk fra Databasen med alle forekomster er at vi skal bygge en tilsvarende struktur i Nye Veier sitt _Digitale Driftssystem_ (*DDS*) som den dere har i *NVDB* i dag. Vi kan fÃ¥ det til ved Ã¥ hente ut bruddstykker av konfigurasjonen fra APIet og sette det sammen til en helhet. Allikevel tror vi at det vil vÃ¦re enklere om vi kan fÃ¥ et uttrekk hvor vi fÃ¥r en total oversikt over innholdet som vi kan bruke for Ã¥ automatisere konfigurering av oppsett i Infor *EAM*.

Â 

Nils Overgaard skrev fÃ¸lgende Ã¸nskeliste:
 * Liste over alleÂ *_Objekter_*Â (utstyr), inkludertÂ *Vegobjekt-ID*,Â *Beskrivelse*,Â *Type-ID**,*Â *Type Beskrivelse*Â ogÂ *Overordnet ID*Â Her trenger vi kun objekter som gjelder for Nye Veier.
 * Liste overÂ *_Objekttyper_*Â (klasser), mÃ¥ inneholdeÂ *Type-ID*Â ogÂ *Beskrivelse*
 * Liste medÂ *_Egenskapsfelt_*Â medÂ *Egenskapsfelt ID*,Â *Beskrivelse*Â ogÂ *Datatype*
 Hvis alle egenskapsfelt kun brukes pÃ¥ en objekttype, kan dette oppgis i denne listen medÂ *Type-ID.*Â Hvis ikke mÃ¥ det lages en egen liste over alle kombinasjoner avÂ **Â *Type-ID*Â ogÂ **Â *Egenskaps ID*
 * Liste medÂ *_Egenskapsfelt_*Â med verdier for alleÂ *Objekter*.Â  MÃ¥ inneholdeÂ *Objekt ID, Egenskaps ID*Â ogÂ **Â *Verdi*
 * Liste medÂ *_Egenskapsfelt Oppslagsverdier_*, som inneholderÂ *Egenskapsfelt ID**,*Â *Oppslagsverdi*Â **Â *ID*Â ogÂ *Beskrivelse*

Â 

Videre skal det opprettes en struktur i DDS etter KontraktsomrÃ¥de, Vegsystemreferanse, Strekning, Delstrekning, Objekt, Objekt. GÃ¥r det an Ã¥ trekke ut en komplett strukturtabell med ObjektIDer som viser Mor datter eller Overordnet Underordnet forhold? Vi vil da kunne bygge strukturen i DDS basert pÃ¥ dette. Dette var kobling som vi finner det vanskelig Ã¥ utlede i sin helhet fra API.

Â 

NÃ¥r det gjelder Vegobjekt-ID i DDS sÃ¥ tenker vi Ã¥ benytte den samme som i NVDB for objektene da dette er et sentralt nÃ¸kkelfelt og inngÃ¥r i alle relasjoner. For Ã¥ opprette nye objekter i DDS som ikke skal ligge i NVDB sÃ¥ trenger vi da Ã¥ bruke en nummerserie som ikke benyttes nÃ¥ eller i fremtiden av NVDB. Kan vi gÃ¥ ut fra at om vi starter nye nummer pÃ¥ f.eks 2.000.000.000 sÃ¥ vil det ligge utenfor det omrÃ¥det som vil bli benyttet av NVDB?",NVDB-6937,Les-API,Skriv-API
Tilgang til utv miljÃ¸ for Datafangst API,"*Fra:* Kjell HÃ¥land <[kjell.haaland@traftec.no|mailto:kjell.haaland@traftec.no]> 
 *Sendt:* torsdag 29. april 2021 10:07
 *Til:* Datafangst support <[Datafangst-support@vegvesen.no|mailto:Datafangst-support@vegvesen.no]>
 *Emne:* Datafangst

Â 

Hei,

Â 

Som driftsentreprenÃ¸r i veglys og elektrokontrakter Ã¸nsker vi Ã¥ gjÃ¸re en integrasjon mot datafangst.

Tanken er at vi fra vÃ¥rt interne system kan skrive til datafangst nÃ¥r vÃ¥re montÃ¸rer gjÃ¸r endringer pÃ¥ anlegget.

Â 

Hvordan gÃ¥r vi frem for Ã¥ fÃ¥ til en slik integrasjon?

Â 

Har dere ett utviklingsmiljÃ¸ for datafangst man kan fÃ¥ tilgang til?

Â 

Ser dere har ett docker-bilde for datafangst, men dette virker gammelt.

[https://hub.docker.com/r/nvdbapnevegdata/nvdb-datafangst/]

Â 

HÃ¸rer fra dere! ğŸ˜Š

Â 

Med vennlig hilsen / best regards,

Â 

*Kjell HÃ¥land*

Systemutvikler

[Otera Traftec AS|https://www.otera.no/]

Â 

E: [kjell.haaland@traftec.no|mailto:kjell.haaland@traftec.no]

M: +47Â 904 00 207",NVDB-6827,Datafangst,
Gi tilbakemelding pÃ¥ forespÃ¸rsel fra Nye Veier/Prevas,"Vi har fÃ¥tt henvendelsen under fra Prevas, via Nye Veier, som har behov for Ã¥ diskutere spÃ¸rsmÃ¥lene med noen pÃ¥ teamet ([~magnoy]Â & [~joslet]?). Dette er relatert til temaer som ble tatt opp i mÃ¸te arrangert av Espen Sveen den 23.4

Â 

Ta kontakt medÂ BjÃ¸rn Moland (Product Manager EAM,Â mailto:bjorn.moland@prevas.no), medÂ mailto:[bjornar.ostgaard@nyeveier.no|mailto:bjornar.ostgaard@nyeveier.no]Â ogÂ mailto:[espen.sveen@vegvesen.no|mailto:espen.sveen@vegvesen.no]Â pÃ¥ kopi.

Â 

-----

I forbindelse med nytt driftssystem skal Prevas tilrettelegge for NVDB data i Infor EAM. For Ã¥ fÃ¥ dataene pÃ¥ plass skal det bestemmes hvilke datafelt som skal tas i bruk i, hvilke attributter som skal tas inn, struktur og forholdet mellom objekter. Kan det tilrettelegges datauttrekk fra NVDB som inneholder mer informasjon om datamodellen enn det som kan hentes ut fra APIer?

- En ren liste med data under nye veier med alle objekter i en tabell.
- Liste med egenskapsdata for alle objekter
- Liste over objekttyper
- Liste med Egenskapsfelt med ID og datatype for alle felt
- Liste med oppslagsverdier for egenskapsfelt
- Tabell med relasjoner mellom Mor og Datterobjekter for alle objekter for Ã¥ bygge struktur.

Prevas spÃ¸r ogsÃ¥ om det finnes en nummerserie for NVDB som ikke er benyttet som Nye veier kan benytte uten at numrene kolliderer. Har NVDB objekter f.eks. alltid et fast antall siffer i nummeret?",NVDB-6937,Les-API,Skriv-API
Leveranseinformasjon Skriv 2021.5.0,"Saker i leveransen:Â [NVDB: Skrive-API 2021.5 - JIRA for Statens vegvesen|https://www.vegvesen.no/jira/projects/NVDB/versions/17892]

Â 

*Testes av SVV:*
 * NVDB-7036 : Sjekk at informasjonen gir en bedre indikasjon pÃ¥ hva som mangler i sÃ¸ket.

Â 

*Testes av Capgemini:*
 * NVDB-7068 : Send inn stedfesting som er nevnt i saken. FÃ¥ vellykket stedfestning innen 10 sekunder.
 * NVDB-7051 : GÃ¥ til generatoren og gjennomfÃ¸r noen oppfÃ¸rte tester.
 * NVDB-7031 : Last ned siste Docker-image og verifiser innlogging til kontrollpanelet.
 * NVDB-6935 : Datafangst sender inn for Ã¥ bekrefte at meldingen er forbedret.Â 

Â ",NVDB-6937,Skriv-API,
Feil i stedfest peaker CPU,"h2. Bakgrunn

Det har i en lengre periode vÃ¦rt hendelser som har fÃ¸rt til at CPU i miljÃ¸ene har gÃ¥tt rett i taket og faller ikke ned igjen. Normal CPU for skriv er mellom 0.01 og 0.4 pÃ¥ veldig hÃ¸y last. Hendelsen har forÃ¥rsaket CPU sÃ¥ hÃ¸yt som 4-5. Dette har tatt ressurser fra andre applikasjoner i SVV.
h2. Analyse

Analyse har blitt gjennomfÃ¸rt i NVDB-7059.
h2. Hendelse

Hendelsen som har blitt fanget opp er kall fra Datafangst som gÃ¥r til _*/rest/v3**/stedfest*_Â 

Har klart Ã¥ gjenskape feilen med Ã¥ gjenskape payloaden fra Datafangst:
 _<stedfestÂ xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">_
 Â Â _<parametere>_
 Â Â Â Â _<maksimalAvstandTilVeg>300</maksimalAvstandTilVeg>_
 Â Â Â Â _<beregnSideposisjon>true</beregnSideposisjon>_
 Â Â _</parametere>_
 Â Â _<vegobjekter>_
 Â Â Â Â _<vegobjektÂ typeId=""99""Â tempId=""509c2d70-4231-4843-85f1-b47222d5bfb3"">_
 Â Â Â Â Â Â _<gyldighetsperiode>_
 Â Â Â Â Â Â Â Â _<startdato>2021-04-22</startdato>_
 Â Â Â Â Â Â _</gyldighetsperiode>_
 Â Â Â Â Â Â _<egenskaper>_
 Â Â Â Â Â Â Â Â _<egenskapÂ typeId=""4798"">_
 Â Â Â Â Â Â Â Â Â Â _<geometri>_
 Â Â Â Â Â Â Â Â Â Â Â Â _<srid>25833</srid>_
 Â Â Â Â Â Â Â Â Â Â Â Â _<wkt>LINESTRINGÂ (164112.17Â 6604590.75,Â 164091.42Â 6604594.69,Â 164013.9Â 6604535.51,Â 163791.57Â 6604519.58,Â 163276.03Â 6604575.04,Â 163151.44Â 6604625.44,Â 163086.24Â 6604683.08,Â 163035.56Â 6604757.77,Â 162950.49Â 6605009.38,Â 162887.92Â 6605033.04,Â 162657.25Â 6605038.41,Â 162608.85Â 6605074.54,Â 162577.02Â 6605143.94,Â 162593.79Â 6605216.87,Â 162851.05Â 6605509.81,Â 162865.19Â 6605752.22,Â 162845.11Â 6605750.01,Â 162822.92Â 6605674.51,Â 162779Â 6605631.74,Â 162593.56Â 6605605.32,Â 162367.4Â 6605724.64,Â 162227.36Â 6605852.07,Â 162089.67Â 6605857.45,Â 161985.2Â 6605889.73,Â 161887.65Â 6605898.05,Â 161779.3Â 6605955.28,Â 161661.02Â 6605983.51,Â 161594.55Â 6606070.44,Â 161475.96Â 6606115,Â 161417.06Â 6606160.71,Â 161345.49Â 6606283.42,Â 161222.66Â 6606394.75,Â 160999.06Â 6606732.83,Â 160720.49Â 6606903.49,Â 160627.73Â 6606942.23,Â 160624.98Â 6607017.13,Â 160704.72Â 6607102.52,Â 160766.65Â 6607126.36,Â 160901.23Â 6607133.47,Â 161006.45Â 6607158.37,Â 161165.43Â 6607099.02,Â 161387.73Â 6606920.08,Â 161659.44Â 6606834.51,Â 161847.21Â 6606733.58,Â 161931.48Â 6606723.62,Â 161978.58Â 6606737.43,Â 162097.91Â 6606888.89,Â 162094.75Â 6606942.91,Â 162046.56Â 6607065.15,Â 162098.66Â 6607286.2,Â 162121.72Â 6607571.26,Â 162061.73Â 6607702.14,Â 161959.23Â 6607794.83,Â 161774.63Â 6607894.41,Â 161562.53Â 6607904.37,Â 161451.34Â 6608217.28,Â 161403.37Â 6608256.37,Â 161296.48Â 6608290.33,Â 161220.8Â 6608418.57,Â 161089.18Â 6608388.96)</wkt>_
 Â Â Â Â Â Â Â Â Â Â _</geometri>_
 Â Â Â Â Â Â Â Â _</egenskap>_
 Â Â Â Â Â Â _</egenskaper>_
 Â Â Â Â Â Â _<assosiasjoner/>_
 Â Â Â Â _</vegobjekt>_
 Â Â _</vegobjekter>_
 _</stedfest>_

Â 
Â  Dette fÃ¸rer til at requesten bare stÃ¥r Ã¥ henger Ã¥ fÃ¥r ingen respons.",NVDB-6937,Skriv-API,
Vise fagdata pÃ¥ historisk vegnett,"Jeg lovet Ã¥ gi en nÃ¦rmere beskrivelse av funksjonen i NVDB som gir oss mulighet til Ã¥ se en vegstrekning med bÃ¥de operativ og historisk vegtrase og tilhÃ¸rende fagdata.

Under innsyn â€“ hent nytt datasett og spesifisering av HVOR det hentes fra er det mulig Ã¥ legge inn en vegstrekning med hp og meter fra-til. Dette gjÃ¸res under Â«vegreferanser og gaterÂ».

Eksempel pÃ¥ en strekning vi vet er bygget om ser du nedenfor.

!Historisk vegstrekning i NVDB123-1.jpg!

Under HVA som hentes velger vi Â«trafikkulykkeÂ» og setter pÃ¥ et filter pÃ¥ periode.

Eks:

!Historisk vegstrekning i NVDB123-2.png!

Deretter trykker vi pÃ¥ Hent data fra NVDB og huker av for Ta med historisk vegnett og historiske fagdata (gjelder nedlagt/omlagt veg).

!Historisk vegstrekning i NVDB123-3.png!

Resultatet vises i kart pÃ¥ denne mÃ¥ten. Hvis du Ã¥pner data-tabellen vil du se at flere av ulykkene har *operativ vegreferanse=FV* og *historisk vegreferanse=EV*. Du vil altsÃ¥ finne eksempler pÃ¥ ulykker som har skjedd pÃ¥ ombygd veg i dette uttrekket.

!Historisk vegstrekning i NVDB123-4.jpg!

Til bruk i filter:

HVOR â€“ 0500 (fylke) Ev6 hp13 m3639 - 0500 Ev6 hp15 m15156 (Ny vegsystemreferanse: EV6 S46D1 m3639 - EV6 S48D1 m15728).

HVA â€“ Trafikkulykke.Ulykkesdato >= 20100101

Med hilsen
 Thea Merete VesterÃ¥s
 Mobil:Â +47Â 92444288",NVDB-6938,Les-API,
"Deaktivere knapp for lukking for ""EntreprenÃ¸r""","EntreprenÃ¸r som logger inn med e-post fÃ¥r valg om Ã¥ lukke data i NVDB.

!image-2021-04-20-09-58-52-153.png!

Det gir feilmelding Ã¥ trykke pÃ¥ knappen

!image-2021-04-20-09-58-10-784.png!

Knappen burde deaktiverast likt med innsending til NVDB for EntreprenÃ¸r",NVDB-6937,Datafangst,
Mulighet for Ã¥ hente ut NVDB ID fra Datafangst API,"Opprinnelig etterspÃ¸rsel fra volue.com:

Vi har en kunde som Ã¸nsker Ã¥ fÃ¥ vite nvdbid pÃ¥ de dataene som leveres via datafangst apiâ€™et. Jeg vet det er mulig Ã¥ hente nvdbid via Les apiâ€™et, men der er det ingen kobling mot en featurecollection som er levert datafangst.
 SÃ¥ er det noen som helst mÃ¥te Ã¥ fÃ¥ tilbake, enten nÃ¥r en sender inn en featurecollection eller i ettertid nÃ¥r en henter status pÃ¥ en featurecollection, Ã¥ fÃ¥ vite hvilken nvdbid et objekt fÃ¥r tildelt. â€“ Stig Vidar Hovland",NVDB-6937,Datafangst,
"Import av vegobjekter med ""NÃ¸yaktighet"" lik -1","Ved import av vegobjekter med ""NÃ¸yaktiget"" lik -1, mÃ¥ det endres til blank ("""") sÃ¥ det er mulig Ã¥ sende inn til NVDB.",NVDB-6937,Datafangst,
NÃ¸yaktighet og MÃ¥lemetode har ulovlige verdier,"*MÃ¥lemetode*

MÃ¥lemetode er satt til verdi 0 som ikke er tillat, dette mÃ¥ enders til verdi 99, som er ukjent mÃ¥lemetode.

*NÃ¸yaktighet*

Fra Datakatalogen skal NÃ¸yaktighet ha verdier mellom 0 og 99999, eller blank.

Det finnes flere innslag av -1 i samtlige miljÃ¸er. BÃ¸r endres til blank.

Eksempel pÃ¥ feil verdi: [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/15/240466141/2]

Â ",NVDB-6937,Database,
Estimat: Vidareutvikling produktfortefÃ¸lge,"Det er behov for en rekke stÃ¸rre eller mindre forbedringer i portefÃ¸lgen fremover.

Dette bÃ¸r vi fÃ¸re en oversikt over og tilhÃ¸rende overordnede lÃ¸sningsforslag og estimater for enkelt Ã¥ eventuelt samle til ""forbedrings-prosjekter"" som vi kan gjÃ¸re avrop pÃ¥ for Ã¥ fÃ¥ dedikerte ressurser etter prioritet og behov.

BÃ¸r kanskje vÃ¦re en Wiki likt med teknisk gjeld?

Eksempel pÃ¥ oppgaver som bÃ¸r ligge der (enkelte er estimert andre er ikke):
 * Elveg 2.0 (Endringsmelding 2021-1)
 * Import av Datakatalogen (Endringsmelding 2021-2)
 * Import av omrÃ¥degrenser (Endringsmelding 2021-2)
 * GML-stÃ¸tte i NVDB (Endringsmelding 2021-3)
 * Sensitive data i Vegkart (innlogging)
 * Historiske (datospesifikke) data i Vegkart
 * Forbedret SOSI i Datafangst
 * Forbedret API i Datafangst
 * Statistikkgenerator (makro) i NVDB
 * Inhousing Datafangst

Â ",NVDB-6940,,
UnngÃ¥ feil fra bean valideringen til Skriv,"Til vanlig sÃ¥ er det forventet at endringssett fra Datafangst blir sendt til Skriv og det blir registrert. NÃ¥ i det siste har det oppstÃ¥tt flere problemer med at endringssett ikke kommer inn Ã¥ blir registrert grunnet validering som skjer ved endepunktet. Dette er en en Bean Validering og vil returnere HTTP-400 med en feilmelding oppsatt ulikt enn hva som er forventet. Et eksempel pÃ¥ den type feilmelding er:Â 

_""registrer.vegobjekter[6].egenskaper[4].verdier[0].kvalitet.nÃ¸yaktighet: MÃ¥ vÃ¦re stÃ¸rre enn eller lik 0""_

Hvor meldingen sier at underÂ *registrer* er det vegobjektÂ *6* som har egenskapÂ *4* med en verdi som ikke er innenfor det datakatalogen tilsier. I dette tilfellet var det at egenskapenÂ _nÃ¸yaktighet_ varÂ *-1*.

Â 

Problemet har fÃ¸rt til flere supportsaker hvor bruker ikke vet hva som mÃ¥ endres, for Datafangst viser bar Beskrivelse:Â _Vegobjektene ble avvist fordi det ble funnet feil under validering_

Â 

Noe som er verd Ã¥ merke seg er at HTTP-400 med feilmelding blir returnert allerede etter fÃ¸rste forekomst. Dette betyr at om en bruker sender inn 100 vegobjekt med samme feilen sÃ¥ blir bare 1 returnert som feil, og den neste blir ikke vist fÃ¸r det blir sendt inn pÃ¥ nytt.

Grunnet dette vil det vÃ¦re mer hensiktsfult at det blir gjennomfÃ¸rt en input sjekk i DatafangstÂ *fÃ¸r* det blir sendt til Skriv. Det vil skape mindre frustrasjon hos brukeren. :)Â 

Â 

ForeslÃ¥r derfor Ã¥ implementere en sjekk for de to forekomstene som har fÃ¸rt til supportsak, og deretter plukke opp andre ""lÃ¸se trÃ¥der"" nÃ¥r det kommer inn supportsak.

Â ",NVDB-6938,Datafangst,
Bytte utgÃ¥ende brukere i tester + se pÃ¥ feilende live integrasjonstester,"Mange av integrasjonstestene og e2e tester benytter brukerer som er utgÃ¥ende. De mÃ¥ oppdateres til enten ""fjeslÃ¸se"" brukere eller benytte brukere til teamet i NVDB.",NVDB-6937,Skriv-API,
Oversikt over teknisk gjeld,"FÃ¥ en oversikt over teknisk gjeld i prosjektet.

Teknisk gjeld innebÃ¦rer fÃ¸lgende:
 * Refaktorisering
 * SÃ¥rbarheter
 * UtgÃ¥ende avhengigheter
 * Utfasede bibliotek og rammeverk
 * Dokumentasjon
 * Minnelekkasjer
 * Distribusjonsstrategi
 * OvervÃ¥king og logging

Â 
 DetteÂ dokumentetÂ vilÂ ikkeÂ inneholdeÂ tidsestimeringÂ forÂ utredelseÂ menÂ omfangetÂ vilÂ bliÂ kategorisertÂ medÂ tankeÂ pÃ¥ *risiko* og *arbeidsmengde*.
 Â 
 Dokumentet blir lagt til Wiki og saken blir oppdatert med link nÃ¥r dokumentet er ferdig.

Â 

[NVDB API SKRIV - Teknisk Gjeld - IKT - Forvaltning og videreutvikling - Confluence (vegvesen.no)|https://www.vegvesen.no/wiki/display/FoV/NVDB+API+SKRIV+-+Teknisk+Gjeld]",NVDB-6937,Skriv-API,
Flytte API Les Client,"Fra og med 01.05.2021 sÃ¥ vil ikke JFrog Bintray eksistere. V3 klienten til les ligger der og mÃ¥ derfor flyttes. [https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/]Â 

Â 

Alt annet i NVDB ligger i JFrog Artifactory, og vil ikke klienten ogsÃ¥ kunne legges inn der?

Â ",NVDB-6937,Les-API,
"Estimat: historisk og sensitiv data, faglig filter.","Vi mÃ¥ vurdere nye funksjoner i Vegkart og trenger skisse/estimat for utvikling av dette:
 * Historisk data (datospesifik).
 Legge til felt for Ã¥ skrive inn dato som Vegkart skal vise data i forhold til.
 * Sensitive data.
 Innlogging for Ã¥ vise sensitive data:
 ** Ved fÃ¸rste forsÃ¸k pÃ¥ Ã¥ vise sensitiv data. (fortrinnsvis)
 ** Kopi av Vegkart med innlogging.
 * Faglige filter
 Mulighet for Ã¥ filtrere basert pÃ¥ andre fagdata. For eksempel vise alle trafikkulykker pÃ¥ veg med fartsgrense 60 eller stÃ¸rre.",NVDB-6938,Vegkart,
Feilmelding vises nÃ¥r den ikke skal ved automatisk stedfesting der mor er i NVDB fra fÃ¸r,"Supportsak fra Raymond:
""Her skjedde det en feil igjen med stedfesting selv om de har like koordinater. Om feilen bare var at det hang pÃ¥ objektet som var hentet inn, at det kun mÃ¥tte hentes inn pÃ¥ nytt, eller om det var Operasjon Korriger som trÃ¸blet vet/husker jeg ikke fra sist, men jeg fikk det lagret til NVDB nÃ¥r jeg fjernet den med Korriger fra tabellen og hentet den inn igjen med Oppdater. Dog, nÃ¥r jeg sÃ¥ skulle stedfeste/vegtilknytte den pÃ¥ ny, byttet fra hovedvei til GangSykkelveg(GS-veg) for alle platene og skiltpunktet, sÃ¥ fikk jeg feilen under. Jeg har fÃ¥tt det tidligere ogsÃ¥, noen ganger er den reell andre ganger ikke, denne gangen ikke, men fint om den kun kommer opp nÃ¥r stedfestinga faktisk ikke ble flyttet automatisk. Litt smÃ¥pirk kanskje, men kan bli forvirrendeâ€¦""
 
!image-2021-03-29-15-06-05-480.png|thumbnail! ",NVDB-6937,Datafangst,
Ny SQL-funksjon for hÃ¥ndtering av vegnummer for privatveger,"Referer til sak: NVDB-6428Â forÂ Automatisk populere vegnummer i Vegsystem (915).

GjennomfÃ¸rt mÃ¸te med [~extt09]Â og [~trykra]Â og har vÃ¦rt gjennom Ã¸nsket funksjonalitet.

Â 

I *SKRIV* Ã¸nsker vi Ã¥ gjennomfÃ¸re et kall til:Â _nvdb.RoadSystemUtils.getNextFreePrivateRoadnumber( ? )_Â hvor fÃ¸lgende parameter erÂ _kommunenummeret_Â og den skal returnere et vegnummer som ikke er benyttet.

Â 

Vegnummer er et tall mellom 0-99999 hvor det starter pÃ¥ 99999 og blir dekrementert. Det er hull i lÃ¸penummeret som gjÃ¸r for eks. at 99920 er ledig men ikke 99917. MÃ¥ derfor sjekke i kommunen hvilke vegnummer som allerede er benyttet.",NVDB-6937,Database,
Brukertilpasset eksport,"*Fra:* Raymond KrossÃ¸y Hermansen <[raymond.hermansen@vtfk.no|mailto:raymond.hermansen@vtfk.no]> 
 *Sendt:* onsdag 24. mars 2021 11:08
 *Til:* Hans Anton Ã…lien <[hans.alien@vegvesen.no|mailto:hans.alien@vegvesen.no]>
 *Kopi:* Vilhelm BÃ¸rnes <[vilhelm.bornes@vegvesen.no|mailto:vilhelm.bornes@vegvesen.no]>; Knut Dammen <[knut.dammen@vtfk.no|mailto:knut.dammen@vtfk.no]>; TorbjÃ¸rn Gjendem <[torbjorn.gjendem@vegvesen.no|mailto:torbjorn.gjendem@vegvesen.no]>
 *Emne:* SV: Vegkart: Kritisk, dette er ikke bra!!!

Â 

Hei igjen.

Â 

AngÃ¥ende utfordringa i det vi mailer om her og det vi diskuterte per tlf. sist, sÃ¥ er det veldig mange fagpersoner som bÃ¥de legger inn data og som tar ut data, og ikke sÃ¥ mange av oss har kunnskapene som trengs for Ã¥ gjÃ¸re dette Â«riktigÂ» sÃ¥nn systemet i dag fungerer, det er komplisert, vi er alt for mange om det og uten god nok opplÃ¦ring. Selv erfarne NVDB folk sliter jo til en viss grad med Ã¥ huske alt. Er det noen mÃ¥te vi kan diskutere oss frem til en lÃ¸sning som vil serve flest mulig brukere best? Jeg prÃ¸ver meg pÃ¥ noen tanker, antakelser, forslag og Ã¸nsker under. PS! Sitter ikke pÃ¥ noen fasit.

Â 

*+Problemstillinger+*
 * Jeg tenker at det er vanskelig Ã¥ lÃ¦re alle NVDB-forvaltere Ã¥ legge inn data i NVDB _Â«helt riktigÂ»_ sÃ¥nn over natta, altsÃ¥ alt etter fÃ¸ringer gitt/nÃ¸dvendigheter for Ã¥ fÃ¥ riktige uttrekk o.l. Det kan f.eks. vÃ¦re at man bÃ¸r splitte alle strekningsobjekter i alle kryss og eventuelt i andre unaturlige veglenkeoverganger. Jeg mener det er viktig at vi prÃ¸ver Ã¥ forenkle sÃ¥ mye som mulig for Ã¥ sikre og unngÃ¥ muligheter for feilkilder.
 * I tillegg har vi andre fagfolk som Ã¸nsker Ã¥ legge inn data og som kan det enda dÃ¥rligere. Noen av de +mÃ¥+ legge inn data selv, da forvaltere ellers ikke har kapasitet til alt.
 * SÃ¥ har vi jo den at det kanskje ikke er Ã¸nskelig Ã¥ legge inn alle strekningsdata med splittelser ogsÃ¥â€¦?

 * VerktÃ¸y for mottak av data og innleggelse har ikke funksjonalitet til Ã¥ splitte, sy, lukke en splittet flate igjen, osv. for Ã¥ fÃ¥ dataene levert fra entreprenÃ¸r inn i NVDB pÃ¥ denne mÃ¥ten heller.

 * Burde vi hatt en godkjent opplÃ¦ring ala Matrikkelkurs for Ã¥ kunne fÃ¥ tilgang til Ã¥ fÃ¸re i NVDB? Da mÃ¥ selvsagt fÃ¸ringsinstrukser vÃ¦re pÃ¥ plass fÃ¸rst.


 * Det som ogsÃ¥ er vanskelig er Ã¥ informere og fÃ¥ alle til Ã¥ huske og forstÃ¥ at data som tas ut i excellister kan bli feil dersom man tenker Ã¥ summere opp i antall, lengde eller areal. Hva annet bruker folk disse listene til egentlig?
 * Antall og noen lengder kan vises riktig i kartvisninga og infoen i Vegkart, men spesielt areal, og mest sannsynlig noen lengder, vil man ikke kunne se riktig summerte tall pÃ¥ der. Derfor mÃ¥ vi ty til excel. Da er det viktig at det man ser der blir riktig for flest mulig brukere.
 * Vi som tar ut til kontraktutlysning vil nok fÃ¥ det riktig, for det meste, men for de som vil se ferske tall, se tall for kun et utvalg av forekomstene av et objekt e.l. vil ta ut nye lister og mest sannsynlig summere opp feil uten Ã¥ vite om det, veldig uheldig.

Â 

*+Tenkte lÃ¸sningsforslag+*
 * +Antakelse;+ I vegkart ville jeg tru at de fleste, spesielt ikke-fagpersoner, som vil ha ut en excelliste for oversikt over det filteret de har satt i kartet, kun vil se en telling av en forekomst, altsÃ¥ FÃ˜RSTE FOREKOMST=1.Â 
 * +Forslag pÃ¥ kort sikt;+ Kunne dere ha snudd pÃ¥ det, satt Standard filter i CSV-fila til FÃ˜RSTE FOREKOMST=1 sÃ¥nn at det automatisk viser kun en telling. Dersom folk da Ã¸nsker Ã¥ faktisk se alle tellingene av forekomsten og vegtilknytningene den har sÃ¥ mÃ¥ heller +de+ slÃ¥ av filteret eller filtrere pÃ¥ 0 verdien etter eget Ã¸nske.
 * +Forslag pÃ¥ lenger sikt;+ Kan det vÃ¦re riktig Ã¥ anta at det kun er interessant Ã¥ vise hvilke vegnumre som et objekt tilstÃ¸ter og ikke alle mulige veglenker? Med unntak av administrative objekter kanskje. I sÃ¥ fall hÃ¥per jeg at det burde vÃ¦re mulig Ã¥ ha en kolonneegenskap med tilknyttede vegnummer listet opp i, sÃ¥nn at forekomster vises med kun en linje samtidig som man kan se at denne forekomsten er tilknyttet flere veier. Verdi for kolonnen Vegnummer i disse tilfellene med flere vegtilknytninger kan da vÃ¦re Â«FlereÂ».
 * +Forslag pÃ¥ enda lenger sikt;+
 * GjÃ¸re det mulig Ã¥ ta ut flere typer rapporter i excel via Vegkart som sÃ¥nn sett lÃ¸ser problemet og informerer om hva den enkelte rapporten faktisk viser.
 * Ha visning av kart og tabell der man kan filtrere og summere pÃ¥ Ã¸nskede verdier i tabellen samtidig som man kan markere linje i tabell og fÃ¥ vist hvilket det er i kartet, og visa-versa. BÃ¸r ogsÃ¥ ha funksjoner som automidtstill tabellen til forekomst merket i kartet, og zoom til 1:1000 pÃ¥ forekomst markert i tabell ved dobbeltklikk, f.eks.
 * Dersom man tar ut info om kun en vei, vis i tabell og rapport/CSV at forekomster er tilknyttet flere veier ala _Â«forslag pÃ¥ lenger siktÂ»_ over.
 * Enda bedre er om det finnes en mÃ¥te Ã¥ la lÃ¸sningen selv Â«splitteÂ» forekomster som gÃ¥r over flere veier til to areal/lengder ved Ã¥ beregne avstand fra senterlinjene og bruke midtpunktet til Ã¥ splitte og sÃ¥nn sett beregne ut ny lengde/areal. Ser at denne kan vÃ¦re utfordrende Ã¥ fÃ¥ til, men hva vet jeg, derfor spÃ¸r jeg. Hadde vÃ¦rt den beste lÃ¸sningen om vi skal snakke om hva som er enkelt for oss alle med tanke pÃ¥ registrering og uthenting av informasjon.

Â 

Â 

Andre synspunkter som forklarer noen av Ã¸nskene over er at jeg mener det bÃ¸r vÃ¦re mulig Ã¥ finne mest mulig info i en og samme lÃ¸sning. Eventuelt at det er en smooth integrasjon mellom flere lÃ¸sninger som gjÃ¸r at man ikke mÃ¥ ta Ã¥ gjÃ¸re samme sÃ¸k, filter osv. pÃ¥ ny, men beholder det man gjorde der man startet sitt sÃ¸k etter info. Jeg vil egentlig gÃ¥ sÃ¥ langt som Ã¥ si at jeg synes det heller ville ha vÃ¦rt Ã¸nskelig Ã¥ fjerne muligheten for Ã¥ ta ut misvisende CSV- og SOSI-filer i Vegkart dersom det er tenkt at andre lÃ¸sninger kan/skal gjÃ¸re det pÃ¥ en mer tilrettelagt og riktig mÃ¥te. Vegkart viser jo mer eller mindre alle rÃ¥dataene i excel og ser veldig rotete ut for de aller fleste, i tillegg til feilkildene de har/kan ha.

Â 

Ring meg gjerne opp om det kan vÃ¦re fornuftig Ã¥ snakke mer rundt dette, men noen ganger er det lurt Ã¥ fÃ¥ det ned skriftlig ogsÃ¥, og jeg har satt noen pÃ¥ kopi som du ser.

Â 

Â 

Vennlig hilsen
 
 *Raymond KrossÃ¸y Hermansen*
 RÃ¥dgiver 
 Team geodata 
 Samferdsel, miljÃ¸ og mobilitet
 
 Mobil: [93 03 20 25|tel:93%2003%2020%2025]",NVDB-6938,Eksport,
Tilgang til forvaltnings grensesnitt,,,,
Fylke mangler,"h1. Supportmail fra Ã…smund Holen <asmund.holen@vianova.no>

Resultatfil fra Â«Egendefinerte rapporter â€“ Detaljert mengdeoversikt (V4)Â» Â inneholder ikke fylkesinformasjon. Dvs nÃ¥r man tar ut rapport for flere fylker i en spÃ¸rring sÃ¥ vet man ikke hvilket fylke data tilhÃ¸rer. Hadde vÃ¦rt greit med en egen kolonne som viser fylkeğŸ˜Š",NVDB-6937,Rapportgenerator,
Oppdater dokumentasjon - get_posisjon/EPSG6173,"h1. POB-sak fra Ole Johs.

Hei,
 
Ser pÃ¥: https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Posisjon/get_posisjon
 
 !image-2021-03-24-13-57-04-084.png!
 
Denne peker videre til:
utviklerkonferanse-2018/epsg6173.md at master Â· nvdb-vegdata/utviklerkonferanse-2018 Â· GitHub
 
Anbefaling for NVDB: EPSG-kode 6173: EUREF1989UTM33 og hÃ¸ydereferanse NN1954. Det foretas ingen tids- og/eller stedsavhengig koordinattransformasjon av data med antatt dÃ¥rlig nÃ¸yaktighet til/fra WGS1984 ved lesing eller skriving til NVDB. I lÃ¸pet av 2018 har alle norske kommuner gÃ¥tt over til det nye hÃ¸ydereferansesystemet NN2000. NN2000 vil tas i bruk som hÃ¸ydereferanse for NVDB innen 2020. Da vil EPSG-koden igjen endres.
 
Er dette litt utdatert?",NVDB-6937,Les-API,
Ta med NVDB sÃ¸kedato i metadata-delen av rapportene,"NÃ¥r jeg som entreprenÃ¸r eller driftskontrakt-ansvarlig tar ut vegnettsrapport, V2, V3, V4 eller tilstandsrapport Ã¸nsker jeg Ã¥ se hvilken dato jeg brukte i sÃ¸ket mitt. I dag ser jeg kun ""Utskriftsdato"", som angir nÃ¥r jeg latet ned data.Â ",,Rapportgenerator,
NÃ¸yaktighet er satt til -1 i NVDB,Hva er omfanget?,NVDB-6937,Datafangst,
Ikke overskriv prosjektreferanse dersom det eksisterer,"Ã˜nske om at refferanse-ID ikkje vert overskrive dersom det er deffinert eigen refferanse-ID pÃ¥ objektet i data-fanen.

!image-2021-03-25-12-38-23-184.png!
h2. Alternativ lÃ¸ysing:

Bytt ut dagens avhuking med radioknappar:
 * (Default) Fyll inn prosjektreferanse for objekt som ikke har det i kontrakten:
 * Overskriv prosjektreferanse pÃ¥ alle objekt:
 * Ikke oppdater prosjektreferanse.

[innput-felt med prosjektets referanse-ID som default]
h2. Tileggsendring:

Dersom prosjektreferanse oppdaterast ved innsending til NVDB, kan original ID stÃ¥ igjen i datafanene sÃ¥ den evt. kan korrigerast tilbake i NVDB ved feilregistrering?

Â 
h2. Analyse

Referanse-ID fra innstillingsfanen legger seg som default i feltet hvor man kan velge referanse-ID ved innsending til NVDB.

Skriver man inn prosjektreferanse i eksport-fanen vil denne overskrive prosjektreferanse i datafanen for alle innsendte objekter og Prosjektreferanse i NVDB, men ikke referanse-ID i kontrakta.

Â 
h2. LÃ¸sning

Valgte Ã¥ ikke gÃ¥ for alternativ lÃ¸sning, siden det vil innebÃ¦re endringer i Angular. Angular har jeg lite erfaring med og det vil fÃ¸re til mer teknisk gjeld.

Har endret sÃ¥nn at kun vegobjekter som ikke har noen prosjektreferanse i datafanen som fÃ¥r ny prosjektreferanse valgt i eksportfanen/innstillingsfanen. Det vil si at vegobjekter som blir importert fra vegkart og som allerede har en prosjektreferanse vil ikke fÃ¥ ny prosjektreferanse. Hvis man vil ha ny prosjektreferanse pÃ¥ de mÃ¥ man bruke datafanen. Vegobjekter der man manuelt har valgt prosjektreferanse vil heller ikke fÃ¥ overskrevet denne. Dersom vegobjekter skulle ha ""tom"" prosjektreferanse, altsÃ¥ at det finnes et prosjektreferanse-attributt i databasen, men at det inneholder en tom streng eller bare whitespace vil det bli overskrevet.

Funksjonen i backend er skrevet pÃ¥ en generell mÃ¥te sÃ¥nn at det vil vÃ¦re enkelt Ã¥ legge til overskriv-alle-prosjektreferanser-alternativ i frontend senere.

Tilleggsendringen er ikke implementert.",NVDB-6937,Datafangst,
Problemer med pÃ¥logging av EXTERNAL,"*Bakgrunn*

Olav Dahl Solstad Mar 02 15:20
 Vi er flere som sliter litt med Ã¥ komme inn pÃ¥ kontrollpanelet. Noen fÃ¥r ""Unauthorized"" nÃ¥r man prÃ¸ver Ã¥ gÃ¥ dit, mens andre fÃ¥r opp en side der man kan velge ""Ekstern bruker"" og automatisk blir logget inn som ""anonymous-external""

Â 

Olav Dahl Solstad Mar 12 10:23

Kom over den ""gamle"" urlen til kontrollpanelet - [https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel]Â Â - og der fÃ¥r man til Ã¥ logge inn med ekstern bruker

*Analyse*

*Unauthorized* kommer av utdatert IPlanetory-token som ligger i coockies og en wipe vil fjerne dette. Dette kommer av bruk av AAA-tjenesten. Denne funksjonalitet vil opphÃ¸re i nÃ¦r framtid.

Â 

*anonymous-external*Â kommer ved at bruker trykker pÃ¥ Ekstern innlogging og fÃ¸rer til automatisk redirect til kontrollpanelet somÂ *ANONYMOUS-EXTERNAL*.

Â 

TOKEN:Â eyJ0eXAiOiJKV1QiLCJ6aXAiOiJOT05FIiwia2lkIjoicTJIT3o5TlNka0wvYlRIT0EzRVp0NmxQb3BjPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhbm9ueW1vdXMtZXh0ZXJuYWwiLCJjdHMiOiJPQVVUSDJfU1RBVEVMRVNTX0dSQU5UIiwiYXV0aF9sZXZlbCI6MCwiYXVkaXRUcmFja2luZ0lkIjoiYjJmYjY2N2QtN2M3OC00NTdkLTkzOTMtMDZjYTYwNTFiMTQ2LTExNzAzODQ0NTAiLCJpc3MiOiJodHRwczovL3d3dy52ZWd2ZXNlbi5ubzo0NDMvb3BlbmFtL29hdXRoMi9yZWFsbXMvcm9vdC9yZWFsbXMvRXh0ZXJuYWwiLCJ0b2tlbk5hbWUiOiJhY2Nlc3NfdG9rZW4iLCJ0b2tlbl90eXBlIjoiQmVhcmVyIiwiYXV0aEdyYW50SWQiOiJMUEFKN2hfNW9RT3NTSzFwNWp4cENPbmg5NG8iLCJub25jZSI6IjZkMmFjYTgxMmFhNDQyMTU5ZWZhN2Y4M2Y2MzJmOTU3IiwiYXVkIjoiT0F1dGgyX252ZGJhcGlza3JpdiIsIm5iZiI6MTYxNjE2NTQyOSwiZ3JhbnRfdHlwZSI6InRva2VuIiwic2NvcGUiOlsic3Z2cHJvZmlsZSIsIm9wZW5pZCJdLCJhdXRoX3RpbWUiOjE2MTYxNjU0MjksInJlYWxtIjoiL0V4dGVybmFsIiwiZXhwIjoxNjE2MTk0MjI5LCJpYXQiOjE2MTYxNjU0MjksImV4cGlyZXNfaW4iOjI4ODAwLCJqdGkiOiJ5WV9tQ2Q1Q3gzWlpDUGVXNUJ3VFc1OUsxMFEifQ.ngfj-Q0zKunpuFAUtWqDOfvzIjTlvGYugx6NXaYX5weTauKzoejywtwTid6dtA8bbgNSaMyYqzEmL5A9T6vPXllWksZtiFoBEDCGVpyI4RFA_cFKgHX-QkSS_TkmJHCqYdGKUiFmrBOrQ6TcnBTFwI9hNXfprZ3-gdEivlET_A1scaJlAYGzUTPwoNTlwY8qRS9djx6W7lEVb86Gw9GJy1UMzjI474l4gJMiX-VnwErD6G7iOnwwRETBQfau5cqHj8-UMp_ZxxGimGRTtXXV-k8Rs04PimaL7Klr3XnKOSpgLQfc0X51-9HQIYnGLXwR1k00As6p0MbILMv47Psalw

Â 

Blir automatisk lagt til i URL.

Denne har informasjonen:Â 

{ ""sub"": ""anonymous-external"", ""cts"": ""OAUTH2_STATELESS_GRANT"", ""auth_level"": 0, ""auditTrackingId"": ""b2fb667d-7c78-457d-9393-06ca6051b146-1170384450"", ""iss"": ""https://www.vegvesen.no:443/openam/oauth2/realms/root/realms/External"", ""tokenName"": ""access_token"", ""token_type"": ""Bearer"", ""authGrantId"": ""LPAJ7h_5oQOsSK1p5jxpCOnh94o"", ""nonce"": ""6d2aca812aa442159efa7f83f632f957"", ""aud"": ""OAuth2_nvdbapiskriv"", ""nbf"": 1616165429, ""grant_type"": ""token"", ""scope"": [ ""svvprofile"", ""openid"" ], ""auth_time"": 1616165429, ""realm"": ""/External"", ""exp"": 1616194229, ""iat"": 1616165429, ""expires_in"": 28800, ""jti"": ""yY_mCd5Cx3ZZCPeW5BwTW59K10Q"" }

Â 

Har lokalisert hvor OIDC blir handert i Skriv. Kommer til Ã¥ gjennomfÃ¸re debugging for Ã¥ finne rotÃ¥rsaken automatisk redirect uten at bruker har fÃ¥rr skrevet inn brukernavn og passord.

Â 

Â 

Â ",NVDB-6937,Skriv-API,
Flere filtreringsmuligheter,"Inn fra support:Â  [tina.vestersager@vegvesen.no|mailto:support%C2%A0tina.vestersager@vegvesen.no]Â 

For fartsgrense filteret Ã¸nsker vi at man kan velge Â«mindre ennÂ» og Â«stÃ¸rre ennÂ». NÃ¥ er det kun Â«likÂ» og Â«ulikÂ». Det er behov for Ã¥ se vei med fartsgrense til og med 50km og tilsvarende fra og med 60km og hÃ¸yere. Â 

Â 

Legge til filtrering pÃ¥ ""stÃ¸rre enn"" og ""mindre enn""

Â 

Kontakt [tina.vestersager@vegvesen.no|mailto:Kontakt%C2%A0tina.vestersager@vegvesen.no]Â for Ã¥ sjekke om ny filtrering dekker behovet.Â 

Â ",NVDB-6937,Vegkart,
Endre navn pÃ¥ kontraktgruppe,"Ã˜nsker Ã¥ endre navnet pÃ¥ Â«Drift og vedlikehold vestÂ» til Â«SVV Drift og vedlikehold vestÂ».

Jan Vidar StrÃ¸msvold <jan.vidar.stromsvold@vegvesen.no>",NVDB-6938,Datafangst,
"Bekreft-knapp ved ""oppdater alle"" i datafanen","Legg til knapp for Ã¥ bekrefte likt med fjern fra kontrakt vd kopiering av eigenskap til alle objekt i Datafanen.

!image-2021-03-18-09-56-03-027.png!",NVDB-6937,Datafangst,
"Feil i visrute ""zoom til geometri""","Vi forsÃ¸kte Ã¥ finne denne veglenka* i kart ved Ã¥ hente ut geometrien** og bruke zoom til geometri i visrute***. Den tar oss derimot til helt feil sted pÃ¥ kartet.

Det korrekte omrÃ¥de kan sees her****. Denne veglenkesekvensen er ogsÃ¥ synelig i visrute om man navigerer dit manuelt.


{code:java}

* https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/1753933

** LINESTRING Z(-25730.63 6756565.13 8.112, -25718.3598632813 6756547.38964844 7.912, -25699.2202148438 6756524.37988281 7.712, -25681.3901367188 6756505.71972656 7.512, -25659.702 6756484.302 7.312)

*** https://nvdb-vegdata.github.io/nvdb-visrute/PROD/

**** https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-25663,6756510,15/hvor:~(vegsystemreferanse~(~'EV39S73D129M10))/vegnett:~'geometri+~()/valgt:1753933:5:9

{code}
",NVDB-6937,Les-API,
Support: Feil i json format,"""Hi there!
Recently got an exception by using nvdb-api-client v.1.15:
Caused by: java.lang.RuntimeException: Error processing""



""BRUTUS heavily uses NVDB services through nvdb-api-client and now we noticed fails at critical synchronization jobs between 2 systems.
 
We use nvdb-api-client version 1.15
 
All environments, including PRODUCTION affected.""



""Below is the stack trace from Splunk logs (PROD), from recent errors at 2021-03-12T00:00:36,212+0100
 
no.vegvesen.nvdbapi.client.exceptions.ClientException: HTTP error 200 for request bfefa8ec-2d35-ecd1-5fe1-f58b7abdb7ce:
 
Caused by: java.lang.RuntimeException: Error processing 
...
{JSON payload}
...
at no.vegvesen.nvdbapi.client.gson.GsonUtil.lambda$rt$9(GsonUtil.java:231) at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193) at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193) at java.util.ArrayList$Itr.forEachRemaining(ArrayList.java:901) at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801) at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482) at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472) at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708) at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566) at no.vegvesen.nvdbapi.client.clients.GenericResultSet.next(GenericResultSet.java:144) ... 13 common frames omitted Caused by: java.lang.IllegalArgumentException: *+navn did not contain a string.+* at no.vegvesen.nvdbapi.client.gson.GsonUtil.parseStringMember(GsonUtil.java:83) at no.vegvesen.nvdbapi.client.gson.RoadObjectParser.lambda$parseStreets$3(RoadObjectParser.java:219) at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193) at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193) at java.util.ArrayList$Itr.forEachRemaining(ArrayList.java:901) at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801) at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482) at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472) at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708) at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566) at no.vegvesen.nvdbapi.client.gson.RoadObjectParser.parseStreets(RoadObjectParser.java:220) at no.vegvesen.nvdbapi.client.gson.RoadObjectParser.parseLocation(RoadObjectParser.java:173) at no.vegvesen.nvdbapi.client.gson.RoadObjectParser.lambda$parse$0(RoadObjectParser.java:115) at java.util.Optional.map(Optional.java:215) at no.vegvesen.nvdbapi.client.gson.RoadObjectParser.parse(RoadObjectParser.java:115) at no.vegvesen.nvdbapi.client.gson.GsonUtil.lambda$rt$9(GsonUtil.java:229) ... 23 common frames omitted""

",NVDB-6937,Les-API,
Regelmessige mÃ¸ter 2021,"Oppgave for kontinuerlig fÃ¸ring av timer for regelmessige mÃ¸ter i 2021. Alle i teamet kan fÃ¸re timer pÃ¥ denne.

Eksempler
 * Daglige standups (Ã¥pne vegdata, forvaltning, NVDB team daglig mÃ¸teplass)
 * Grooming mÃ¸ter for alle produktene
 * Retrospektiv",NVDB-6940,,
Slette kontraktgruppe,"Ã˜nsker Ã¥ fÃ¥ fjernet kontraktsgruppen Â«Driftskontrakter region vestÂ»,

Jan Vidar StrÃ¸msvold <jan.vidar.stromsvold@vegvesen.no>",NVDB-6938,Datafangst,
Bruke navn i feilmelding om at objektet ikke har stedfesting som fullstendig dekkes av mor,"Eksempel pÃ¥ feilmelding vi fÃ¥r nÃ¥r et datterobjekt sin stedfesting ikke er fullstendig dekket av morobjektet:

Skiltplate (12-1-2021 10:40:45): Objektet har ikke stedfesting som fullstendig dekkes av morobjekt av type Skiltpunkt (95): tempId 08c6e9d7-aa5a-4019-ada4-420ff512ee12

Hvis mor ikke er i NVDB fra fÃ¸r fÃ¥r vi tilbake denne tempIden. Da kan ikke brukerne vite hvilket objekt det er snakk om. Denne brukes i datafangst kun for Ã¥ ha en id i databasen. GÃ¥r det an Ã¥ bruke navn/alias istedenfor sÃ¥nn som pÃ¥ datterobjektet?

!image-2021-03-11-15-10-41-789.png!",NVDB-6937,Skriv-API,
Endring av verdi i datafanen funker ikke,"Legge til verdier pÃ¥ enkelte vegobjekter feiler.

Fikk supportmail om at de ikke klarer Ã¥ legge inn verdier pÃ¥ to vegobjekter. Det gjelder de som er markert med feil pÃ¥ bildet.

PrÃ¸vde selv og fikk det ikke til jeg heller. PrÃ¸vde Ã¥ sette inn oppsettingsdato og endre pÃ¥ skiltnummer.

!image-2021-03-11-12-23-36-185.png!

Â 

Â 
h3. Hvordan reprodusere

Last inn vegobjekter som korriger: [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/96?segmentering=true&kartutsnitt=-49702.214%2C6622999.058%2C-49417.786%2C6623108.942&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

Endre verdien pÃ¥ skiltnummer pÃ¥ Skiltplate:745372148. Du vil fÃ¥ feil

Â 
h3. Analyse

Koden krasjer pÃ¥ linje 134 i AttributeAutoCorrector
{code:java}
String value = fa.getValue().trim();
{code}
fordi fa.getValue() er lik null.



Det er verdien pÃ¥ attributtet ""Tekst"" som er satt til null. Attributter som er tomme pleier egentlig ikke Ã¥ ligge i datafangst-databasen i det hele tatt. Denne blir lest ogsÃ¥ nÃ¥r andre attributter blir oppdatert. Da krasjer koden, man fÃ¥r feilmelding og Ã¸nskede attributter blir ikke oppdatert.

Verdien av tekstfeltet kan derimot endres. Da kan man lÃ¸se problemet enkelt ved Ã¥ legge pÃ¥ tekst og fjerne den etterpÃ¥.

Objektet sÃ¥nn det ser ut fra LES:

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/96/745372148/1]

Da ser egenskapstypen slik ut:
<egenskap>
<id>1910</id>
<navn>Tekst</navn>
<egenskapstype>Tekst</egenskapstype>
<datatype>Tekst</datatype>
</egenskap>
Â 
Den mangler verdi. Skal datafangst kunne hÃ¥ndtere dette eller er det en feil i NVDB?",NVDB-6937,Datafangst,
SOSI-eksport av leverte data,"I dag kan data under behandling eksporterast til SOSI i Eksport-fanen, men sÃ¥ snart det er levert til NVDB er det ikkje mogleg lenger. Det er Ã¸nske om Ã¥ kunne eksportere leverte data og, til dÃ¸mes for vidare import for leveranse til FKB.

Â 

Slik det er i dag mÃ¥ det vÃ¦re endring pÃ¥ et objekt av vegobjekttypen for at en skal kunne laste ned sosi-fil.

En supportsak fra Olav LÃ¸berg:

Han Ã¸nsker Ã¥ kunne laste ned Sosi fra FKB filen i eksportfanen men dette er ikke mulig.",NVDB-6937,Datafangst,
580-KontraktomrÃ¥de mangler vegsegmenter,"I SINUS infra er vi nÃ¥ i test med det nye opplegget for Ã¥ opprette/redigere/slette objekter med mange stedfestinger (vegsystemreferanser). Vi har bla. brukt Vinterdriftsklasse i vÃ¥r testing og det fungerer nÃ¥ fint med svÃ¦rt mange stedfestinger.

NÃ¥r vi gÃ¥r lÃ¸s pÃ¥ kontraktsomrÃ¥der ser denne objekttypen veldig annerledes ut enn Â«normaleÂ» objekttyper i Datakatalogen/NVDB. Derfor har vi noen spÃ¸rsmÃ¥l om KontraktsomrÃ¥de (580).

Eksempel fra V3-Les-Test: [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/580/316720625/1.json?inkluder=alle]

Hvorfor mangler vegsegmenter for objekter av typen kontraktsomrÃ¥de (580)? VÃ¥rt opplegg for Ã¥ hÃ¥ndtere sÃ¥nne store objekter er avhengig av vegsegmentene for Ã¥ kunne hÃ¥ndtere koblingen mellom veglenkene og stedfestingen. Endrer brukeren pÃ¥ en stedfesting mÃ¥ vi vite hvilke veglenker dette pÃ¥virker.

Er det spesiell behandling av 580 sammenlignet med 810 i Les/IND

Sigmund Fredriksen <Sigmund.Fredriksen@triona.no>",NVDB-6937,Les-API,
Fikse feilmeldinger i gradle tasks,"Flere javadoc-relaterte gradle tasks spytter ut feilmeldinger under bygging. Dette er generelt enkle feil som omhandler Ã¥ definere parametere og returtyper. I tillegg kan gradle-versjonen fint oppdateres, som mulig medfÃ¸rer enkle endringer. Dette ble sist gjort 16.10.2020.
{quote}[NVDB Reader Â» master #1222 Console [Jenkins]|http://svvunvdbbuild02:8080/jenkins/view/NVDB%20API%20Les/job/NVDB%20Reader/job/master/1222/console]
 ...
 /var/opt/vegdata/jenkins_home/workspace/NVDB_Reader_master/modules/nvdbind-cache/src/main/java/no/vegvesen/nvdbind/cache/h2/RoadSystemSectionLookup.java:94: warning: no @param for period
 public List<RoadSystemSection> getByPosition(long nid, double pos, Period period) {
 ...
{quote}

 Det ble tidligere diskutert om javadocs skal fjernes helt, men med tanke pÃ¥ at vi allerede har en god del implementasjoner av det i koden, synes jeg det skal viderefÃ¸res. I tillegg er dette en mÃ¥te Ã¥ fÃ¥ bedre kontroll pÃ¥ koden nÃ¥ i startfasen av overtagelsen.",NVDB-6938,NVDB-IND,
Fikse feilmeldinger i gradle tasks,"Javadoc-tasks, blant annet, gir flere feilmeldinger under bygging, se f.eks siste kjÃ¸ring:

[NVDB Reader Â» master #1222 Console [Jenkins]|http://svvunvdbbuild02:8080/jenkins/view/NVDB%20API%20Les/job/NVDB%20Reader/job/master/1222/console]
...
/var/opt/vegdata/jenkins_home/workspace/NVDB_Reader_master/modules/nvdbind-cache/src/main/java/no/vegvesen/nvdbind/cache/h2/RoadSystemSectionLookup.java:94: warning: no @param for period
    public List<RoadSystemSection> getByPosition(long nid, double pos, Period period) {
...",,,
Riksvegrute overlapp med versjon -1337,"Under full reindeksering pÃ¥ fredag dukket det opp mange feil som gikk pÃ¥ overlapp av riksvegruter i sammenheng med segmentering. Alle listede riksvegruter har versjon -1337, som er ganske mystisk. Denne verdien er typisk brukt som en dummyverdi.

Eksempel:
{code:java}
2021-03-05 16:19:12 [segmenter (02)] ERROR NetComponentBuilder - Error segmenting RefLinkPart(3, MAIN, 0.01755057 - 0.97915625@2522155) by [ConnectedRoute{id=495608796, version=-1337, netelemid=2522155, startPos=0.01755057, endPos=0.97915625, startDate=2015-05-27, endDate=null}, ConnectedRoute{id=495608796, version=-1337, netelemid=2522155, startPos=0.01755057, endPos=0.97915625, startDate=2021-01-01, endDate=null}] caused by overlap detected: ConnectedRoute{id=495608796, version=-1337, netelemid=2522155, startPos=0.01755057, endPos=0.97915625, startDate=2015-05-27, endDate=null} and ConnectedRoute{id=495608796, version=-1337, netelemid=2522155, startPos=0.01755057, endPos=0.97915625, startDate=2021-01-01, endDate=null}
{code}
",NVDB-6937,Les-API,
Prosjekt EPIC - For alle oppgaver relatert til Administrasjon NVDB,,,,
Prosjekt EPIC - For alle oppgaver relatert til Beredskap NVDB,,,,
Prosjekt EPIC - For alle oppgaver relatert til Utvikling NVDB,,,,
Prosjekt EPIC - For alle oppgaver relatert til Forvaltning NVDB,,,,
Mer brukervennlig feilmelding ved stedfesting pÃ¥ veglenkesekvens som ikke er gyldig i hele objektets gyldighetsperiode,"Lurer pÃ¥ om det er mulig Ã¥ forbedre feilmeldingen som kommer nÃ¥r man sender inn objekt som er stedfestet pÃ¥ veglenkesekvens som er lukket.

Eksempel pÃ¥ feilmelding man kan fÃ¥:

85346722: Vegobjektet er stedfestet pÃ¥ segment [0.38149528, 0.38149528] av veglenkesekvens 72155, som ikke er gyldig i hele vegobjektets gyldighetsperiode: 1950-01-01 - >


Denne var vanskelig Ã¥ forstÃ¥ for meg. FÃ¸rst trodde jeg ""1950-01-01 - >"" var gyldighetsperioden til veglenkesekvensen.


Er det relevant hvor pÃ¥ veglenkesekvensen vegobjektet er stedfestet? Denne informasjonen tror jeg gjÃ¸r det vanskeligere Ã¥ forstÃ¥ hva feilmeldingen sier.Â Jeg blir dobbelt-forrvirra nÃ¥r dette er et punkt, skrevet som om det skulle hatt utstrekning. Som i eksempelet: ""[0.38149528, 0.38149528]"".


Jeg synes heller ikke det er Ã¥penbart at 85346722 er vegobjektet som gjÃ¸r at endringssettet feiler.


Min drÃ¸mme-tilbakemelding hadde kanskje vÃ¦rt noe sÃ¥nt som ""Vegobjektet 85346722 kunne ikke sendes inn til NVDB fordi det er stedfestet pÃ¥ en veglenkesekvens som ikke er gyldig i hele vegobjektets gyldighetsperiode. Veglenkesekvensen 72155 er gyldig fra og med 01.01.1950 til 01.01.2009. Vegobjektet er gyldig fra og med 01.01.1950 og fram til det oppdateres eller lukkes.""",NVDB-6937,Skriv-API,
Leveranseinformasjon,"*Testes av SVV:*
 * NVDB-6455Â -Legg til bruker: Sjekk at en kan sÃ¸ke pÃ¥ brukere som ikke er i kontrakten. (se kommentarer)
 * NVDB-6476Â -SjekkÂ  at spinner i chrome (nÃ¥r du laster inn datafangst kontrakt eller lignende) er i hÃ¸yere opplÃ¸sning enn fÃ¸r (se skjermdump)
 * NVDB-6480 -Sjekk at en kan navigere i dataen med piltastene i datagriden og merket celle vises i vinduet (i en kontrakt med mange vegobjekter)
 * NVDB-6481 -Sjekk at ""gyldig fra data"" er fjernet fra modalt vindu ved nedlastning av SOSI-fil (export)
 * NVDB-6511Â -Sjekk stavefeil ""GjenomfÃ¸res"" er rettet opp ved feilmelding i datafangst.
 * NVDB-6532 -Sjekk i sammenkoblingsfanen at egenskaper vises pÃ¥ en linje, ikke brekker ved listeverdier og har annenhver hvit og grÃ¥ linje.
 * NVDB-6899Â -Sjekk at en kontraktsgruppe har en ""gul boks""Â  som vises nÃ¥r ingen kontrakt er lagt til og en ""gul boks"" nÃ¥r de ingen brukere er lagt til.Â  Sjekk ogsÃ¥ at disse fjernes og blir lagt til dersom en fjerner/legger til brukere i kontrakten
 * NVDB-6541Â -Sjekk at en fÃ¥r samme stedfesting ved kopiering av vegobjekt. Sjekk ogsÃ¥ at ny dialogboks vises ved kopiering til ny objekttype (fortsatt samme stedfesting men uten egenskaper).
 * NVDB-6894Â -Verifiser at changeloggen viser riktig dato til release. (sjekk ATM nÃ¥) og at den settes riktig i prod ved release.
 * NVDB-6891Â -Sjekk at fanemenyen pÃ¥ venstre side ikke blir deaktivert(grÃ¥et ut) nÃ¥r en har vegobjekter i kontrakten.Â  NB: Denne fikser ikke hele problemet. Vi ser etter en mÃ¥te Ã¥ fÃ¥ reprodusert denne pÃ¥.
 * NVDB-6535 -Sjekk at en fÃ¥r beskjed om mor/datterobjekt mÃ¥ registreres inn i samme endringssett

I denne versjonen oppdaterer vi blant annet Java, NPM pakker og SQL DSL-bibliotek. Test grundig at flyt( i datafangst funker som normalt.

*Testes av leverandÃ¸r:*
 * NVDB-6533Â -Sjekk i console at riktig kall sendes ved sammenkobling til mor i NVDB (2 GET og to OPTIONS)
 * NVDB-6516Â -Sjekk at godkjenning av innsendt stedfesting ikke gir dirty vegobjekt.
 * NVDB-6517Â -Sjekk at innsending med dirty ute av sync gir systemfeil.
 NVDB-6906 - Sjekk at en ikke fÃ¥r konsollfeil om ikke-unik ID til barna i kontrakten.

*Saker som ikke teste manuelt i ATM:* 
* NVDB-6914 -Oppgradere Java avhengigheter
* NVDB-6548 -Ta i bruk oppdaterte SQL DSL bibliotek
* NVDB-6518 - Oppgradere NPM pakker
Sjekk at flyt fungerer som normalt",NVDB-6937,Datafangst,
Kartlegge erstatning av Makroer i Klassisk,"Klassisk har enkelte makroar for Ã¥ berekne verdiar basert pÃ¥ andre data i NVDB.

[~hansal]Â kan oppdatere kva for makroar som finst i Klassisk ut over Skredpunkt?

Kartlegge dokumentasjon av desse makroane.
 # Skaffe oversikt over makro
 # Beskrive funksjon
 # Vurdere om funksjon skal vedarefÃ¸rast

I tillegg vurdere implementasjon.
 * Gensesnitt i skriv
 * Eget kontrollpanel

Duplikat fra NVDB-2827

Tilsvarende makeNextPass i Klassisk NVDB.

Dokumentasjon fra API Skriv sitt utviklingsprosjekt:

Fra Tor Storruste, Triona;

Det finnes et opplegg som genererer statistikkobjekter basert pÃ¥ innsjekkede data. Jeg klipper inn fra systemdokumentasjonen:
Â«Statistikktjenesten er en tjeneste som finnes pÃ¥ server, og som har til hensikt Ã¥ generere statistikk ut fra predefinerte statistikkdefinisjoner og en eksekvert task.
Nye og/eller endrede objekt som er sjekket inn gjennom eksekvert task blir krysset mot de predefinerte statistikkdefinisjonene, og dersom disse objektene medfÃ¸rer endringer i statistikken vil tidligere statistikk slettes, og ny statistikk beregnet, hvor det er behov for dette.Â»
Det som skjer er at nÃ¥r fagdataredigeringsoppdrag sjekkes inn til serveren, kontrolleres det om noen av de berÃ¸rte fagdatatypene er aktuelle for de avledete typene. Det vil si at om fagdatatypen 540 (trafikkmengde) oppdateres, vil det vÃ¦re aktuelt Ã¥ regenerere statistikkobjekter for type 643 (Statistikk, trafikkmengde). Det opprettes da en task som settes til Ã¥ utfÃ¸res i fremtiden hvor regenerering av aktuelle statistikkobjekter skjer. Denne tasken plukkes opp av et program pÃ¥ serveren som heter ScheduledTaskExecutor. Den spÃ¸r databasen med jevne mellomrom om det er noen oppgaver som skal utfÃ¸res, og utfÃ¸rer alle den finner. SÃ¥ venter den en liten stund fÃ¸r den prÃ¸ver igjen.
Selve genereringen av statistikkdata skjer i en C++-tjeneste pÃ¥ serveren. Den henter ut de aktuelle Â«kildeobjekteneÂ», utfÃ¸rer beregninger og genererer avledete objekter.
Hvor-delen i oppgaven hentes fra hvor-delen i fagdataredigeringsoppdraget som ble sjekket inn. Hva som skal gjÃ¸res hentes fra hvilke objekttyper som ble sjekket inn. Funksjonaliteten som bygger opp oppgavene som skal utfÃ¸res ligger definitivt utenfor databasen, men for Ã¥ fortelle nÃ¸yaktig hvor mÃ¥ jeg eventuelt lete det frem i kildekoden, da jeg ikke har jobbet med dette selv. Antageligvis ligger funksjonaliteten et sted i C++-koden pÃ¥ serversiden.
Jeg forhÃ¸rte meg litt rundt for Ã¥ vÃ¦re sikker pÃ¥ at det ikke er noen del av systemet jeg ikke har vÃ¦rt borte i som gjÃ¸r det. SÃ¥ langt jeg har funnet ut, blir ikke andre objekt-/egenskapstyper enn statistikktypene oppdatert automatisk. Andre avledete objekt-/egenskapstyper blir altsÃ¥ ikke gjort noe med.

Fra Eivind Nilsen, Triona:

Skredpunkt(824) har ogsÃ¥ egenskaper blir oppdatert automatisk..
Det laget regler for at Holdeplassutrustning(487) ogsÃ¥ skal oppdateres automatisk, men jeg er usikker pÃ¥ om dette er driftsatt eller om det testes av kunde.
En vesentlig forskjell mellom disse og statistikkobjektene, er at disse oppdateres, mens statistikkobjektene blir slettet og det blir opprettet nye.",NVDB-6937,Skriv-API,
"Tilstandsrapport fane ""Kommentar"" har vegreferanse i ""Beskrivelse""-feltet","Ved gjennomgang av tilstandsrapport fant vi ut at fanen ""297 - *Kommentar*""Â -Dokumentasjon-"" (EDIT: Feil objekttypenavn) har vegreferanser i fanen ""Beskrivelse"", i stedet for egenskapverdier hentet fra 297-objektet.Â 

Eksempel: For k.omrÃ¥det 9305 Sunnfjord 2021-2026 sÃ¥ har objektetÂ 78782429 egenskapverdienÂ _Beskrivelse =Â UtlÃ¸p i fjorden,_Â men i tilstandsrapporten sÃ¥ stÃ¥r det _Beskrivelse=RV5KS4D30M2400_.Â 

Mistenker at dette er navnekollisjon med kode vi eksperimenterte med i fjor, hvor vi sammenfattet vegreferansen pÃ¥ denne mÃ¥ten i feltet ""Beskrivelse"". Slik sett kan dette problemet gjelde alle objekttyper med egenskapsnavn ""Beskrivelse"".Â ",NVDB-6827,Rapportgenerator,
Endepunkt /vegnett/veglenkesekvenser/segmentert mangler data,"Hei,
 
I forbindelse med TNE3 henter jeg hver natt ned data far /vegnett/veglenkesekvenser/segmentert
(https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?historisk=true?antall=500)
 
Jeg opplever at jeg mangler data nÃ¥r jeg sammenstiller resultatet i TNE3 i etterkant, mangler data for noen lenker. Jeg trenger derfor Ã¥ vite hvordan endepunktet fungerer. 
 
Er dataene alltid komplette? Gis det alltid data for alle lenker som finnes i NVDB, eller det etterslep i segmenteringen som gis?
 
Startet f.eks uthenting:
 
2021-02-19 12:47:23,405 INFO NvdbExporter - X-Client-Session for job: a8b9a6ee-d379-45d0-bf4b-a0802944fbc0
 
Dette er jo en jobb som bruker over to timer, henter 500 stk. i Â«delerÂ»:
 
2021-02-19 12:47:23,998 INFO NvdbExporter - Call to https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?historisk=true?antall=500 completed in 0,4843819. Status of result was Ok
2021-02-19 12:47:24,342 INFO NvdbExporter - Call to https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?historisk=true%3Fantall=500&start=A5421GTyTMu2rgs7ithAWd9zo2CUAdoErEsjwRwqvY7hRMTezzmMzXL8Vgm4ADnVyuDRXpVtAbCGb42ajFAzHiFapKks5SXCqpHqcdf3LuGBPqqHeVaTMsvcLtPwqnPfgh8Zmpa53vkubrtJrk8bS7FpvzqnapocBqtp completed in 0,3437409. Status of result was Ok
2021-02-19 12:47:24,673 INFO NvdbExporter - Call to https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?historisk=true%3Fantall=500&start=A5421GTyTMu2rgs7ithAWfQVpsifBsD3hrj4dyDFPMfKxT4uZddygmeHnhxrmM62akW6hKoWdodnxFkP1oz7SciuEVJ74wxxgpZ8jjyN8wS1fNXosFc3Ap15TX6sCjK4cFZAQAVzRm5Gp9JzpXAk9E5FUNoqL9X5FScU completed in 0,3306551. Status of result was Ok
2021-02-19 12:47:25,001 INFO NvdbExporter - Call to https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?historisk=true%3Fantall=500&start=A5421GTyTMu2rgs7ithAWimYHpavdw3pWgY9xVEAy9hxqEDUoihsPt8rqNjSMoEvcRcfDyAhoLj4ABsWuM5gBsYNEkK12sBv78CaDB3nRs6GWKZtfE7G7Cxj8cEwpRLQbtV4J3EkidKtD15cqjCSa8zbVH7T3P6umsR6 completed in 0,3281186. Status of result was Ok
.
.
.
.
Er det da datene som var i endepunket 2021-02-19 12:47:23,405 som vil bli gitt ut? Hvordan fanges eventuelt opp data endringer som inntreffer i tidsrommet jobben med Ã¥ hentet data tar?
 
Ser ogsÃ¥ at jeg fanger opp, det som oppfattes som dataavvik av TNE3:
2021-02-19 15:01:23,386 INFO NvdbExporter - Segmented network part with id 3243697, linknumber 8, segmentnumber 5 has no section, crossroadsystem or sidesystem. Removing from import
2021-02-19 15:01:23,386 INFO NvdbExporter - Segmented network part with id 3243697, linknumber 9, segmentnumber 5 has no section, crossroadsystem or sidesystem. Removing from import
2021-02-19 15:01:23,386 INFO NvdbExporter - Segmented network part with id 3243697, linknumber 10, segmentnumber 5 has no section, crossroadsystem or sidesystem. Removing from import
 
Hvordan betrakter NVDB Â«has no section, crossroadsystem or sidesystem"" er det tillatt? 
 
 
Mvh. Ole Johs.",NVDB-6937,Les-API,
Oppdatere DaKatLite,"Datakatalogen Lite ([Nasjonal vegdatabank Datakatalog|https://datakatalogen.vegdata.no/]) er basert pÃ¥ v2 og delar av funksjonaliteten er alt ute av drift. Den mÃ¥ oppdaterast og endrast til v3.

Ser to alternativ her:
 # Oppdatere dagens produkt til v3 og reparere knekt funksjonalitet
 # Utvikle ny versjon basert pÃ¥ DaKat i Vegkart.

!image-2021-02-26-09-43-37-377.png!!image-2021-02-26-09-44-12-604.png!",NVDB-6937,Vegkart,
Kaskadefjerning av morobjekt fjerner ikke datterobjekt,"h2. Observasjon

Sigmund Fredriksen (Trion/Sinus) spÃ¸r: Vi har et spÃ¸rsmÃ¥l om sletting av Â«ikke-tidsromrelevanteÂ» objekter, som f.eks. trafikkulykke. Pr. i dag har vi bare LUKK med angivelse av lukkedato i SINUS infra. For Â«ikke-tidsromrelevanteÂ» objekttyper antar vi at FJERN skal brukes, og vi bruker KASKADEFJERNING PÃ….

{code:json}
{
  ""fjern"": {
    ""vegobjekter"": [
      {
        ""kaskadefjerning"": ""JA"",
        ""typeId"": 570,
        ""nvdbId"": 85174545,
        ""versjon"": 1
      }
    ]
  },
  ""status"": {
    ""mottatt"": ""2021-02-17T08:38:03.226"",
    ""fremdrift"": ""AVVIST"",
    ""fremdriftOppdatert"": ""2021-02-17T08:38:12.76"",
    ""kanselleringBestilt"": false,
    ""avvistÃ¥rsak"": ""VALIDERINGSFEIL"",
    ""eier"": ""sigmfred"",
    ""klient"": ""NVDB API Skriv Generator"",
    ""apiversjon"": ""3"",
    ""transaksjon"": {},
    ""ressurser"": [
      {
        ""rel"": ""endringssett"",
        ""src"": ""https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/8e4789e5-3cbf-4f78-9495-8fec680b69b2""
      },
      {
        ""rel"": ""self"",
        ""src"": ""https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/8e4789e5-3cbf-4f78-9495-8fec680b69b2/status""
      }
    ]
  },
  ""datakatalogversjon"": ""2.23"",
  ""id"": ""8e4789e5-3cbf-4f78-9495-8fec680b69b2""
}]]>
{code}

Type	Kode	Melding
  Feil	MANGLER MOROBJEKT	Objektet er av en type som krever morobjekt, men det har ingen: VEGOBJEKTTYPE=571; ID=85174546; VERSJON=1; STARTDATO=1996-09-10; SLUTTDATO=null

Varsler for vegobjekter
Feil (1)
Id	Operasjon	Type	Kode	Melding
85174545:1	Fjern	  Feil	DATTEROBJEKT UTEN MOR	Objektet har et datterobjekt som ogsÃ¥ mÃ¥ lukkes: Datterobjekt av type 571, id 85174546, versjon 1 har gyldighet etter morobjektets sluttdato 1996-09-10

Er dette en feil i SKRIV?",NVDB-6937,Skriv-API,
Systemfeil: ORA-01795: maximum number of expressions in a list is 1000,"h2. Bakgrunn

FÃ¸lgende feilmelding kom pÃ¥ e-post fra en superbruker. Jeg har fortalt ham at dette er en begrensning som gjelder alle miljÃ¸er. Han Ã¸nsker egentlig muligheten for stÃ¸rre endringssett.

Hvordan kan vi hjelpe ham? Feilen bÃ¸r i det minste hÃ¥ndteres bedre.

Hei Hans Anton!

Jeg har i det siste jobbet med Ã¥ lage ei lÃ¸ype som tar for seg alle lenker og noder innenfor en kommune, og tildeler alle oppdatert Z-verdi. LÃ¸ype henter inn vegnettet fra STM og draperes over pÃ¥ en hÃ¸ydemodell, slik at vegnettet blir da mest mulig korrekt i 3D, uten at en gjÃ¸r noen endring i XY-grunnrisset.

LÃ¸ypa fungerer enkelt forklart slikt:

Henter lenkesekvenser og noder fra nvdbapiles-v3-stm.utv â€“ filtrerer ut historiske lenker og lenker med medium + noder i mellom. Sender alle lenker og noder gjennom en draperingsfunksjon for Ã¥ hÃ¸ste inn Z-verdi fra hÃ¸ydemodellen. HÃ¥ndterer historikk i noder som fÃ¥r oppdatert z-verdi ved Ã¥ kun oppdatere koordinat knyttet inn til disse nodene. LikesÃ¥ skjer i lenker med medium at koordinatene inn mot disse nodene blir uberÃ¸rt.

Jeg mÃ¥tte opprette en lÃ¥s. Dette ble gjort i Quadri ved Ã¥ kun bruke kommunen som sÃ¸kekriterier, uten noen objekter:

[https://nvdbapiskriv-stm.utv.atlas.vegvesen.no/kontrollpanel/#/locks/view/18568604]

Denne testen jeg prÃ¸vde pÃ¥ nÃ¥, utspillet seg pÃ¥ Randaberg kommune 1127, hvor jeg fant totalt 2954 noder og 1732 lenkesekvenser med 3968 lenker ,som ble sydd sammen til et endringssett.

ForsÃ¸ket kan ses her:

[https://nvdbapiskriv-stm.utv.atlas.vegvesen.no/kontrollpanel/#/jobs/view/d7fb5a37-6874-4cbd-bff4-2faeba0fc681]

Etter at all valideringskontroll og godkjenning ble utfÃ¸rt, dukket det opp en systemfeil med en konkret melding:

Caused by: java.sql.SQLSyntaxErrorException: ORA-01795: maximum number of expressions in a list is 1000

Dette fÃ¥r jo meg til Ã¥ lure pÃ¥ om det stÃ¸rrelse begrensning i STM? Er dette noe du justerer etter hvert som testing og slikt pÃ¥gÃ¥r?

Med hilsen
 Joakim MÃ¸yholm
 Mobil:Â +47Â 97090538

h2. Analyse

Hendelsesloggen for endringsettet:


{code:java}
no.vegvesen.vt.nvdb.apiskriv.api.exception.NvdbRepositoryException: Failed to execute JDBC update
	at no.vegvesen.vt.nvdb.apiskriv.api.exception.ApplicationException$Builder.build(ApplicationException.java:44)
	at no.vegvesen.vt.nvdb.apiskriv.nvdbrepository.NvdbExecutors.executeUpdate(NvdbExecutors.java:70)
	at no.vegvesen.vt.nvdb.apiskriv.nvdbrepository.NvdbExecutors.executeUpdate(NvdbExecutors.java:22)
	at no.vegvesen.vt.nvdb.apiskriv.nvdbrepository.JdbcAreaLocationRepository.removeForRefLinkNvdbId(JdbcAreaLocationRepository.java:41)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.NvdbTransactionWriter.updateAreaLocations(NvdbTransactionWriter.java:371)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.NvdbTransactionWriter.writeJob(NvdbTransactionWriter.java:145)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$24(JobWorker.java:766)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.lambda$transactional$0(Jdbc.java:110)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:135)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:109)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:105)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$updateNvdb$25(JobWorker.java:764)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.lambda$transactional$0(Jdbc.java:110)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:135)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:109)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:105)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.updateNvdb(JobWorker.java:764)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$0(JobWorker.java:215)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.processJobAndRetryOnException(JobWorker.java:243)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$1(JobWorker.java:152)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:47)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:151)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.messageHandler(JobListener.java:60)
	at no.vegvesen.vt.nvdb.apiskriv.rabbitmqclient.RabbitMqSubscription.onMessage(RabbitMqSubscription.java:181)
Caused by: Error : 1795, Position : 6959, Sql = delete from nvdb.arealocations al where al.location.netelemid in (:1 , :2 , :3 , :4 , :5 , :6 , :7 , :8 , :9 , :10 , :11 , :12 , :13 , :14 , :15 , :16 , :17 , :18 , :19 , :20 , :21 , :22 , :23 , :24 , :25 , :26 , :27 , :28 , :29 , :30 , :31 , :32 , :33 , :34 , :35 , :36 , :37 , :38 , :39 , :40 , :41 , :42 , :43 , :44 , :45 , :46 , :47 , :48 , :49 , :50 , :51 , :52 , :53 , :54 , :55 , :56 , :57 , :58 , :59 , :60 , :61 , :62 , :63 , :64 , :65 , :66 , :67 , :68 , :69 , :70 , :71 , :72 , :73 , :74 , :75 , :76 , :77 , :78 , :79 , :80 , :81 , :82 , :83 , :84 , :85 , :86 , :87 , :88 , :89 , :90 , :91 , :92 , :93 , :94 , :95 , :96 , :97 , :98 , :99 , :100 , :101 , :102 , :103 , :104 , :105 , :106 , :107 , :108 , :109 , :110 , :111 , :112 , :113 , :114 , :115 , :116 , :117 , :118 , :119 , :120 , :121 , :122 , :123 , :124 , :125 , :126 , :127 , :128 , :129 , :130 , :131 , :132 , :133 , :134 , :135 , :136 , :137 , :138 , :139 , :140 , :141 , :142 , :143 , :144 , :145 , :146 , :147 , :148 , :149 , :150 , :151 , :152 , :153 , :154 , :155 , :156 , :157 , :158 , :159 , :160 , :161 , :162 , :163 , :164 , :165 , :166 , :167 , :168 , :169 , :170 , :171 , :172 , :173 , :174 , :175 , :176 , :177 , :178 , :179 , :180 , :181 , :182 , :183 , :184 , :185 , :186 , :187 , :188 , :189 , :190 , :191 , :192 , :193 , :194 , :195 , :196 , :197 , :198 , :199 , :200 , :201 , :202 , :203 , :204 , :205 , :206 , :207 , :208 , :209 , :210 , :211 , :212 , :213 , :214 , :215 , :216 , :217 , :218 , :219 , :220 , :221 , :222 , :223 , :224 , :225 , :226 , :227 , :228 , :229 , :230 , :231 , :232 , :233 , :234 , :235 , :236 , :237 , :238 , :239 , :240 , :241 , :242 , :243 , :244 , :245 , :246 , :247 , :248 , :249 , :250 , :251 , :252 , :253 , :254 , :255 , :256 , :257 , :258 , :259 , :260 , :261 , :262 , :263 , :264 , :265 , :266 , :267 , :268 , :269 , :270 , :271 , :272 , :273 , :274 , :275 , :276 , :277 , :278 , :279 , :280 , :281 , :282 , :283 , :284 , :285 , :286 , :287 , :288 , :289 , :290 , :291 , :292 , :293 , :294 , :295 , :296 , :297 , :298 , :299 , :300 , :301 , :302 , :303 , :304 , :305 , :306 , :307 , :308 , :309 , :310 , :311 , :312 , :313 , :314 , :315 , :316 , :317 , :318 , :319 , :320 , :321 , :322 , :323 , :324 , :325 , :326 , :327 , :328 , :329 , :330 , :331 , :332 , :333 , :334 , :335 , :336 , :337 , :338 , :339 , :340 , :341 , :342 , :343 , :344 , :345 , :346 , :347 , :348 , :349 , :350 , :351 , :352 , :353 , :354 , :355 , :356 , :357 , :358 , :359 , :360 , :361 , :362 , :363 , :364 , :365 , :366 , :367 , :368 , :369 , :370 , :371 , :372 , :373 , :374 , :375 , :376 , :377 , :378 , :379 , :380 , :381 , :382 , :383 , :384 , :385 , :386 , :387 , :388 , :389 , :390 , :391 , :392 , :393 , :394 , :395 , :396 , :397 , :398 , :399 , :400 , :401 , :402 , :403 , :404 , :405 , :406 , :407 , :408 , :409 , :410 , :411 , :412 , :413 , :414 , :415 , :416 , :417 , :418 , :419 , :420 , :421 , :422 , :423 , :424 , :425 , :426 , :427 , :428 , :429 , :430 , :431 , :432 , :433 , :434 , :435 , :436 , :437 , :438 , :439 , :440 , :441 , :442 , :443 , :444 , :445 , :446 , :447 , :448 , :449 , :450 , :451 , :452 , :453 , :454 , :455 , :456 , :457 , :458 , :459 , :460 , :461 , :462 , :463 , :464 , :465 , :466 , :467 , :468 , :469 , :470 , :471 , :472 , :473 , :474 , :475 , :476 , :477 , :478 , :479 , :480 , :481 , :482 , :483 , :484 , :485 , :486 , :487 , :488 , :489 , :490 , :491 , :492 , :493 , :494 , :495 , :496 , :497 , :498 , :499 , :500 , :501 , :502 , :503 , :504 , :505 , :506 , :507 , :508 , :509 , :510 , :511 , :512 , :513 , :514 , :515 , :516 , :517 , :518 , :519 , :520 , :521 , :522 , :523 , :524 , :525 , :526 , :527 , :528 , :529 , :530 , :531 , :532 , :533 , :534 , :535 , :536 , :537 , :538 , :539 , :540 , :541 , :542 , :543 , :544 , :545 , :546 , :547 , :548 , :549 , :550 , :551 , :552 , :553 , :554 , :555 , :556 , :557 , :558 , :559 , :560 , :561 , :562 , :563 , :564 , :565 , :566 , :567 , :568 , :569 , :570 , :571 , :572 , :573 , :574 , :575 , :576 , :577 , :578 , :579 , :580 , :581 , :582 , :583 , :584 , :585 , :586 , :587 , :588 , :589 , :590 , :591 , :592 , :593 , :594 , :595 , :596 , :597 , :598 , :599 , :600 , :601 , :602 , :603 , :604 , :605 , :606 , :607 , :608 , :609 , :610 , :611 , :612 , :613 , :614 , :615 , :616 , :617 , :618 , :619 , :620 , :621 , :622 , :623 , :624 , :625 , :626 , :627 , :628 , :629 , :630 , :631 , :632 , :633 , :634 , :635 , :636 , :637 , :638 , :639 , :640 , :641 , :642 , :643 , :644 , :645 , :646 , :647 , :648 , :649 , :650 , :651 , :652 , :653 , :654 , :655 , :656 , :657 , :658 , :659 , :660 , :661 , :662 , :663 , :664 , :665 , :666 , :667 , :668 , :669 , :670 , :671 , :672 , :673 , :674 , :675 , :676 , :677 , :678 , :679 , :680 , :681 , :682 , :683 , :684 , :685 , :686 , :687 , :688 , :689 , :690 , :691 , :692 , :693 , :694 , :695 , :696 , :697 , :698 , :699 , :700 , :701 , :702 , :703 , :704 , :705 , :706 , :707 , :708 , :709 , :710 , :711 , :712 , :713 , :714 , :715 , :716 , :717 , :718 , :719 , :720 , :721 , :722 , :723 , :724 , :725 , :726 , :727 , :728 , :729 , :730 , :731 , :732 , :733 , :734 , :735 , :736 , :737 , :738 , :739 , :740 , :741 , :742 , :743 , :744 , :745 , :746 , :747 , :748 , :749 , :750 , :751 , :752 , :753 , :754 , :755 , :756 , :757 , :758 , :759 , :760 , :761 , :762 , :763 , :764 , :765 , :766 , :767 , :768 , :769 , :770 , :771 , :772 , :773 , :774 , :775 , :776 , :777 , :778 , :779 , :780 , :781 , :782 , :783 , :784 , :785 , :786 , :787 , :788 , :789 , :790 , :791 , :792 , :793 , :794 , :795 , :796 , :797 , :798 , :799 , :800 , :801 , :802 , :803 , :804 , :805 , :806 , :807 , :808 , :809 , :810 , :811 , :812 , :813 , :814 , :815 , :816 , :817 , :818 , :819 , :820 , :821 , :822 , :823 , :824 , :825 , :826 , :827 , :828 , :829 , :830 , :831 , :832 , :833 , :834 , :835 , :836 , :837 , :838 , :839 , :840 , :841 , :842 , :843 , :844 , :845 , :846 , :847 , :848 , :849 , :850 , :851 , :852 , :853 , :854 , :855 , :856 , :857 , :858 , :859 , :860 , :861 , :862 , :863 , :864 , :865 , :866 , :867 , :868 , :869 , :870 , :871 , :872 , :873 , :874 , :875 , :876 , :877 , :878 , :879 , :880 , :881 , :882 , :883 , :884 , :885 , :886 , :887 , :888 , :889 , :890 , :891 , :892 , :893 , :894 , :895 , :896 , :897 , :898 , :899 , :900 , :901 , :902 , :903 , :904 , :905 , :906 , :907 , :908 , :909 , :910 , :911 , :912 , :913 , :914 , :915 , :916 , :917 , :918 , :919 , :920 , :921 , :922 , :923 , :924 , :925 , :926 , :927 , :928 , :929 , :930 , :931 , :932 , :933 , :934 , :935 , :936 , :937 , :938 , :939 , :940 , :941 , :942 , :943 , :944 , :945 , :946 , :947 , :948 , :949 , :950 , :951 , :952 , :953 , :954 , :955 , :956 , :957 , :958 , :959 , :960 , :961 , :962 , :963 , :964 , :965 , :966 , :967 , :968 , :969 , :970 , :971 , :972 , :973 , :974 , :975 , :976 , :977 , :978 , :979 , :980 , :981 , :982 , :983 , :984 , :985 , :986 , :987 , :988 , :989 , :990 , :991 , :992 , :993 , :994 , :995 , :996 , :997 , :998 , :999 , :1000 , :1001 , :1002 , :1003 , :1004 , :1005 , :1006 , :1007 , :1008 , :1009 , :1010 , :1011 , :1012 , :1013 , :1014 , :1015 , :1016 , :1017 , :1018 , :1019 , :1020 , :1021 , :1022 , :1023 , :1024 , :1025 , :1026 , :1027 , :1028 , :1029 , :1030 , :1031 , :1032 , :1033 , :1034 , :1035 , :1036 , :1037 , :1038 , :1039 , :1040 , :1041 , :1042 , :1043 , :1044 , :1045 , :1046 , :1047 , :1048 , :1049 , :1050 , :1051 , :1052 , :1053 , :1054 , :1055 , :1056 , :1057 , :1058 , :1059 , :1060 , :1061 , :1062 , :1063 , :1064 , :1065 , :1066 , :1067 , :1068 , :1069 , :1070 , :1071 , :1072 , :1073 , :1074 , :1075 , :1076 , :1077 , :1078 , :1079 , :1080 , :1081 , :1082 , :1083 , :1084 , :1085 , :1086 , :1087 , :1088 , :1089 , :1090 , :1091 , :1092 , :1093 , :1094 , :1095 , :1096 , :1097 , :1098 , :1099 , :1100 , :1101 , :1102 , :1103 , :1104 , :1105 , :1106 , :1107 , :1108 , :1109 , :1110 , :1111 , :1112 , :1113 , :1114 , :1115 , :1116 , :1117 , :1118 , :1119 , :1120 , :1121 , :1122 , :1123 , :1124 , :1125 , :1126 , :1127 , :1128 , :1129 , :1130 , :1131 , :1132 , :1133 , :1134 , :1135 , :1136 , :1137 , :1138 , :1139 , :1140 , :1141 , :1142 , :1143 , :1144 , :1145 , :1146 , :1147 , :1148 , :1149 , :1150 , :1151 , :1152 , :1153 , :1154 , :1155 , :1156 , :1157 , :1158 , :1159 , :1160 , :1161 , :1162 , :1163 , :1164 , :1165 , :1166 , :1167 , :1168 , :1169 , :1170 , :1171 , :1172 , :1173 , :1174 , :1175 , :1176 , :1177 , :1178 , :1179 , :1180 , :1181 , :1182 , :1183 , :1184 , :1185 , :1186 , :1187 , :1188 , :1189 , :1190 , :1191 , :1192 , :1193 , :1194 , :1195 , :1196 , :1197 , :1198 , :1199 , :1200 , :1201 , :1202 , :1203 , :1204 , :1205 , :1206 , :1207 , :1208 , :1209 , :1210 , :1211 , :1212 , :1213 , :1214 , :1215 , :1216 , :1217 , :1218 , :1219 , :1220 , :1221 , :1222 , :1223 , :1224 , :1225 , :1226 , :1227 , :1228 , :1229 , :1230 , :1231 , :1232 , :1233 , :1234 , :1235 , :1236 , :1237 , :1238 , :1239 , :1240 , :1241 , :1242 , :1243 , :1244 , :1245 , :1246 , :1247 , :1248 , :1249 , :1250 , :1251 , :1252 , :1253 , :1254 , :1255 , :1256 , :1257 , :1258 , :1259 , :1260 , :1261 , :1262 , :1263 , :1264 , :1265 , :1266 , :1267 , :1268 , :1269 , :1270 , :1271 , :1272 , :1273 , :1274 , :1275 , :1276 , :1277 , :1278 , :1279 , :1280 , :1281 , :1282 , :1283 , :1284 , :1285 , :1286 , :1287 , :1288 , :1289 , :1290 , :1291 , :1292 , :1293 , :1294 , :1295 , :1296 , :1297 , :1298 , :1299 , :1300 , :1301 , :1302 , :1303 , :1304 , :1305 , :1306 , :1307 , :1308 , :1309 , :1310 , :1311 , :1312 , :1313 , :1314 , :1315 , :1316 , :1317 , :1318 , :1319 , :1320 , :1321 , :1322 , :1323 , :1324 , :1325 , :1326 , :1327 , :1328 , :1329 , :1330 , :1331 , :1332 , :1333 , :1334 , :1335 , :1336 , :1337 , :1338 , :1339 , :1340 , :1341 , :1342 , :1343 , :1344 , :1345 , :1346 , :1347 , :1348 , :1349 , :1350 , :1351 , :1352 , :1353 , :1354 , :1355 , :1356 , :1357 , :1358 , :1359 , :1360 , :1361 , :1362 , :1363 , :1364 , :1365 , :1366 , :1367 , :1368 , :1369 , :1370 , :1371 , :1372 , :1373 , :1374 , :1375 , :1376 , :1377 , :1378 , :1379 , :1380 , :1381 , :1382 , :1383 , :1384 , :1385 , :1386 , :1387 , :1388 , :1389 , :1390 , :1391 , :1392 , :1393 , :1394 , :1395 , :1396 , :1397 , :1398 , :1399 , :1400 , :1401 , :1402 , :1403 , :1404 , :1405 , :1406 , :1407 , :1408 , :1409 , :1410 , :1411 , :1412 , :1413 , :1414 , :1415 , :1416 , :1417 , :1418 , :1419 , :1420 , :1421 , :1422 , :1423 , :1424 , :1425 , :1426 , :1427 , :1428 , :1429 , :1430 , :1431 , :1432 , :1433 , :1434 , :1435 , :1436 , :1437 , :1438 , :1439 , :1440 , :1441 , :1442 , :1443 , :1444 , :1445 , :1446 , :1447 , :1448 , :1449 , :1450 , :1451 , :1452 , :1453 , :1454 , :1455 , :1456 , :1457 , :1458 , :1459 , :1460 , :1461 , :1462 , :1463 , :1464 , :1465 , :1466 , :1467 , :1468 , :1469 , :1470 , :1471 , :1472 , :1473 , :1474 , :1475 , :1476 , :1477 , :1478 , :1479 , :1480 , :1481 , :1482 , :1483 , :1484 , :1485 , :1486 , :1487 , :1488 , :1489 , :1490 , :1491 , :1492 , :1493 , :1494 , :1495 , :1496 , :1497 , :1498 , :1499 , :1500 , :1501 , :1502 , :1503 , :1504 , :1505 , :1506 , :1507 , :1508 , :1509 , :1510 , :1511 , :1512 , :1513 , :1514 , :1515 , :1516 , :1517 , :1518 , :1519 , :1520 , :1521 , :1522 , :1523 , :1524 , :1525 , :1526 , :1527 , :1528 , :1529 , :1530 , :1531 , :1532 , :1533 , :1534 , :1535 , :1536 , :1537 , :1538 , :1539 , :1540 , :1541 , :1542 , :1543 , :1544 , :1545 , :1546 , :1547 , :1548 , :1549 , :1550 , :1551 , :1552 , :1553 , :1554 , :1555 , :1556 , :1557 , :1558 , :1559 , :1560 , :1561 , :1562 , :1563 , :1564 , :1565 , :1566 , :1567 , :1568 , :1569 , :1570 , :1571 , :1572 , :1573 , :1574 , :1575 , :1576 , :1577 , :1578 , :1579 , :1580 , :1581 , :1582 , :1583 , :1584 , :1585 , :1586 , :1587 , :1588 , :1589 , :1590 , :1591 , :1592 , :1593 , :1594 , :1595 , :1596 , :1597 , :1598 , :1599 , :1600 , :1601 , :1602 , :1603 , :1604 , :1605 , :1606 , :1607 , :1608 , :1609 , :1610 , :1611 , :1612 , :1613 , :1614 , :1615 , :1616 , :1617 , :1618 , :1619 , :1620 , :1621 , :1622 , :1623 , :1624 , :1625 , :1626 , :1627 , :1628 , :1629 , :1630 , :1631 , :1632 , :1633 , :1634 , :1635 , :1636 , :1637 , :1638 , :1639 , :1640 , :1641 , :1642 , :1643 , :1644 , :1645 , :1646 , :1647 , :1648 , :1649 , :1650 , :1651 , :1652 , :1653 , :1654 , :1655 , :1656 , :1657 , :1658 , :1659 , :1660 , :1661 , :1662 , :1663 , :1664 , :1665 , :1666 , :1667 , :1668 , :1669 , :1670 , :1671 , :1672 , :1673 , :1674 , :1675 , :1676 , :1677 , :1678 , :1679 , :1680 , :1681 , :1682 , :1683 , :1684 , :1685 , :1686 , :1687 , :1688 , :1689 , :1690 , :1691 , :1692 , :1693 , :1694 , :1695 , :1696 , :1697 , :1698 , :1699 , :1700 , :1701 , :1702 , :1703 , :1704 , :1705 , :1706 , :1707 , :1708 , :1709 , :1710 , :1711 , :1712 , :1713 , :1714 , :1715 , :1716 , :1717 , :1718 , :1719 , :1720 , :1721 , :1722 , :1723 , :1724 , :1725 , :1726 , :1727 , :1728 , :1729 , :1730 , :1731 , :1732 ), OriginalSql = delete from nvdb.arealocations al where al.location.netelemid in (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?), Error Msg = ORA-01795: maximum number of expressions in a list is 1000
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:513)
	... 50 more
{code}

Et IN-uttrykk i SQLen som genereres i JdbcAreaLocationRepository.removeForRefLinkNvdbId har flere enn 1000 elementer. Maksimum antall i Oracle er 1000.

h2. LÃ¸sning

Fikses i JdbcAreaLocationRepository.removeForRefLinkNvdbId: Del opp parameter refLinkNvdbIds i flere batcher/dellister (Ã¡ f.eks. 500) og utfÃ¸r DELETE for hver batch/delliste. 
",NVDB-6937,Skriv-API,
Analyser avvistÃ¥rsaker fra Datafangst,"NÃ¥r det registreres endringssett mot Skriv fra Datafangst blir mange av disse AVVIST. Disse blir alltid avvist korrekt, men i mange tilfeller av Ã¥rsaker som Datafangst burde ha hÃ¥ndtert fÃ¸r innsending. Et eksempel, som vi har sett tidligere, erÂ STÃ˜RRE_ENN_ABSOLUTT_MAKSIMUM - noe Datafangst burde ha fanga opp nÃ¥r den har full kontroll over Datakatalogen.

Oppgaven gÃ¥r pÃ¥ Ã¥ gjÃ¸re en slik analyse pÃ¥ nytt. For Ã¥ gjÃ¸re dette kan man benytte Python-script som ligger i API Skriv sitt prosjekt.

Se howto i
{noformat}
/nvdb-skrive-api/performance-test/src/test/python/rejectReasonsInProd
{noformat}
For Ã¥ bli kjent med hvordan det virker, legg inn (som beskrevet) en fil password.txt med kun ditt passord i Prod. KjÃ¸r deretter kommando i eksempel 3 fra howto.

Deretter kjÃ¸r skriptet med oppdaterte fra- og til-tider og se pÃ¥ avvistÃ¥rsakene til Datafangst.

(Dette kan ogsÃ¥ utfÃ¸res uten Ã¥ angi Datafangst i kommandoen s.a. man ser avvistÃ¥rsaker for andre klienter)

*MERK* Anbefaler Ã¥ kjÃ¸re slike analyser jevnlig - bÃ¥de for Ã¥ kvalitetssikre egne klienter, se hva Skriv avviser flest ganger, og hjelpe andre klienter med typiske avvistÃ¥rsaker.",NVDB-6937,Datafangst,
Anrop til LDAP-API henger uten timeout,"h2. Observasjon

Ser ut som at anrop til SVVs LDAP-API blir stÃ¥ende Ã¥ henge (blokkere) for enkelte typer requester:

https://loggsentralen.vegvesen.no/loggsentralen/en-GB/app/SVV_nvdbapis/search?q=search%20index%3D%22svvunvdbapis%22%20APPENV%3D%22utvikling%22%20sourcetype%3D%22nvdbapis-exchange%3ANA-log%22%20host%3D%22svvpocp1sn1n010.vegvesen.no%22&display.page.search.mode=smart&dispatch.sample_ratio=1&earliest=-4h%40m&latest=now&sid=1614179269.15845_C5996C14-FEA3-4A85-B277-7060A0DC991F

Metrikker: https://atlas-grafana.atlas.vegvesen.no/d/pods/pods-and-containers?orgId=1&from=now-6h&to=now&var-iktlosning=nvdbapis&var-appmiljo=utvikling&var-pod=All

Ser ut til at CPU-last Ã¸ker mye og holdes hÃ¸y akkurat i tidsrommet requesten til LDAP-API sendes (respons uteblir).

h2. Analyse

Caset er repeterbart: Hver gang API Skriv anropes med /rest/v1/ldap/bruker?etternavn=test holdes en CPU kjerne i gang til evig tid. Tomcat-trÃ¥den blokkerer mens den venter pÃ¥ responsen fra SVVs LDAP-endepunkt, som aldri kommer. Gjelder alle Atlas-miljÃ¸er.

h2. ForsÃ¸k pÃ¥ lÃ¸sning

Caset er meldt til Mats Faugli, utvikler av LDAP-API for analyse pÃ¥ den siden.

FÃ¸lgende er forsÃ¸kt i API Skriv:

# La inn blokkering i Fake-LDAP-API og fÃ¥r da korrekt SocketTimeoutException ved kjÃ¸ring av API Skriv lokalt. Dette beviser at oppsett av timeout-verdier i Jersey Client er korrekt satt.
# Bruke asynkron request, med egen timeout pÃ¥ fullfÃ¸ring av request-trÃ¥den. Request-trÃ¥den avbrytes nÃ¥r tidsgrensen er nÃ¥dd, men det er fortsatt blokkering i anropet mot LDAP-API. CPU-last som tidligere.
# Erstattet Jersey Client med RESTeasy som JAX-RS-klient. Samme oppfÃ¸rsel.

Det som ikke er forsÃ¸kt:

# Bytte til nyere versjon av klient-bibliotekene. Dette lar seg forelÃ¸pig ikke gjÃ¸re fordi disse er basert pÃ¥ JAX-RS v2.1, mens API Skriv mÃ¥ bruke v2.0.1, siden det er det RestStop bruker.

---

Fikk rettet noen memory leaks i samme seansen: Manglet close() pÃ¥ flere Response-objekter der body ikke leses.",NVDB-6937,Skriv-API,
E2E-test av manuell stedfesting,"Sak NVDB-6369 innfÃ¸rte manuell stedfesting med ankerpunkter. Det er ikke laget e2e-tester for denne funksjonen.

Et lite skjellet er laget pÃ¥ branch NVDB-6916 med tips om hva disse bÃ¸r inneholde. Dette gjelder testene:
 * /nvdb-datafangst/e2e-tests/cypress/integration/tests/locational_spec.js:Â should manually localize a single feature with line geometry
 * /nvdb-datafangst/e2e-tests/cypress/integration/tests/locational_spec.js:Â should manually localize a single feature with point geometry

Oppgaven gÃ¥r pÃ¥ Ã¥ sjekke ut branch NVDB-6916 (mÃ¥ gjerne merge inn master pÃ¥ nytt om det er en stund mellom branchen ble laget og denne saken tas tak i) eller se hva som ligger i de to testene og heller lage en ny branch fra master, kopiere inn testene, for sÃ¥ Ã¥ slette branch NVDB-6916.

Â Se: [https://git.vegvesen.no/projects/NVDBDATA/repos/nvdb-datafangst/commits/01d278ba9446a303417b54b958055d77d7c5ffbf]

Â ",NVDB-6937,Datafangst,
LDAP-endepunkt feiler ved sÃ¸k pÃ¥ etternavn,"h2. Observasjon

Fra HÃ¥vard W: Ser ut som jeg fÃ¥r en feil fra Skriv som kommer av 500 fra ldap-api hvis jeg sÃ¸ker etter ""test"" (bÃ¥de med og uten wildcard), f.eks. https://www.test.vegvesen.no/nvdb/apiskriv/rest/v1/ldap/bruker/?etternavn=test

h2. Analyse

Ã…rsaken til 500-respons er NPE:

{code:java}
java.lang.NullPointerException: null
	at no.vegvesen.vt.nvdb.apiskriv.domain.ldap.UserType.fromUsername(UserType.java:42)
	at no.vegvesen.vt.nvdb.apiskriv.security.soabasis.SoaBasisWsClient.createUserProfile(SoaBasisWsClient.java:107)
	at no.vegvesen.vt.nvdb.apiskriv.security.soabasis.SoaBasisWsClient.toUserProfile(SoaBasisWsClient.java:85)
	at no.vegvesen.vt.nvdb.apiskriv.security.soabasis.EmployeeSearchWsClient.findUserProfiles(EmployeeSearchWsClient.java:47)
	at no.vegvesen.vt.nvdb.apiskriv.security.soabasis.SoaBasisLdapGateway.findUserProfiles(SoaBasisLdapGateway.java:50)
	at no.vegvesen.vt.nvdb.apiskriv.security.CachingLdapGateway.findUserProfiles(CachingLdapGateway.java:33)
	at no.vegvesen.vt.nvdb.apiskriv.rest.ldap.v1.LdapResource.lambda$listUsers$3(LdapResource.java:103)
	at no.vegvesen.vt.nvdb.apiskriv.rest.ResourceUtils.catchExceptions(ResourceUtils.java:63)
	at no.vegvesen.vt.nvdb.apiskriv.rest.ldap.v1.LdapResource.listUsers(LdapResource.java:98)
{code}

Ser ut til at uid-feltet noen ganger ikke er utfylt i responsen fra LDAP.

h2. LÃ¸sning

Gjorde SoaBasisWsClient (og subklasser) mer null-safe. Tilsvarende i DefaultLdapGateway.",NVDB-6937,Skriv-API,
Oppdater changelog,"Flytte changelog til frontend, ettersom gradle jobb i backend ikke er pÃ¥litelig.

Testes ikke funksjonelt
Â ",NVDB-6937,Vegkart,
Egenskapen Sideveg mangler i segmentering,"[~linsto]Â lagt til en kommentar
Det har nÃ¥ blitt oppdaget at egenskapen Sideveg ikke legges ut sammen med gatekode og gatenavn i segmenteringen. Dette trenger vi for Ã¥ kunne levere korrekt Elveg 2.0 frem til eksportlÃ¸sningen er klar. Regner med at dette ogsÃ¥ vil vÃ¦re nÃ¸dvendig i eksportlÃ¸sningen.

Eksempel pÃ¥ veg som mangler Sideveg:Â [https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/3197357]",NVDB-6937,Les-API,
Automatisk stedfestning fÃ¥r overlapp nÃ¥r visning viser god avstand mellom kurve 1 og 10,"Supportsak:

Visning viser fortau et godt stykke fra hverandre(Kurve 1 og 10). Ved automatisk stedfestning sÃ¥ vises det overlapp i stedfestningen. Burde etterforskes hvorfor dette skjer.Â 

Sosi -fil er lagt til. En kan laste opp sosi fil i UTV og kjÃ¸re automatisk stedfesting for Ã¥ gjenskape feilen.

Kan fikses ved Ã¥ bruke ny manuell stedfestning.

Â 

!image-2021-02-23-11-16-13-532.png!

Â ",NVDB-6937,Skriv-API,
Helsesjekk gir 500 nÃ¥r API Les svarer med 503,"h2. Observasjon

Helsesjekkendepunktet /rest/health pinger alle API Skriv sine integrasjonspunkter deriblant API Les (stedfestingstjenesten bruker API Les sitt ruteendepunkt). Ved et tilfelle ser det ut til at API Les var nede i Atlas og lastbalanserer returnerte 503. Dette ser ut til Ã¥ ha trigget 500-respons fra API Skriv:

https://loggsentralen.vegvesen.no/loggsentralen/en-GB/app/SVV_nvdb/search?dispatch.sample_ratio=1&display.page.search.mode=verbose&earliest=-4h%40m&latest=now&q=search%20index%3Dsvvpnvdb%20host%3Dsvvptomcat25%20OR%20host%3Dsvvptomcat26%20613863a9-5be1-2d9c-2927-d97364487b18&sid=1614069295.10014_C5996C14-FEA3-4A85-B277-7060A0DC991F

h2. Analyse

Det er HealthCheckResource i API Skriv som samler inn rapporter fra pinging av ulike integrasjonspunkter. Dersom en rapport inneholder feilbeskrivelse vil denne legges inn i payloaden og responsen fÃ¥r statuskode 500. OppfÃ¸rselen er derfor ""by design"" og skyldes ikke mangelfull exception-hÃ¥ndtering.
",NVDB-6937,Skriv-API,
E2E-test for Ã¥ sÃ¸ke direkte pÃ¥ NVDB-id,"Ny funksjonalitet i Vegkart er Ã¥ kunne sÃ¸ke direkte pÃ¥ en NVDB-id. Vi bÃ¸r ha en e2e-test for dette. Velg gjerne en NVDB-id det allerede finnes opptak av i wiremock. Det som bÃ¸r gjÃ¸res:

*Test 1:*
 * Start Vegkart
 * Skriv inn en NVDB-id
 * Sjekk at infoboks kommer opp med riktig NVDB-id
 * Sjekk at urlÂ inneholder NVDB-id
 * Velg ""zoom til"" og verifiser at zoom-nivÃ¥ er endret til mindre tall og at url fortsatt inneholder NVDB-id

*Test 2*
 * Start Vegkart
 * Skriv inn en NVDB-id
 * Sjekk at infoboks kommer opp med riktig NVDB-id
 * Sjekk at urlÂ inneholder NVDB-id
 * Velg ""legg til i sÃ¸k""
 * Verifiser at aktuell type er lagt til i sÃ¸ket",NVDB-6937,Vegkart,
Systemfeil /transaksjoner,"Dersom /transaksjoner kjÃ¸res og NVDBIND ikke har prosessert noen transaksjoner etter oppstart feilet /transaksjoner med 
{quote}
SQLDataException: ORA-01830: date format picture ends before converting entire input string
{quote}
pÃ¥ grunn av at tidspunktet brukt for spÃ¸rring har millisekunder. ",NVDB-6937,Les-API,
Kontraktgrupper uten brukere skulle ha vist en boks om dette,"Det finner kode for Ã¥ vise en boks som sier ""Ingen brukere i denne gruppen"" nÃ¥r man velger en kontraktgruppe uten brukere. Denne vises aldri fordi det er skevet litt feil i koden.

Steg for Ã¥ reprodusere:
1. GÃ¥ til admin -> kontraktgrupper
2. Lag en ny kontraktgruppe
3. Observer: Der hvor det skal dukke opp brukere hvis de finnes er det ingenting. Det skulle ha vÃ¦rt en boks som sa:Â  ""Ingen brukere i denne gruppen""",NVDB-6937,Datafangst,
Vise/skjule NVDB/FKB i rapport,"Legge til knappar for Ã¥ vise/skjule (velge) om NVDB- og/eller FKB-data skal visast i rapportmodulen i DF.

!image-2021-02-19-15-21-08-785.png!",NVDB-6937,Datafangst,
FÃ¥ inn dato i changeloggen automatisk,"LÃ¸sningen vi har i dag fungerer dÃ¥rlig. Vi mÃ¥ enten sette pÃ¥ riktig dato for produksjon allerede nÃ¥r vi bygger prosjektet for Ã¥ ta det til ATM, eller vi mÃ¥ bygge pÃ¥ nytt med dato etter at det er testet i ATM.

Â 

Jeg (Maria) vet ikke hvordan vi skal fÃ¥ til dette.Â  Vi kan hente ut byggedato, men vi kan vel ikke hente ut dato for release til prod?

h2. LÃ¸sning
Har lagret tidspunkt for deploy til server i fil, og bruker dette som versjon for release.
Dette vil vÃ¦re riktig i alle tilfeller utenom der det mÃ¥ rulles tilbake til en tidligere versjon, og for de tilfellene kan fil pÃ¥ disk (i /opt/datafangst pÃ¥ server) redigeres for Ã¥ sette riktig tidspunkt.",NVDB-6937,Datafangst,
OverfÃ¸re komplette datasett over DF-API,"For registrering av data til NVDB etter utfasing av klassisk vil det vere behov for Ã¥ behandle data i ulike produkt. For Ã¥ gjere dette effektiv mÃ¥ vi ha ein effektiv mÃ¥te Ã¥ overfÃ¸re data mellom produkt pÃ¥. DF-API kan vere ei lÃ¸ysing der delar av eller heile datasett kan hentast ut og lastast opp. Det mÃ¥ dÃ¥ utvidast til Ã¥ kunne sende objekt som er oppreta i DF, importert via API eller direkte i DF. Det mÃ¥ og omfatte alle eigenskapar og endringar som er gjort sÃ¥ ein ikkje mÃ¥ gjere arbeid opp igjen etter overfÃ¸ring.
h2. Ã˜nske frÃ¥ Raymond KrossÃ¸y Hermansen

HÃ¥per pÃ¥ en bedreÂ *API bru mellom Datafangst og Sinus modulene.*Â Sinus felt entreprenÃ¸r modulen kan i dag hente en del info fra Datafangst og kontraktene som ligger der, men ikke alt av data fra kontraktene kan ses eller jobbes videre med. Denne muligheten til Ã¥ hente inn data fra Datafangst skulle vi absolutt ha hatt muligheten til i Sinus infra ogsÃ¥, bare man da kan fÃ¥ til Ã¥ hente alt som er gjort med dataene fra kontraktene for bÃ¥de Infra og felt entreprenÃ¸r modulen. Dvs. at vi trenger Ã¥ fÃ¥ fram alle objekter som ligger i kontraktene, alle endringer som er gjort pÃ¥ objektene generelt og uavhengig av om objektene er nye fra sosifiler, eksisterende hentet fra Vegkart som igjen har fÃ¥tt endrede egenskaper eller plassering, og nye digitaliserte objekter opprettet i Datafangst. En API`bru der alle disse dataene med endringer utfÃ¸rt i bl.a. Datafangst, per kontrakt, kan hentes inn direkte for Ã¥ jobbes videre med i felt modulen for entreprenÃ¸r fÃ¸r dataene sendes tilbake fra felt entreprenÃ¸r til Datafangst igjen, eller der dataene lagres direkte fra Infra og inn i NVDB. Dette vil kunne lÃ¸se mange utfordringer.
h2. 1. Analyse (svar frÃ¥ Tor Kjetil)

Det du kan hente ut er:
 - All data som er innsendt via det eksterne-API, inkludert nye og importerte NVDB-objekter.
 - All data som er innsendt som del av en SOSI-fil
 
 Det du *ikke* kan hente ut per i dag er:
 - NVDB-objekter som er importert fra kart i datafanen
 - NVDB-objekter som er importert fra Vegkart
 - Nye objekter som er kopierte fra enten andre nye objekter eller NVDB-objekter",NVDB-6937,Datafangst,
Fanemenyene blir disablet av og til nÃ¥r datakatalogen ikke blir initiert,"h2. Observasjon

Fanemenyen blir av og til disablet og man fÃ¥r ikke til Ã¥ bruke datafangst.
h2. Analyse

Dette ser ut til Ã¥ oppstÃ¥ av og til fordi datakatalogen ikke er initiert. Av og til gÃ¥r det bra fordi en annen funksjon klarer Ã¥ initiere datakatalogen fÃ¸r feilen oppstÃ¥r.
Feilen oppstÃ¥r nÃ¥r fordi readFeatureList er avhengig av datakatalogen, men datakatalogen er ikke initiert.
Feilen oppstÃ¥r ikke nÃ¥r readFKFeatureList kjÃ¸rer ferdig fÃ¸r readFeatureList prÃ¸ver Ã¥ bruke datakatalogen fordi readFKBFeatureList forsikrer seg om at datakatalogen er initiert fÃ¸rst.
h2. LÃ¸sning

Legg inn kall til Ã¥ initiere datakatalogen pÃ¥ readFeatureList pÃ¥ lik linje som readFKBFeatureList gjÃ¸r.

Â ",NVDB-6937,Datafangst,
Oppdaterte Dashboard i Grafana,NÃ¥ som skriv eksponerer flere metrikker fraÂ prometheus sÃ¥ vil det vÃ¦re nyttig Ã¥ oppdatere grafana til Ã¥ presentere de nye metrikkene. Samtidig vil det vÃ¦re nyttig Ã¥ legge inn alerts som rapporterer til Slack om unormaliteter.,NVDB-6937,Skriv-API,
Leveranseinformasjon Lese API V3 2021.4.0+.1+.2+5.0,"*Testes av SVV:*
 * NVDB-5977 - funksjonalitet som fÃ¸r. Krever full reindeksering, nÃ¥r full reindeksering er utfÃ¸rt sette konfig areacache.NVDB5977=true. For kontraktsomrÃ¥der/riksvegruter/gater med flere objekter skal solrspÃ¸rring inneholde kun Ã©n id.
 * NVDB-6224 - Test at Ã¥ legge til kommune som vegobjekttype og et fylke som omrÃ¥defilter gir ut kommunene i fylket.
 * NVDB-6456 - Test Ã¥ filtrer med relativposisjon 0 og 1.
 * NVDB-6544 - Ved filtrering pÃ¥ ikke-eksisterende riksvegrute vil responsen nÃ¥ vÃ¦re feilmelding.
 * NVDB-6461: Re-kjÃ¸r stedfestingskall mot aktuelt miljÃ¸. Resposnen skal nÃ¥ kun ha en veglenkesekvens-id
 * NVDB-6545: Verifiser filtrering med riksvegrute. Bruk gjerne url i beskrivelsen.
 * NVDB-6917: Ved filtrering pÃ¥ gate skal objekter ha komplett lokasjon

*Testes av LeverandÃ¸r:*
 * NVDB-6493 - Kontrakter, riksvegruter og gater som bestÃ¥r av flere objekter skal komme kun Ã©n gang for /omrader/X. Med header Â«Accept: application/vnd.vegvesen.nvdb-v3-rev2+jsonÂ» vil alle objekter bli listet ut for hvert kontrakt/rute, med rev1 blir kun laveste id returnert.

Saker som ikke er nevnt her testes ikke manuelt",NVDB-6937,Les-API,
Ta hensyn til eksisterende NVDB-dÃ¸tre ved re-stedfesting av NVDB-objekter,"h2. Bakgrunn

Vi har hatt noen case i Datafangst hvor en bruker har re-stedfestet et NVDB-objekt som da fÃ¥r en stedfesting som er litt ulik sin tidligere stedfesting - og da videre stedfestingen til sine dÃ¸tre i NVDB. Ved et support-tilfelle hadde et belysningspunkt fÃ¥tt veldig ny stedfesting da Les ga beskjed om at punktet lÃ¥ nÃ¦rmest en KV som gikk over tunnelen langs E6. Her fikk altsÃ¥ et NVDB-objekt stedfesting pÃ¥ KV nÃ¥r alle dÃ¸trene var pÃ¥ E6 (ingen preferanse var satt pÃ¥ veg og kategori i Datafangst).

For de fleste re-stedfestingene sÃ¥ er det kun nede i desimalene at ny stedfesting skiller seg fra enten mors eller dÃ¸tres stedfesting i NVDB. I slike tilfeller er det raskt Ã¥ tenke at Skriv kunne benyttet original stedfesting for objektet - men det mÃ¥ her vÃ¦re grenser for hva Skriv antar er innenfor ""slingsringsmonnet"". Har brukeren benyttet f.ex manuell stedfesting i klienten og vet at den SKAL endres eller ikke? Og det siste eksemplet over med KV vs EV er stedfestingen ganske forskjellig. Hva bÃ¸r Skriv gjÃ¸re her? Gi beskjed om at objektet ikke blir re-stedfestet pga eksisterende NVDB-dÃ¸tre?

Det ligger sak pÃ¥ Ã¥ stedfeste hierarki i Datafangst, men dette vil uansett ikke hjelpe her da man vanligvis ikke importerer hele NVDB-hierarkier (tenk type 581 -> 67 -> ...).

Gode forslag mottas!

h2. Analyse

Stedfestingstjenesten til API Skriv tar i mot vegobjekter for stedfesting uten Ã¥ vite om dette er nye vegobjekter som skal registreres eller om det er eksisterende vegobjekter i NVDB som skal restedfestes. I representasjonsmodellen er vegobjektene derfor oppgitt kun med tempId, som i DF sitt tilfelle settes lik DFs interne feature-id (UUID). Tjenesten er altsÃ¥ frikoblet fra aspekter som er irrelevant for beregning av en stedfesting basert pÃ¥ egengeometri. Det reduserer kompleksitet via ""separation of concerns"".

I saken Ã¸nskes en lÃ¸sning der stedfestingstjenesten gjÃ¸res kjent med at et vegobjekt finnes i NVDB og dermed har en eksisterende stedfesting. For Ã¥ realisere dette mÃ¥ en nvdbId oppgis for relevante vegobjekter i tillegg til tempId. Det fÃ¸rste endringsforslaget gÃ¥r pÃ¥ Ã¥ returnere eksisterende stedfesting i NVDB, dersom ny beregnet stedfesting ikke avviker mer enn en terskelverdi. Dette medfÃ¸rer en del ekstra round-trips mot NVDB for Ã¥ hente data og responstiden for det synkrone endepunktet kan potensielt Ã¸ke. Dog antageligvis ikke mye.

Det andre endringsforslaget gÃ¥r ut pÃ¥ at datterobjekter til et eksisterende vegobjekt som stedfestes ogsÃ¥ hentes inn i prosessen og kontrolleres mot morobjektets nye stedfesting. Jeg tenker at dette er en dypere form for validering som gÃ¥r utover naturlig ansvarsomrÃ¥de for stedfestingstjenesten. OgsÃ¥ her vil kompleksisteten Ã¸ke i API Skriv og responstiden forringes. Det er DF som kjenner den aktuelle konteksten, nemlig at vegobjektet finnes i NVDB fra fÃ¸r og kan ogsÃ¥ hente eventuelle datterobjekter fra NVDB uten Ã¥ tenke pÃ¥ krav til responstid (ved automatisk stedfesting). Mengden datterobjekter trenger ikke vÃ¦re stor da DF ikke behÃ¸ver hente dypere enn til den generasjonen der ""innenfor mor"" ikke er et krav. I det aktuelle tilfellet med morobjekt som havner pÃ¥ annen veg enn datterobjektene, kunne dette vÃ¦rt lÃ¸st ved at datterobjektene med krav om ""innenfor mor"" ble inspisert og vegbenevnelsen hentet fra disse og matet inn i requesten for stedfesting av mor som foretrukken veg. For Ã¥ hindre at mor fÃ¥r annen plassering pÃ¥ denne vegen enn dÃ¸trene kunne ankerpunkter beregnet ut fra datterobjektenes ytterposisjoner vÃ¦rt angitt. Eksisterende dÃ¸tre blir her styrende for stedfestingen til mor. For Ã¥ forenkle dette kunne eventuelt API Skriv vÃ¦rt utvidet til Ã¥ ta i mot lokasjoner (lenkesekvensposisjoner) som ankerpunkter. I dag stÃ¸ttes kun geometriposisjoner som ankerpunkter.",NVDB-6937,Skriv-API,
Ta i bruk oppdatert versjon av SQL DSL-bibliotek,"Datafangst har en gammel versjon av et bibliotek for Ã¥ lage SQL integrert i koden (pakke ""{color:#000000}no.svv.nvdb.datafangst.jdbc.dsl"" i jdbc-modulen). Denne koden er stort sett urÃ¸rt siden 2015, men er videreutviklet i Skriv og er skilt ut som et eksternt bibliotek.{color}

{color:#000000}Koden som Datafangst har mangler f.eks. fundamentale sammenlikningsoperasjoner som ""like"" i spÃ¸rringer, sÃ¥ i stedet for Ã¥ flikke pÃ¥ gammel kode her bÃ¸r vi gÃ¥ over til den versjonen som er vedlikeholdt i fellesskap.{color}",NVDB-6937,Datafangst,
Filtrering pÃ¥ riksvegrute gir feil svar,"h2. Observasjon

Filtrerer pÃ¥ en riksvegrute [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/96.json?riksvegrute=%22RUTE16%202006-2009%22&antall=12&segmentering=false&inkluder=lokasjon]

Men alle resultater viser riksvegrute RUTE6B - og ikke RUTE16 som er etterspurt.",NVDB-6937,Les-API,
Ikke eksisterende riksvegrute gir mange treff,"h2. Observasjon

Kallet [https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert.json?antall=25&riksvegrute=%22RUTE5YX%202014-2023%20/%202018-2029%22]Â etter en ikke-eksisterende riksvegrute gir mange treff. Riktignok har alle riksvegrute: [].

Tilsvarende for f.ex kontraktsomrÃ¥de-filteret gir typeÂ _Finner ikke noe kontraktsomrÃ¥de ved navn '120199999 Asola tillegg 2020-2023'._",NVDB-6937,Les-API,
Endre kolonneoverskrift tillatt for modulvogntog,"NÃ¥r jeg som faggruppe vegliste skal publisere veglister tÃ¸mmertransport Ã¸nsker jeg at kolonnen for ""tillatt for modulvogntog"" har teksten Tillatt for modulvogntog 1 og 2 med sporingskrav"" slik at dette med ""tillatt for modulvogntog"" blir formidlet tydelig til brukerne vÃ¥re og ikke kan misforstÃ¥s.Â 

Â 

Gjelder altsÃ¥ word-rapporten for ""TÃ¸mmertransport, uoffisiell"" i produksjon av ferdige veglisterÂ https://nvdb-veglister.atlas.vegvesen.no/#/generer

Â ",NVDB-6937,Rapportgenerator,
"Problem med Paginering i ""Data factory""","h1. Support

Hei.

Er som alltid veldig imponert over det dere lever! Sender bare inn et innspill her. Tidligere har jeg brukt Python for Ã¥ importere data fra dere, men har test litt Azure Data Factory i dag, og gjort noen forsÃ¸k pÃ¥ Ã¥ lese data ut fra deres API pÃ¥ https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?srid=4326Â 

MÃ¥ten Â«paginationÂ» er lagt opp hos dere fungerer veldig bra med Data Factory, man treger bare Ã¥ legge til Â«$.metadata.neste.hrefÂ», sÃ¥ leser REST komponent de resterende sidene automatisk:Â  !image-2021-02-12-14-46-51-206.png!

Dessverre ser det ut som at nÃ¥r lesingen gÃ¥r mot den siste batchene, sÃ¥ henger den seg opp i en Â«uendelig loopÂ». Hos meg stod lÃ¸sningen slik i nÃ¦r 30 min, etter den egentlig var ferdig.Â  SÃ¥ restatte den og startet Ã¥ lese inn pÃ¥nytt. Jeg fÃ¥r ikke sporete det, men jeg antar at siste Â«nesteÂ» url gikk om igjen hele tiden.

Om man ser pÃ¥ siste url: https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?start=2PPhBHmfx4TFYHG8CwcBYsr3sT2NAVp3kyi95w48hMvvrNF1JeHhLPVzFgsoedAqZqfhw1VrGqARi35h9tCbG2n9z3nq1Wngh3KcFX1nc2DimiBsGimZGWyKD41S9NMdRzc6r2o9EHafvCNnx5BY1NJnXMaY2uP&srid=4326, sÃ¥ ser det ut som Data Factory blir forvirret av at det leveres Â«$.metadata.neste.hrefÂ» nÃ¥r resultatet har kommet sÃ¥ langt at det er tomt:

!image-2021-02-12-14-49-19-340.png!

Jeg vet ikke om det er hensikten fra deres side at Â«nesteÂ» kommer, selv om det ikke er flere rader? Strengt tatt burde Data Factory sluttet Ã¥ lese her, men det er sÃ¥ vidt jeg vet, ingen gode mÃ¥ter Ã¥ overstyre denne logikken pÃ¥.Â 

Tenkte det kunne vÃ¦re greit for dere Ã¥ vite, det er sikkert flere som kunne tenke seg Ã¥ lese data fra dere med Data Factory. Stort sett forenkler det hele ETL prosessen. Om det var en mulighet til Ã¥ ikke fÃ¥ Â«nesteÂ» nÃ¥r man har kommet til slutten av filen, tror jeg i hvert fall det kunne vÃ¦rt nyttig.Â 

Med vennlig hilsenÂ Â 
Jarle BjÃ¸rnbethÂ  
Databasearkitekt
t: 934 28 766
e:jb@bonum.no",NVDB-6937,Les-API,
MÃ¥ vi stedfeste objekter som kopieres fra NVDB-objekter,"h2. Problem

Dette tilfellet kommer fra testing knyttet til Ketil Johansen sitt problem pÃ¥ support (12-02-21). Kanskje ikke direkte problemet, men likevel kan det ha vÃ¦rt med pÃ¥ Ã¥ skape et problem.

Saken er at nÃ¥r man kopierer et NVDB-objekt til en ny type, gjÃ¸r forvalterne ofte dette for Ã¥ lage et objekt som skal kobles pÃ¥ NVDB-objektet - eller erstatte NVDB-objektet. NÃ¥r nytt objekt blir laget sÃ¥ stedfestes dette gjennom Skriv, noe som kan fÃ¸re til at man fÃ¥r en litt annen stedfesting enn det opprinnelige NVDB-objektet. Dette skaper problemer. To tilfeller her:

Importer url i en kontrakt: [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/87?segmentering=true&kartutsnitt=275791.812%2C7041152.653%2C276089.883%2C7041291.229&vegsystemreferanse=E6&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

*Observasjon #1*

Kopier 87-671973535 til ny type 88 (datter). Da fÃ¥r vi stedfestingene:
 * 87-671973535: EV6: 0.8718908@72811
 * copy-as-new 88: EV6: 0.87192732@72811

Request og respons fra Skriv:
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><parametere><maksimalAvstandTilVeg>300</maksimalAvstandTilVeg><beregnSideposisjon>true</beregnSideposisjon></parametere><vegobjekter><vegobjekt typeId=""88"" tempId=""eab0836f-c322-4faa-8655-b7ddd46e2178""><egenskaper><egenskap typeId=""4788""><geometri><srid>5973</srid><wkt>POINT (275815.74 7041161.92 19.259)</wkt><datafangstdato>2015-10-22</datafangstdato><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>10</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>-1</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>20</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>0</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2021-02-12</startdato></gyldighetsperiode></vegobjekt></vegobjekter></stedfest>

<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt tempId=""eab0836f-c322-4faa-8655-b7ddd46e2178""><stedfesting><oversikt><veg><kategori>E</kategori><fase>V</fase><nummer>6</nummer></veg><lengde>0.0</lengde></oversikt><punkt veglenkesekvensNvdbId=""72811"" posisjon=""0.87192732""><sideposisjon>V</sideposisjon><geometri><srid>5973</srid><wkt>POINT (275809.8950182986 7041149.537822907)</wkt></geometri></punkt></stedfesting></vegobjekt></stedfestingResultat>
{noformat}
Â 

Denne lille forskjellen gÃ¥r bra nÃ¥r man vil sammenkoble. For etter sammenkobling fÃ¥r man:
 * 87-671973535: EV6: 0.8718908@72811
 * new-88: EV6: 0.8718908@72811

Men new-88 er fortsatt oransje i stedfestingsfanen, og ved en ny aut.stedfesting (sannsynligvis pga flere nye av samme type - eller at man ikke av-huker type 88) gir da derimot tilbake:
 * new-88: EV6: 0.87192732@72811

Dette gir problemer ved registrering

*Observasjon #2*

Kopier 87-671973536 til ny type 88 (datter). Da fÃ¥r vi stedfestingene:
 * 87-671973536: EV6: 0.86927441@72811
 * copy-as-new 88: KV7660: 0.60475016@42651

Request og respons til Skriv
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><parametere><maksimalAvstandTilVeg>300</maksimalAvstandTilVeg><beregnSideposisjon>true</beregnSideposisjon></parametere><vegobjekter><vegobjekt typeId=""88"" tempId=""3b655639-138f-41f9-88ef-ea94249d039b""><egenskaper><egenskap typeId=""4788""><geometri><srid>5973</srid><wkt>POINT (275793.44 7041173.21 19.749)</wkt><datafangstdato>2015-10-22</datafangstdato><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>10</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>-1</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>20</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>0</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2021-02-12</startdato></gyldighetsperiode></vegobjekt></vegobjekter></stedfest>

<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt tempId=""3b655639-138f-41f9-88ef-ea94249d039b""><stedfesting><oversikt><veg><kategori>K</kategori><fase>V</fase><nummer>7660</nummer></veg><lengde>0.0</lengde></oversikt><punkt veglenkesekvensNvdbId=""42651"" posisjon=""0.60475016""><sideposisjon>V</sideposisjon><geometri><srid>5973</srid><wkt>POINT (275789.2740009451 7041171.569511681)</wkt></geometri></punkt></stedfesting></vegobjekt></stedfestingResultat>
{noformat}
Denne forskjellen gÃ¥r ikke bra ved sammenkobling. SÃ¥ jeg Ã¸nsker derfor videre Ã¥ ta en stedfesting av kun new-88 til E6. Dette gir imidlertid en feil. Her er jeg usikker pÃ¥ om dette er en feil pga ytelsestest mot Skriv i ATM pÃ¥ gjennomfÃ¸ringstidpunkt eller om dette er en faktisk feil, men poenget i denne saken gÃ¥r ikke pÃ¥ det. Kibana: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-utv-beats-6.8.13-2021.02.12/doc/?id=5nJLlncBczWDIpQ8Hm0p]
h2. Forslag

Ved kopiering til nytt objekt (ny type eller ikke) sÃ¥ beholdes geometri. Kunne vi da bare beholdt stedfestingen ogsÃ¥ - og samtidig satt denne til grÃ¸nn i stedfestingsfanen? Dersom geometri endres i etterkant sÃ¥ blir det en annen sak, og da fÃ¥r man jo muligheten til Ã¥ re-stedfeste, men nÃ¥r geometri ikke endres sÃ¥ vil et slikt forslag bevare stedfestingen fra NVDB og vi kan fÃ¥ fÃ¦rre problemer.

Â 
h2. LÃ¸sning

Ved kopiering av objekt kopieres stedfesting fra det originale objektet. Det gjelder bÃ¥de kopiering innenfor samme objekttype og kopiering til ny objekttype. OgsÃ¥ hvor sikker stedfestingen er kopieres. Eksempel: kopi av vegobjekt med usikker stedfesting vil ogsÃ¥ fÃ¥ usikker stedfesting.

Endret knappen ""Kopier geometri til ny objekttype"" til ""Kopier til annen objekttype"". (""kopier geometri og stedfesting ..."" ble litt langt). Forklarer bedre i dialogen som kommer opp hva som skjer.",NVDB-6937,Datafangst,
Leveranseinformasjon,"*Testes av SVV:*
 * NVDB-6496 -Sjekke at stÃ¸tte for import av v2 url ikke stÃ¸ttes lenger (og at v3 funker)
 * NVDB-6369Â -Sjekke at manuelt angi stedfestning i ny versjon funker
 * NVDB-6253Â -Sjekke oppdatert pÃ¥loggingshjelp for fk
 * NVDB-6226Â -SjekkeÂ Visning av stedfesting pÃ¥ flere veger
 * NVDB-5669Â -Sjekke at en kan registrere nye dÃ¸tre til samme NVDB-mor pÃ¥ samme dag
 * NVDB-6351Â -Sjekke at hendelseslogg er sortert etter nyeste Ã¸verst
 * NVDB-6354Â -Sjekke changelog som egen DF komponent
 * NVDB-6364Â -Sjekke at ny manuell stedfesting funker for de to observasjonene (sosi filer er i attachment)
 * NVDB-4510Â -Sjekke at Morobjekter fra NVDB importeres til kontrakten
 * NVDB-6514Â -Sjekke at scrolling funker i sammenkoblingsfanen for dÃ¸tre ++NY TorbjÃ¸rn!!
 * Siste her er ny TorbjÃ¸rn(6514)

*Testes av leverandÃ¸r:*
 * NVDB-6416Â -Sjekke at polling stopper ved automatisk stedfestning nÃ¥r stedfestning allerede er satt
 * NVDB-6464Â -Sjekke riktig feilkoder 405, 409
 * NVDB-6499 -Sjekke at E2E tester kjÃ¸res grÃ¸nt etter oppdatert webpack-cli

*Testes ikke i ATM:*
 * NVDB-6437Â - Integrasjonstest -Â Validere geometritype i alle vegobjekter
 * NVDB-6465Â - Tekstendringer - Oppdatere dokumentasjon om feilkoder
 * NVDB-6475Â -Integrasjonstest",NVDB-6937,Datafangst,
Manglende beskjed om Ã¥ registrere mor samtidig i eksportfanen,"*Observasjon #1*

(Fra NVDB-4510): Laster inn 96.sos og kobler til NVDB-mor 95. I eksport fanen sÃ¥ fÃ¥r jeg ikke beskjed om at 95 mÃ¥ registreres samtidig ved markering av kun 96 (serÂ MISSING_RELATION_IN_CHANGESET: 1 i responsen). FÃ¥r melding om at 96 mÃ¥ registreres samtidig som 95 ved kun Ã¥ markere 95.

*Observasjon #2*

Importerer et NVDB-objekt av type 95 (95-1011051982 v2) og 96.sos. Kobler NVDB-objektet til det nye 96-objektet internt i kontrakten. FÃ¥r samme observasjon som i #1 med at det ikke kommer melding om Ã¥ registrere 95 samtidig ved kun markering av 96 i eksportfanen.

Gjenskapt pÃ¥ UTV ved Ã¥ importere 95-599558224 fra kartet i datafanen + 96.sos. Kobler disse sammen (kontrakt-til-kontrakt) etter Ã¥ ha stedfestet 96. Samme observasjon. Eksportfanen: Markering av kun 95 gir beskjed om Ã¥ markere 96 samtidig, mens markering av kun 96 gir ingen info om hva som mÃ¥ registreres sammen med 96 + registrer-knappen er disablet.",NVDB-6937,Datafangst,
Mangler markering av NVDB-mor etter sammenkobling,"h2. Observasjon

Etter Ã¥ ha funnet kandidatmÃ¸dre i NVDB, for deretter Ã¥ koble kontrakt-datter til en NVDB-mor, sÃ¥ ble tilkoblet NVDB-mor tidligere ""farget"" grÃ¸nn (kan det ha noe med at den tidligere fikk klassen ""isInTargetAssociation"", noe den ikke fÃ¥r nÃ¥). Det skjer ikke nÃ¥. Etter import av NVDB-mor sÃ¥ kan jeg nÃ¥ markere den nye datteren og pÃ¥ nytt hente opp aktuelle mÃ¸dre. Da er ikke allerede pÃ¥koblet NVDB-mor markert som tidligere. Skulle man da fÃ¥tt beskjed (med en grÃ¸nnfarge) om at akkurat denne NVDB-mor allerede er koblet til datter

Â 

Fra [~havwig]:Â Jeg synes ogsÃ¥ at det skulle ha virket som fÃ¸r med markering, men det er en uforholdsmessig stor jobb. Vi kan vurdere Ã¥ enten skille det ut som en egen sak sÃ¥ vi kan ta dette ut nÃ¥, eller vente pÃ¥ et mer helhetlig redesign iÂ NVDB-6450.",NVDB-6937,Datafangst,
Doble kall for Ã¥ hente info i sammenkoblingsfanen,"h2. Observasjon

Jeg kobler til NVDB-mor som igjen har en NVDB-mor, og fÃ¥r da opp hierarkiet pÃ¥ venstre side. NÃ¥r jeg sÃ¥ markerer Tunnel for Ã¥ fÃ¥ vist info om denne tunnelen gÃ¥r det doble kall mot API Les. Dvs doble OPTIONS-kall og doble GET-kall (bÃ¥de for Ã¥ finne versjon og den faktiske versjonen).
h2. Gjenskap

Kan gjenskapes med Ã¥ importere 95.sos og koble til TunnellÃ¸p ""Helltunnelen"" (sÃ¸k 1000 m unna). Marker Tunnel. Og se i networks-tab under Inspect.",NVDB-6937,Datafangst,
boksen med egenskaper pÃ¥ sammenkobling brekker ved listeverdier,"Boksen for egenskapsverdier som vises nÃ¥r man har valgt et vegobjekt pÃ¥ sammenkoblingsfanen klarer ikke Ã¥ vise verdier riktig nÃ¥r verdiene er liste-verdier.

Â 

Analyse:

Fant ingen vegobjekter med egenskapstyper som hadde liste-verdier. Vi sÃ¥ derimot at vegobjekter med egenskapstyper med lange navn gjorde tabellen merkelig.",NVDB-6937,Datafangst,
Ta ut omitNorms fra solr-skjema,"Det er sannsynligvis ikke nÃ¸dvendig Ã¥ ha ""omitNorms=x"" i skjemaet, og det forÃ¥rsaker en del systemmisnÃ¸ye i loggene. Jeg har derfor blitt anbefalt at vi bÃ¸r fjerne dem.",NVDB-6937,Les-API,
For lave lengder i veglistene,"Vegliste arbeid har feil (altfor smÃ¥) lengdeverdier. Iallfall for BK tÃ¸mmertransport, uoffisiell (objekttype 901) for Vestland fylke langs Fv50:Â 

!image-2021-02-11-14-06-33-467.png!

Her har vi ett NVDB-objekt for hvert av strekningene, sÃ¥ dette burde vÃ¦re en veldig god case for feilsÃ¸king og feilretting.Â 

Riktige verdier:Â 
|Â Â  nvdbId|Strekningsbeskrivelse|Sum lengde|
|777617084|Arm Steine bru - Bjelde|1159,340|
|777617562|Viken gr. / Geiteryggen - Aurland (Nyheim) x E16|42394,511|

Â 

Â 

Â 

Â ",,Rapportgenerator,
"Oppdatering av datakatalog via Skriv, lÃ¸sningsbeskrivelse/design m/grovestimater","Ref. NVDBFOR-446, samt forelÃ¸pig utredning pÃ¥Â [Oppdatering av datakatalog - Veg og transport â€“ NVDB og Geodata - Confluence (vegvesen.no)|https://www.vegvesen.no/wiki/display/NVDBogGeodata/Oppdatering+av+datakatalog]

Â 

Vi gÃ¥r for ""Alt.3: Ny klient for Ã¥ generere endringssett med datakatalogendringer"", der klienten Ã¸nskes implementert som fane/menyvalg i Kontrollpanelet i Skriv.

Vi ber med dette om utarbeidelse av mer detaljert lÃ¸sningsbeskrivelse/design m/grovestimater.

Â 

LÃ¸sningsbeskrivelse:

[Ny klient for Ã¥ generere endringssett for datakatalogendringer - IKT - Forvaltning og videreutvikling - Confluence (vegvesen.no)|https://www.vegvesen.no/wiki/pages/viewpage.action?pageId=147710190]",NVDB-6937,Skriv-API,
Flytte api-client koden fra bintray,"Bintray vil foreta seg en sÃ¥kalt ""sunset"" hvor de ikke lenger vil hoste opensource-kode ( https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/ ).
Dette medfÃ¸rer at vi bÃ¸r flytte vekk ""client-api"" repoet vÃ¥rt fra Bintray, og til en annen tjeneste, feks. Maven central.",NVDB-6937,Les-API,
Fikse integrasjonstester i LES V3,"Integrasjonstester feiler ofte i LES V3. Det har vÃ¦rt snakk om at det noe randomisering som brukes i testene. Dette kan fÃ¸re til at testene noen ganger kjÃ¸rer OK og andre ganger ikke. Hadde vÃ¦rt greit Ã¥ fÃ¥ disse testene mer konsistente, og at lykkes oftere.

!jenkins.png|thumbnail!

Â 

*LÃ¸sning*

Har tatt en ny datadump og gjort noen justeringer i henting av testdata. Det ser ut til Ã¥ lÃ¸se de periodiske feilene vi har hatt i det siste.",NVDB-6937,Les-API,
Oppdatert status for objekt i kontrakt,"Ã˜nske om Ã¥ vise informasjon og oppdatert status for objekt.

Til dÃ¸mes:
 * om det kom inn frÃ¥ SOSI, API, NVDB
 * om det er uendra eller oppdatert
 * er det levert til nvdb, forsÃ¸kt levert...",NVDB-6937,Datafangst,
DÃ¸tre for lukking vises i sammenkobling,"h2. Observasjon

Last inn en ny mor og en datter til lukking. Ved forsÃ¸k pÃ¥ Ã¥ manuelt sammenkoble ny mor til NVDB-datter i prosjektet, sÃ¥ fÃ¥r man en HTTP 400 pÃ¥ kalletÂ /create_manually med beskjedenÂ 
{noformat}
(FeatureToBeClosedException) Attempting to associate from/to feature with id 9d2e1419-c614-409f-bd73-342a3dbe4903Â and NVDB id 1011051973:1 that is marked for closing
{noformat}
NVDB-objekter som har operasjon Lukk burde ikke kunne blitt valgt i utgangspunktet inne i sammenkoblingsfanen. Disse bÃ¸r filtreres bort.

Dette er et problem ogsÃ¥ noen pÃ¥ support har stÃ¸tt borti:Â 

[https://vegdata.kantega.no/kibana/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:'2021-02-07T23:00:00.000Z',mode:absolute,to:'2021-02-12T22:59:59.999Z'))&_a=(columns:!(_source),index:'datafangst-logs-*',interval:auto,query:(language:lucene,query:'HOSTNAME:datafangst.kantega.no%20AND%20%22d36ca338-ff40-427d-8db1-3f229a164227%22%20AND%20%22that%20is%20marked%20for%20closing%22'),sort:!('@timestamp',desc))]",NVDB-6937,Datafangst,
Endre til responsrevisjon 2,"NVDB-6493 innfÃ¸rer gruppering av kontraktsomrÃ¥der og riksvegruter, slik at kontrakter som bestÃ¥r av flere objekter i NVDB vises som Ã©n kontrakt. 
NÃ¥r et kontraktsomrÃ¥de velges i Vegkart ser det ut som de faktiske objektene for kontrakten blir hentet. Det mÃ¥ undersÃ¸kes om dette mÃ¥ endres og hva det brukes til.",NVDB-6937,Vegkart,
Oppgradere npm pakker,"Oppgradere generelle npm pakker.

Se siste versjon av pakkene vi bruer med: npx npm-check-updates

Bla. ny versjon av React og Leaflet.",NVDB-6937,Datafangst,
Innsending med dirty ute av sync gir systemfeil,"Det kan skje at vegobjekter ved en feil (f.eks. fra NVDB-6516) bli markert som endret (""dirty"") i databasen, uten at det er faktiske endringer.

Da kan bruker sende inn, men vil fÃ¥ systemfeil fordi vi ender opp med et tomt endringssett. Vi kunne ha brukt denne anledningen til Ã¥ synkronisere oss pÃ¥ dirty, sÃ¥nn at i de tilfeller vi finner at et objekt er dirty men ikke har endringer sÃ¥ nullstiller vi dirty. I sÃ¥ fall mÃ¥ bruker fÃ¥ en fornuftig beskjed tilbake om at det ikke er noen innsending (siden hen forventer Ã¥ fÃ¥ det), men at status er oppdatert eller noe.",NVDB-6937,Datafangst,
Godkjenning av innsendt stedfesting gir dirty vegobjekt,"Support-sak fra Jon BrÃ¥ten (Jon.Braten@afgruppen.no) 8. februar, etter at han har klaget over ""dÃ¥rlig pÃ¥litelighet"" og at Datafangst har glemt status.

I dette konkrete tilfellet ser det ut som det er vegobjekter som er sendt inn, for sÃ¥ Ã¥ fÃ¥ godkjent sin stedfesting pÃ¥ nytt (sikkert som en del av et stÃ¸rre utvalg). For dette sÃ¥ beholder vi operasjon for stedfesting, sÃ¥ den skrives ikke pÃ¥ nytt (som forventet), men selv om alle stedfestinger er satt til ""READ"" sÃ¥ settes fortsatt vegobjektet til ""dirty"".

Steg for Ã¥ reprodusere:
 # Last opp og stedfest vedlagt SOSI
 # Send inn til NVDB, sjekk at ingen vegobjekter er markert som endret etterpÃ¥
 # Veg en stedfesting og trykk ""Godkjenn"" pÃ¥ den
 # Se at eksport-fanen nÃ¥ rapporterer om ett endret vegobjekt",NVDB-6937,Datafangst,
Scrolling i sammenkoblingsfanen,"h2. Observasjon

I sammenkoblingsfanen, velg et vegobjekt som har mange potensielle dÃ¸tre. Det gÃ¥r ikke an Ã¥ scrolle selv om lista over potensielle dÃ¸tre blir sÃ¥ lang at den er lengre enn vinduet.

!image-2021-02-08-15-23-54-702.png!
h2. Analyse

Feilen oppstÃ¥r i Blink-baserte nettlesere som Edge og Vivaldi, og Firefox (Gecko) men oppstÃ¥r merkelig nok ikke i Chrome.

Jeg antar dette har mest med timing i DOM vs renderen Ã¥ gjÃ¸re. Feilen oppstÃ¥r nÃ¥r listen over dÃ¸tre blir sÃ¥ lang at listen fÃ¥r scrollbar.
 Elementene er implementert med Flex-layout, men elementene blir ikke contained i flex-boxen riktig. jeg tror dette oppstÃ¥r fordi listen fÃ¥r en kakulerte hÃ¸yde som er hÃ¸yere enn max tillatt innenfor flexboksen. Da burde overflow-regelen slÃ¥tt inn, men det gjÃ¸r den bare i chrome.Â 
h2. LÃ¸sning

Vi kan hjelpe rendrene litt pÃ¥ vei ved Ã¥ sette height: 0 pÃ¥ listen, slik at den blir initelt rendret som veldig liten, og flex-grow regelen blir overholdt.

Â ",NVDB-6937,Datafangst,
Statistikk veglister,"Som kunnskapsgrunnlag for veglisteproduksjon Ã¸nsker vi en logg over hvilke veglisterapporter som er kjÃ¸rt i systemets levetid. Ideelt sett bÃ¸r denne loggen ha med tidspunkt, type og geografisk omrÃ¥de. Jeg antar kanskje at innholdet i databasen samsvarer med valgmulighetene i AP, sÃ¥ ut fraÂ [Swagger UI (vegvesen.no)|https://nvdbrapportapi.atlas.vegvesen.no/swagger-ui/#/Veglister/get_rapporter_veglister__bruksklasse_]Â skulle det bli noe slikt som :Â 
 * bruksklasse
 * fylke (liste)
 * kommune (liste)
 * publisering (boolean)Â 
 * vegsystemreferanse

Ved produksjonstopper sÃ¥ er bÃ¥de PROD, ATM og UTV - miljÃ¸ene brukt, sÃ¥ vi trenger nok statistikk fra alle tre miljÃ¸ene.Â ",NVDB-6825,Rapportgenerator,
FÃ¥r ikke koblet til NVDB-datter pÃ¥ importert NVDB-mor pga feil versjon,"*Observasjon*

Oppdaget under test avÂ NVDB-5669. Fant ut under analyse av saken at det er NVDB-5713 som blokkerer denne (som NVDB-6365), men beholder saken for enkel re-testing.

Her har jeg koblet til ny 96 pÃ¥ NVDB-obj 95 og registrert. UTFÃ˜RT. Deretter koblet til NVDB-obj 96Â pÃ¥ samme NVDB-obj 95. Da feiler registreringen med at det ikke finnes noen relasjon fra gammel NVDB-mor til NVDB-datter (DF vil slette assosiasjon pÃ¥ v2, men v2 av NVDB-mor har ikke denne assosiasjonen, det er det v1 som har).

*Gjenskap*

Last inn 96.sos. Stedfest og koble til NVDB-obj 95Â (ikke velgÂ 1011051974). Registrer. Deretter velg importert NVDB-obj 95Â og koble til NVDB-datter (velgÂ 1011051973). Da feiler registreringen medÂ _1011051974: Egenskapstypen 220004 finnes ikke i objektet_.

*Problem*

Relatert til at Les gir ut feilaktig foreldre-relasjon for Skiltplata. Se [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/96/1011051973/1.json]Â hvor forelder er 95-1011051974 (i tillegg til riktig mor). Dette kan ogsÃ¥ sjekkes via Skriv sitt Kontrollpanel - velg _Innsyn_ og tast inn 95 -Â 1011051974 - v1/v2).

LÃ¸ses nok ikke fÃ¸r NVDB-5713.",NVDB-6937,Datafangst,
Systemfeil ved aut.sammenkobling nÃ¥r NVDB-objekt ikke har stedfesting,"h2. Observasjon

Laster inn vedlagte SOSI og kjÃ¸rer auto-sammenkobling mot dÃ¸tre i NVDB (avstand 25). Da kommer det en systemfeil opp.

[https://datafangst.utv.vegvesen.no/#!/contract/bb291d56-c106-4630-aa76-c4524557aad5/association]

Kan se ut til at vi klarer Ã¥ sende avgÃ¥rde [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/-1]

som gir et uventet svar tilbake.

Se Kibana logg for kontrakten over:

[https://vegdata.kantega.no/kibana/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:'2021-02-04T23:00:00.000Z',mode:absolute,to:'2021-02-05T22:59:59.999Z'))&_a=(columns:!(_source),index:'datafangst-logs-*',interval:auto,query:(language:lucene,query:'HOSTNAME:datafangst-utv.kantega.no%20AND%20%22bb291d56-c106-4630-aa76-c4524557aad5%22'),sort:!('@timestamp',desc))]

Â ",NVDB-6937,Datafangst,
Gap i segmentert vegnett (gir geometrifeil pÃ¥ veglenker i Elveg2.0),"h3. Sak frÃ¥ Arne SonflÃ¥

Jeg har ""tunet"" geometrikontrollene pÃ¥ Elveg20 nÃ¥ og finner en del geometrihull pÃ¥ veglenkene. NÃ¥r disse oppsto vet jeg ikke, men de var ikke der i september i alle fall.

Stedene feilene oppstÃ¥r er der vi har gateobjekter som ikke er snappet til port. Da blir det hull pÃ¥ 1-3 meter i veglenkegeometrien fÃ¸r resten av lenka kommer videre.

Lurer pÃ¥ om dette kan ha noe med at LES nÃ¥ segmenterer pÃ¥ gate?? (mail fra Marvin 19.01). Men uansett om den segmenterer pÃ¥ gate skal ikke slike hull pÃ¥ veglenkene oppstÃ¥.

Ettersom Einar snart skal slutte og det ifÃ¸lge det siste jeg har hÃ¸rt jobbes med ny eksport (stemmer det?) sÃ¥ lurer jeg pÃ¥ hva som er det beste Ã¥ gjÃ¸re. Er ny eksportfunksjon snart klar er det vel greit Ã¥ vente pÃ¥ den. Om ikke sÃ¥ bÃ¸r Einar finne ut hva som er feil og rette det? Jeg vet i alle fall ikke, men en plan bÃ¸r vi ha. Jeg finner en del feil i mine kontroller der avstand mellom lenkedelene er mindre enn 2,5 meter, men klarer ikke Ã¥ finne de over. Og Hans JÃ¸rgen har ingen kontroll som kan gi meg en fornuftig liste over hvor vi har slike gate objekter.

Eksempel pÃ¥ lenker som fÃ¥r brudd pÃ¥ geometrien er
 * 2462758
 * 2461671
 * 2461571

Alle i kommune 1528
h3. Svar frÃ¥ Linda StÃ¸eng:

Ser i Vegkart at det ogsÃ¥ er gap her, sÃ¥ dette handler nok om segmenteringen (NVDB-6040 Segmetering av vegnett og Gate - JIRA for Statens vegvesen).

2462758: PV99059
2461671: PV99176
2461571: PV99192


[Vegkart (vegvesen.no)|https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@65573,6941095,10/hva:~(~(id~538))/hvor:~(kommune~(~1528)~vegsystemreferanse~(~'PV99176~'PV99059~'PV99192))/vegnett:~'geometri+~()]
Â 
Det er helt riktig at slike gap ikke skal oppstÃ¥. Jeg husker ikke om det ble forutsatt at Gate skulle dekke hele veglenka. Det er jo en naturlig forutsetning vil jeg tro, men det finnes helt sikkert eksempler der gate ikke skal dekke hele veglenka, f.eks. der en veg ender blindt (?).",NVDB-6937,Les-API,
Vegobjektersegmenter mangler omrÃ¥der,"KontraktsomrÃ¥der, riksvegruter og gate mangler i vegobjektsegmenter. Dataene er der, sÃ¥ de trenger bare skrives ut,
",NVDB-6937,Les-API,
Leveranseinformasjon,"*Testes av SVV i ATM:*
 * NVDB-6283: Sjekk Vegkart-lenkene i observasjonene
 * NVDB-6397: Sjekk skrivefeil
 * NVDB-6489: Verifiser ingen vit.notasjon pÃ¥ relativ posisjon i lenke fra beskrivelsen (sammenlign ATM og Prod)
 * NVDB-6443: Sjekk dokumantasjon for gater ([https://nvdbapiles-v3.test.atlas.vegvesen.no/dokumentasjon/openapi])

*Testes av leverandÃ¸r i ATM:*
 * NVDB-6472: Sjekk at riktig cache-Control-header benyttes. Bruk gjerne Vegkart.

Saker i leveransen som ikke er nevnt over trenger ikke eksplisitt Ã¥ testes.

*MERK* at noen av sakene krever at NVDBIND V3 2021.2.0 er levert og reindeksert (https://www.vegvesen.no/jira/projects/NVDB/versions/17403)",NVDB-6937,Les-API,
Melding om Ã¥ benytte v3 for import,"Dersom det er oppgitt url til API v2 ved import skal det gis ein beskjed om at det ikkje lenger er stÃ¸tte for det.
h3. Forslag til tekst:

_API-v2 kan ikke lenger benyttes for import fra NVDB. Benytt API-v3 for Ã¥ importere._
_Ved bruk av Vegkart for Ã¥ generere API-URL, mÃ¥ den nÃ¥ hentes fra ""Nye"" Vegkart. Vegkart-2019 kan ikke lenger benyttes for Ã¥ generere API-URL til import._",,,
Fjerne stÃ¸tte for API-v2-import,"Import av objekt med API-v2 skaper potensielt problemer med multigeometri. Det skjer dersom det er feil i NVDB frÃ¥ fÃ¸r. Det skjer ikkje ved Ã¥ bruke v3.Det er ikkje behov for Ã¥ stÃ¸tteimport over v2, sÃ¥ vi kan unngÃ¥ problemet med Ã¥ fjerne stÃ¸tte for import.",NVDB-6937,Datafangst,
Klipp/kopier vegsysref med kommunenummer for KPS,"Funksjonen for Ã¥ klikke pÃ¥ veg og kopiere vegreferanse gir ikkje unik referanse for KPS. For Ã¥ gjere det mÃ¥ den ha med evt. kommunenummer i referansen.
h2. Beskrive behov:

[https://www.vegvesen.no/_attachment/2912425/binary/1360253?fast_title=Faktaark+-+Vegreferansesystemet+i+NVDB.pdf]

Ref ERF veg OK

Fungerer slik det skal i vegkart og API

Â 

KPS-veger derimot blir som faktaarket sier ikke unike uten kommunenummer.

Bare for Ã¥ ha klarlagt det, sÃ¥ nei folk vet ikke hva kommunen heter nÃ¸dvendigvis og langt mindre kommunenummer.

Â 

Kan bruke der jeg bor som eksempel

PV91596 S1D1 m88

Som gÃ¥r ut fra

SV439 S1D1 m321

Â 

Disse blir ikke unike uten prefikset 4 sifret kommunenummer

Tilfeldigvis er privatvegen unik i norge men skogsbilvegen finnes i 18 kommuner

Â 

Â 

Eksempeloppslag pÃ¥ PV1S1D1 viser hvordan dette da selvsagt ikke blir unikt

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@311259,6915208,4/hva:~(~(id~915))/hvor:~(vegsystemreferanse~(~'PV1S1D1))]

Â 

Men at kommunenummer mÃ¥ vÃ¦re del av omrÃ¥deoppslaget Â (I vegkart er ikke kommune nummer sÃ¸kbart kun kommunenavnet)

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@261088,6729184,9/hva:~(~(id~915))/hvor:~(kommune~(~3443)~vegsystemreferanse~(~'PV1S1D1))]

Â 

Â 

En veldig stor andel av oppdragene kommer inn med stedfestinger langs vegnettet, veldig ofte i form av excel ark.

Selv om jeg i tunge stunder har tenkt at excel burde avskaffes i denne etaten er nok ikke det sannsynlig at vil skje sÃ¥ vi vil fortsette Ã¥ fÃ¥ inn stedfestinger pÃ¥ denne mÃ¥ten.

Â 

Vi har testet litt nÃ¥ i forbindelse med MilitÃ¦rÃ¸velsen Joint Viking 2021

Â 

Der vi sendte ut fÃ¸lgende hjelpetekst for Â«sikkerÂ» stedfesting av strekninger.

Hele poenget her er klikk og kopier uten menneskelige feil

Â 
|Ã…pne vegkart|+[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@744529,7639849,5]+|
|Enkel bruksanvisning for vegkart:|+[http://www.vegdata.no/vegkart/brukerveiledning/]+|
|For innlegging i lista|Klikk i kartet for Ã¥ fÃ¥ Ã¸nsket fra posisjon.|
|Â |Kopier med knappen til hÃ¸yre|
|Â |Lim inn i de angitte kolonnene i regnearket|
|+[FRA_KOPIERT|https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@744529,7639849,5]+|Â |Â |Â |
|TIL_KOPIERT|Â |Â |Â |

Â  !klipp-lim.png!

Dersom denne metodikken kan nyttes ogsÃ¥ for KPS veger hadde dette forenklet men da mÃ¥ minimum kommunenummeret legges pÃ¥ for KPS vegene i Vegkart

Helst burde ogsÃ¥ Kortformen berikes med kommunenummer for disse vegene KPS.

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/915?segmentering=true&kartutsnitt=257987.477%2C6775502.963%2C258622.478%2C6775812.857&vegsystemreferanse=SV439S1D1&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

Â 

<lokasjon>

<kommuner>

<kommune>3411</kommune>

</kommuner>

<fylker>

<fylke>34</fylke>

</fylker>

<vegsystemreferanser>

<vegsystemreferanse>

<vegsystem>

<id>1002451341</id>

<versjon>1</versjon>

<vegkategori>S</vegkategori>

<fase>V</fase>

<nummer>439</nummer>

</vegsystem>

<strekning>

<id>-1</id>

<versjon>-1</versjon>

<strekning>1</strekning>

<delstrekning>1</delstrekning>

<arm>false</arm>

<adskilte_lÃ¸p>Nei</adskilte_lÃ¸p>

<trafikantgruppe>K</trafikantgruppe>

<fra_meter>0.0</fra_meter>

<til_meter>1587.317</til_meter>

<retning>MED</retning>

</strekning>

<kortform>SV439 S1D1 m0-1587</kortform>

</vegsystemreferanse>

</vegsystemreferanser>

Â 

Alternativet blir at dette mÃ¥ Â«TrekkesÂ» ut og behandles sÃ¦rskilt pÃ¥ uttrekksklienter.

Geodata AS jobber konkret med en slik klient og vi er i dialog med dem.

KORTFORM er der basis ID for bygging av Rute datasett

Â 

Setter Jan Kristian ogsÃ¥ pÃ¥ kopi siden han har holdt i trÃ¥den pÃ¥ NVDB Uttrekk arbeidet.

Â 

Med hilsen
 Roger Bakkestuen

Statens vegvesen, Transport og samfunn
 Transportutvikling, Geodata 3
 *BesÃ¸ksadresse:*Â Industrigata 1,Â Lillehammer
 *Mobil:*Â +47Â 94833636Â *epost:*Â [roger.bakkestuen@vegvesen.no|mailto:roger.bakkestuen@vegvesen.no]
 [www.vegvesen.no|http://www.vegvesen.no/]Â *epost:*Â [firmapost@vegvesen.no|mailto:firmapost@vegvesen.no]",NVDB-6937,Vegkart,
Aggregering av kontraktsomrÃ¥der og riksvegruter,"/omrader/kontraktsomrader og /riksvegruter antar det er ett objekt per kontrakt. 
Aggreger objekter som tilhÃ¸rer samme kontrakt. 
Utlisting av alle objektene i kontrakten blir ny responsrevisjon.",NVDB-6937,Les-API,
Nye regler for KOSTRA veglengder,"Regelverket for beregning av veglenger har vÃ¦rtÂ  uklart, nÃ¥ har vegnettsgruppa talt:Â 

Vi teller med kryssdeler, og typeveg=kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun og veglenketype=hoved.Â 

Vi teller IKKE med sideanlegg, konnekteringslenker og _adskilte lÃ¸p=Mot_.Â 

Dette er nesten, men ikke helt slik NVDB rapporter gjÃ¸r det nÃ¥, tror jeg.Â 

{'sideanlegg': 'false', 'trafikantgruppe': 'K', 'detaljniva': 'VT,VTKB', 'adskiltelop': 'med,nei', 'typeveg': 'kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun', 'historisk': 'true', 'tidspunkt': '2020-12-31', 'veglenketype': 'hoved'}

Â 

Unntaket her er 4-feltsveg-rapporten, der det ikke gir mening Ã¥ ta med kryssdeler.Â ",NVDB-6826,Rapportgenerator,
Merkelig systemfeil-tilfelle i STM,"h2. Observasjon

1) Endringssett https://nvdbapiskriv-stm.utv.atlas.vegvesen.no/kontrollpanel/#/jobs/view/ecd15d89-14e7-4273-a6d6-89db2c8dded8 havner i SYSTEMFEIL, men det er uklart hvorfor. Hendelsesloggen ser ikke helt frisk ut.

2) Et annet eksempel fra PROD: https://nvdbapiskriv.atlas.vegvesen.no/kontrollpanel/#/jobs/view/9f07a32a-f9a7-431d-8adf-7671e1486782. Endringssettet er i status SYSTEMFEIL, men hendelsesloggen ser OK ut.

h2. Analyse

1) Ser ut til at AutoPro eller Atlas-versjonen i STM ble avbrutt under behandling av dette endringssett da ny versjon ble rullet ut 2/2 kl 13:45. Det er rundt dette tidspunktet de merkelige innslagene dukker opp i hendelsesloggen. Ved oppstart prÃ¸ver ActiveMQ Ã¥ sende start-meldingen pÃ¥ nytt. Dette kommer muligens i konflikt med at JobRecoveryService forsÃ¸ker Ã¥ tilbakestille endringssett som har vÃ¦rt i status RUNNING for lenge. Finner ingen logger fra AutoProd da de ikke er indeksert av Splunk. Finner heller ingenting i Atlas-loggene. 

2) Det kastes exception ved anrop LDAP-API rundt 28/1 kl 22:44:37 ifÃ¸lge Splunk:

https://loggsentralen.vegvesen.no/loggsentralen/en-GB/app/SVV_nvdbapis/search?q=search%20index%3D%22svvpnvdbapis%22%209f07a32a-f9a7-431d-8adf-7671e1486782%20sourcetype%3D%22nvdbapis-stacktrace%3ANA-log%22&display.page.search.mode=smart&dispatch.sample_ratio=1&earliest=1609455600&latest=1612442456&sid=1612453134.125629_C5996C14-FEA3-4A85-B277-7060A0DC991F

{code:java}
com.google.common.util.concurrent.UncheckedExecutionException: javax.ws.rs.ProcessingException: javax.net.ssl.SSLException: Connection reset
	at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2203)
	at com.google.common.cache.LocalCache.get(LocalCache.java:3937)
	at com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3941)
	at com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4824)
	at com.google.common.cache.LocalCache$LocalLoadingCache.getUnchecked(LocalCache.java:4830)
	at no.vegvesen.vt.nvdb.apiskriv.security.CachingLdapGateway.getUserProfile(CachingLdapGateway.java:32)
	at no.vegvesen.vt.nvdb.apiskriv.security.DefaultPermissionManager.hasPermission(DefaultPermissionManager.java:91)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.FeatureTypeAuthorizationJobFilter.doFilter(FeatureTypeAuthorizationJobFilter.java:31)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:117)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:133)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:466)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$0(JobWorker.java:177)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.processJobAndRetryOnException(JobWorker.java:230)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$1(JobWorker.java:144)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:47)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:143)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.rabbitmqclient.RabbitMqSubscription.onMessage(RabbitMqSubscription.java:181)
{code}

Dette fÃ¸rer helt korrekt til SYSTEMFEIL, men det er ingen spor etter det i hendelsesloggen i Kontrollpanelet. Siste innslag der er 11:46 samme dag med info om VENTER_PÃ…_LÃ…S.
Et sÃ¸k i EVENT og EVENT_THREAD-tabellene viser imidlertid at SYSTEM_ERROR er registrert der:

{code:sql}
select et.title, e.time, e.code
from nvdbapiskriv.event_thread et, nvdbapiskriv.event e
where et.job_id = '9f07a32a-f9a7-431d-8adf-7671e1486782'
and e.code = 'SYSTEM_ERROR'
and e.thread_id = et.id
order by e.time;
{code}

NÃ¥r Kontrollpanelet skal hente hendelser sendes requesten https://nvdbapiskriv.atlas.vegvesen.no/kontrollpanel/data/events?jobid=9f07a32a-f9a7-431d-8adf-7671e1486782 som resulterer i et sÃ¸k i databasen med default ""page"" pÃ¥ [0, 1000]. Dersom det, som i dette tilfellet, er flere enn 1000 events, vil de overskytende ikke bli returnert til Kontrollpanelet.

h2. LÃ¸sning

I jobs.services.js i frontendkoden for Kontrollpanelet utvides funksjonen getJobEvents() til Ã¥ hente alle ""pages"" med hendelser, ikke bare de 1000 fÃ¸rste.
",NVDB-6937,Skriv-API,
Format pÃ¥ desimaltall i xml-svar fra api bÃ¸r forandres,"""Hei, Jeg tror jeg har oppdaget en liten feil. Jeg fikk problemer med parsing av XML som returneres fra denne https://nvdbapiles-v3.atlas.vegvesen.no/veg/batch?veglenkesekvenser=0.00065647%40578625 . <relativPosisjon> inneholder en desimalverdi pÃ¥ ""scientific notation"", og det liker ikke XML-parseren min. I fÃ¸lge dette http://books.xmlschemata.org/relaxng/ch19-77057.html sÃ¥ er det heller ikke tillatt i XML. Akkurat for min applikasjon sÃ¥ trenger jeg ikke egentlig denne verdien, sÃ¥ jeg kan alltids parse den som streng i stedet for tall. Men det burde kanskje vÃ¦rt rettet?""

Vi burde legge om fra vitenskapelig notasjon pÃ¥ denne verdien slik at ikke brukere opplever unÃ¸dvendig trÃ¸bbel med parsing.",NVDB-6937,Les-API,
SpÃ¸rredb fÃ¥r ikke oppdatert datakatalog ved datakatalogoppdatering,Den delen av SpÃ¸rredatabasen som lagrer data laster datakatalogen kun ved oppstart. SÃ¥ gammel datakatalog blir brukt etter datakatalogoppdatering.,NVDB-6937,NVDB-IND,
Skjemaendring kreves for Solr-8.7.0,En liten skjemaendring som kreves for Solr-8.7.0,NVDB-6937,NVDB-IND,
Oppgrader curator,"NVDBIND og API bruker ganske gammel versjon av [Curator|https://curator.apache.org/]. 
NÃ¥r nvdb-shared definerte Solr 8.7.0 ble nyere versjon av zookeeper dratt inn, som ikke er kompatibel med den versjonen av Curator som er brukt. Oppgrader til siste versjon av Curator.",NVDB-6937,NVDB-IND,
Gyldig fra dato vises feilaktig pÃ¥ last ned som SOSI-modal,"gyldighet er noe som er relevant for NVDB, men ikke for nedlasting av sosi

Â 

!image-2021-01-29-14-01-38-417.png!",NVDB-6937,Datafangst,
"Skriv avviser med feil sideposisjon, men den ser rett ut","h2. Observasjon

Se kontrollpanel her:

[https://nvdbapiskriv.test.atlas.vegvesen.no/kontrollpanel/#/jobs/view/2461d66e-e1b9-49d5-bc54-ad3d95a9fc51]

Endringssettet er avvist medÂ STEDFESTING INNENFOR MOROBJEKT MEN ANNEN SIDEPOSISJON, men bÃ¥de mor og datter har sideposisjon H

h2. Analyse

Endringssettet avvises med:

{noformat}
2a9a2d4d-a74a-4413-b9c9-794abdfb2ae7 Feil STEDFESTING INNENFOR MOROBJEKT MEN ANNEN SIDEPOSISJON Objektet har stedfesting som fullstendig dekkes av morobjekt av type Skiltpunkt (95), men sideposisjonene er forskjellige: nvdbId 1011052124:2
{noformat}

Vegobjekt av type skiltplate (96), med tempId 2a9a2d4d-a74a-4413-b9c9-794abdfb2ae7, registreres i endringssettet med fÃ¸lgende stedfesting:

{code:json}
""punkt"": [
    {
        ""posisjon"": 0.21161864,
        ""sideposisjon"": ""H"",
        ""veglenkesekvensNvdbId"": 72234
    }
]
{code}

I feilmeldingen refereres til morobjekt av type Skiltpunkt (95), med nvdbId 1011052124 som delvis oppdateres i samme endringssett. Oppdateringen bestÃ¥r i Ã¥ legge til skiltplaten over som datterobjekt. Stedfestingen til skiltpunktet i NVDB er:

{code:xml}
<punkt veglenkesekvensNvdbId=""72234"" posisjon=""0.21161864""/>
{code}

Stedfestingen er altsÃ¥ i samme punkt pÃ¥ vegnettet, men datterobjektet har angitt sideposisjon H, mens morobjektet ikke har angitt sideposisjon. Assosiasjonstypen som styrer sammenkoblingen mellom skiltpunkt og skiltplate krever at tverrposisjon er identisk, derfor avvises endringssettet. ",NVDB-6937,Skriv-API,
Datakatalog og omrÃ¥der cachet i en uke,"For endepunktene som stÃ¸tter ETag (alt under /omrader/ untatt /omrader/gater, og /vegobjekttyper/) har vi fÃ¸r satt header Â«Cache-Control: public, max-age=604800Â». 
Denne sier til nettleseren at responsen kan caches i en uke. Dette kan fÃ¸re til at brukere ikke fÃ¥r opp de kontraktsomrÃ¥dene og riksvegrutene de forventer.
Endres til Â«Cache-Control: must-revalidateÂ», som gjÃ¸r at det alltid blir gjort et kall til Les, men om det ikke er noen endringer vil responsen vÃ¦re 304 uten innhold.",NVDB-6937,Les-API,
E2E-test: FÃ¥ karttestene til Ã¥ virke igjen,"Karttestene har ikke fungert, dvs klikk og sjekk av selve kartet og objekter her, pÃ¥ en stund pga Cypress ikke har latt et klikk traversere ned til selve objektene. Dette skjedde ved overgangen fra ol 5.x til ol 6.x.

Etter litt initiell testing ser det nÃ¥ ut til at Cypress (oppgradert mye siden siste forsÃ¸k) klarer Ã¥ propagere et klikk ned til objektene i kartet.

Oppgaven gÃ¥r pÃ¥ Ã¥ fÃ¥ karttestene for desktop og mobil opp Ã¥ kjÃ¸re igjen (desktop_map.js og mobile_map.js).",NVDB-6937,Vegkart,
Bedre sortering/utvalg i sÃ¸k,"h2. Problemstilling
Det er fast rekkefÃ¸lje pÃ¥ sÃ¸keresultat i vegkart. Objekttype - Fylke - Kommune - Riksvegrute ---Â 
Resultat visast i den rekkefÃ¸lje og nÃ¥r det er sÃ¸kt med tal, som til dÃ¸mes 50. Det er truleg ikkje sÃ¥ mange som sÃ¸ker etter kommune etter nummer, og i alle fall ikkje utan Ã¥ skrive inn alle fire siffer.
Resultat pÃ¥ til dÃ¸mes kontraktomrÃ¥de som ofte starter med nummer kan dÃ¥ visast legre oppe nÃ¥r sÃ¸ket er pÃ¥ tal.
Â 
h2. Supportsak
Stian Soberg
@StianSoberg_gitlab[Jan 14 11:20|https://gitter.im/nvdb-vegdata/vegkart-v3?at=60001ad981c55b09c708ef46]
Hva har skjedd med sÃ¸kefunksjonen i v-3 nÃ¥r den ikke lenger gir mest logiske resultat fÃ¸rst. Hvis jeg f.eks sÃ¸ker pÃ¥ 34(01) fÃ¥r jeg opp objekt typer og kommuner som i utgangspunktet ikke har 34 i seg fÃ¸rst?
Â 
!https://avatars2.githubusercontent.com/u/33287065?v=4&s=30!
Â 
magnusoy
@magnusoy[Jan 18 15:16|https://gitter.im/nvdb-vegdata/vegkart-v3?at=6005985b14cec811eca7616f]
I datakatalogen er alle typer vegobjekt ogsÃ¥ sÃ¸kbare med ID, sÃ¥ nÃ¥r du f.eks skriver 34 sÃ¥ sÃ¸ker den ogsÃ¥ blant id'ene til datakatalogen. Her finner du en komplett liste av alle typer vegobjekter i datakatalogen:Â [https://datakatalogen.vegdata.no/?sort=nummer]
!https://secure.gravatar.com/avatar/3c5f9ea584e5f524bc484a2098835d28?s=30&d=identicon!
Â 
Stian Soberg
@StianSoberg_gitlab[12:02|https://gitter.im/nvdb-vegdata/vegkart-v3?at=600ff6d46244ee1450b29574]
Det er greit men jeg Ã¸nsker jo og finne kontrakts omrÃ¥de 3402 og det kommer jo ikke opp som forslag en gang fÃ¸r pÃ¥ tredje sifferet og da nederst pÃ¥ lista med mange kontraktsomrÃ¥der over seg som ikke har noe med sifrene og gjÃ¸re.",NVDB-6937,Vegkart,
Oppdatere dokumentasjon om feilkoder,"Feilkodene 400-404 er beskrevet i dokumentasjon. 405, 409 og 413 mÃ¥ ogsÃ¥ legges inn.",NVDB-6937,Datafangst,
Endre feilkode 409 til 405,"Vi har forskjellige 409-feilkoder:
 # Feature collection [id] is currently being processed, please try again later
 # Feature collection [id] is not created from API, can't replace this collection
 # Feature collection [id] is not created from API, can't add to this collection

Ved nummer 1 er noe under behandling, sÃ¥ klienten mÃ¥ vente.

Ved nummer 2 og 3 sier vi at ressursen klienten prÃ¸ver Ã¥ skrive til er ikke skrivbar.

Â 

Nummer 2 og 3 kan endres til 405 - method not allowed.

Â ",NVDB-6937,Datafangst,
Merkelig stedfesting pÃ¥ kabel,"h2. Observasjon

Sjekker utÂ [kabel 1006210802|https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@267707,7031168,17/hva:~(~(id~92))/vegnett:~'geometri+~()/valgt:1006210802:92] (i Sandmoenkrysset) i forbindelse med testing av NVDB-6226. I NVDB sÃ¥ er denne kabelen stedfestet bÃ¥de pÃ¥ E6 og F704, sÃ¥ ville se hvordan det gikk med Skriv.

Jeg fÃ¥r stedfesting pÃ¥ kun E6, og det er jo fint. Men jeg fÃ¥r stedfesting bÃ¥de pÃ¥ pÃ¥kjÃ¸ringsrampa like ved som det er naturlig Ã¥ stedfeste til, pluss et lite segment til, som sÃ¥ vidt jeg kan se er langt unna. Det er stedfestet pÃ¥ veglenkesekvens-ID 72191, en rampe som dekker hele utstrekning av kabel, men i tillegg pÃ¥ 2641856 som etter det jeg kan se er ut av rundkjÃ¸ringa pÃ¥ vei ned mot 72191.

I tillegg blir opptegning i Datafangst veldig rar, mulig at vi fikser det selv, eller sÃ¥ er det kanskje noen feil med returnert WKT.
h3. Request
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <parametere>
        <maksimalAvstandTilVeg>300</maksimalAvstandTilVeg>
        <beregnSideposisjon>true</beregnSideposisjon>
    </parametere>
    <vegobjekter>
        <vegobjekt typeId=""92"" tempId=""616d4b15-7926-43d3-a9ee-5342b0996a9c"">
            <egenskaper>
                <egenskap typeId=""4792"">
                    <geometri>
                        <srid>5973</srid>
                        <wkt>LINESTRING (267675.72 7031216.75 143.033, 267675.14 7031214.92 142.943, 267673.59
                            7031210.17 142.783, 267672.22 7031205.7 142.633, 267672.17 7031205.47 142.603, 267671.84
                            7031204.53 142.383, 267671.32 7031202.89 142.783, 267671.51 7031200.49 143.293, 267671.69
                            7031198.06 143.843, 267671.74 7031196.02 144.243, 267671.56 7031193.22 144.603, 267671.29
                            7031190.16 144.923, 267671.38 7031189.83 144.893, 267676.3 7031170.83 143.753)
                        </wkt>
                        <datafangstdato>2018-05-23</datafangstdato>
                        <referansegeometri>false</referansegeometri>
                        <kvalitet>
                            <mÃ¥lemetode>96</mÃ¥lemetode>
                            <mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde>
                            <nÃ¸yaktighet>50</nÃ¸yaktighet>
                            <nÃ¸yaktighetHÃ¸yde>25</nÃ¸yaktighetHÃ¸yde>
                            <synbarhet>0</synbarhet>
                        </kvalitet>
                    </geometri>
                </egenskap>
            </egenskaper>
            <gyldighetsperiode>
                <startdato>2021-01-24</startdato>
            </gyldighetsperiode>
        </vegobjekt>
    </vegobjekter>
</stedfest>{noformat}
h3. Response
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt tempId=""616d4b15-7926-43d3-a9ee-5342b0996a9c"">
        <stedfesting>
            <oversikt>
                <veg>
                    <kategori>E</kategori>
                    <fase>V</fase>
                    <nummer>6</nummer>
                </veg>
                <lengde>223.76061914181741</lengde>
            </oversikt>
            <linje veglenkesekvensNvdbId=""72191"" fra=""0.07582129"" til=""0.51927188"">
                <sideposisjon>H</sideposisjon>
                <geometri>
                    <srid>5973</srid>
                    <wkt>LINESTRING (267747.187957764 7031104.19374847, 267744.73 7031100.99, 267740.27 7031096.68,
                        267735.19 7031093.21, 267729.6 7031090.65, 267723.75 7031089.11, 267720.931610107
                        7031088.64801025, 267717.52 7031088.57, 267714.284393311 7031088.5679245, 267710.640045166
                        7031089.17991638, 267702.7 7031091.39, 267699.156890869 7031092.53531647, 267691.46 7031094.96,
                        267689.27 7031095.72, 267687.11 7031096.55, 267685.1 7031097.39, 267682.86 7031098.45, 267680.8
                        7031099.51, 267678.78 7031100.64, 267676.79 7031101.85, 267674.85 7031103.13, 267672.96
                        7031104.47, 267671.12 7031105.88, 267669.33 7031107.36, 267667.59 7031108.9, 267665.9
                        7031110.49, 267664.28 7031112.15, 267662.72 7031113.87, 267661.22 7031115.65, 267659.78
                        7031117.48, 267658.43 7031119.39, 267657.15 7031121.36, 267655.97 7031123.37, 267654.88
                        7031125.44, 267653.89 7031127.55, 267652.98 7031129.71, 267652.18 7031131.9, 267651.48
                        7031134.13, 267650.87 7031136.39, 267650.37 7031138.67, 267649.96 7031140.96, 267649.65
                        7031143.28, 267649.46 7031145.61, 267649.37 7031147.94, 267649.38 7031150.29, 267649.55
                        7031153.56, 267649.9 7031156.82, 267650.14 7031158.43, 267650.69 7031161.05, 267650.92
                        7031162.05, 267651.57 7031164.63, 267651.8 7031165.52, 267652.74 7031169.01, 267653.72
                        7031172.49, 267654.17 7031174.02, 267654.75 7031175.94, 267655.82 7031179.4, 267655.98
                        7031179.89, 267656.94 7031182.83, 267657.91 7031185.72, 267658.09 7031186.24, 267659.3
                        7031189.64, 267660.54 7031193.02, 267661.84 7031196.4, 267662.18 7031197.26, 267663.18
                        7031199.74, 267664.55 7031203.08, 267665.97 7031206.39, 267666.95 7031208.6, 267667.43
                        7031209.69, 267668.95 7031212.97, 267669.51 7031214.18, 267670.49 7031216.23, 267671.69757602253
                        7031218.708708678)
                    </wkt>
                </geometri>
            </linje>
            <linje veglenkesekvensNvdbId=""2641856"" fra=""0.30178672"" til=""1.0"">
                <sideposisjon>H</sideposisjon>
                <geometri>
                    <srid>5973</srid>
                    <wkt>LINESTRING (267751.38 7031117.87, 267751.2 7031117.01, 267750.59 7031114.55, 267749.71
                        7031110.42, 267748.34 7031106.41, 267747.85 7031105.18, 267747.187957764 7031104.19374847)
                    </wkt>
                </geometri>
            </linje>
        </stedfesting>
    </vegobjekt>
</stedfestingResultat>{noformat}
h2. Analyse

API Les sin ruteberegner gir fÃ¸lgende resultat:

!VisRute.png|thumbnail!

Kabelen er markert i gult, mens beregnet rute vises i blÃ¥tt. Ruten gir mening fordi den starter pÃ¥ veglokasjonen som er nÃ¦rmest geometriens start og slutter pÃ¥ veglokasjonen som er nÃ¦rmest geometriens slutt. API Skriv masserer responsen ved Ã¥ fjerne konnekteringslenkesegmenter og finner deretter lengste sammenhengende delrute innenfor samme veg, i dette tilfellet EV6. Responsen fra Skriv blir dermed to sammenhengende segmenter som representerer hele rampen fra avkjÃ¸ring EV6 helt fram til rundkjÃ¸ringen.

Dette er en stedfesting som forventet gitt geometrien til kabelen. Det merkelige resultatet mÃ¥ tilskrives kabelgeometrien kombinert med den litt kinkige vegsituasjonen i omrÃ¥det. API Skriv kan ikke forventes Ã¥ produsere ""perfekt"" stedfesting for alle situasjoner og denne mÃ¥ nok manuelt stedfestes i etterkant ved Ã¥ angi EV6 som Ã¸nsket veg. I sÃ¥ fall produserer API Skriv ""perfekt"" stedfesting, det vil si bare den delen av rampen som kabelen kan projiseres ned pÃ¥.

Â 

*LÃ¸sning*

Tar vare pÃ¥ mer enn bare nÃ¦rmeste veglenke for start og endepunkt, og lagt til et steg som sjekker om kalkulert rute er mer enn 3 ganger lengre enn innsendt geometri. I tilfelle dette slÃ¥r til forsÃ¸kes det med alternative endepunkt.",NVDB-6937,Les-API,
FÃ¥r ikke stedfestet pÃ¥ angitt gangveg,"h2. Observasjon

Ikke noe resultat for denne i prod, der vegobjekt ligger rett over gangveg. Kan ha noe med angitte typeVeg Ã¥ gjÃ¸re.

(!) I ATM fÃ¥r jeg stedfesting, men pÃ¥ feil veg. Datafangst sender ikke med noe for typeVeg der av en eller annen grunn, men en kurve som ligger rett over gangvegen burde vel kanskje bli plassert der ogsÃ¥ uten valg av typeVeg?
h3. Request
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <parametere>
        <maksimalAvstandTilVeg>300</maksimalAvstandTilVeg>
        <veger>
            <veg>
                <kategori>F</kategori>
                <fase>V</fase>
                <nummer>503</nummer>
            </veg>
        </veger>
        <typeVeger>
            <typeVeg>GANG_OG_SYKKELVEG</typeVeg>
            <typeVeg>SYKKELVEG</typeVeg>
            <typeVeg>GANGVEG</typeVeg>
            <typeVeg>GÃ…GATE</typeVeg>
            <typeVeg>FORTAU</typeVeg>
            <typeVeg>TRAPP</typeVeg>
            <typeVeg>GANGFELT</typeVeg>
        </typeVeger>
        <beregnSideposisjon>true</beregnSideposisjon>
    </parametere>
    <vegobjekter>
        <vegobjekt typeId=""791"" tempId=""f307a11a-914c-4fe1-9aa7-243b389a87c6"">
            <egenskaper>
                <egenskap typeId=""8874"">
                    <geometri>
                        <srid>25833</srid>
                        <wkt>LINESTRING (-14834.69 6534556.01 101.76, -14832.67 6534555.61 101.86, -14830.65 6534555.78
                            101.96000000000001, -14828.82 6534555.9 102.08, -14825.04 6534557.39 102.33, -14817.71
                            6534561.69 102.88, -14813.19 6534562.85 103.2, -14806.37 6534563.72 103.56, -14797.5
                            6534565.06 103.97, -14790.01 6534566.39 104.31, -14783.12 6534567.87 104.62, -14775.27
                            6534569.93 104.95, -14765.22 6534572.91 105.35000000000001, -14756.02 6534576.13 105.65,
                            -14747.5 6534579.43 105.87, -14737.46 6534583.84 106.09, -14723.24 6534590.77
                            106.35000000000001, -14710.86 6534596.88 106.60000000000001, -14690.99 6534606.6
                            106.85000000000001, -14672.52 6534615.66 107.03, -14654.34 6534624.55 107.12, -14643.56
                            6534629.69 106.93, -14635.5 6534632.97 106.72, -14635.37 6534633.02 106.74000000000001)
                        </wkt>
                        <datafangstdato>2020-12-09</datafangstdato>
                        <referansegeometri>false</referansegeometri>
                        <kvalitet>
                            <mÃ¥lemetode>96</mÃ¥lemetode>
                            <mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde>
                            <nÃ¸yaktighet>5</nÃ¸yaktighet>
                            <nÃ¸yaktighetHÃ¸yde>5</nÃ¸yaktighetHÃ¸yde>
                            <synbarhet>0</synbarhet>
                        </kvalitet>
                    </geometri>
                </egenskap>
            </egenskaper>
            <gyldighetsperiode>
                <startdato>2021-01-22</startdato>
            </gyldighetsperiode>
        </vegobjekt>
    </vegobjekter>
</stedfest>
{noformat}
h3. Response
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt tempId=""f307a11a-914c-4fe1-9aa7-243b389a87c6"">
        <feil>
            <feil kode=""STEDFESTING_MISLYKTES"">
                <melding>Ingen relevant vegnettstilknytning ble funnet med de angitte parametere</melding>
            </feil>
        </feil>
    </vegobjekt>
</stedfestingResultat>
{noformat}

h2. Analyse

Requesten over gir samme respons (STEDFESTING_MISLYKTES) bÃ¥de i ATM og PROD.

Se https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@-14759,6534574,18/vegnett:~'geometri+~()/valgt:3296617:2:1

Geometrien ligger rett over gang- og sykkelveg FV508. Requesten ber om stedfesting for ulike ""gÃ¥ende"" typeveger for veg FV503. Det finnes ikke slike i omrÃ¥det. API Les returnerer derfor ingen rute, hvilket er korrekt.

Dersom vegparameteren droppes blir det generert rute (og stedfesting) pÃ¥ FV508.
",NVDB-6937,Skriv-API,
Leveranseinformasjon,"*Testes av SVV i AT:*
 * NVDB-6427: Ta inn NVDB-mor og -datter for Ã¥ sammenkoble. Se at dette gÃ¥r bra. Tips til test i kommentar pÃ¥ saken.
 * NVDB-6366: Regresjonstest av Ã¥ stedfeste objekter som kan og kan ikke ha sideposisjon. Sjekk datafanen etter stedfesting.
 * NVDB-6055: Gjenta testbeskrivelse i saken og verifiser at det fungerer

*Testes av leverandÃ¸r i AT:*
 * NVDB-5228: Verifiser at multigeometri mot API ikke gÃ¥r. Sjekk at endring pÃ¥ NVDB-objekt med multigeo kan endres og lagres. Se testbeskrivelser i saken.
 * NVDB-6301: Sjekk at https returneres i ressurser fra API - og ikke http
 * NVDB-6211: Sjekk at kall mot Les og Skriv inneholder unik ID. Sjekk i Splunk at denne finnes igjen.

Saker i leveransen som ikke er nevnt over trenger ikke Ã¥ eksplisitt testes i ATM",NVDB-6937,Datafangst,
"Feil formatering pÃ¥ sÃ¸keord i openapi ""try it out""","I les-apiets openapi (https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/ ) finner man under diverse mulige sÃ¸k en ""try it out"" funksjon som hjelper brukere Ã¥ sette sammen spÃ¸rringer. 

De funker dog ikke spesielt bra nÃ¥ fordi de formaterer sÃ¸keord med stor forbokstav (Kommune), mens apiet kun godtar smÃ¥ forbokstaver (kommune). 

Dette resulterer i at man som regel fÃ¥r en respons som ligner denne:

{code:java}
[
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Fylke"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Kontraktsomrade"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Overlapp"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Veglenkesekvens"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Riksvegrute"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Vegsystemreferanse"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: dybde"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Kommune"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Kartutnitt"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  },
  {
    ""code"": 4013,
    ""message"": ""Ukjent parameter: Polygon"",
    ""help_url"": ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Vegobjekter""
  }
]
{code}


Utover dette har vi fÃ¥tt flere tilbakemeldinger pÃ¥ openapi ""test it out"":

""Det er ogsÃ¥ litt forvirrende at eksemplet her: https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Posisjon/get_veg tilsynelatende skal ha som input en liste av vegsystemreferanser, men det er uklart hvilket format som skal brukes for dette. Eksempelet som kommer fram (List [ ""EV6S1D1m341"", ""R6S1D1m1300KD4m129"", ""SP12S1D3m123"" ]) godtas ikke, ei heller forenklingen til EV6S1D1m341, R6S1D1m1300KD4m129, SP12S1D3m123; da fÃ¥r man beskjed om at ""MÃ¥ inneholde bare en vegreferanse"".""
",NVDB-6937,Les-API,
Ikke treff pÃ¥ vegobjektsÃ¸k med plassering 0 eller 1 pÃ¥ veglenkesek,"bq. ""Hei! Her er en bug-report pÃ¥ filtrering pÃ¥ veglenkesekvens. Det ser ut som at filtreringen sliter med grenseverdier for veglenkeposisjon - nÃ¥r relativ veglenkeposisjon er 0 eller 1 fÃ¥r man ikke treff. Men nÃ¥r man bytter ut 0 og 1 med 0.000001 og 0.999999, sÃ¥ finner man dem. I stedfestingen til objektene stÃ¥r det at de skal ha startposisjon/sluttposisjon lik 0/1, sÃ¥ de skulle ha dukket opp opprinnelig. Eksempler i trÃ¥d.""
bq. ""https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/616?veglenkesekvens=0@1993681""
bq. ""https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/616?veglenkesekvens=1@444329""

Det er altsÃ¥ slik at kall mot /vegobjekter/id?veglenkesekvens=0 eller 1 aldri gir treff.",NVDB-6937,Les-API,
SÃ¸ke pÃ¥ navn i tilknyttet bruker,"I dag kan vi berre legge til brukarnamn (e-post eller SVV-brukar) nÃ¥r ein brukar skal knyttast til kontrakt.

Dette er spesielt problematisk med p-brukarar som ikkje ka nidentifiserast med brukaren pÃ¥ anna mÃ¥te enn oppslag i oversikt.

Veg Ã¥ kunne sÃ¸ke pÃ¥ regsitrerte brukarar i Datafangst vil dette vere lettare for alle.",NVDB-6937,Datafangst,
Stedfestingsfeil for kontraktsomrÃ¥de oppdages ikke,"h2. Observasjon

V2 har meldt feil ved full reindeksering og indeksering av vegnett, nÃ¦rmere bestemt segmentering for starten av lenkesekvens 2539075:

2021-01-19 01:32:43 [segmenter] ERROR NetComponentBuilder - Error segmenting RefLinkPart(CONNECTION, [2539075@0.0|mailto:2539075@0.0] - 0.00444528) 2021-01-12 - null, [no.vegvesen.nvdb.segmentation.SpatialObjectCollection@5fdfb971|mailto:no.vegvesen.nvdb.segmentation.SpatialObjectCollection@5fdfb971], [ConnectedContract\{id=1008541173, version=1, startPos=0.0, endPos=0.00444528, startDate=2020-05-22, endDate=null}, ConnectedContract\{id=1008541173, version=1, startPos=0.0, endPos=1.0, startDate=2020-05-22, endDate=null}, ConnectedContract\{id=1009963296, version=8, startPos=0.0, endPos=1.0, startDate=2021-01-12, endDate=null}, ConnectedContract\{id=1009963299, version=2, startPos=0.0, endPos=1.0, startDate=2020-04-24, endDate=null}], [], 2020-06-22T10:01:20

svvpnvdbind01:/data/vegkart/logs/nvdbind>

Etter litt forskning fant jeg fram til at kontraktsomrÃ¥de med NVDB_ID=1008541173 hadde interntt overlappende lokasjonsattributter, og det ser ut som om dette er innfÃ¸rt i fÃ¸lgende endringssett, sendt inn fra NovaPoint 7. desember 2020:

Id: 60f8b281-e8a5-44e9-b5f1-2c9228d7a7c2 
Ekstern referanse: Joakim_Vegnett 2020-12-07 20-27
Mottatt: 2020-12-07 22:05:12
Klient: Novapoint
API-versjon: 3
Eier: joamoy

Resultatet ble to lokasjonsattributt pÃ¥ lenkesekvens 2539075, akkurat som angitt over.

Etter at denne interne overlappen ble eliminert, feiler ikke lenger indeksering av vegnett i V2.

Jeg mener dette er en datafeil for stedfesting, som bÃ¸r oppdages av validering i Skriv, og
 * enten fÃ¸re til feilmelding og avvisning av endr.settet,
 * eller elimineres av logikk i Skriv (evt. med NB-melding).

Er det definert noen validering i Skriv som burde fanga opp dette?

Dette burde kanskje ogsÃ¥ vÃ¦rt oppdaget/forhindret i Novapoint.

h2. Analyse

Jeg tror hovedproblemet i denne saken er hvordan API Skriv hÃ¥ndterer styringsregelen â€œretningsrelevantâ€. Regelen angis med 0/1 (Nei/Ja) i datakatalogen. API Skriv tolker â€œJaâ€ som at retning MÃ… angis pÃ¥ stedfestingselementer (og avviser endringssettet om det mangler), mens â€œNeiâ€ tolkes som at retning ikke mÃ¥ angis, men endringssettet avvises ikke dersom retning likevel er satt. I dette konkrete caset er det snakk om vegobjekter av type KontraktsomrÃ¥de, som har retningsrelevant=Nei og API Skriv godtar dermed vilkÃ¥rlig bruk av retningsattributten i stedfestingen.

API Skriv har allerede optimalisering av overlappende og butt-i-butt stedfestingselementer, men denne algoritmen tar hensyn til retning, sideposisjon og kjÃ¸refelt. Er det overlapp i veglenkesekvensintervallet mellom to stedfestingselementer vil det derfor ikke utfÃ¸res sammenslÃ¥ing dersom de har ulik retning, sideposisjon eller kjÃ¸refelt.

Jeg tenker at fixâ€™en her er Ã¥ tolke retningsrelevant pÃ¥ (nesten) samme mÃ¥te som sideposisjonrelevant og kjÃ¸refeltrelevant. AltsÃ¥ tolke verdi 0 som â€œKAN IKKEâ€ og avvise bruk av retning, og tolke verdi 1 som â€œMÃ…â€ og kreve retning (som nÃ¥). Alternativt kunne vi ogsÃ¥ tolket verdi 1 som â€œKANâ€, slik som for sideposisjon og kjÃ¸refelt, og ikke avvise dersom retning mangler. I mitt hode virker imidlertid ikke det siste alternativet korrekt slik jeg forstÃ¥r datakatalogen.

Tilbakemelding fra Vilhelm B og Hans Anton:

Vi er langt pÃ¥ veg enig i det du skriver, Tore. Imidlertid er det slik at nesten alle stedfestinger i NVDB har verdi, DIR=1 (MED), for retning, og vi mistenker at det kan finnes tilfeller der verdi er forventa, selv om objekttypen ikke er retningsrelevant. Vi ber derfor om at Skriv inntil videre for objekttyper uten retningsrelevans ikke tar hensyn til verdien pÃ¥ retning, mens retningsrelevante objekttyper fortsatt valideres som i dag. Dersom dette medfÃ¸rer at lokasjonsattributt kan slÃ¥s sammen, men har ulike verdier for retning, som i eksemplet med KontraktsomrÃ¥de, lagres verdien 1 pÃ¥ det sammenslÃ¥tte lokasjonsattributtet.

h2. LÃ¸sning

Endret OptimizeLocationalAttributeFilter.optimizeLocationalAttribute til Ã¥ anrope ny metode Locational.optimizeNonDirectional nÃ¥r vegobjekttypen ikke er retningsrelevant.  Implementerte Locational.optimizeNonDirectional og LocationalLine.optimizeNonDirectional.",NVDB-6937,Skriv-API,
Redesign av sammenkobling med mindre fokus pÃ¥ i kontrakt vs i NVDB,"Dagens design for brukergrensesnittet for sammenkobling er fra da Datafangst hovedsaklig var kun for Ã¥ legge nye vegobjekter inn i NVDB, og det var lite import til kontrakt eller endring av innsendte vegobjekter.

Dette brukergrensesnittet bÃ¸r designes pÃ¥ nytt ut i fra dagens forutsetninger, der det ikke er et like skarpt skille mellom i eller utenfor NVDB.

Det er ogsÃ¥ etterspurt en ny type kobling (NVDB-6387) som det kan vÃ¦re naturlig Ã¥ se i sammenheng her.",NVDB-6937,Datafangst,
Geometri pÃ¥ segmenter opprydding,"Etter NVDB-6283 er prodsatt kan det ryddes opp skjema (fjerne ubrukte felt) og fjernes noe kode iÂ SolrRoadObjectSegmentDecoder som er kommentert med TODO.

Fjern de gamle feltene fra segmentFields i QueryBuilders i api-et.",NVDB-6937,NVDB-IND,
V2/V3 Arealberegning med withAreaFromAttributeOrCrossSection feiler,"Lengdeberegning med metodenÂ withAreaFromAttributeOrCrossSection gir 30-55% stÃ¸rre verdier enn det vi fÃ¥r med python-kode som gjÃ¸r tilsvarende summering av V4-rapporten.

Akkurat nÃ¥ vet vi ikke om det er python-koden, NVDB rapporter eller begge som er feil.Â 

Jeg har prÃ¸vd Ã¥ finne en fasit for Mur (62 StÃ¸ttekonstruksjon) med vedlagte python-script (forutsetter en del biblioteker). Beregnigen i detalj:Â 

Areal fra 521 objekter med Areal-egenskap: 58773.0
 -Areal fra 192 objekter der vi bruker lengde- og hÃ¸ydeegenskap: 19831-
 -Areal fra 131 vegsegmenter (121 objekt) der vi bruker vegnettlengdeÂ  X hÃ¸ydeegenskap 14844-
 -Areal totalt: 93447 <= NVDB rapporter har 190093 (E+R) + 25946 (G/S) = 216039 m2.-Â  Â 

Dobbeltsjekker lengden langs veg ogsÃ¥
 Lengde ut fra egenskap: 44214
 Lengde ut fra vegnett: 16388
 Lengde totalt: 60602

Â ",,Rapportgenerator,
Oppgradere frontend-bygg til webpack 5,"Ny major versjon av webpack har vÃ¦rt ute en stund, og pÃ¥ et eller annet tidspunkt mÃ¥ vi oppgradere. Dette haster ikke, men kan vÃ¦re en fin oppgave for Ã¥ bli bedre kjent med byggesystemet.

https://webpack.js.org/migrate/5/",NVDB-6937,Datafangst,
Gater er ikke dokumentert ,/omrader/gater mangler i dokumentasjonen. Sjekk ogsÃ¥ at det er dokumentert i vegobjekt og veglenkesegment-respons.,NVDB-6937,Les-API,
SynliggjÃ¸re sÃ¸k pÃ¥ vegreferanse og NVDB-ID,"Det er ikkje synleg i Vegkart at man kan gjere sÃ¸k pÃ¥ vegreferanse. Det er noko som ein berre mÃ¥ vite om.
Kan dette synleggjerast for brukar?",NVDB-6937,Vegkart,
Feil automatisk sideposisjon ved rundkjÃ¸ring,"h2. Observasjon

Mail fra Jon BrÃ¥ten (Jon.Braten@afgruppen.no) pÃ¥ datafangst-support 15/1 16:04. Usikker pÃ¥ om dette er noe vi fÃ¥r gjort noe med, i alle fall sÃ¥ lenge Datafangst kun stedfester enkeltobjekter, men dere fÃ¥r se pÃ¥ det.
----
Jeg tror det mÃ¥ vÃ¦re en bug i den automatiske sideposisjoneringen. Her har den registrert HÃ¸yreposisjon nÃ¥r det skal vÃ¦re venstre. Det kan virke som det noe rot med stedfesting og rundkjÃ¸ring da det for sÃ¥ vidt er korrekt at rekkverksenden er HÃ¸yre nÃ¥r den kun er stedfestet i rundkjÃ¸ringen. Det oppstÃ¥r et problem nÃ¥r rekkverket ogsÃ¥ er stedfestet Â utenfor rundkjÃ¸ringen og retningen da er motsatt.

Â 

Â  !image006.jpg! 

Â  !image007.jpg! 

Som dere ser her sÃ¥ er jo kurven stedfestet bÃ¥de pÃ¥ rundkjÃ¦ringen og rettlinjen, mens rekkverksenden kun er i rundkjÃ¸ringen.

Â  !image008.jpg! 

Kan dere sjekke dette?

Â 

For moro skyld sÃ¥ kjÃ¸rte jeg gammel stedfesting pÃ¥ kurvene og tvang de inn pÃ¥ rundkjÃ¸ringen. Da forsvant de feilmeldingene og jeg fikk registrert alt i NVDB.

h2. Analyse

SvÃ¦rt tidkrevende Ã¥ reprodusere dette caset da det verken er angitt X-Request-ID, request/respons fra stedfestingstjenesten eller vegobjekt-id.

Reproduserte stedfestingen ved Ã¥ hente det jeg tror er nevnte rekkverk fra https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/5/1013166898/1.

Rev ut geometrien herfra og kjÃ¸rte denne requesten mot stedfestingstjenesten:

{code:xml}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <parametere>
        <maksimalAvstandTilVeg>300</maksimalAvstandTilVeg>
        <veger>
            <veg>
                <kategori>F</kategori>
                <fase>V</fase>
                <nummer>409</nummer>
            </veg>
        </veger>
        <typeVeger>
            <typeVeg>ENKEL_BILVEG</typeVeg>
            <typeVeg>KANALISERT_VEG</typeVeg>
            <typeVeg>RAMPE</typeVeg>
            <typeVeg>RUNDKJÃ˜RING</typeVeg>
        </typeVeger>
        <beregnSideposisjon>true</beregnSideposisjon>
    </parametere>
    <vegobjekter>
        <vegobjekt typeId=""5"" tempId=""2d1c0a30-04dc-4073-8b1b-3de6d90590a9"">
            <egenskaper>
                <egenskap typeId=""4714"">
                    <geometri>
                        <srid>25833</srid>
                        <wkt>LINESTRING Z(138628.19052113325 6501111.248446529 65.34, 138630.21257454116 6501111.353813271 65.31, 138630.24246977415 6501111.350909486 65.31, 138630.40481480188 6501111.365317872 65.31, 138630.77933024504 6501111.389295003 65.3, 138630.97157050506 6501111.400799604 65.29, 138631.0323288992 6501111.404957117 65.29, 138631.08312221547 6501111.410082555 65.29, 138631.15384568705 6501111.413272136 65.29, 138631.40587641223 6501111.418969172 65.29, 138631.52739319962 6501111.4272841895 65.29, 138631.88903977763 6501111.422334016 65.28, 138631.93983309355 6501111.427459453 65.28, 138631.98965848138 6501111.422619813 65.28, 138632.03048671992 6501111.428713181 65.28, 138632.2616193599 6501111.426380993 65.27, 138632.57150469162 6501111.406340303 65.26, 138632.61233292992 6501111.412433671 65.26, 138632.63226308487 6501111.410497814 65.26, 138633.0019388807 6501111.384649556 65.25, 138633.15238297085 6501111.380095715 65.25, 138633.19224328082 6501111.376224005 65.25, 138633.22213851317 6501111.373320222 65.25, 138633.38157975272 6501111.357833374 65.24, 138633.75028761796 6501111.32202004 65.23, 138633.80011300527 6501111.317180402 65.23, 138634.11802755413 6501111.27624163 65.22, 138634.3362913286 6501111.244982139 65.21000000000001, 138634.37615163805 6501111.241110428 65.21000000000001, 138634.40604687022 6501111.238206643 65.21000000000001, 138634.48479956115 6501111.220498141 65.21000000000001, 138634.851571567 6501111.164754657 65.2, 138634.94028933498 6501111.146078228 65.19, 138634.97018456686 6501111.143174442 65.19, 138634.9901147216 6501111.141238588 65.19, 138635.01904202555 6501111.128369725 65.19, 138635.21737564355 6501111.099046091 65.19, 138635.57224671397 6501111.024340378 65.17, 138635.93611493253 6501110.93870166 65.12, 138636.02386477188 6501110.910060155 65.1, 138636.29901522218 6501110.843097868 65.09, 138636.58316282107 6501110.765202573 65.08, 138636.66191551049 6501110.747494072 65.08, 138637.012914865 6501110.632928053 65.07000000000001, 138637.15948723827 6501110.588513904 65.06, 138637.19837961905 6501110.574677117 65.07000000000001, 138637.36391421844 6501110.518362034 65.06, 138637.7149135708 6501110.403796016 65.05, 138637.76280310075 6501110.379026224 65.05, 138638.06397706678 6501110.269299846 65.04, 138638.32529072434 6501110.163445181 65.03, 138638.4130405619 6501110.134803678 65.02, 138638.75117105083 6501109.991310356 65.01, 138638.86688026343 6501109.939834916 65.01, 138639.08833361138 6501109.837851962 65, 138639.4155310942 6501109.685361496 64.99, 138639.44445839728 6501109.672492636 64.99, 138639.7607228745 6501109.511005021 64.98, 138639.97124321654 6501109.40002492 64.97, 138640.08598450036 6501109.3385844035 64.97, 138640.41027819784 6501109.15619871 64.95, 138640.49609217886 6501109.107627057 64.95, 138641.972242016 6501108.149459128 63.93)</wkt>
                    </geometri>
                </egenskap>
            </egenskaper>
            <gyldighetsperiode>
                <startdato>2021-01-13</startdato>
            </gyldighetsperiode>
        </vegobjekt>
    </vegobjekter>
</stedfest>
{code}

Responsen var:

{code:xml}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt tempId=""2d1c0a30-04dc-4073-8b1b-3de6d90590a9"">
        <stedfesting>
            <oversikt>
                <veg>
                    <kategori>F</kategori>
                    <fase>V</fase>
                    <nummer>409</nummer>
                </veg>
                <lengde>21.80261827381404</lengde>
            </oversikt>
            <linje veglenkesekvensNvdbId=""2809662"" fra=""0.90136236"" til=""0.96668122"">
                <sideposisjon>V</sideposisjon>
                <geometri>
                    <srid>5973</srid>
                    <wkt>LINESTRING (138619.65458841514 6501109.175709964, 138620.3 6501106.52, 138620.64 6501105.14, 138621.62030895 6501100.80423356)</wkt>
                </geometri>
            </linje>
            <linje veglenkesekvensNvdbId=""2809650"" fra=""0.8607037"" til=""0.95206637"">
                <sideposisjon>H</sideposisjon>
                <geometri>
                    <srid>5973</srid>
                    <wkt>LINESTRING (138635.00007580407 6501095.289942364, 138635 6501095.29, 138631.99 6501096.77, 138629.24 6501097.55, 138625.72 6501097.84, 138623 6501097.55, 138622.39 6501097.4)</wkt>
                </geometri>
            </linje>
        </stedfesting>
    </vegobjekt>
</stedfestingResultat>
{code}

Beregnet stedfesting er korrekt plassert delvis pÃ¥ konnekteringslenke koblet til rundkjÃ¸ringen og en lenke i rundkjÃ¸ringen. Sideposisjon er ogsÃ¥ korrekt beregnet for hvert av elementene relativ til de to lenkeretningene.

Den delen av stedfestingen som er inne i rundkjÃ¸ringen har sideposisjon H, det samme som rekkverksenden som nevnes over. Slik jeg tolker caset blir rekkverksenden avvist fordi den ikke har samme sideposisjon som rekkverket inne i rundkjÃ¸ringen. Dette valideres av constraint'ene CoveredByParent og CoversChild. Begge delegerer til klassen InsideParentEvaluator for Ã¥ finne eventuelle feil. Her ser det ut til at det ikke tas hensyn til at sideposisjon (og kjÃ¸refelt) kan variere nÃ¥r stedfestingen bestÃ¥r av flere elementer. Sammenligningen gjÃ¸res mellom sideposisjon hentet fra fÃ¸rste element for begge vegobjekter og de er jo forskjellige.

h2. LÃ¸sning

InsideParentEvaluator oppdateres til Ã¥ matche korrekte stedfestingselementer mot hverandre nÃ¥r sideposisjon (og kjÃ¸refelt) sammenlignes.",NVDB-6937,Skriv-API,
Ruteberegning av rekkverk,"Se vedlagt SOSI. Denne stedfestes i Datafangst gjennom Skriv/Les. Her er to utvalgte rekkverk med observasjoner.
h2. KURVE 3

Her gÃ¥r rekkverket langs en veglenkesekvens som man forventer den stedfestet til. Men muligens er ene enden nÃ¦rmere en annen veglenkesekvens som gjÃ¸r at stedfestingen ser litt ""unÃ¸dvendig ut"". Se skjermbilde KURVE3.png vedlagt som viser ruteberegningen fra [https://nvdb-vegdata.github.io/nvdb-visrute/ATM/]

Resultat: [ 0.0-0.66325399@805009,Â 0.73497357-1.0@805010 ]

POST [https://nvdbapiskriv.test.atlas.vegvesen.no/rest/v3/stedfest]
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><parametere><maksimalAvstandTilVeg>300</maksimalAvstandTilVeg><veger><veg><kategori>R</kategori><fase>V</fase><nummer>555</nummer></veg></veger><typeVeger><typeVeg>KANALISERT_VEG</typeVeg><typeVeg>ENKEL_BILVEG</typeVeg><typeVeg>RAMPE</typeVeg><typeVeg>RUNDKJÃ˜RING</typeVeg><typeVeg>GATETUN</typeVeg></typeVeger><beregnSideposisjon>true</beregnSideposisjon></parametere><vegobjekter><vegobjekt typeId=""5"" tempId=""e67748ae-ea03-40c0-8b45-4fdcc317ee69""><egenskaper><egenskap typeId=""4714""><geometri><srid>25833</srid><wkt>LINESTRING (-32323.43 6733673.33 0, -32320.38 6733670.95 0, -32318.4 6733667.91 0, -32316.55 6733665.26 0, -32314.96 6733661.82 0, -32314.3 6733658.12 0, -32314.030000000002 6733654.41 0, -32314.43 6733650.98 0, -32315.36 6733647.54 0, -32316.68 6733643.3 0, -32327.66 6733634.7 0, -32337.05 6733626.7700000005 0)</wkt><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>45</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>-1</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>100</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>0</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2021-01-15</startdato></gyldighetsperiode></vegobjekt></vegobjekter></stedfest>
{noformat}
POST [https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""start"":null,""slutt"":null,""geometri"":""LINESTRING (-32323.43 6733673.33, -32314.96 6733661.82, -32315.36 6733647.54, -32316.68 6733643.3, -32337.05 6733626.77)"",""maks_avstand"":300,""omkrets"":100,""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""RV555"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2021-01-15"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
*Ny stedfesting med forankring gjennom Skriv*

Skriv har innfÃ¸rt elementet <forankring> som spesifiserer start- og sluttpunkt i kallet mot /rute i stedet for Ã¥ oppgi geometri. Ved Ã¥ bruke denne sÃ¥ blir stedfestingen bra. Se vedlagte bilde KURVE3_medForankring.png.

POST [https://nvdbapiskriv.test.atlas.vegvesen.no/rest/v3/stedfest]
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><parametere><maksimalAvstandTilVeg>300</maksimalAvstandTilVeg><forankring><srid>5973</srid><startWkt>POINT (-32328.88597080266 6733667.570919707)</startWkt><sluttWkt>POINT (-32340.303678489945 6733629.524711821)</sluttWkt></forankring><veger><veg><kategori>R</kategori><fase>V</fase><nummer>555</nummer></veg></veger><typeVeger><typeVeg>KANALISERT_VEG</typeVeg><typeVeg>ENKEL_BILVEG</typeVeg><typeVeg>RAMPE</typeVeg><typeVeg>RUNDKJÃ˜RING</typeVeg><typeVeg>GATETUN</typeVeg></typeVeger><beregnSideposisjon>true</beregnSideposisjon></parametere><vegobjekter><vegobjekt typeId=""5"" tempId=""e67748ae-ea03-40c0-8b45-4fdcc317ee69""><egenskaper><egenskap typeId=""4714""><geometri><srid>25833</srid><wkt>LINESTRING (-32323.43 6733673.33 0, -32320.38 6733670.95 0, -32318.4 6733667.91 0, -32316.55 6733665.26 0, -32314.96 6733661.82 0, -32314.3 6733658.12 0, -32314.030000000002 6733654.41 0, -32314.43 6733650.98 0, -32315.36 6733647.54 0, -32316.68 6733643.3 0, -32327.66 6733634.7 0, -32337.05 6733626.7700000005 0)</wkt><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>45</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>-1</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>100</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>0</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2021-01-15</startdato></gyldighetsperiode></vegobjekt></vegobjekter></stedfest>
{noformat}
POST [https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""start"":""-32328.88597080266,6733667.570919707"",""slutt"":""-32340.303678489945,6733629.524711821"",""geometri"":null,""maks_avstand"":300,""omkrets"":100,""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""RV555"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2021-01-15"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
*SpÃ¸rsmÃ¥l:*

Hvorfor fÃ¥r man ikke den ""pene"" stedfestingen man oppnÃ¥r ved Ã¥ bruke start- og sluttpunkt mot /rute nÃ¥r man i stedet benytter geometri mot /rute?

Â 
h2. KURVE 5

Her gÃ¥r rekkverket langs en veglenke i hele dens utstrekning. Stedfesting gjennom Skriv/Les klarer ikke Ã¥ finne en stedfesting gjennom Datafangst.

POST [https://nvdbapiskriv.test.atlas.vegvesen.no/rest/v3/stedfest]
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><parametere><maksimalAvstandTilVeg>300</maksimalAvstandTilVeg><veger><veg><kategori>R</kategori><fase>V</fase><nummer>555</nummer></veg></veger><typeVeger><typeVeg>GANG_OG_SYKKELVEG</typeVeg><typeVeg>SYKKELVEG</typeVeg><typeVeg>GANGVEG</typeVeg><typeVeg>GÃ…GATE</typeVeg><typeVeg>FORTAU</typeVeg><typeVeg>TRAPP</typeVeg><typeVeg>GANGFELT</typeVeg></typeVeger><beregnSideposisjon>true</beregnSideposisjon></parametere><vegobjekter><vegobjekt typeId=""5"" tempId=""b538230e-ac04-4844-bc53-a2a7b344e47d""><egenskaper><egenskap typeId=""4714""><geometri><srid>25833</srid><wkt>LINESTRING (-32350.940000000002 6733581.26 0, -32356.5 6733576.49 0, -32360.600000000002 6733572.66 0, -32365.23 6733568.43 0, -32370.920000000002 6733562.87 0, -32376.74 6733556.92 0, -32383.88 6733549.24 0, -32391.16 6733541.57 0, -32401.48 6733530.72 0, -32417.350000000002 6733513.79 0, -32445.530000000002 6733483.76 0, -32471.33 6733456.51 0, -32511.54 6733413.25 0, -32523.190000000002 6733401.08 0, -32545.54 6733377.79 0, -32567.24 6733354.38 0, -32593.96 6733326.33 0, -32615.260000000002 6733303.71 0, -32637.88 6733279.76 0, -32644.23 6733274.08 0)</wkt><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>45</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>-1</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>100</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>0</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2021-01-18</startdato></gyldighetsperiode></vegobjekt></vegobjekter></stedfest>
{noformat}
Skriv forenkler geometrien til:

POST [https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""start"":null,""slutt"":null,""geometri"":""LINESTRING (-32350.94 6733581.26, -32644.23 6733274.08)"",""maks_avstand"":300,""omkrets"":100,""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""RV555"",""trafikantgruppe"":null,""typeveg"":""gangOgSykkelveg,sykkelveg,gangveg,gÃ¥gate,fortau,trapp,gangfelt"",""tidspunkt_start"":""2021-01-18"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}{noformat}
Her blir ingen rute funnet.

*Ny stedfesting med forankring gjennom Skriv*

Dersom vi, som over, benytter <forankring> mot Skriv - som da benytter start- og sluttpunkt i kallet mot /rute i stedet for Ã¥ oppgi geometri, sÃ¥ gÃ¥r fÃ¸lgende kall - *og* vi fÃ¥ en fin rute tilbake.

POST [https://nvdbapiskriv.test.atlas.vegvesen.no/rest/v3/stedfest]
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><parametere><maksimalAvstandTilVeg>300</maksimalAvstandTilVeg><forankring><srid>5973</srid><startWkt>POINT (-32349.59 6733580.2)</startWkt><sluttWkt>POINT (-32643.32670927604 6733273.268868647)</sluttWkt></forankring><veger><veg><kategori>R</kategori><fase>V</fase><nummer>555</nummer></veg></veger><typeVeger><typeVeg>GANG_OG_SYKKELVEG</typeVeg><typeVeg>SYKKELVEG</typeVeg><typeVeg>GANGVEG</typeVeg><typeVeg>GÃ…GATE</typeVeg><typeVeg>FORTAU</typeVeg><typeVeg>TRAPP</typeVeg><typeVeg>GANGFELT</typeVeg></typeVeger><beregnSideposisjon>true</beregnSideposisjon></parametere><vegobjekter><vegobjekt typeId=""5"" tempId=""b538230e-ac04-4844-bc53-a2a7b344e47d""><egenskaper><egenskap typeId=""4714""><geometri><srid>25833</srid><wkt>LINESTRING (-32350.940000000002 6733581.26 0, -32356.5 6733576.49 0, -32360.600000000002 6733572.66 0, -32365.23 6733568.43 0, -32370.920000000002 6733562.87 0, -32376.74 6733556.92 0, -32383.88 6733549.24 0, -32391.16 6733541.57 0, -32401.48 6733530.72 0, -32417.350000000002 6733513.79 0, -32445.530000000002 6733483.76 0, -32471.33 6733456.51 0, -32511.54 6733413.25 0, -32523.190000000002 6733401.08 0, -32545.54 6733377.79 0, -32567.24 6733354.38 0, -32593.96 6733326.33 0, -32615.260000000002 6733303.71 0, -32637.88 6733279.76 0, -32644.23 6733274.08 0)</wkt><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>45</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>-1</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>100</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>0</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2021-01-18</startdato></gyldighetsperiode></vegobjekt></vegobjekter></stedfest>
{noformat}
POST [https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""start"":""-32349.59,6733580.2"",""slutt"":""-32643.32670927604,6733273.268868647"",""geometri"":null,""maks_avstand"":300,""omkrets"":100,""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""RV555"",""trafikantgruppe"":null,""typeveg"":""gangOgSykkelveg,sykkelveg,gangveg,gÃ¥gate,fortau,trapp,gangfelt"",""tidspunkt_start"":""2021-01-18"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
*SpÃ¸rsmÃ¥l:*

Hvorfor fÃ¥r man stedfesting ved Ã¥ bruke start- og sluttpunkt mot /rute, men ikke nÃ¥r man benytter geometri? I dette tilfellet burde vel ogsÃ¥ bruk av geometri finne rute?

Â 

Â ",NVDB-6937,Les-API,
Fjern aktivitetslogging i NVDBIND V3,"NVDB-5113 deaktiverte bare opprydding, NVDBIND lagrer ennÃ¥ til database.
Fjern dette.",NVDB-6937,NVDB-IND,
Rydding i hvordan Solr-request bygges,"-[532/980977947/1|https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/532/980977947/1] (startdato: 2019-10-03) er stedfestet pÃ¥ 0.60568412-0.60620364@885116. 
[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/580/777263582/4| 1815 Helgeland sÃ¸r 2017-2032 (777263582 v3) (2020-08-31-2020-11-04)] er ogsÃ¥ stedfestet her.
Men 
[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/580/777263582/4| 1815 Helgeland sÃ¸r 2017-2032 (777263582 v4) (2020-11-04)] er ikke stedfestet her. 

532/980977947/1 er beriket med Â«1815 Helgeland sÃ¸r 2017-2032Â». Siden siste versjon av dette kontraktsomrÃ¥det ikke er stedfestet samme sted som dette vegreferanseobjektet er det nok ikke korrekt Ã¥ berike Â«hovedobjektetÂ»(docType:objekt i Solr) med dette kontraktsomrÃ¥det. -

Det ser ut som den opprinnelige saken skyldes at kontrakt er oppdatert, og objekter ikke er oppdatert. SÃ¥ det som er beskrevet er ikke reproduserbart etter reindeksering.

SÃ¥ denne endringen teste ved Ã¥ kjÃ¸re full regresjonstest. Alt skal fungere som fÃ¸r. 
Det som er endret er at det er ryddet i hvordan SolrspÃ¸rringer genereres. Slik at det er lettere Ã¥ skjÃ¸nne hva som skjer for /vegobjekter/X og /vegobjekter/X/statistikk med og uten segmentering aktivert.",NVDB-6937,NVDB-IND,
Migrere til Cypress 6.0,Cypress har kommet med versjon 6.0 (siste 6.2.1). I den forbindelse mÃ¥ noen av funksjonene (cy.request) migreres til nye funksjoner (cy.intercept) da de utgÃ¥ende etterhvert ikke vil stÃ¸ttes.,NVDB-6937,Vegkart,
Fra 1.8.2021 - Automatisk populere vegnummer i Vegsystem (915),"h2. Bakgrunn

Det store volumet nÃ¥r det gjelder vedlikehold av vegnettet for Kartverket er endringer og innleggelse av PV i NVDB, deriblant tildele unikt, ledig nummer for disse vegene. I dag gjÃ¸res dette parallelt i to vegreferansesystemer.

Dagens funksjonalitet for hÃ¥ndtering av dette pÃ¥ en effektiv mÃ¥te, er funksjonalitet i NP/Vegnettseditoren basert pÃ¥ 532 Vegreferanse. 532 Vegreferanse vil fra 01.08.2021 ikke lengre ajourholdes og alle gyldige 532 objekt i NVDB, vil fÃ¥ satt en sluttdato. Dermed sÃ¥ vil dagens funksjonalitet mÃ¥tte kodes om/endres.

Vegnettsgruppa og Kartverket har vurdert at den mest smidige og ikke minst fremtidsrettede lÃ¸sningen, vil vÃ¦re funksjonalitet i SKRIV for tildeling av vegnummer for PV.

Gitt avvikling av 532 Vegreferanse 1.8.2020 sÃ¥ mÃ¥ lÃ¸sningen som lages nÃ¥, fungere frem til dette skjer. Her vil man kunne benytte seg av 532 Vegreferanse â€“ dette objektet legges pÃ¥ av Quadri/Vegnettseditoren og skal vedlikeholdes frem til avvikling. Viktig at det er samsvar med 915 Vegsystem frem til 01.08.
 Med kun noen mÃ¥neder igjen, anses det lite hensiktsmessig Ã¥ innfÃ¸re ny arbeidsmetodikk rundt dette og vi ser for oss at SKRIV kan hente info. om vegnummer fra 532 Vegreferanse, som ogsÃ¥ sikrer samsvar mellom dem.

Â 

Det nevnt ovenfor ble utredet i saken denne er klonet fra. NVDB-6382

Â 

Etter 01.08.2021 skal NVDB API Skriv ikke lengre populere vegnummer ved Ã¥ hente fra Vegreferanse (532), men populere via et lÃ¸penummer:
 * NÃ¥ vil vi ikke lengre ha gyldige 532 Vegreferanse Ã¥ hente info fra, disse er lukket. Men, endringssettet vil kunne ha 915 Vegsystem uten nummer.
 * Her Ã¸nskes kort fortalt en funksjon i SKRIV som tildeler nummer pÃ¥ PV, som er unikt innenfor en kommune. Skal tildele fÃ¸rste ledige nummer etter 99999 (nedadgÃ¥ende) pÃ¥ de objektene som mangler dette i endringssettet. Dersom neste ledige lÃ¸penummer allerede er i bruk, skal neste nummer prÃ¸ves. Eventuelle ledige ""hull"" i nummersekvensen kan brukes.
 * Her mÃ¥ det finnes andre lÃ¸sninger enn 532 Vegreferanse for Ã¥ kunne hente ut info som trengs for Ã¥ kunne tildele ledige, unike nummer pÃ¥ PV. F. eks. pÃ¥ 38 nye PV`er i et gitt endringssett.",NVDB-6937,Skriv-API,
Tillate sammenkobling til barn importert fra NVDB,"Hvis man importerer bÃ¥de mor og datter fra NVDB, sÃ¥ hindrer vi automatisk sammenkoblinger mellom disse typene.

Denne hindringen kan fjernes, og saken mÃ¥ ses i forbindelse med NVDB-6055",NVDB-6937,Datafangst,
Leveranseinformasjon,"*Testes av SVV i ATM:*
 * NVDB-6424: Sjekk at geodata-kart vises pÃ¥ de ulike fanene
 * NVDB-6395: Verifiser at innloggingsdialog kun vises pÃ¥ ""test.vegvesen"" og ikke pÃ¥ ""-test.kantega""
 * NVDB-6140: Sjekk at vegobjekter listes riktig numerisk (stedfesting, sammenkobling, etc). Sjekk bÃ¥de nye (type PUNKT 1, PUNKT 2, PUNKT 10) og NVDB-id.
 * NVDB-6401: Verifiser at beskrivende navn vises i stedfestingsfanen om dette er togglet pÃ¥. (eksempel er skiltplate)
 * NVDB-6379Â Â Skrivefeil i feltkategori",NVDB-6937,Datafangst,
Tilpasse URL for Geodata-kart,"Karttjeneste for Geodata svarer ikke lengre pÃ¥ de URL'ene vi bruker, URL mÃ¥ tilpasses.

Ulike subdomener (brukt for at IE skal kunne laste flere samtidig) er ikke lengre i bruk, og gir HTTP 503.",NVDB-6937,Datafangst,
Inkludere konnekteringslenke og filtrere i etterkant,"h2. Bakgrunn

Saken gÃ¥r pÃ¥ at det er mange vegobjekter i Datafangst som ikke fÃ¥r stedfesting gjennom Skriv siden Les gir ingen rute tilbake nÃ¥r konnekteringslenker er satt til false. Gammel stedfesting for Datafangst ga konnekteringslenker tilbake s.a. Datafangst filtrerte selv i etterkant.

*Fra Mattermost* ([https://mattermost.kantega.no/svv/pl/8gbpzzoi77y1dpocdgr9qft4ro])

Har sett pÃ¥ noen vanskelige tilfeller av stedfesting med Skriv. Vedlagte SOSI (843_difficult.sos) er utdrag av stÃ¸rre SOSI (843.sos) med noen vanskelige tilfeller. Manuell stedfesting med Skriv genererer fÃ¸lgende kall mot Les for utvalgte kurver. Problemet er generelt at det ikke finnes ruter. *MEN* om vi setter {{konnekteringslenker=true}} finnes det ruter (da med rutesegmenter som ikke er konnektering OG konnekteringslenker).

Gammel stedfesting finner stedfesting for alle. Er det ikke slik at vi for gammel stedfesting fÃ¥r konnekteringslenker, men filtrerer bort disse i Datafangst?

Hva tenker folk om Ã¥ be om konnekteringslenker ogsÃ¥ for Datafangst og heller filtrere disse bort i Skriv/Datafangst etter at rute er oppnÃ¥dd fra Les? Eksemplene her er typiske eksempler hvor det er veier som mÃ¸tes. Alternativet her blir jo Ã¥ stedfeste alle som gÃ¥r med Skriv og deretter velge gammel for de som ikke gÃ¥r. Alle 1018 objektene i 843.sos er tatt fra Prod og reflekterer reelle situasjoner vi helt sikkert kommer borti mange ganger.
Â 
{noformat}
KURVE 246 
{""geometri"":""LINESTRING (138553.42 6501292.32, 138554 6501288.68, 138546.53 6501278.28, 138489.17 6501242.18)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""FV409"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker 

KURVE 255 {""geometri"":""LINESTRING (138554.32 6501292.18, 138572.76 6501271.68)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""FV409"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker 

KURVE 258 {""geometri"":""LINESTRING (138568.71 6501250.91, 138562.89 6501231.29)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""EV18"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker 

KURVE 278 {""geometri"":""LINESTRING (138591.19 6501078.74, 138598.13 6501077.81, 138601.35 6501076.33, 138604.65 6501071.57)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""EV18"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker
{noformat}

*Kommentar fra Tore:*

Skriv anroper Les /rute med konnekteringsparameter=JA/NEI avhengig av om vegobjekttypen tillater det. Tanken var nok opprinnelig at Les da skulle foreta denne filtreringen, men det har jo runnet en del vann i Gaula siden da. Mulig Skriv skal sende konsekvent JA her og plukke ut konnekteringslenkene etterpÃ¥ selv. Dermed blir det som i gammel DF-lÃ¸sning.

h2. Analyse

Min kommentar ovenfor var nok litt forhastet. Stedfestingstjenesten bruker faktisk allerede strategien som angitt over. Ã…rsaken til at det ikke fungerer som tenkt er at requesten til Les sin rutetjeneste pÃ¥fÃ¸res ""konnekteringslenker"": false nÃ¥r det ikke skal stedfestes pÃ¥ konnekteringslenker (punktstedfesting), mens det *ikke* angis ""konnekteringslenker"": true nÃ¥r det kan stedfestes pÃ¥ konnekteringslenker (strekningsstedfesting, med filtrering i etterkant).

h2. LÃ¸sning

Setter eksplisitt ""konnekteringslenker"" i requesten til Les, enten verdien fra RouteParams.isConnectingRefLinksAllowed() er true eller false",NVDB-6937,Skriv-API,
Migrere til Cypress 6.0,Cypress har kommet med versjon 6.0 (siste 6.2.1). I den forbindelse mÃ¥ noen av funksjonene (cy.request) migreres til nye funksjoner (cy.intercept) da de utgÃ¥ende etterhvert ikke vil stÃ¸ttes.,NVDB-6937,Datafangst,
Leveransesak - Vegkart V3 2021.2.0,"SVV tester i ATM
 * Gang- og sykkleveg mangler under gÃ¥ende og syklende.Â NVDB-6259
 * Legge til tekst og feilkode ved ""Ulykke""NVDB-6263
 * Link til support i feilmelding https://www.vegvesen.no/jira/browse/NVDB-6463
 * Vise startdato for objekt https://www.vegvesen.no/jira/browse/NVDB-6441
 * SÃ¸ke pÃ¥ NVDB-ID https://www.vegvesen.no/jira/browse/NVDB-5809",NVDB-6937,Vegkart,
v2 returnerer forskjellig resultat med samme spÃ¸rring,"Hei,

Det ser ut til at vi fÃ¥r forskjellige data nÃ¥r vi spÃ¸r pÃ¥ det samme fra nvdbV2 , ser ut til at dette har startet engang i helgen.

Har vedlagt respons data vi fÃ¥r ved kall tilÂ [https://nvdbapiles-v2.atlas.vegvesen.no/vegobjekter]/\{id}Â 

Zip filen inneholder en katalog for alle spÃ¸rringer med dato for hver gang vi gjÃ¸r spÃ¸rringer og det ser ut som vi fÃ¥r litt random resultat.

Filnanvnene er URL til tjeneste med parametere og med page nummer for de paginerte dataene ( : ,? og / er erstattet med _ )

f.eks for uthenting av vinterdriftsklasse returnerer kallet under 25 i metadata:

*20210111_152229*\https___nvdbapiles-v2.atlas.vegvesen.no_vegobjekter_*810*_antall=250&inkluder=vegsegmenter,egenskaper&kontraktsomrade=*1815 Helgeland sÃ¸r 2017-2032*_page_*1*.json

mens denne har 21:

*20210111_152241*\https___nvdbapiles-v2.atlas.vegvesen.no_vegobjekter_*810*_antall=250&inkluder=vegsegmenter,egenskaper&kontraktsomrade=*1815 Helgeland sÃ¸r 2017-2032*_page_*1*.json

Det virker som vi kan fÃ¥ forskjellige data vegobjekttypene vi spÃ¸r pÃ¥ ( 106,532,540,577 og 810) mellom hvert kall, kan det ha skjedd noe med indekseringen her?

mvh

morten

<[Morten.Stenseth@norconsult.com|mailto:Morten.Stenseth@norconsult.com]>",NVDB-6937,Les-API,
Polling stopper ikke nÃ¥r alle er stedfestet,"h2. Observasjon

NÃ¥r man laster inn en type og stedfester vil POSTÂ /rest/vegobjekt/<id>/autostedfest returnere > 0 (auto stedfesting), og polling med GET /antall stopper nÃ¥r denne blir 0.

Hvis man stedfester og godkjenner s.a. alle objektene er grÃ¸nne sÃ¥ vil en pÃ¥fÃ¸lgende automatisk stedfesting (POSTÂ /rest/vegobjekt/<id>/autostedfest) returnere 0. Imidlertid sÃ¥ fortsetter GET /antall Ã¥ polle selv om resultatet er 0. Stopper ikke fÃ¸r man refresher siden. Det hjelper ikkeÂ Ã¥ gÃ¥ bort fra stedfestingsfanen til en annen fane.",NVDB-6937,Datafangst,
Deassosiering fÃ¸rer til lukking av datter,"h2. Observasjon

Sinus har problem med sletting av assosiasjon.
I endringssett 25c402a2-2dd7-4859-a5a6-30a88ec1330d skulle assosiasjon til kum 83:842987759 slettast i obejektet 79:842988050, men heile kum-objektet var lukka.
Dette er i ATM. https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/25c402a2-2dd7-4859-a5a6-30a88ec1330d

h2. Analyse

Stikkrenne (79) har en assosiasjon til Kum (83) av type KOMPOSISJON (ogsÃ¥ kjent som ""sterk kobling""). Ved lukking av 79 vil derfor alle datterobjekter av type 83 lukkes pÃ¥ samme dato gjennom en kaskadeoperasjon. Skriv betrakter fjerning av denne assosiasjonen i en ny versjon av 79 som konseptuelt samme sak, at mor lukkes. Derfor utfÃ¸res ogsÃ¥ lukking av 83 her. Kum har ikke styringsparameter ""mÃ¥ ha mor"" sÃ¥ den kunne forsÃ¥vidt overlevd i NVDB.

Trunkering av datterobjekt etter lukking av mor hÃ¥ndteres av TruncateDeassociatedFeaturesEnricherFilter.

h2. LÃ¸sning

I doFilter-metoden, rett etter anrop getParentsWithRemovedChildren: Tar ut assosiasjoner til datterobjekttyper som ikke krever mor via ny metode discardChildrenNotRequiringParent.",NVDB-6937,Skriv-API,
Avviser ikke overlapp ved korrigert gyldighetsperiode,"h2. Observasjon

Endringssett aaf8beff-396c-4bba-9622-7e6bff74078b korrigerer sluttdato pÃ¥ et Vegsystem-objekt som allerede overlapper med et annet i NVDB (datafeil). Det er fortsatt overlapp etter korrigert sluttdato, men endringssettet blir ikke avvist.

h2. Analyse

NVDB API Skriv utfÃ¸rer overlappskontroll for alle vegobjekttyper som ikke tillater overlapp iht styringsparameter i datakatalogen. Vegsystem (915) tillater ikke overlapp. For Ã¥ fÃ¥ avvist et endringssett mÃ¥ det vÃ¦re overlapp bÃ¥de i tid og rom (stedfesting).
 
Et sÃ¸k pÃ¥ det aktuelle vegobjektet i transaksjonsloggen (https://nvdbapiskriv.atlas.vegvesen.no/kontrollpanel/#/tasks/transactions?time=0&featureId=1011249727) viser fÃ¸lgende:
 
+5025354               2021-01-06 14:33:09       groknu+ 
 
Operasjon          ObjektId              Ver.       Startdato            Sluttdato
OPPDATERT       1011249727       1             1950-01-01         2020-10-04         
 
+5027004               2021-01-07 08:29:45       hansal+
 
Operasjon          ObjektId              Ver.       Startdato            Sluttdato
SLETTET               1011249727       1             1950-01-01         2020-10-04
 
Det er altsÃ¥ ingen innslag for etablering av vegobjektet. Jeg antar det skjedde via et SQL-script.
 
Oppdrag 5025354 stammer fra endringssett aaf8beff-396c-4bba-9622-7e6bff74078b. Her utfÃ¸res delvis korrigering av Vegsystem-objektet. Eneste endring er oppdatering av gyldighetsperiode, antagelig er det bare sluttdato som settes for Ã¥ lukke vegobjektet:
 
{code:xml}
<vegobjekt typeId=""915"" nvdbId=""1011249727"" versjon=""1"">
  <gyldighetsperiode>
    <startdato>1950-01-01</startdato>
    <sluttdato>2020-10-04</sluttdato>
  </gyldighetsperiode>
  <validering>
    <lestFraNvdb>2021-01-05T12:46:34</lestFraNvdb>
  </validering>
</vegobjekt>
{code}
 
Under behandling av endringssettet finner API Skriv korrekt at det er overlapp med et annet Vegsystem-objekt i NVDB med id 1011249729. Dette har identisk stedfesting og har gyldighetsperiode 2020-10-03 ->. Etter korrigering er det altsÃ¥ overlappende stedfesting mellom disse to pÃ¥ datoen 2020-10-04. Siden stedfestingen ikke berÃ¸res av korrigeringen velger API Skriv Ã¥ neglisjere overlappet og i stedet logge dette som datafeil i NVDB:
 
https://loggsentralen.vegvesen.no/loggsentralen/en-GB/app/SVV_nvdb/search?q=search%20index%3Dsvvpnvdb%20host%3Dsvvptomcat25%20OR%20host%3Dsvvptomcat26%20NvdbDataErrorReporter%201011249727&display.page.search.mode=verbose&dispatch.sample_ratio=1&earliest=1609714800&latest=1610013623&sid=1610013826.1900086_C5996C14-FEA3-4A85-B277-7060A0DC991F
 
Det kan se ut som at brukeren her har forsÃ¸kt Ã¥ rette datafeilen, men bommet pÃ¥ lukkedato med Ã©n dag.

h2. LÃ¸sning

Tar nÃ¥ hensyn til om bÃ¥de stedfesting og gyldighetsperiode er endret ved overlappskontroll i NoOverlapsValidator. Endret navn pÃ¥ stÃ¸ttemetoden isUnchangedLocation til isUnchangedLocationAndLifetime og la inn kontroll pÃ¥ om gyldighetsperiode er endret. Tilsvarende endring ble ogsÃ¥ gjort i tvillingvalidatoren NoInterOverlapsValidator. Etter denne endringen blir det kun rapportert datafeil ved overlapp nÃ¥r bÃ¥de stedfesting og gyldighetsperiode er uendret av endringssettet.",NVDB-6937,Skriv-API,
V2 ser ut til Ã¥ mangle vegnett,"https://gitter.im/nvdb-vegdata/api-les-v2?at=5ff856314498e01bbf953dd2
",NVDB-6937,NVDB-IND,
segment.lengde ikke riktig ved segmentering,"Det ser ut som veglenkesegment.lengde og veglenkesegment.geometri.lengde har verdi fra orginal veglenke.
https://github.com/nvdb-vegdata/nvdb-api-client/issues/102

*Test*

Sjekk at lengde og geometri.lengde er like i disse veglenkesegmentene:
https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/2721409?historisk=false&srid=6173 ",NVDB-6937,NVDB-IND,
FÃ¥r ikke registrert objekt med allerede registrert datter,"h2. Observasjon

Har et Leskur og Holdeplassutrustning. Leskur trenger ikke mor, men kan vÃ¦re barn av Holdeplass. Hvis man registrerer Leskur fÃ¸rst, deretter assosierer Holdeplass til barn i kontrakten (les: Leskur), sÃ¥ vil Registrer-knapp ligge inaktiv pÃ¥ eksportfanen for Holdeplass. GUI gir inntrykk av at alt er greit, men kalletÂ /submittability_report viser at ""MISSING_RELATION_IN_CHANGESET:Â 1"".

For Ã¥ gjenskape, importer vedlagte SOSI og fÃ¸lg beskrivelsen.

For Ã¥ komme rundt mÃ¥ bruker heller assosiere til NVDB-utgaven av Leskuret, men dette er vanskelig Ã¥ finne ut av selv nÃ¥r man klart ser - og vet - at det er Leskur i kontrakten som er det riktige Leskuret.",NVDB-6937,Datafangst,
Intern feil nÃ¥r NVDB-objekt er borte,"h2. Observasjon

Under registrering sÃ¥ hentes info inn fra API Les om ulike objekter. I et tilfelle som ble oppdaget under support-feilsÃ¸k sÃ¥ er det et tilfelle hvor en versjon av et objekt er borte. Type respons som mottas fra Les (HTTP 410):
{noformat}
[ { ""code"" : 4016, ""message"" : ""Feature 86180198, version 2 of type 14 gone!"", ""help_url"" : ""https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/"" } ]
{noformat}
Da reagerer Datafangst med
{noformat}
javax.ws.rs.ProcessingException: Error reading entity from input stream.
...
Caused by: com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot deserialize instance of `no.svv.nvdb.datafangst.integration.nvdbapi.binding.lesV3.Vegobjekt` out of START_ARRAY toke
{noformat}
[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.13-2021.01.06/doc/?id=AsOW13YBLuQOkdqhz7LS]

[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.13-2021.01.06/doc/?id=BsOW13YBLuQOkdqhz7LT]

Â ",NVDB-6937,Datafangst,
Vise beskrivende navn i stedfestingsfanen,"NÃ¥r featuretoggle ""Beskrivende navn"" er satt skal beskrivende navn ogsÃ¥ vises i stedfestingsfanen.

Dette ble gjort i Angular-komponenten, men ble ikke implementert i React.",NVDB-6937,Datafangst,
Atlas-utrulling via Jenkinsfile feiler sporadisk,"Jenkins bygger applikasjonen og ruller ut i Atlas-UTV via Jenkinsfile. Dette feiler sporadisk, antagelig fordi /home/vegdata/.ac.yaml oppdateres med info fra andre byggejobber som ikke er kompatibel med NVDB API Skriv.

Jenkinsfile bÃ¸r justeres slik at egen .ac.yaml etableres inne i workspace fÃ¸r Atlas Client-brukes. Dette er beskrevet her: https://atlas-docs.atlas.vegvesen.no/atlas-dokumentasjon/latest/client/byggserver.html",NVDB-6937,Skriv-API,
Skrivefeil i api-doc,"https://nvdbapiles-v3.atlas.vegvesen.no/dokumentasjon/openapi/#/Datakatalog/get_vegobjekttyper_version

Datakatalog: GET /vegobjekttyper/version -> GET /vegobjekttyper/*versjon*

PS: Trenger denne tasken noe mer innhold / info?",NVDB-6937,Les-API,
Avbruddssikkerhet i JobRetryService,"h2. Bakgrunn

JobRetryService er en separat trÃ¥d som kjÃ¸rer i NVDB API Skriv. Den sÃ¸ker etter endringssett som er flagget for et nytt behandlingsforsÃ¸k, dvs. endringssett i status VENTER_PÃ…_LÃ…S eller VENTER_PÃ…_DATAKATALOG. TrÃ¥den sparkes i gang hvert 30 sekund. Dersom det inntreffer et databaseavbrudd i samme Ã¸yeblikk som sÃ¸ket i JOBS-tabellen vil trÃ¥den dÃ¸, og (ser det ut for) aldri starte opp igjen.

h2. Analyser

Etter Ã¥ ha sett pÃ¥ loggene i Splunk ser det ut til at JobRetryService fortsatt kjÃ¸rer etter SqlException. TrÃ¥den logger hver gang den startes av ExecutionService. Loggingen stopper plutselig uten at det er spor av andre exceptions i loggen.

Javadoc for ExecutorService sin scheduleAtFixedRate-metode indikerer at det ikke gjÃ¸res nye forsÃ¸k pÃ¥ Ã¥ starte trÃ¥den om en exception kastes mens den kjÃ¸rer. Det er en catch-blokk i JobRetryService.run som fanger opp eventuelle exceptions, men det er en finally-blokk som potensielt ogsÃ¥ kan feile.

h2. LÃ¸sning

Etablerer en CatchingRunnable som kapsler inn JobRetryService.run og fanger alle exceptions og logger slike.",NVDB-6937,Skriv-API,
Skru av innloggingsdialog for kantega-adresser,"Brukere som gÃ¥r til Kantega-domener for Datafangst fÃ¥r fra fÃ¸r beskjed om Ã¥ bruke Vegvesen-adresse i stedet. For Ã¥ fortsette overgangen bÃ¸r vi endre kode sÃ¥nn at innloggings-dialogen ikke kommer opp for Kantega-domener.

Â 
h2. Implementasjon

Endret innloggingsinfo til Ã¥ kun vises dersom url ikke inneholder ""kantega"".",NVDB-6937,Datafangst,
Mors endrede stedfesting mÃ¥ endre NVDB-datters stedfesting,"h2. Observasjon

Det har vÃ¦rt et gjentakende problem pÃ¥ support i det siste med at man importerer NVDB-objekter i kontrakten (typisk rettekontraktene rundt E18 Tvedestrand-Arendal), kanskje lukker et objekt og erstatter med et annet, men ender opp med Ã¥ re-stedfeste NVDB-objekter. Disse har igjen dÃ¸tre som ligger i NVDB. Ofte har vi da sett at ny stedfesting skiller seg fra den eksisterende - og gjerne bare pÃ¥ 3. eller 4.desimal.

Det generelle problemet er at man re-stedfester et NVDB-objekt som da vil fÃ¥ stedfesting som ikke fullstendig dekker NVDB-datters stedfesting, men som mÃ¥ det.

Et eksempel fra Jon BrÃ¥ten pÃ¥ support (05-01-21 14:01, [https://datafangst.vegvesen.no/#!/contract/db3a2eb8-8673-4184-b35e-e4a357f23753/locational2]):
{noformat}
NÃ¥ har jeg stÃ¸tt pÃ¥ et nytt problem med rekkverk og rekkverksende. Hvorfor fÃ¥r jeg feil pÃ¥ Tilstandsgrad?
{noformat}
!braÌŠten.png!",NVDB-6937,Datafangst,
Uforutsigbare stedfestinger nÃ¥r mor har feil stedfesting fra VVI,"En feil i den gamle stedfestingsmetoden som benytter VVI gjorde at objekter fikk feil stedfesting (men riktig wkt). feilen er rettet (vi bruker ikke VVI lenger) men enkelte objekter er lagret til NVDB med feil verdier.Â 

NÃ¥r vi prÃ¸ver Ã¥ stedfeste dÃ¸tre til disse objektene vil dÃ¸trene fÃ¥ stedfestinger som ogsÃ¥ er helt feil, men de vil i motsetning til mÃ¸drene ogsÃ¥ se feil ut.Â 

Dette kan rettes ved Ã¥ restedfeste mor. Vi kan legge inn en sjekk for om stedfestingen er helt feil i forhold til en ny stedfesting med Skriv, og enten gi tilbakemelding til bruker om at mor mÃ¥ stedfestes pÃ¥ nytt, eller automatisk restedfeste mor hvis det er mulig.

Se NVDB-6225",NVDB-6937,Datafangst,
NVDBIND stoppet transaksjonsbehandling etter infrastrukturproblemer,"NVDBIND stoppet Ã¥ behandle transaksjoner etter infrastrukturproblemer 29. desember. 
Det er ingen feilmeldinger i loggen. ",NVDB-6937,NVDB-IND,
OverfÃ¸re vegnummer fra Vegreferanse (532) til Vegsystem (915),"h2. Bakgrunn
 
Det store volumet nÃ¥r det gjelder vedlikehold av vegnettet for Kartverket er endringer og innleggelse av PV i NVDB, deriblant tildele unikt, ledig nummer for disse vegene. I dag gjÃ¸res dette parallelt i to vegreferansesystemer.

Dagens funksjonalitet for hÃ¥ndtering av dette pÃ¥ en effektiv mÃ¥te, er funksjonalitet i NP/Vegnettseditoren basert pÃ¥ 532 Vegreferanse. 532 Vegreferanse vil fra 01.08.2021 ikke lengre ajourholdes og alle gyldige 532 objekt i NVDB, vil fÃ¥ satt en sluttdato. Dermed sÃ¥ vil dagens funksjonalitet mÃ¥tte kodes om/endres.
 
Vegnettsgruppa og Kartverket har vurdert at den mest smidige og ikke minst fremtidsrettede lÃ¸sningen, vil vÃ¦re funksjonalitet i SKRIV for tildeling av vegnummer for PV.  
 
Gitt avvikling av 532 Vegreferanse 1.8.2020 sÃ¥ mÃ¥ lÃ¸sningen som lages nÃ¥, fungere frem til dette skjer. Her vil man kunne benytte seg av 532 Vegreferanse â€“ dette objektet legges pÃ¥ av Quadri/Vegnettseditoren og skal vedlikeholdes frem til avvikling. Viktig at det er samsvar med 915 Vegsystem frem til 01.08.
Med kun noen mÃ¥neder igjen, anses det lite hensiktsmessig Ã¥ innfÃ¸re ny arbeidsmetodikk rundt dette og vi ser for oss at SKRIV kan hente info. om vegnummer fra 532 Vegreferanse, som ogsÃ¥ sikrer samsvar mellom dem.
 
Frem til 01.08.2021 gjelder dette:

* SKRIV sjekker om det er 915 vegsystemobjekter uten nr i endringssettet og tar tak i disse (det vil i praksis vÃ¦re P-veger)
* SKRIV sjekker OM det finnes gyldig 532 vegreferanse pÃ¥ samme lenke/sted, der hvor vi har 915 Vegsystem uten nr. (dette skal eksistere via normal ajourholdsrutine):
* SKRIV henter vegnr fra 532 Vegreferanse og overfÃ¸re til vegsystem 915 pÃ¥ disse lenkene.

Etter 01.08.2021 skal dette endres til en annen strategi. Dette er beskrevet i sak NVDB-6428.

h2. Analyse

Det er kun Vegsystem-objekter med vegkategori P uten angitt vegnummer-egenskap som skal behandles. Alle relevante operasjoner, det vil si registrer, korriger og oppdater m/overskriv (+ delvis-varianter), skal behandles. Dette gjelder selv om korrigeringen innebÃ¦rer Ã¥ fjerne vegnummer-egenskapen.

Vegnummer-egenskapen populeres med verdi fra tilsvarende egenskap pÃ¥ den/de Vegreferanse-objekt(er) med sammenfallende stedfesting og gyldighetsperiode. Dersom det er ingen slike skal endringssettet avvises med beskrivende feilmelding tilknyttet Vegsystem-objektet i endringssettet. Dersom det er flere sammenfallende Vegreferanse-objekter og disse har ulike vegnummere skal endringssettet ogsÃ¥ avvises med beskrivende feilmelding.

Dersom Vegreferanse-objektet sin vegnummer-egenskap ikke er populert (datafeil i NVDB), skal endringssettet avvises med beskrivende feilmelding tilknyttet Vegsystem-objektet i endringssettet.

Denne fÃ¸lgeoppdateringen mÃ¥ utfÃ¸res etter at det er kontrollert at Vegreferanse er heldekkende.

---

Vegreferanser hentes inn i jobben i dag via filteret RoadRefEnricherFilter i BeforeLockingPipeline. Kontroll av heldekkende Vegreferanse gjÃ¸res i RefLinkPart-constraint CoveredByRoadReference som eksekveres i AfterLockingPipeline.

h2. LÃ¸sning

Nytt FeatureFilter, RoadNumberAttributeEnricherFilter, som legges inn i AfterLockingPipeline.",NVDB-6937,Skriv-API,
Etterarbeid etter overgang til nye startscript,"For Solr, Zookeeper og NVDBIND, fjern koden som ligger igjen midlertidig, sÃ¸k etter:

""/sbin/chkconfig --del""",NVDB-6937,NVDB-IND,
Skrivefeil i feltkategori,"h2. Observasjon

Det er skrivefeil i feltkategori ved val av falt i Datafanen.

!image-2020-12-22-12-20-17-569.png!",NVDB-6937,Datafangst,
Finner ikke rute for objekt den bÃ¸r finne rute for,"h2. Observasjon

Vedlagt SOSI vises som vedlagte skjermbilde i Datafangst, hvor det bÃ¸r gÃ¥ Ã¥ finne en rute. Datafangst sender POSTÂ /rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=E&vegnummer=6&fase=V&typeVeg=KANALISERT_VEG%2CENKEL_BILVEG%2CRAMPE%2CRUNDKJ%C3%98RING%2CGATETUN
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""77"" tempId=""cb09eb7f-c308-4938-b392-ae728b2e960c""><egenskaper><egenskap typeId=""4778""><geometri><srid>25833</srid><wkt>LINESTRING (272775.11 6760327.12 241.83, 272775.32 6760326.95 241.85, 272777.72 6760325.95 241.93, 272778.35 6760325.65 241.95000000000002, 272778.64 6760324.2 242.01, 272779.07 6760322.4 242.12, 272781.35 6760320.28 242.20000000000002, 272784.11 6760317.69 242.34, 272785.73 6760316.3 242.39000000000001, 272788.75 6760313.84 242.47, 272793.42 6760310 242.59, 272798.06 6760306.13 242.69, 272802.74 6760302.31 242.84, 272807.35 6760298.65 242.93)</wkt><datafangstdato>2019-05-15</datafangstdato><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>96</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>10</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>10</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-12-21</startdato></gyldighetsperiode></vegobjekt></vegobjekter>
{noformat}
til Skriv som igjen sender POSTÂ /beta/vegnett/rute
{noformat}
{""geometri"":""LINESTRING (272775.11 6760327.12, 272778.35 6760325.65, 272779.07 6760322.4, 272784.11 6760317.69, 272807.35 6760298.65)"",""maks_avstand"":""300"",""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""EV6"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-12-21"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
til Les.

Les gir tilbake svaret _IKKE_FUNNET_RUTE_.

Â 

*LÃ¸sning*

I tilfellet her skyldes det at nÃ¦rmeste startpunkt og sluttpunkt havner pÃ¥ rampe og kanalisert_veg og det er ikke mulig Ã¥ fÃ¥ en rute mellom de. I tilfeller der resultatet er ""IKKE_FUNNET_RUTE"" gjÃ¸res det et nytt forsÃ¸k med en intern ""beholdTypeVeg"". NÃ¥r det sendes inn flere typeVeg i requesten (som i tilfellet her) prÃ¸ver den alle til den finner fÃ¸rste mulig rute. FÃ¸rste punkt i geometrien som sendes innÂ i requesten brukes for Ã¥ velge hvilken typeVeg som testes fÃ¸rst.",NVDB-6937,Les-API,
Paginering pÃ¥ /gater,"/omrader/gater er en stor respons, legg til paginering.",NVDB-6937,Les-API,
500 og NPE ved POST til /stedfest,"h2. Observasjon

POST https://nvdbapiskriv.test.atlas.vegvesen.no/rest/v3/stedfest med

{code:xml}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
  <parametere>
    <maksimalAvstandTilVeg>300</maksimalAvstandTilVeg>
    <veger>
      <veg>
        <kategori>E</kategori>
        <fase>V</fase>
        <nummer>0</nummer>
      </veg>
    </veger>
    <beregnSideposisjon>true</beregnSideposisjon>
  </parametere>
  <vegobjekter>
    <vegobjekt typeId=""96"" tempId=""bdd8e197-680d-40e9-91ac-7401e12a71b2"">
      <egenskaper>
        <egenskap typeId=""4795"">
          <geometri>
            <srid>25833</srid>
            <wkt>POINT (291464.82 7038427.63 33.733744518756865)</wkt>
            <datafangstdato>2014-07-29</datafangstdato>
            <temakode>999</temakode>
            <referansegeometri>false</referansegeometri>
            <kvalitet>
              <mÃ¥lemetode>96</mÃ¥lemetode>
              <mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde>
              <nÃ¸yaktighet>8</nÃ¸yaktighet>
              <nÃ¸yaktighetHÃ¸yde>8</nÃ¸yaktighetHÃ¸yde>
              <synbarhet>0</synbarhet>
            </kvalitet>
          </geometri>
        </egenskap>
      </egenskaper>
      <gyldighetsperiode>
        <startdato>2020-12-17</startdato>
      </gyldighetsperiode>
    </vegobjekt>
  </vegobjekter>
</stedfest>
{code}

Gir respons 500 med payload:

{code:xml}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1"">
  <message>roadTypes</message>
</fault>
{code}

h2. Analyse

500-response skyldes at det kastes en NPE fordi typeVeger er null i RouteParams.withRoadTypes().

h2. LÃ¸sning

Fikset i NetElementTransforms.toRoadTypes() ved Ã¥ returnere tomt EnumSet i stedet for null, nÃ¥r input er null.",NVDB-6937,Skriv-API,
Beregne stedfesting fra ankerpunkter,"Datafangst trenger Ã¥ angi manuelle ankerpunkter for Ã¥ fÃ¥ stedfestet vegobjekter mer presist. Skriv sin stedfestingstjeneste skal derfor godta Ã©n (punktstedfesting) eller to (strekningstedfesting) WKT-strenger med POINT-geometri i parameter-elementet som skal brukes til dette formÃ¥let. Disse benyttes til ruteberegning i stedet for egengeometrien til vegobjektene dersom de er angitt.
",NVDB-6937,Skriv-API,
tilbakemelding om vellykkede sammenkoblinger vises ikke,"h2. Observasjon

Ved sammenkobling lages det meldinger om at x antall vegobjekter har fÃ¥tt ny stedfesting, men meldingen vises ikke i GUI
h2. Analyse

Kan ikke finne meldingene.
h2. LÃ¸sning

Lager liste med vegobjektene som har fÃ¥tt ny stedfestingÂ (roadObjectsWithUpdatedLocational).

Sender denne til frontend.

Viser fram en melding om at x antall vegobjekter har fÃ¥tt ny stedfesting.",NVDB-6937,Datafangst,
Manuelt angi stedfestingsposisjoner med ny stedfesting,"Det vil alltid vÃ¦re tilfeller der vi ikke klarer Ã¥ finne en stedfesting, eller der vi ikke gjÃ¸r helt det som bruker Ã¸nsker. Det bÃ¸r derfor vÃ¦re en mulighet for Ã¥ manuelt angi punkt eller start og slutt for stedfesting ved Ã¥ klikke i kart, og sÃ¥ fÃ¥ dette som stedfesting tilbake med riktige vegsegmenter.

Det er mulig for Datafangst Ã¥ beregne disse selv, men siden Skriv ellers gjÃ¸r tilsvarende operasjoner kan det ogsÃ¥ vurderes om API i Skriv skal utvides (eller lages et nytt endepunkt) sÃ¥nn at Datafangst kan sende inn koordinater eller posisjon og at Skriv lager en stedfesting av det.",NVDB-6937,Datafangst,
Test: FullfÃ¸re de automatiserte testene av Eksport,"NVDB-6175 har opprettet flere tester av SOSI- og CSV-eksport, men det stÃ¥r igjen Ã¥ fullfÃ¸re disse. det som skal gjÃ¸res:
 * FullfÃ¸re tomme tester i v3.apiExport.SosiExport
 * FullfÃ¸re tomme tester i v3.apiExport.CsvExport
 * Legge de nye testene inn iÂ v3.apiExport.ApiExportScenario

Testene kan kjÃ¸res ved
{noformat}
/nvdb-rest-api/gradlew e2e -Denvironment=utv -DuseCase=v3Export -DtestInfo=true -DsimulationTime=900 -Dapihash=NA
{noformat}
og kjÃ¸rer nÃ¥ nattlig mot UTV pÃ¥ Jenkins: [http://svvunvdbbuild02:8080/jenkins/view/NVDB%20API%20Les/job/NVDB%20Test%20Eksport%20-%20UTV/]

Under utvikling av testene kan en og en enables i usecase ""test"" ved Ã¥ utkommentere aktuell test, for deretter Ã¥ kjÃ¸re:
{noformat}
/nvdb-rest-api/gradlew e2e -Denvironment=utv -DuseCase=test -DtestInfo=true -DsimulationTime=900 -Dapihash=NA Â 
{noformat}",NVDB-6937,Eksport,
Fjern kode for Ã¥ filtrere sideposisjon,For Ã¥ kunne ta ut sideposisjon fra Skriv nÃ¥ er det gjort en work-around i Datafangst for NVDB-6348. NÃ¥r denne er deployet (etter frysperioden) sÃ¥ kan koden i Datafangst fjernes. Dette gjelder commit https://github.com/nvdb-vegdata/nvdb-datafangst/pull/1123/commits/8110fa6d347bf0de62e171396da38cf239f1b857,NVDB-6937,Datafangst,
HÃ¥ndtere feilaktig mor fra Les,"h2. Observasjon

(fra support ved Terje Ringen)

I kontrakt [https://datafangst.kantega.no/#!/contract/c24657c8-a810-4609-b519-fd4c1ae09540/export]Â blir registreringen avvist medÂ _268578406: Egenskapstypen 220077 finnes ikke i objektet._Â Dette refererer til endringssettet ([https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/02563fda-4399-403c-a6bd-fb79ed7c26a8]) som er sendt inn som inneholder
{noformat}
""assosiasjoner"": [ { ""typeId"": 200077, ""tempId"": [], ""nvdbId"": [ { ""verdi"": 268578407, ""operasjon"": ""slett"" } ], ""operasjon"": ""oppdater"" }
{noformat}
men objektÂ 268578406 har ingen barn i NVDB ([https://www.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/89/268578406/2).]Â Ã…rsaken til at Datafangst legger til denne ass-slettingen er pga atÂ 268578407 ogsÃ¥ sendes inn og da spÃ¸r DF Les om dette objektet: [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/90/268578407/1?inkluder=relasjoner]

HER kan vi se at Les mener atÂ 268578406 er mor tilÂ 268578407. Dette er en foreldre-relasjon som henger igjen. Sannsynligvis er denne relasjonen fjernet, men henger altsÃ¥ igjen i Les. Dermed vil DF sette pÃ¥ en ass-slett for denne relasjonen som Skriv ikke godtar.

Den beste lÃ¸sningen er Ã¥ rette dette i Les (NVDB-5713 og NVDB-6360). En alternativ lÃ¸sning er Ã¥ ikke ta foreldre-relasjonen for god fisk, men i tillegg sjekke pÃ¥ objektet som oppgis som forelder om det virkelig har dette barnet (barne-relasjonen i Les er oppdatert).",NVDB-6937,Datafangst,
FÃ¥r ikke stedfestet til Ã¸nsket vegstrekning,"h2. Observasjon

(fra support ved Janet Berringer)

Vedlagte skjermbilde viser at Kum-PUNKT 4 (vedlagt SOSI) manuelt stedfestes til rundkjÃ¸ring nÃ¥r man egentlig har valgt vegstrekning inn mot rundkjÃ¸ringen. Ved automatisk sÃ¥ velges FG til hÃ¸yre (ingen parametre satt i innstillinger). NÃ¥r man sÃ¥ markerer Ã¸nsket veg og stedfester manuelt blir objektet knyttet til rundkjÃ¸ringen.

Basert pÃ¥ dagens algoritme er dette naturlig. Vi sender POSTÂ /rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=F&vegnummer=420&fase=V&typeVeg=KANALISERT_VEG%2CENKEL_BILVEG%2CRAMPE%2CRUNDKJ%C3%98RING%2CGATETUN

med
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""83"" tempId=""946e95a4-8449-498a-9311-0ff4c8d88e75""><egenskaper><egenskap typeId=""4784""><geometri><srid>25833</srid><wkt>POINT (109997.57681420061 6474407.890970628 35.35)</wkt><datafangstdato>2019-03-12</datafangstdato><temakode>0</temakode><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>96</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>10</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>10</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-12-15</startdato></gyldighetsperiode></vegobjekt></vegobjekter>
{noformat}
noe som gjÃ¸r at Skriv tar med RUNDKJÃ˜RING i beregningen. men dette blir altsÃ¥ feil her.

*Mulige lÃ¸sninger:*
 * Introdusere sjekkbokser for hvilke tyep veger bruker Ã¸nsker Ã¥ benytte (default alle)
 * Ta hensyn til veglenkesekvens som bruker faktisk sender inn via UI i kallet POST /stedfesting (_...""roadSegment"":{""linkId"":3212989,..._). Da mÃ¥ evt Skriv utvides til Ã¥ ta inn Ã¸nsket veglenkesekvens om dette ikke stÃ¸ttes.
 * InnfÃ¸re parameter ""behold_typeVeg=true"" som mÃ¥ benyttes i Skriv OG Les.
 * annet?

En notis er at gammel stedfesting fungerer bedre i dette tilfellet.
h2. Observasjon 2

Samme support-henvendelse, analyse og lÃ¸sning som over. Denne gang for Vegdekke-KURVE 26. OgsÃ¥ vedlagt.",NVDB-6937,Datafangst,
Feil i openapi-spesifikkasjon,"Gitter: 
{quote}
Olav Dahl Solstad
@olav89
12:15
Ok. Jeg har prÃ¸vd Ã¥ generere opp klientkode fra openapi-dokumentasjonen, men ser ut som det er noen ting som ikke stemmer helt i den - her er iallefall det jeg har funnet sÃ¥ langt:
""forenklet"" pÃ¥ geometri har ingen type (2 tilfeller)
""egenskapstyper"" har i vegobjekttype-endepunktet blitt til ""egenskaper""
konnekteringslenkeOk burde vel vÃ¦re med _ok i vegobjekttype
{quote}",NVDB-6937,Les-API,
Barn-Forelder-relasjon henger igjen,"h2. Support

Vi har nÃ¥ testet Â«bytte av morÂ» bÃ¥de for skiltpunkt-skiltplate og rekkverk-rekkverksende vha. Â«Redigere koblingÂ» i SINUS:

Det ser bra ut! NVDB SKRIV tar imot vÃ¥rt endringssett og utfÃ¸rer Â«omkoblingenÂ» som den skal. Datterobjekt kobles til ny mor og forsvinner fra gammelmora. Om man betrakter hierarkiet ovenfra og nedover.

*MEN*: Vi mener det var snakk om at det genereres en ekstra indeks fra datter-til-mor i LES. En kobling som ikke finnes i NVDB. Det kan se ut som denne indeksoppdateringen ikke utfÃ¸res helt riktig. Resultatet er at sett fra datterobjektet og Â«oppoverÂ» sÃ¥ har den to mÃ¸dre. BÃ¥de det gamle og det nye skiltpunktet/rekkverket.

Â 

Sigmund Fredriksen",NVDB-6937,Les-API,
Patch for Ã¥ stÃ¸tte gammel og ny Skriv URL mens auth redirect fikses,"Ved utrulling av datafangst-2020.3.3.0 fikk ikke brukere til Ã¥ logge inn.
releasen inneholder ny URL til API Skriv i atlas.
[~exttxa] mistenker at dette er en feil i hvordan innlogging rutes i SVV, og tar det med drift.

Vi har to mulige scenarier for Ã¥ rette dette, der den ene er Ã¥ rulletilbake til en tidligere release, og den andre er Ã¥ patche releasen.

Etter analysering av kodeendringene som berÃ¸rer problemet beslutter vi Ã¥ patche releasen. det innebÃ¦rer at vi tilpasser koden for Ã¥ ogsÃ¥ stÃ¸tte gammel Skriv URL, som vil si en liten endring i hvordan vi fornyer auth token.

Vi setter da conf i PROD til Ã¥ peke mot gammel skriv-url (uten atlas). NÃ¥r rutingen av autentisering blir fikset senere, skal vi da kunne gÃ¥ over til atlas-url uten Ã¥ trenge Ã¥ gjÃ¸re en ny release.",NVDB-6937,Datafangst,
Systemfeil pÃ¥ eksport pga overgang til Atlas,"h2. Observasjon

GÃ¥ til [https://datafangst.kantega.no/#!/contract/59f52e49-7ba9-4108-bae6-b814592b28fb/export]

Kallet GET [https://datafangst.kantega.no/rest/contract/59f52e49-7ba9-4108-bae6-b814592b28fb/nvdb_submission/registration]

gir HTTP 500 og
{noformat}
{""messages"":[""java.lang.IllegalStateException: Unexpected NVDB Write API URL: https://www.vegvesen.no/nvdb/apiskriv""]}
{noformat}",NVDB-6937,Datafangst,
Veglister feiler for kv40142 i Saltdal kommune,"Vi fÃ¥r denne feilmeldingen nÃ¥r vi tar ut vegliste, arbeid forÂ kv40142 i Saltdal kommune, eller alle andre omrÃ¥der som omfatter denne vegen. Feilen skjer pÃ¥ normaltransport, tÃ¸mmertransport og spesialtransport, bÃ¥de offisiell og uoffisiell.Â 
Â 
FEIL (00:00:23.116) Vegliste feilet! (java.util.NoSuchElementException: No value present)
Â 
Mistanken gÃ¥r jo primÃ¦rt mot en datafeil i NVDB vegnett for KV40142, den gjÃ¸r jo det...Â Â ",NVDB-6869,Rapportgenerator,
Flytt change log inn som en DF-komponent,"I dag ligger change log som en egen side pÃ¥ github.

Det er uheldig, fordi changelog mÃ¥ skrives som et eget steg i release, der noen mÃ¥ manuelt gÃ¥ igjenom hele releasen. Istedet burde utvikler legge inn et innslag i changelog som en de av Ã¥ utfÃ¸re en jiraoppgave, og sjekk av changelog blir en del av QA.Â 
Github skal ogsÃ¥ fases ut, kodebasen flyttes til Bitbucket internt i SVV. da fÃ¥ vi sannsynligvis ikke like like lett offentlig tilkang til changelog.

Â 

Lag en changelog-komponent i DF

Â - mÃ¥ funke med gave-ikon, slik dagens lÃ¸sning gjÃ¸r

Â 

Â ",NVDB-6937,Datafangst,
Veglister feiler for kv40142 i Saltdal kommune,"Vi fÃ¥r denne feilmeldingen nÃ¥r vi tar ut vegliste, arbeid forÂ kv40142 i Saltdal kommune, eller alle andre omrÃ¥der som omfatter denne vegen. Feilen skjer pÃ¥ normaltransport, tÃ¸mmertransport og spesialtransport, bÃ¥de offisiell og uoffisiell.Â 
Â 
FEIL (00:00:23.116) Vegliste feilet! (java.util.NoSuchElementException: No value present)
Â 
Mistanken gÃ¥r jo primÃ¦rt mot en datafeil i NVDB vegnett for KV40142, den gjÃ¸r jo det...Â Â ",,Rapportgenerator,
Brukere mottar ikke epost,"h2. Observasjon

(meldt pÃ¥ support fra Stian SÃ¸berg)

Det har vÃ¦rt flere tilfeller pÃ¥ support av brukere som melder at de ikke mottar epost. Den ligger heller ikke i sÃ¸ppelposten. Jeg har selv prÃ¸vd Ã¥ legge til en bruker uten Ã¥ fÃ¥ epost.

For aktuell bruker i SÃ¸berg sitt tilfelle er denne:

[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.13-2020.12.09/doc/?id=IHuzRnYBZ_myVmB8gJUe]

Fra eposten:
{noformat}
HeiÂ 
Jeg har lagt inn noen nye brukere ved hjelp av e-post i datafangst, men fÃ¥r ingen mail om oppretting av passord. Det er nÃ¥ gÃ¥tt to dager, er dette riktig?Â 

Brukerne det er snakk om er:Â 
- Innlandetfk1@gmail.com
- Innlandetfk2@gmail.com
- Innlandetfk3@gmail.com
{noformat}
h2. LÃ¸sning

Dette er fiksa ved konfigurasjonsendring i prod og ATM.
h2. Installasjon

NÃ¥r versjon med denne saken rulles ut kan konfigurasjon for SMTP fjernes i config-fil i ATM og prod.",NVDB-6937,Datafangst,
Stedfesting ikke mulig pÃ¥ privat veg i ATM,"h2. Observasjon

Ved forsÃ¸k pÃ¥ stedfesting pÃ¥ privat veg med Skriv vil det ikke produseres kandidater pÃ¥ den private vegen. enten fÃ¥r du beskjed om at ingen kandidater finnes, eller sÃ¥ fÃ¥r du stedfesting pÃ¥ nÃ¦rmeste hovedveg.

Eksempel pÃ¥ request med oppgitt veg:
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfest xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <parametere>
        <maksimalAvstandTilVeg>300</maksimalAvstandTilVeg>
        <veger>
            <veg>
                <kategori>P</kategori>
                <fase>V</fase>
                <nummer>97730</nummer>
            </veg>
        </veger>
        <typeVeger>
            <typeVeg>KANALISERT_VEG</typeVeg>
            <typeVeg>ENKEL_BILVEG</typeVeg>
            <typeVeg>RAMPE</typeVeg>
            <typeVeg>RUNDKJÃ˜RING</typeVeg>
            <typeVeg>GATETUN</typeVeg>
        </typeVeger>
        <beregnSideposisjon>true</beregnSideposisjon>
    </parametere>
    <vegobjekter>
        <vegobjekt typeId=""96"" tempId=""2d1c0a30-04dc-4073-8b1b-3de6d90590a9"">
            <egenskaper>
                <egenskap typeId=""4795"">
                    <geometri>
                        <srid>25833</srid>
                        <wkt>POINT (273354.28 7044384.03 21.73)</wkt>
                        <referansegeometri>false</referansegeometri>
                        <kvalitet>
                            <mÃ¥lemetode>82</mÃ¥lemetode>
                            <mÃ¥lemetodeHÃ¸yde>-1</mÃ¥lemetodeHÃ¸yde>
                            <nÃ¸yaktighet>100</nÃ¸yaktighet>
                            <nÃ¸yaktighetHÃ¸yde>0</nÃ¸yaktighetHÃ¸yde>
                            <synbarhet>99</synbarhet>
                        </kvalitet>
                    </geometri>
                </egenskap>
            </egenskaper>
            <gyldighetsperiode>
                <startdato>2021-01-14</startdato>
            </gyldighetsperiode>
        </vegobjekt>
    </vegobjekter>
</stedfest>{noformat}
Respons:
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt tempId=""2d1c0a30-04dc-4073-8b1b-3de6d90590a9"">
        <feil>
            <feil kode=""STEDFESTING_MISLYKTES"">
                <melding>Ingen relevant vegnettstilknytning ble funnet med de angitte parametere</melding>
            </feil>
        </feil>
    </vegobjekt>
</stedfestingResultat>{noformat}

h2. Analyse

PrÃ¸vde requesten over mot API Skriv i PROD og fikk:

{code:xml}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt tempId=""2d1c0a30-04dc-4073-8b1b-3de6d90590a9"">
        <stedfesting>
            <oversikt>
                <veg>
                    <kategori>P</kategori>
                    <fase>V</fase>
                    <nummer>97730</nummer>
                </veg>
                <lengde>0.0</lengde>
            </oversikt>
            <punkt veglenkesekvensNvdbId=""46678"" posisjon=""0.28120338"">
                <sideposisjon>H</sideposisjon>
                <geometri>
                    <srid>5973</srid>
                    <wkt>POINT (273350.57284296886 7044379.740949327)</wkt>
                </geometri>
            </punkt>
        </stedfesting>
    </vegobjekt>
</stedfestingResultat>
{code}

Â ",NVDB-6937,Les-API,
Veglenkesekvenser uten strekningsdata fÃ¸rer til NPE,"h2. Observasjon

Beskrevet pÃ¥ NVDB-6340, men med feil referanse til koden.

Auto.assos i kontrakt [https://datafangst.kantega.no/#!/contract/db3a2eb8-8673-4184-b35e-e4a357f23753]Â mellom kontrakt-96 og NVDB-95 gjÃ¸r at DF henter ned aktuelle 95-objekter fra NVDB:Â GET [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/95?kartutsnitt=138644.77811097656%2C6501017.379412278%2C138748.77811097656%2C6501121.379412278&inkluder=lokasjon%2Cgeometri%2Cegenskaper%2Cmetadata%2Crelasjoner&srid=UTM33]
h2. Analyse

Siden en av disse er stedfestet pÃ¥ veglenkesekvensÂ 3153539 sÃ¥ hentes denne med GET [https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/3153539|https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/3153539,]

Noen av disse segmentene -har PV uten vegnummer,-Â vegsystemferanse uten strekningsdata, noe som gjÃ¸r at DF kaster en NPE
{noformat}
java.lang.NullPointerException at no.svv.nvdb.datafangst.integration.nvdbapi.transform.NvdbReadApiTransform.toRefLinkPart(NvdbReadApiTransform.java:78)
{noformat}
78: if (part.getVegsystemreferanse().getStrekning().getRetning().equals(""MOT""))

Vi bruker retning for Ã¥ vurdere om vi skal reversere wkt eller ikke.
h2. Fix

Siden vi ikke har noe strekningsdata, og ikke noen retning pÃ¥ disse segmentene sÃ¥ kan vi ikke gjÃ¸re noen antakelse om wkt skal snus eller ikke.
Det beste vi kan gjÃ¸re er Ã¥ presentere wkt slik den er.

LÃ¸sningen blir da Ã¥ innfÃ¸re en nullsjekk og hoppe over reversering hvis retning ikke finnes.Â ",NVDB-6937,Datafangst,
Beregner sideposisjon nÃ¥r ikke sideposisjonrelevant,Stedfestingstjenesten har fÃ¥tt opsjon for Ã¥ beregne sideposisjon. Dette gjÃ¸res imidlertid uten Ã¥ ta hensyn til om vegobjekttypen er sideposisjonrelevant eller ikke. Kun vegobjekttyper som er sideposisjonrelevant kan ha sideposisjon satt i stedfestingen.,NVDB-6937,Skriv-API,
Bruk nyere Oracle driver,,NVDB-6937,NVDB-IND,
HTTP 500 ved oppslag,"*Observasjon*

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/105.json?antall=13&adskiltelop=Med]

gir bl.a.Â 81497572. Oppslag mot denne gir HTTP 500

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/105/81497572/6]

*Observasjon #2*

Filtrering med kontraktsomrÃ¥de ""30-2E01- Veilys Viken Nord 2021-2026"" gir HTTP 500:

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/96.json?kontraktsomrade=%2230-2E01-%20Veilys%20Viken%20Nord%202021-2026%22&segmentering=true&debug=true]

Â 

Â ",NVDB-6937,Les-API,
MÃ¥ logge inn igjen etter kun 30 min,"*Observasjon fra support (Kurt Johnsen)*

Bruker mÃ¥ logge inn igjen etter 15 min inaktivitet. Bruker har undersÃ¸kt lokalt og har fÃ¸lgende uttalelse:
{noformat}
Hei,Â 

Har hatt it hos oss og sett pÃ¥ saken, alt skal vÃ¦re i orden lokalt. Ser at hvis jeg er inaktiv (ikke bruker datafangst) i ca.15 minutter sÃ¥ mÃ¥ jeg logge inn i datafangst pÃ¥ nytt, husker det ogsÃ¥ var slik i begynnelsen da datafangst ble lansert men at dette ble ordnet slik at en var innlogget selv om en var inaktiv en god stund. Jeg benytte Google Chrome nettleser.Â 

Andre web programmer jeg logger inn i med Google Chrome fungerer fint uten at jeg mÃ¥ logge inn pÃ¥ nytt hvis jeg er inaktiv over en time.Â 

Kan dere se pÃ¥ om det er noe i datafangst en kan endre slik at en kan vÃ¦re innlogget lengre nÃ¥r en er inaktiv (ikke bruker programmet).
{noformat}
Â 

Testing viser at det er 30 min og ikke 15, men uansett plagsomt.",NVDB-6937,Datafangst,
Manglende vegnummer for PV skaper trÃ¸bbel,"Se diskusjon pÃ¥ Mattermost som starter med: [https://mattermost.kantega.no/svv/pl/nzrus33hpjys3r1mooo4fg4meh]

Â 

*Observasjon stedfesting*

Hvis man stedfester til PV uten vegnummer sÃ¥ vil intern sjekk i Datafangst kaste en HTTP 500 siden antallet tegn ""PV"" ikke er minimum 3 som f.ex ""EV6"".

Se forÃ¸vrig stedfesting av kummer i kontrakt [https://datafangst.kantega.no/#!/contract/db3a2eb8-8673-4184-b35e-e4a357f23753.]Â Her lar ikke PUNKT 2 seg stedfeste til PV, mens PUNKT 1 stedfestes til en KV langt unna.

*Observasjon automatisk assosiasjon*

Auto.assos i kontrakt [https://datafangst.kantega.no/#!/contract/db3a2eb8-8673-4184-b35e-e4a357f23753]Â mellom kontrakt-96 og NVDB-95 gjÃ¸r at DF henter ned aktuelle 95-objekter fra NVDB:Â GET [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/95?kartutsnitt=138644.77811097656%2C6501017.379412278%2C138748.77811097656%2C6501121.379412278&inkluder=lokasjon%2Cgeometri%2Cegenskaper%2Cmetadata%2Crelasjoner&srid=UTM33]

Siden en av disse er stedfestet pÃ¥ veglenkesekvensÂ 3153539 sÃ¥ hentes denne med GET [https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/3153539|https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/3153539,]

Noen av disse segmentene har PV uten vegnummer, noe som gjÃ¸r at DF kaster en NPE
{noformat}
java.lang.NullPointerException at no.svv.nvdb.datafangst.integration.nvdbapi.transform.NvdbReadApiTransform.toRefLinkPart(NvdbReadApiTransform.java:78) 

se linje 87: part.getVeglenkenummer()
{noformat}
Se sÃ¸k
{noformat}
ttps://vegdata.kantega.no/kibana/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:'2020-12-07T10:00:00.000Z',mode:absolute,to:'2020-12-07T10:11:59.999Z'))&_a=(columns:!(_source),index:'datafangst-logs-*',interval:auto,query:(language:lucene,query:'HOSTNAME:datafangst.kantega.no%20AND%20%22db3a2eb8-8673-4184-b35e-e4a357f23753%22'),sort:!('@timestamp',desc))
{noformat}
h2. LÃ¸sning

Fra @havwig:Â _Tre tegn for vegnummer er bare et krav i vÃ¥r interne kode, og bare pga en antakelse som ble gjort for lenge siden. Dropp det kravet og gjÃ¸r litt testing pÃ¥ at ikke noe annet ramler ut._

Â ",NVDB-6937,Datafangst,
Duplikat punktstedfesting fra /rute,"h2. Observasjon

FÃ¸lgende request gÃ¥r til API Les:
{noformat}
POST https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute
Accept: application/json
X-Client: NVDB API Skriv
Content-Type: application/json
X-Request-ID: ab753475-50df-4521-9fb0-b071f5632f51
svvguid: 55f97a59-b4e8-c095-dc9a-8391c2252ac1
{""geometri"":""POINT (140947.43 6497139.56)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""FV409"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-12-04"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
Responsen er:
{code:json}
{
    ""vegnettsrutesegmenter"": [
        {
            ""href"": ""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/22197"",
            ""metadata"": {
                ""startdato"": ""2020-03-02""
            },
            ""veglenkesekvensid"": 22197,
            ""startposisjon"": 0.24049489,
            ""sluttposisjon"": 0.24049489,
            ""kortform"": ""0.24049489@22197"",
            ""veglenkenummer"": 10,
            ""sluttnode"": ""2962986"",
            ""type"": ""HOVED"",
            ""detaljnivÃ¥"": ""Vegtrase og kjÃ¸rebane"",
            ""typeVeg"": ""Enkel bilveg"",
            ""typeVeg_sosi"": ""enkelBilveg"",
            ""feltoversikt"": [
                ""1"",
                ""2""
            ],
            ""geometri"": {
                ""wkt"": ""POINT Z(140935.99 6497172.559 5.946)"",
                ""srid"": 5973
            },
            ""lengde"": 0.0,
            ""fylke"": 42,
            ""kommune"": 4203,
            ""vegsystemreferanse"": {
                ""vegsystem"": {
                    ""id"": 1002106964,
                    ""versjon"": 1,
                    ""vegkategori"": ""F"",
                    ""fase"": ""V"",
                    ""nummer"": 409
                },
                ""strekning"": {
                    ""id"": 1003423684,
                    ""versjon"": 1,
                    ""strekning"": 1,
                    ""delstrekning"": 1,
                    ""arm"": false,
                    ""adskilte_lÃ¸p"": ""Nei"",
                    ""trafikantgruppe"": ""K"",
                    ""meter"": 2183.773,
                    ""retning"": ""MED""
                },
                ""kortform"": ""FV409 S1D1 m2184""
            },
            ""kontraktsomrÃ¥der"": [
                {
                    ""id"": 775462797,
                    ""nummer"": 910,
                    ""navn"": ""0910 Aust-Agder elektro og veglys 2018-2023""
                },
                {
                    ""id"": 980782098,
                    ""nummer"": 920,
                    ""navn"": ""0920 Arendal 2020-2025""
                },
                {
                    ""id"": 596780270,
                    ""nummer"": 903,
                    ""navn"": ""0903 Arendal vest 2016-2021""
                }
            ],
            ""riksvegruter"": []
        },
        {
            ""href"": ""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/22197"",
            ""metadata"": {
                ""startdato"": ""2020-03-02""
            },
            ""veglenkesekvensid"": 22197,
            ""startposisjon"": 0.24049489,
            ""sluttposisjon"": 0.24049489,
            ""kortform"": ""0.24049489@22197"",
            ""veglenkenummer"": 11,
            ""startnode"": ""2962986"",
            ""type"": ""HOVED"",
            ""detaljnivÃ¥"": ""Vegtrase og kjÃ¸rebane"",
            ""typeVeg"": ""Enkel bilveg"",
            ""typeVeg_sosi"": ""enkelBilveg"",
            ""feltoversikt"": [
                ""1"",
                ""2""
            ],
            ""geometri"": {
                ""wkt"": ""POINT Z(140935.99 6497172.559 5.946)"",
                ""srid"": 5973
            },
            ""lengde"": 0.0,
            ""fylke"": 42,
            ""kommune"": 4203,
            ""vegsystemreferanse"": {
                ""vegsystem"": {
                    ""id"": 1002106964,
                    ""versjon"": 1,
                    ""vegkategori"": ""F"",
                    ""fase"": ""V"",
                    ""nummer"": 409
                },
                ""strekning"": {
                    ""id"": 1003423684,
                    ""versjon"": 1,
                    ""strekning"": 1,
                    ""delstrekning"": 1,
                    ""arm"": false,
                    ""adskilte_lÃ¸p"": ""Nei"",
                    ""trafikantgruppe"": ""K"",
                    ""meter"": 2183.773,
                    ""retning"": ""MED""
                },
                ""kortform"": ""FV409 S1D1 m2184""
            },
            ""kontraktsomrÃ¥der"": [
                {
                    ""id"": 775462797,
                    ""nummer"": 910,
                    ""navn"": ""0910 Aust-Agder elektro og veglys 2018-2023""
                },
                {
                    ""id"": 980782098,
                    ""nummer"": 920,
                    ""navn"": ""0920 Arendal 2020-2025""
                },
                {
                    ""id"": 596780270,
                    ""nummer"": 903,
                    ""navn"": ""0903 Arendal vest 2016-2021""
                }
            ],
            ""riksvegruter"": []
        }
    ],
    ""metadata"": {
        ""antall"": 2,
        ""lengde"": 0.0,
        ""status"": 2000,
        ""status_tekst"": ""KOMPLETT""
    }
}
{code}
Samme punktstedfesting er angitt to ganger.

Â 

*LÃ¸sning*

Samme punkt ble gitt ut 2 ganger fordi det var slutten pÃ¥ en lenke og starten pÃ¥ neste lenke (veglenkenummer er forskjellig i de 2 i responsen). Lagt til et steg som fjerner punkter med samme stedfestning.",NVDB-6937,Les-API,
Mulighet for Ã¥ endre navn pÃ¥ kontraktgrupper,SjÃ¥ tittel,NVDB-6937,Datafangst,
Kontrollere rettigheter i REST-API,"Kontrollere at bare de med riktig rolle fÃ¥r tilgang til riktige funksjoner.

Rolle 9_system_admin skal gi tilgang til alle funksjoner
Rolle 0_bruker_fagdata skal ikke ha tilgang til alle funksjoner

I lÃ¸sninger er dette forelÃ¸pig kodet til Ã¥ bruke andre roller, siden vÃ¥re brukere i UTV ikke har fÃ¥tt disse to rollene, og vi heller ikke har testbrukere som har disse rollene.",NVDB-6937,Skriv-API,
Opprette en enkelt vegobjekttype i NVDB,"Bomstasjon er en enkel vegobjekttype som kan brukes som case. InnebÃ¦rer ikke lÃ¥sing.

Akseptansekriterier:
- Vegobjekt finnes i NVDB og transaksjonslogg reflekterer dette.
",NVDB-6937,Skriv-API,
Synkronisering med NVDB Data ut,"Jobbstatus skal oppdateres med info om NVDB Data ut-indeksen er oppdatert.

LÃ¸sningsforslag fra mÃ¸te med Data ut, 22.1:
Skrive-API eksponerer en REST-tjeneste som Lese-APIet kan anrope med informasjon om transaksjoner som er ferdig indeksert. Payloaden skal inneholde nok informasjon til at jobben kan identifiseres (transaksjonsid eller jobbid).

Testbeskrivelse:
- UtfÃ¸r en jobb (f.eks testcase 0).
- Hent jobb (kontrollpanel eller URL). Sjekk at ""tilgjengeligILes=true"" ikke stÃ¥r i jobben.
- Hent tastId fra Jobb-databasen (select taskid from job where id='<jobbId>').
- POST /nvdb/apiskriv/synkroniser/<taskId>
- Hent jobb (kontrollpanel eller URL). Sjekk at ""tilgjengeligILes=true"" stÃ¥r i jobben under etterbehandling.",NVDB-6937,Skriv-API,
"Opprette, endre, korrigere og slette heldekkende vegobjekter","Akseptansekriterier
- Nytt vegobjekt pÃ¥ samme lokasjon som eksisterende vegobjekt skal sette det eksisterende vegobjektet historisk
- Nytt vegobjekt som ligger innenfor lokasjon som eksisterende vegobjekt, men som ikke dekker hele, skal dele opp det eksisterende vegobjektet s.a. neste versjon av det eksisterende vegobjektet nÃ¥ inneholder to stedfestinger.

Testbeskrivelse
- Finn et vegobjekt og merk lokasjon, f.ex fartsgrense (105) pÃ¥ en vegstrekning. Sjekk eksisterende objekt gjennom /read/-API og NVDB 123 eller NVDB API Les / Vegkart
- Opprett request med samme type vegobjekt innenfor samme lokasjon
- Verifiser at nytt vegobjekt eksisterer pÃ¥ aktuell lokasjon gjennom NVDB API Ut / Vegkart eller NVDB 123. Det eksisterende objektet skal nÃ¥ vÃ¦re delt og omslutte det nye vegobjektet.
- Verifiser gjennom /read/-API at versjonene er endret (dette vises ikke i NVDB 123)

Flere ulike scenario for heldekkende vegobjekter testes gjennom de automatiserte integrasjonstestene.",NVDB-6937,Skriv-API,
Vise versjon av datakatalogen i Dashboard,"Akseptansekriterium:

Datakatalogens versjon vises i Kontrollpanelet",NVDB-6937,Skriv-API,
filtrere ut doble stedfestinger fra Skriv,"En bug i skriv gjÃ¸r at det av og til produseres doble stedfestinger for punktobjekter.
I mens vi venter pÃ¥ bugfix kan vi filtrere ut  duplikater pÃ¥ vÃ¥r side.

",NVDB-6937,Datafangst,
"Punktgeometri fÃ¥r dobbel, identisk stedfesting","h2. Observasjon
NÃ¥r vi sender inn punktobjekter til stedfesting fÃ¥r vi av og til to identiske stedfestinger tilbake. 
Punktobjekter skal ha bare en stedfesting, og to identiske stedfestinger er aldri gyldig for noen objekter.

Sender request til 

{code:java}
https://nvdbapiskriv.test.atlas.vegvesen.no/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=F&vegnummer=409&fase=V&typeVeg=KANALISERT_VEG%2CENKEL_BILVEG%2CRAMPE%2CRUNDKJ%C3%98RING%2CGATETUN
{code}

med 

{code:xml}
<vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
<vegobjekt typeId=""95"" tempId=""455efb6a-9495-46b3-8a5b-97d44cff7daa"">
    <egenskaper>
        <egenskap typeId=""4794"">
            <geometri>
                <srid>25833</srid>
                <wkt>POINT (140947.43 6497139.56 4.5200000000000005)</wkt>
                <datafangstdato>2020-05-26</datafangstdato>
                <referansegeometri>false</referansegeometri>
                <kvalitet>
                    <mÃ¥lemetode>96</mÃ¥lemetode>
                    <mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde>
                    <nÃ¸yaktighet>5</nÃ¸yaktighet>
                    <nÃ¸yaktighetHÃ¸yde>5</nÃ¸yaktighetHÃ¸yde>
                    <synbarhet>0</synbarhet>
                </kvalitet>
            </geometri>
        </egenskap>
    </egenskaper>
    <gyldighetsperiode>
        <startdato>2020-12-04</startdato>
    </gyldighetsperiode>
</vegobjekt>
</vegobjekter>
{code}

og fÃ¥r svar


{code:xml}
<stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt tempId=""455efb6a-9495-46b3-8a5b-97d44cff7daa"">
        <stedfesting>
            <oversikt>
                <veg>
                    <kategori>F</kategori>
                    <fase>V</fase>
                    <nummer>409</nummer>
                </veg>
                <lengde>0.0</lengde>
            </oversikt>
            <punkt veglenkesekvensNvdbId=""22197"" posisjon=""0.24049489"">
                <geometri>
                    <srid>5973</srid>
                    <wkt>POINT (140935.99 6497172.559)</wkt>
                </geometri>
            </punkt>
            <punkt veglenkesekvensNvdbId=""22197"" posisjon=""0.24049489"">
                <geometri>
                    <srid>5973</srid>
                    <wkt>POINT (140935.99 6497172.559)</wkt>
                </geometri>
            </punkt>
        </stedfesting>
    </vegobjekt>
</stedfestingResultat>
{code}

h2. Analyse

FÃ¸lgende request gÃ¥r til API Les:

{noformat}
POST https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute
Accept: application/json
X-Client: NVDB API Skriv
Content-Type: application/json
X-Request-ID: ab753475-50df-4521-9fb0-b071f5632f51
svvguid: 55f97a59-b4e8-c095-dc9a-8391c2252ac1
{""geometri"":""POINT (140947.43 6497139.56)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""FV409"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-12-04"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}

Responsen er:

{code:json}
{
    ""vegnettsrutesegmenter"": [
        {
            ""href"": ""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/22197"",
            ""metadata"": {
                ""startdato"": ""2020-03-02""
            },
            ""veglenkesekvensid"": 22197,
            ""startposisjon"": 0.24049489,
            ""sluttposisjon"": 0.24049489,
            ""kortform"": ""0.24049489@22197"",
            ""veglenkenummer"": 10,
            ""sluttnode"": ""2962986"",
            ""type"": ""HOVED"",
            ""detaljnivÃ¥"": ""Vegtrase og kjÃ¸rebane"",
            ""typeVeg"": ""Enkel bilveg"",
            ""typeVeg_sosi"": ""enkelBilveg"",
            ""feltoversikt"": [
                ""1"",
                ""2""
            ],
            ""geometri"": {
                ""wkt"": ""POINT Z(140935.99 6497172.559 5.946)"",
                ""srid"": 5973
            },
            ""lengde"": 0.0,
            ""fylke"": 42,
            ""kommune"": 4203,
            ""vegsystemreferanse"": {
                ""vegsystem"": {
                    ""id"": 1002106964,
                    ""versjon"": 1,
                    ""vegkategori"": ""F"",
                    ""fase"": ""V"",
                    ""nummer"": 409
                },
                ""strekning"": {
                    ""id"": 1003423684,
                    ""versjon"": 1,
                    ""strekning"": 1,
                    ""delstrekning"": 1,
                    ""arm"": false,
                    ""adskilte_lÃ¸p"": ""Nei"",
                    ""trafikantgruppe"": ""K"",
                    ""meter"": 2183.773,
                    ""retning"": ""MED""
                },
                ""kortform"": ""FV409 S1D1 m2184""
            },
            ""kontraktsomrÃ¥der"": [
                {
                    ""id"": 775462797,
                    ""nummer"": 910,
                    ""navn"": ""0910 Aust-Agder elektro og veglys 2018-2023""
                },
                {
                    ""id"": 980782098,
                    ""nummer"": 920,
                    ""navn"": ""0920 Arendal 2020-2025""
                },
                {
                    ""id"": 596780270,
                    ""nummer"": 903,
                    ""navn"": ""0903 Arendal vest 2016-2021""
                }
            ],
            ""riksvegruter"": []
        },
        {
            ""href"": ""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/22197"",
            ""metadata"": {
                ""startdato"": ""2020-03-02""
            },
            ""veglenkesekvensid"": 22197,
            ""startposisjon"": 0.24049489,
            ""sluttposisjon"": 0.24049489,
            ""kortform"": ""0.24049489@22197"",
            ""veglenkenummer"": 11,
            ""startnode"": ""2962986"",
            ""type"": ""HOVED"",
            ""detaljnivÃ¥"": ""Vegtrase og kjÃ¸rebane"",
            ""typeVeg"": ""Enkel bilveg"",
            ""typeVeg_sosi"": ""enkelBilveg"",
            ""feltoversikt"": [
                ""1"",
                ""2""
            ],
            ""geometri"": {
                ""wkt"": ""POINT Z(140935.99 6497172.559 5.946)"",
                ""srid"": 5973
            },
            ""lengde"": 0.0,
            ""fylke"": 42,
            ""kommune"": 4203,
            ""vegsystemreferanse"": {
                ""vegsystem"": {
                    ""id"": 1002106964,
                    ""versjon"": 1,
                    ""vegkategori"": ""F"",
                    ""fase"": ""V"",
                    ""nummer"": 409
                },
                ""strekning"": {
                    ""id"": 1003423684,
                    ""versjon"": 1,
                    ""strekning"": 1,
                    ""delstrekning"": 1,
                    ""arm"": false,
                    ""adskilte_lÃ¸p"": ""Nei"",
                    ""trafikantgruppe"": ""K"",
                    ""meter"": 2183.773,
                    ""retning"": ""MED""
                },
                ""kortform"": ""FV409 S1D1 m2184""
            },
            ""kontraktsomrÃ¥der"": [
                {
                    ""id"": 775462797,
                    ""nummer"": 910,
                    ""navn"": ""0910 Aust-Agder elektro og veglys 2018-2023""
                },
                {
                    ""id"": 980782098,
                    ""nummer"": 920,
                    ""navn"": ""0920 Arendal 2020-2025""
                },
                {
                    ""id"": 596780270,
                    ""nummer"": 903,
                    ""navn"": ""0903 Arendal vest 2016-2021""
                }
            ],
            ""riksvegruter"": []
        }
    ],
    ""metadata"": {
        ""antall"": 2,
        ""lengde"": 0.0,
        ""status"": 2000,
        ""status_tekst"": ""KOMPLETT""
    }
}
{code}

Det kommer altsÃ¥ duplikate punktstedfestinger fra API Les. Registrerer en Bug-sak pÃ¥ dette.

h2. LÃ¸sning

MÃ¥ fikses i API Les, men legger uansett inn et par kodelinjer i API Skriv for Ã¥ fjerne duplikat punktstedfesting.",NVDB-6937,Skriv-API,
"Driftskontrakt tilstandsrapport: Ta med navn, id og vegkartlenke til morobjekt i tabell","For tilstandsrapporten, basert pÃ¥ tilbakemeldinger under og etter demo:Â 

Vi Ã¸nsker at tilstandsrapporten har kolonner for objekttype ID, objekttype navn og vegkart-lenke for mor-objektet.Â 

For det spesialtilfellet at vi har mer enn ett ""mÃ¸dreobjekt"": Dette er datafeil, og vÃ¥r lÃ¸sning er Ã¥ bruke det fÃ¸rste objektet i listen over ""mÃ¸dreobjektet"" (som ideelt sett har ett og kun ett medlem).Â 

Vegkart-URL oppygning erÂ [https://vegkart.atlas.vegvesen.no/#valgt:78901692:5]Â  , dvsÂ [https://vegkart.atlas.vegvesen.no/#valgt:|https://vegkart.atlas.vegvesen.no/#valgt:78901692:5]Â  + <nvdb objektId> + :Â  + <nvdb objektTypeId> refÂ  [https://www.vegdata.no/2020/09/23/ny-funksjon-erstattar-redirect-url-for-vegobjekter-id/]Â 

!image-2020-12-03-13-17-56-573.png!

Â ",NVDB-6827,Rapportgenerator,
FÃ¥ sideposisjon ved stedfesting med Skriv,"API Skriv sin stedfestingstjeneste er omskrevet til Ã¥ ta i mot parametere som del av payload. Datafangst sin gateway mÃ¥ skrives om til Ã¥ bruke denne i stedet for varianten med query-parametere.

Â 

Den nye strukturen gir ogsÃ¥ muligheten til Ã¥ fÃ¥ automatisk sideposisjon, sÃ¥ det skrus pÃ¥.",NVDB-6937,Datafangst,
Bruk nye OIDC-endepunkter i Skriv,"API Skriv sitt OIDC-endepunkt (og payloads) har skiftet navn til engelsk. Se detaljer pÃ¥ https://apiskriv.vegdata.no/autentisering#autentisering-via-openid-connect

De gamle endepunktene med norske navn er fortsatt operative, men fjernes straks denne saken gjort.",NVDB-6937,Les-API,
Vegsegmentet finnes ikke,"h2. Observasjon

via Datafangst support

les finner dette segmentet, men det gjÃ¸r ikke stedfesting med skriv

[https://nvdbapiles-v3.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/3285592]

prÃ¸ver Ã¥ stedfeste pÃ¥ FG227

[https://www.vegvesen.no/nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=F&vegnummer=227&fase=V&typeVeg=GANG_OG_SYKKELVEG%2CSYKKELVEG%2CGANGVEG%2CG%C3%85GATE%2CFORTAU%2CTRAPP%2CGANGFELT]

for Ã¥ gjenskape i datafangst:
 last opp vedlagte sosi.
 prÃ¸v Ã¥ stedfest objektetene til gangvegen.
 stedfesting med skriv gir feilaktig stedfesting pÃ¥ hovedvegen.
 legacy stedfesting feiler, fordi topologyprovider sier at det ikke eksisterer noe vegsegment med oppgitt id

h2. Analyse

Det eneste jeg finner av logginnslag i Splunk er dette:

{noformat}
2020-12-01T13:21:00,632+0100 [http-nio-18230-exec-14] [] [1049925] RES 405 2
host = svvptomcat25source = /data/base-nvdbskriv-03/logs/svvptomcat25.vegvesen.no_access.logsourcetype = nvdb-access-log
2020-12-01T13:21:00,630+0100 [http-nio-18230-exec-14] [] [1049925] REQ GET https://www.vegvesen.no/nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=F&vegnummer=227&fase=V&typeVeg=GANG_OG_SYKKELVEG%2CSYKKELVEG%2CGANGVEG%2CG%C3%85GATE%2CFORTAU%2CTRAPP%2CGANGFELT
host = svvptomcat25source = /data/base-nvdbskriv-03/logs/svvptomcat25.vegvesen.no_access.logsourcetype = nvdb-access-log
{noformat}

Det er brukt GET pÃ¥ et endepunkt som krever POST. Derfor responderes med 405 METHOD NOT ALLOWED.",NVDB-6937,Skriv-API,
TrekkerÃ¸r lar seg ikke stedfeste med Skriv,"h2. Observasjon

Fra support.

Vedlagt ligger sosi med trekkekrÃ¸r der flere ikke lar seg stedfeste med skriv. Auto-stedfesting stedfester mange, men ikke alle.

De som mangler ligger nÃ¦r eller pÃ¥ vei, og noen uten annen vei i nÃ¦rheten, men gjerne i litt rare vinkler.

Ã‰n kurve lar seg ikke stedfeste manuelt nÃ¥r jeg tester, det er kurve 83. FÃ¥r feilmelding som vanligvis betyr at Skriv ikke har fÃ¥tt svar fra Les. Hadde vÃ¦rt interessant Ã¥ se pÃ¥ de automatiske som feiler, men det viktigste er nok den ene som ogsÃ¥ feiler manuelt.

API-kall mot Skriv: POST [https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=E&vegnummer=39&fase=V&typeVeg=KANALISERT_VEG%2CENKEL_BILVEG%2CRAMPE%2CRUNDKJ%C3%98RING%2CGATETUN]

Request body:

{code:xml}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt typeId=""852"" tempId=""02acb0d5-c597-4604-8e35-9f0373fa2898"">
        <egenskaper>
            <egenskap typeId=""9721"">
                <geometri>
                    <srid>25833</srid>
                    <wkt>LINESTRING (-9857.29 6785067.83 15.52, -9857.11 6785067.92 16.56, -9856.85 6785067.97
                        17.490000000000002, -9856.36 6785067.95 18.36, -9855.76 6785067.93 19.04, -9855.04 6785067.89
                        19.57, -9854.23 6785067.87 19.92, -9853.44 6785067.89 20.16, -9852.92 6785067.84 20.35, -9852.51
                        6785067.84 20.38, -9852 6785067.73 20.11)
                    </wkt>
                    <datafangstdato>2019-09-02</datafangstdato>
                    <temakode>4008</temakode>
                    <referansegeometri>false</referansegeometri>
                    <kvalitet>
                        <mÃ¥lemetode>11</mÃ¥lemetode>
                        <mÃ¥lemetodeHÃ¸yde>11</mÃ¥lemetodeHÃ¸yde>
                        <nÃ¸yaktighet>10</nÃ¸yaktighet>
                        <nÃ¸yaktighetHÃ¸yde>10</nÃ¸yaktighetHÃ¸yde>
                        <synbarhet>0</synbarhet>
                    </kvalitet>
                </geometri>
            </egenskap>
        </egenskaper>
        <gyldighetsperiode>
            <startdato>2020-12-05</startdato>
        </gyldighetsperiode>
    </vegobjekt>
</vegobjekter>
{code}

h2. Analyse

Stedfestingstjenesten skal sikre at ruten fra API Les er pÃ¥ minst en meter. I dette tilfelle er den ikke det og det gjÃ¸res forsÃ¸k pÃ¥ Ã¥ blÃ¥se opp geometrien slik at ruten fÃ¥r minstelengde. Etter tre forsÃ¸k  er fortsatt ikke lengden 1 m, og det returneres tom stedfesting med melding om at stedfesting mislyktes. Gjennom gjentatte oppblÃ¥singer blir rutelengden slik:

* 0.973
* 0.984
* 0.986
* 0.994

Ã…rsaken til Ã¥ at den ikke tipper over 1 m ser ut til Ã¥ vÃ¦re hvordan bufferlengden beregnes i GeometryPrimer.inflateGeometryForMinimumLocationalLength. Algoritmen tar ikke tilstrekkelig hensyn
til abnorme geometrier som i dette tilfellet.

h2. LÃ¸sning

Endret GeometryPrimer.inflateGeometryForMinimumLocationalLength til Ã¥ legge til 5 cm pÃ¥ manglende lengde i stedet for 10 %.",NVDB-6937,Skriv-API,
Ingen progress ved automatisk stedfesting med Skriv,Ved automatisk stedfesting stÃ¥r bare progress bar pÃ¥ 50% helt til det er ferdig. Siden dette er er en operasjon som kan ta lang tid sÃ¥ hadde det vÃ¦rt veldig gunstig her om progress bar ga en reell indikasjon pÃ¥ hvor mye som er igjen. Slik som det er nÃ¥ er det fort gjort Ã¥ tro at den henger.,NVDB-6937,Datafangst,
Utfasing av datafangst.kantega.no,"Adressene til Datafangst pÃ¥ Kantega-domene mÃ¥ fasast gradvis ut.
 # Verlse brukarar som gÃ¥r inn pÃ¥ datafangst.kantega.no om at dei mÃ¥ bytte til ny adresse, men tillate vidare bruk denne sesjon enten med redirect eller fortsat bruk i same sesjon.
 Dette kan skje ved varselboble etter innlogging, samt melding pÃ¥ innloggingskjerm.
 # PÃ¥ ein gitt dato vise ei melding om feil adresse (kan gjerne styres via konfig). Brukar mÃ¥ sjÃ¸lv skrive inn ny adresse, eller klikke pÃ¥ lenke til ny adresse.
 # Til slutt skal sida vise generell feil.",NVDB-6937,Datafangst,
Fjern alle spor av Kantega,"Finner bare en referanse til Kantega, og det er i mail template for nye brukere. den er endret til datafangst.vegvesen.no

",NVDB-6937,Datafangst,
Lokal kjÃ¸ring feiler nÃ¥r den ikke finner jaxb-implementasjon,"FÃ¥r relativt ofte feil med lokal kjÃ¸ring med at den ikke finner noen jaxb-implementasjon. Kan fikses med en restart, men irriterende uansett.",NVDB-6937,Datafangst,
Unaurhorized endepunkt via API,"via Stig Vidar Hovland <Stig-Vidar.Hovland@powel.no>

Hei

Problemet med CORS ser ut til Ã¥ vÃ¦re lÃ¸st. Men det er allikevel noen andre problemer som jeg ikke helt finner ut av pÃ¥ egenhÃ¥nd.

Jeg klarer Ã¥ levere data til datafangst med


PUT /api/v1/contract/{contractId}/featurecollection/{collectionId}
og POST /api/v1/contract/{contractId}/featurecollection

Men nÃ¥r jeg bruker

GET /api/v1/contract/{contractId}/featurecollection/{collectionId}/status


sÃ¥ fÃ¥r jeg respons â€œunauthorizedâ€

Bruker er svh@powel.com

 !screenshot-1.png|thumbnail! ",NVDB-6937,Datafangst,
Legge om til OIDC og Skrive-Atlas for index- og smoke-tester,"De jevnlige testene pÃ¥ Jenkins som kjÃ¸rer smoke-tester og indekseringstester gÃ¥r ikke mot Atlas-Skriv. Oppgaven gÃ¥r pÃ¥ Ã¥ skrive om til Ã¥ benytte oidc/jwt og Atlas-Skriv i disse testene:
 * Scenario _indexTest_
 * Scenario _smokeTest_

Merk: Behold _smokeTest_ mot de gamle miljÃ¸ene.

Â ",NVDB-6937,Les-API,
SÃ¸rg for at  genererte filer havner i target,"frontend/src/main/css/svviconfont.scss

frontend/src/main/fonts/svviconfont.eot

frontend/src/main/fonts/svviconfont.ttf

frontend/src/main/fonts/svviconfont.woff",NVDB-6937,Datafangst,
PV med manglende nummer fÃ¸rer til ugyldige stedfestinger,"..som fÃ¸rer til at datafangst krasjer (med vilje).

Disse stedfestingene mÃ¥ slettes for Ã¥ unngÃ¥ at datafangst krÃ¦sjer for de prosjektene det gjelder.

Brukerne mÃ¥ samtidig fÃ¥ beskjed om at de ikke mÃ¥ stedfeste privatvegene pÃ¥ nytt fÃ¸r feilen er rettet i NVDB.

Feilen rettes nÃ¥r det blir kjÃ¸rt et script (som det har vÃ¦rt problemer med)

Mailadresse til alle som henvender seg til oss pÃ¥ mail kan legges i en kommentar pÃ¥ denne posten slik at vi kan sende ut mail til dem nÃ¥r feilen er rettet.",NVDB-6937,Datafangst,
UtgÃ¥tte passordtoken blir ikke slettet fra database,"Etter NVDB-4282 sÃ¥ er ikke lengre TokenSweeper aktiv, sÃ¥ utgÃ¥tte tokens for ny bruker slettes ikke fra database.",NVDB-6937,Datafangst,
API mangler CORS-headere,,NVDB-6937,Datafangst,
E2E-test av gruppeadmin,"Det mangler E2E-tester av gruppeadmin, dvs alle operasjoner underÂ /#!/admin/groups.

Tester som mÃ¥ implementeres:
 * (/)Â Opprette ny kontraktsgruppe
 * (/)Â Legge til bruker i gruppe
 * (/) Fjerne bruker fra gruppe
 * (/) Endre rolle til gruppeadmin
 * (/) Endre rolle til gruppeforvalter
 * (/)Â Endre rolle til gruppedeltaker
 * (/)Â Legge til kontrakt i gruppe
 * (/)Â Fjerne kontrakt fra gruppe",NVDB-6937,Datafangst,
Merking av duplikate objekter i CSV,"I CSV-eksport vert objekt med stadfesting pÃ¥ fleire vegar delt opp i ei rad for kart vegelement. Det kan vere nyttid Ã¥ ha med ei kolonne som indikerer om dette er primÃ¦re (fÃ¸rste) forekomst av dette objektet, eller det er duplikat av ei tidlegare rad.

Til dÃ¸mes kan det indikerast med ""1"" for fÃ¸rste rad, og ""0"" for resterande rader.",NVDB-6937,Eksport,
Innlesing av datakatalog fra NVDB til intern objektgraf,"Akseptansekriterier:
- Datakatalog populeres fra NVDB og refreshes nÃ¥r den endres i NVDB

Testbeskrivelse:
LÃ¸sningen startes med -Plive i sandboxmiljÃ¸et. GjÃ¸r et anrop med testklienten og kontroller i loggen at datakatalogen populeres fra NVDB. Refreshing ved endret datakatalog er litt mer verre Ã¥ teste...",,,
NVDBREF-608 : Vegobjekt-Belysingspunkt uten vegsystemreferanse,"Jeg har funnet et belysningspunkt (id 268323390) uten vegsystemreferanse i vegkart.
 [https://vegkart.test.atlas.vegvesen.no/#kartlag:topo4/@654839,7731893,18/hva:~(~(id~87))/valgt:268323390:87]
 Jeg tok at oppdateringsprosjekt i NVDB123 og finner objektet her med slettede dÃ¸tre og uten vegreferanse.Â  Dette er kanskje mer enn datafeil i basen enn en vegkartfeil ?, men et sted mÃ¥ jeg jo melde dette.
 Se skjermdump i fila ""Belysningspunkt 268323390""
h2. Â LÃ¸sning

For vegobjekter som er Ã¥pne men stedfestet pÃ¥ lukket vegnett brukes nÃ¥ vegsystemreferansen fra vegnettet fÃ¸r det ble lukket, den ""nyeste"" vegsystemreferansen. I tilfellet som ble meldt i denne saken er det bare vegsystem (EV8) pÃ¥ det gamle vegnettet.",NVDB-6937,Les-API,
Serialisering av geometri til cache,"Caused by: java.lang.RuntimeException: No serializer for GeometryHolder

Â 

Oppdaget i ATM.",NVDB-6937,NVDB-IND,
Rydde i sprÃ¥k (engelsk/norsk) i koden,Bruke norsk for domene-objekter og engelsk ellers,,,
Jobbrelaterte entiteter,"Akseptansekriterier:
- Implementert domeneklasser for NVDB-nÃ¦r representasjon av jobb-entiteter",,,
Involvere designer,"Akseptansekriterier:
- FÃ¸lger SVVs design guide",,,
Avklare datakatalogkvalitet med Vilhelm BÃ¸rnes,"Forskjeller i datakatalogen slik den framstÃ¥r i Java webstart og NVDB, f.eks. ift. sideposisjonrelevans. Tidligere hadde flere vegobjekttyper pÃ¥krevd sideposisjon, men i siste versjon er disse endret til valgfri.",,,
Kontrollere roller pÃ¥ serveren,"Kontrollere pÃ¥ serveren at brukeren ikke fÃ¥r hentet ut informasjon han ikke skal ha, basert pÃ¥ de rollene han har",,,
Validere at verdier pÃ¥ egenskaper skal vÃ¦re riktig i henhold til gyldig datatype,"Id: 2
Navn: Tall
Kortnavn: N
Beskrivelse: Datatype benyttes for ET som skal inneholde tall.  Benyttes bÃ¥de om heltall og desimaltall.  Det mÃ¥ angis feltlengde og antall desimaler.  BÃ¥de siffer foran og bak komma samt selve kommaet inngÃ¥r i feltlengde.  Kan angi maksverdi, minverdi, defaultverdi og maske.  NVDB: Nf_IntegerAttributetype eller Nf_RealAttributeType

Id: 8
Navn: Dato
Kortnavn: D
Beskrivelse: Datatype benyttes for ET som skal inneholde Ã…r/MÃ¥ned/Dag.  Skal ha feltlengde = 8.  MÃ¥ oppgi maske.  Kan oppgi maksverdi,  minverdi og defaultverdi.  NVDB: Nf_DateAttributeType

Id: 9
Navn: KortDato
Kortnavn: KD
Beskrivelse: Datatype benyttes for ET som skal inneholde MÃ¥ned/Dag for datoer som skal gjentas Ã¥r etter Ã¥r.  MÃ¥ angi feltlengde.  Skal ha feltlengde 4.  MÃ¥ angi maske.  Kan angi maksverdi, minverdi og defaultverdi.  NVDB: Nf_ShortDate

Id: 10
Navn: Klokkeslett
Kortnavn: KL
Beskrivelse: Datatype benyttes for ET som skal inneholde Time/Minutt.  MÃ¥ ha feltlengde=4. Kan angi maksverdi, minverdi og defaultverdi.  NVDB: Nf_TimeAttributeType

Id: 17
Navn: GeomPunkt
Kortnavn: GP
Beskrivelse: Datatype benyttes for ET som skal inneholde koordinater til et punkt i form av x-, y- og z-verdier.  Z-koordinat kan utelates.  Det mÃ¥ gis informasjon om koordinatsystem.  NVDB: Ng_PointType

Id: 18
Navn: GeomLinje eller Kurve
Kortnavn: GLK
Beskrivelse: Datatype benyttes for ET som skal inneholde koordinater til ei linje/kurve.  Det kan gis linjer/kurver i 3 dimensjoner.  Linja/kurva gÃ¥r gjennom et sett med punkter i gitt rekkefÃ¸lge.   Punktene er gitt ved x-, y- og z-verdier.  z-koordinat kan utelates.  Det mÃ¥ gis informasjon om koordinatsystem.  NVDB: Ng_CurveType

Id: 19
Navn: GeomFlate
Kortnavn: GF
Beskrivelse: Datatype benyttes for ET som skal inneholde koordinater til et ei flate.  Det kan gis flater i 3 dimensjoner. Flate avgrenses av ei linje/kurve. Linja/kurva gÃ¥r gjennom et sett med punkter i gitt rekkefÃ¸lge.   Punktene er gitt ved x-, y- og z-verdier.  Z-koordinat kan utelates.  Det mÃ¥ gis informasjon om koordinatsystem.  NVDB: Ng_SurfaceType

Id: 20
Navn: GeomSammensatt geometri
Kortnavn: GSG
Beskrivelse: Datatype benyttes for ET som skal inneholde geometri bestÃ¥ende av bÃ¥de punkt, linje/kurve og flate

Id: 21
Navn: GeomMultiPunkt
Kortnavn: GMP
Beskrivelse: Datatype benyttes for ET som skal inneholde et sett med punkt (se datatype GP 17)

Id: 22
Navn: GeomMultiKurve/linje
Kortnavn: GMLK
Beskrivelse: Datatype benyttes for ET som skal inneholde et sett med kurver/linjer (se datatype GLK 18)

Id: 23
Navn: GeomMultiFlate
Kortnavn: GMF
Beskrivelse: Datatype benyttes for ET som skal inneholde et sett med flater (se datatype GF 19)

Id: 26
Navn: Struktur
Kortnavn: STRUKT
Beskrivelse: Datatype benyttes for ET som skal settes sammen av andre ET. NVDB: Nf_StructAttributeType

Id: 27
Navn: BinÃ¦rObjekt
Kortnavn: BO
Beskrivelse: Datatype benyttes for ET som skal inneholde lyd, bilde, video, binÃ¦rtekst etc.  NVDB: Nf_BlobAttributeType

Id: 28
Navn: Boolean
Kortnavn: BL
Beskrivelse: Datatype benyttes for ET hvor det skal gis enten ?Ja? eller ?Nei?. (?True? eller ?False?).  NVDB: Nf_BoolAttributeTypea

Id: 29
Navn: Tegn
Kortnavn: TG
Beskrivelse: Datatype benyttes for ET som skal ha et sett med tillatte verdier, der de tillatte verdiene er av type tekst.  MÃ¥ angi feltlengde stÃ¸rre enn strenglengde av lengste tillatte verdi.  NVDB: Nf_CharAttributeType

Id: 30
Navn: FlerverdiAttributt, Tekst
Kortnavn: FVA
Beskrivelse: Datatype benyttes for ET som skal ha et sett med tillatte verdier, der de tillatte verdiene er av type tekst.  MÃ¥ angi feltlengde stÃ¸rre enn strenglengde av lengste tillatte verdi. NVDB: Nf_PrimitiveAttributeType / Nf_EnumPrimitive / Nf_PrimitiveAttribute

Id: 31
Navn: Flerverdiattributt, Tall
Kortnavn: FVN
Beskrivelse: Datatype benyttes for ET som skal ha et sett med tillatte verdier, der de tillatte verdiene er av type tall.  Det mÃ¥ oppgis feltlengde og antall desimaler slik at alle tillatte verdier holder seg innenfor formatet.  NVDB: Nf_PrimitiveAttributeType / Nf_EnumPrimitive / Nf_PrimitiveAttribute

*De nedenfor stÃ¸ttes IKKE*

Id: 24
Navn: NettNodeEllerPunktT??
Kortnavn: NNPT
Beskrivelse:

Id: 32
Navn: Autogenerert verdi
Kortnavn: AV
Beskrivelse: Datatype benyttes for ET hvor det skal angis heltallsverdi som skal vÃ¦re unik innenfor objekttypen.  Ny verdi skal vÃ¦re hÃ¸yeste eksisterende verdi + 1.  NVDB: Ikke definert

Id: 33
Navn: BinÃ¦rObjekt, Bilde
Kortnavn: BB
Beskrivelse: Datatype benyttes for ET som inneholder bilde/illustrasjon.  NVDB: Erstattet av DT 27

Id: 34
Navn: BinÃ¦rObjekt, Lyd
Kortnavn: BL
Beskrivelse: Datatype benyttes for ET som inneholder lyd.  NVDB: Erstattet av DT 27

Id: 35
Navn: BinÃ¦rObjekt, Video
Kortnavn: BV
Beskrivelse: Datatype benyttes for ET som inneholder video.  NVDB: Erstattet av DT 27

Id: 36
Navn: BinÃ¦rObjekt, TSF
Kortnavn: BTSF
Beskrivelse: Datatype benyttes for ET som inneholder ?.

Id: 37
Navn: BinÃ¦rObjekt, Tekst
Kortnavn: BTX
Beskrivelse: Datatype benyttes for ET som inneholder tekst.  NVDB: Erstattet av DT 27",,,
Kopier innlesingskode fra nvdb-reader,,,,
Integrer med NVDB,,,,
Etabler repository for datakatalog,"Skal tilby metoder for Ã¥ hente datakataloginformasjon (vegobjekttyper, egenskapstyper m.m.) fra NVDB.",,,
Etabler mock for datakatalog-repository,,,,
Serialisering til/fra JSON via Jackson,Trenger oppdatert JSON-fil for repository-nvdb-mock.,,,
"Implementer bedre stÃ¸tte for Struct, Spatial, List og Locational i datakatalogen","Strukturmedlemmer leses ikke inn i dag.
Queryen for Ã¥ hente listeattributter henter heller ikke ""lister av strukturer"".

Spatial mangler spatialType.

Locational mangler extentType

List mangler kardinalitet.",,,
Lese et vegobjekt (inkl. stedfesting) fra NVDB,,,,
Oversette KurvGen-fil ihht NVDB-API-Skriv API,"- Skaffe KurvGen-data
- Oversette",,,
Introdusere lÃ¥sing i prosessen i JobWorker,,,,
Database-kode for Ã¥ skape og fjerne lÃ¥s,,,,
Ved sletting: Hent fossefallskandidater (cascading delete) u/attributter,"Akseptansekriterium:
- NÃ¥r et objekt slettes (settes historisk), slettes ogsÃ¥ alle datterobjekter gjennom assosiasjoner med affiliation COMPOSITION rekursivt nedover i hierarkiet.
- NÃ¥r et objekt slettes (settes historisk), fjernes ogsÃ¥ alle assosiasjoner inn mot objektet. Det refererende objektene fÃ¥r da ny versjon uten denne assosiasjonen.


Testbeskrivelse:

I PoC-miljÃ¸et:

1) KjÃ¸r testcase 63 som oppretter et objekthierarki. Noter nvdbId for rot-objektet (-1).
2) Endre testcase 64, sett inn nvdbId fra punktet over. KjÃ¸r.
3) Kontroller at alle fire objekter er bort med NVDB123 e.l.",,,
Ved registrering (ikke-overlappende): Hent overlappskandidater m/lokasjonsattributt (gyldige ved nytt objekts fÃ¸dsel),,,,
Analysere uttrekk fra transaksjonsloggen,NVDB-186 har gjort uttrekk. Uttrekket er tilgjengelig pÃ¥ wiki under Testing-BruksmÃ¸nster.,,,
Ved oppdatering: Hent gjeldende/referert versjon u/attributter + samme som for registrering,,,,
Opprette task nÃ¥r det lages en lÃ¥s,"En task mÃ¥ opprettes med alle verdier.
Det lages Ã©n task for hver jobb. Alle lÃ¥ser kobles til denne tasken.
Tasken lages pÃ¥ samme mÃ¥te som det er vist i skripene i transactiontaskutils i nvdb.

Tasken knyttes midlertidig til en hardkodet bruker.

For kodereview:
- Se pÃ¥ JobWorker linje 67 og 80.",,,
Kopiere en bruker fra LDAP til NVDB,Dersom en task skal kobles til en bruker som ikke allerede er lagt inn i NVDB mÃ¥ vi legge inn brukeren. Data som skal legges inn skal hentes fra LDAP.,,,
Ved registrering av mor: Hent refererte (eksisterende) dÃ¸tre med m/lokasjonsattributt (gyldige ved/etter mors fÃ¸dsel),,,,
Ved sletting: Fjerne assosiasjoner til objektet som skal slettes (oppdatering),"Alle objekter som har assosiasjon til det objektet som skal slettes mÃ¥ oppdateres ved at disse assosiasjonsattributtene fjernes. Fjerning skjer ved at refererende objekter hentes inn i jobben med Operation UPDATE, samme validFrom som sletting og med assosiasjonsattributten tatt bort.",,,
Filtrere pÃ¥ lÃ¥ser som er i konflikt med en spesifikk jobb ,,,,
StÃ¸tte for UPDATE i representasjon og jobbehandling,,,,
StÃ¸tte for UPDATE i NvdbRepository,,,,
Teknisk installasjonsdokumentasjon,Avventer failover-lÃ¸sning for ActiveMQ.,,,
Systemdokumentasjon (utkast),//Store/Felles/ProsjekterOgLÃ¸sninger/NVDB Skrive-API/Leveransedokumentasjon/NVDB API Skriv - Systemdokumentasjon.docx,,,
StÃ¸tte for CORRECT i jobbehandling,,,,
Helsesjekkmekanisme,"ForespÃ¸rsel

GET /nvdb-api/status

Respons

200 OK
Content-Type: ""text/plain""

RUNNING

eller

200 OK
Content-Type: ""text/plain""

FAIL",,,
Oppdatering av feature i NvdbRepository,,,,
Validering av kvalitetsparametere i SkriveAPIet,"DAKATs SOSI-KONTROLL-applikasjon kontrollerer at kvalitetsparametrene for geometrien har lovlige verdier for mÃ¥lemetode, nÃ¸yaktighet osv. Dette mangler i SkriveAPIets valideringslogikk.

Verdiene mÃ¥ kontrolleres mot lovlige verdier angitt i datakatalogen for vegobjekttype NVDB_Dokumentasjon (typeid 793).",,,
Flytt SOSI-parser til eget GitHub-repo (open source),Flyttet til GitHub: https://github.com/nvdb-opensource/sosi-reader,,,
Autentisering mot Skrive-API,Gjenbruk pÃ¥logget brukers OpenAM-token ved anrop NVDB Skrive-API.,,,
Velge vegreferanse og stedfeste til denne,Dataforvalter kan velge en vegreferanse og en eller flere objekter og stedfeste objektene til denne vegen,,,
Domenemodell for FKB objekttyper,"En fÃ¸rste minimums ""datakatalog"" for FKB inneholder temakode (=id), navn og assosierte NVDB vegobjekttyper.",,,
Differensiering mellom opplastede FKB- og NVDB-filer,,,,
Visning i Oversiktsfanen,,,,
Opprette dummy dokumenter med egengeometri/omrÃ¥der for omrÃ¥der,,,NVDB-IND,
BruksmÃ¸nster leseAPI,"Basert pÃ¥ data fra Splunk eller direkte fra logger bÃ¸r man bl.a. finne:
* Hvilke endepunkter
* Hvilke spÃ¸rringer/filtre brukes
* Fordeling og mengde over tid",,,
Ta i bruk byggeverktÃ¸y for frontend-ressurser,"Webpack, NPM, ES6.",,,
Norge i bilder,,,,
Driftskontrakt V4: Flytte relasjoner (assosiert-egenskaper) lengst mot hÃ¸yre,"Som en siste finpuss pÃ¥ V4-rapporten kan vi flytte ""assosiert"" - egenskapene _(kommaseparert liste med ID til datterobjekter)_ lengst mot hÃ¸yre, bortforbi sorteringskolonne #2.Â ",,Rapportgenerator,
Flere farger for objekter i kartet pÃ¥ datafanen,"Fra support (Astrid Heier Vegusdal).
{noformat}
NÃ¥r vi skal ta inn NVDB data for lukking i datafangst fÃ¥r objektet samme farge som eksisterende objekter i datafangst. Kan dere endre denne fargen til rÃ¸d slik at objekt tatt inn for lukking er forskjellig fra eksisterende
{noformat}
Dette Ã¸nsket tangerer et annet fra support (Janet Lynn Berringer SlÃ¥en) som Ã¸nsker:
{noformat}
Er det mulig Ã¥ implementere bytt av farge (ikke det samme blÃ¥) nÃ¥r en selekterer eksisterende data i NVDB?
{noformat}
Slik jeg tolker disse Ã¸nskene sÃ¥ er det forrvirrende at vi kun opererer med to typer farger i kartet. Antallet farger og hvilke operasjoner som bÃ¸r knyttes til hvilke farger mÃ¥ utforskes nÃ¥r saken tas tak i.",NVDB-6937,Datafangst,
Fjerne stedfesting,"Fra support (Steinar Johansen, Innlandet FK).

Ã˜nsket er Ã¥ kunne fjerne stedfesting for alle nye objekter (operasjon CREATE). Bakgrunnen er at objektene i kontrakten var stedfestet fÃ¸r ny veg var lagt inn i NVDB.

Kunne vÃ¦rt lÃ¸st med en modal a la automatisk stedfesting hvor man kunne valgt typer Ã¥ fjerne stedfestingen for.

LÃ¸sning i dag er Ã¥ manuelt stedfeste aktuelle objekter til ny veg da automatisk stedfestinig ikke tar med objekter som har ""grÃ¸nn"" stedfesting.",NVDB-6937,Datafangst,
Strekningsobjekt vises som rette linjer ved bruk av filter,"h1. Observasjon 1

Med dÃ¸me frÃ¥ ulike klientar

[Vegkart (vegvesen.no)|https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@26934,6943035,12/hva:~(~(filter~(~(operator~'*3d~type_id~9260~verdi~(~12905)))~id~810)~(id~5)~(id~540)~(id~105)~(id~241)~(id~775)~(id~86))/hvor:~(vegsystemreferanse~(~'FV61))]

Â  !fv61_nvdb123.PNG|thumbnail! !fv61_vegkart_v3.png|thumbnail! !fv61_sinus_infra.PNG|thumbnail! !fv61_vegkart_v2.png|thumbnail!

Â 
h1. Observasjon 2

Her er det fvk som plutselig har tatt en Â«liten avstikkerÂ» nÃ¥r filter er satt pÃ¥ vegen.

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-37218,6580374,12/hva:~(~(id~532))/hvor:~(vegsystemreferanse~(~'E39))]

!FeilsÃ¸k API.jpg|thumbnail!

Â 
h1. Observasjon 3

https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@-33344,6564399,18/hva:~(~(id~105))/hvor:~(vegsystemreferanse~(~'FV))

Â 

*LÃ¸sning*

Algoritmen for Ã¥ lagre geometri til vegobjektsegmenter er endret. Det lÃ¸ser alle disse observasjonene, og tidligere observasjoner pÃ¥ feil med segmentert geometri samtidig som vi ikke lagrer mer til solr.",NVDB-6937,Les-API,
Leveranseinformasjon,"*Testes i ATM av leverandÃ¸r:*
 * NVDB-5017: Verifiser at geometriegenskaper kommer med pÃ¥ segmentene
 * NVDB-6287: SlÃ¥ opp aktuelt objekt og verifiser at det har vegsystemreferanse
 * NVDB-6051: Verifiser at objekt i saken (se siste kommentar) har geometri

Â NVDB-5017 og NVDB-6051 vil ikke gi forventede resultater fÃ¸r NVDBIND V3 2020.18.0 ([https://jira.kantega.no/projects/NVDB/versions/36511)]Â er ute og reindeksert. Sjekk derfor at disse sakene ikke gir feil etter deploy av denne leveransen, og re-test disse sakene etter reindeksering.",NVDB-6937,Les-API,
Forvirrende koble-klippe symboler pÃ¥ assosiasjon?,"h2. Observasjon

Hvis man importerer et NVDB-objekt som har barn, f.ex importer et skiltpunkt fra kartet ved Ã¥ laste opp vedlagte SOSI fÃ¸rst, sÃ¥ vil assosiasjonsfanen vise koblingene (assosiasjon_steg0.png).

Om man klipper bort en av assosiasjonene vil symbolene i menyen vise motsatt av symbolene i menyen for ""koble til NVDB-datter"" (assosiasjon_steg1.png). Dette kan forstÃ¥s ved atÂ menyen for ""koble til NVDB-datter"" viser hva som er gjort - samtidig er det en viss fare for uklarhet nÃ¥r de to ""menyene"" viser omvendte symboler for koblet og ikke-koblet.",NVDB-6937,Datafangst,
Tilbakestilling av assosiasjoner endrer ikke dirtyness,"*Observasjon #1*

Importerer kun et nytt 96 (96.sos). Kobler til NVDB-mor 95-1011052388 (kommer opp pÃ¥ sÃ¸k i ass.fanen). Ser da i datafanen atÂ 95-1011052388 er ""dirty"", som jo er naturlig nÃ¥r den har fÃ¥tt en ny assosiasjon. Men fjerner jeg assosiasjonen jeg lagde til nytt 96-objekt, sÃ¥ liggerÂ 95-1011052388 fortsatt som ""dirty"". Burde ikke denne da vÃ¦rt synkronisert?

Â 

*Observasjon #2*

Importer en NVDB-datter via kartet i datafanen. F.ex skiltplate ved Ã¥ laste opp vedlagt SOSI for Ã¥ fÃ¥ ta i NVDB-skiltplater. Verifiser at objektet ikke er dirty i datafanen. GÃ¥ til assosiasjonsfanen. Slett kobling til mor. Angre sÃ¥ sletting ved Ã¥ koble tilbake igjen. GÃ¥ til datafanen og se at objektet nÃ¥ ligger som dirty. Ingenting er endret sÃ¥ dette skulle ligget som ikke dirty.",NVDB-6937,Datafangst,
Systemfeil etter mislykket versjonskontroll pÃ¥ berikede objekter,"h2. Observasjon

Endringssett https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/10f34137-a562-4c9a-8cea-a861ca9994db havner i SYSTEMFEIL pga ENRICHMENT_VERSION_CHECK_FAILED etter 12 t.

h2. Analyse

+10f34137-a562-4c9a-8cea-a861ca9994db+

VT 87 - NVDB-ID 421037274:2 (ADD): Vegobjektversjonen er ikke siste versjon. Siste versjon er 2.

Ã…rsak: Vegobjekt 421037274 (VT87) fikk versjon 2 i oppdrag 1504408, uten at versjon 1 ble lukket. Dette forvirrer API Skriv som forventer at bare siste versjon av et vegobjekt har Ã¥pen sluttdato.

+40ad4218-7b76-4d7a-b8c6-171922ada5be+

VT 87 - NVDB-ID 421037273:2 (ADD): Vegobjektversjonen er ikke siste versjon. Siste versjon er 2.

Ã…rsak: Vegobjekt 421037273 (VT87) fikk versjon 2 i oppdrag 1504408, uten at versjon 1 ble lukket. Dette forvirrer API Skriv som forventer at bare siste versjon av et vegobjekt har Ã¥pen sluttdato.

+4f3895e5-d218-4922-8e0f-9689ba47dde4+

VT 87 - NVDB-ID 421037282:2 (ADD): Vegobjektversjonen er ikke siste versjon. Siste versjon er 2.

Ã…rsak: Vegobjekt 421037282 (VT87) fikk versjon 2 i oppdrag 1504408, uten at versjon 1 ble lukket. Dette forvirrer API Skriv som forventer at bare siste versjon av et vegobjekt har Ã¥pen sluttdato.

+276c721b-d5e1-44a0-9aa7-4bdfc44e99f3+

VT 87 - NVDB-ID 421037281:2 (ADD): Vegobjektversjonen er ikke siste versjon. Siste versjon er 2.

Ã…rsak: Vegobjekt 421037281 (VT87) fikk versjon 2 i oppdrag 1504408, uten at versjon 1 ble lukket. Dette forvirrer API Skriv som forventer at bare siste versjon av et vegobjekt har Ã¥pen sluttdato.

+3fee339d-0227-41cb-b6f6-010c11119bbc+

VT 87 - NVDB-ID 421037284:2 (ADD): Vegobjektversjonen er ikke siste versjon. Siste versjon er 2.

Ã…rsak: Vegobjekt 421037284 (VT87) fikk versjon 2 i oppdrag 1504408, uten at versjon 1 ble lukket. Dette forvirrer API Skriv som forventer at bare siste versjon av et vegobjekt har Ã¥pen sluttdato.


Konklusjon: Dette er datafeil i NVDB som mÃ¥ rettes med SQL-script. Sender info til Hans Anton.
",NVDB-6937,Skriv-API,
Forhindre Changeset monitor til Ã¥ kjÃ¸re opp flere trÃ¥der,"Changset monitor er satt til Ã¥ starte opp changeset progrerss check med jevne intervall (satt i application.properties).

Men slik den er nÃ¥, vil en ny trÃ¥d starte hvert intervall, og potensielt kjÃ¸re opp flere jobber samtidig.

Sett flaggetÂ 

concurrentExecution = Scheduled.ConcurrentExecution.SKIP

i @Scheduler annotation",NVDB-6937,Datafangst,
Systemdokumentasjon inn i ny mal fra forvaltning,"Avtalt pÃ¥Â [2020-11-24 - IKT-mÃ¸te - NVDB api Rapport overlevering til IKT drift|https://www.vegvesen.no/wiki/pages/viewpage.action?pageId=142882224]:Â 

Systemdokumentasjon legges over i ny mal fra Forvaltning:

[https://www.vegvesen.no/wiki/display/FoV/Systemdokumentasjon+NVDB+API+Rapport]Â ",,Rapportgenerator,
Systemfeil i NoOverlapValidator,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/cc50ebed-53ed-4627-8213-14f177bef6e1 havner i SYSTEMFEIL:

{code:java}
java.lang.RuntimeException: Feature 81462145:2 of type 105 has no locational attribute
	at no.vegvesen.vt.nvdb.apiskriv.domain.feature.Feature.lambda$getLocationalAttributeOrThrow$9(Feature.java:483)
	at java.util.Optional.orElseThrow(Optional.java:290)
	at no.vegvesen.vt.nvdb.apiskriv.domain.feature.Feature.getLocationalAttributeOrThrow(Feature.java:483)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.job.NoOverlapsValidator.isValidOverlap(NoOverlapsValidator.java:143)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.job.NoOverlapsValidator.isValid(NoOverlapsValidator.java:72)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.job.NoOverlapsValidator.isValid(NoOverlapsValidator.java:39)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.ConstraintEnforcer.enforce(ConstraintEnforcer.java:58)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.ConstraintJobFilter.doFilter(ConstraintJobFilter.java:32)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:117)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:455)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:177)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:54)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:145)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

Det angitte vegobjektet blir delvis korrigert i endringssettet, uten at noen detaljer faktisk endres:

{code:xml}
<vegobjekt typeId=""105"" nvdbId=""81462145"" versjon=""2"">
  <egenskaper/>
  <gyldighetsperiode>
    <startdato>2015-03-04</startdato>
  </gyldighetsperiode>
  <validering>
    <lestFraNvdb>2020-11-24T11:53:39</lestFraNvdb>
  </validering>
</vegobjekt>
{code}

Ved rekjÃ¸ring pÃ¥ VDI lar ikke systemfeilen seg reprodusere (mÃ¥tte Ã¸ke versjonsnummeret pÃ¥ et annet vegobjekt som ble delvis oppdatert for Ã¥ fÃ¥ det gjennom). Det avvises korrekt med valideringsfeil pga manglende endringer i vegobjektet over.

h2. LÃ¸sning

La inn mer logging pÃ¥ stedet der exception blir kastet for Ã¥ kunne belyse caset mer om det skulle dukke opp igjen.",NVDB-6937,Skriv-API,
"Legge til tekst og feilkode ved ""Ulykke""","h2. Observasjon

I dag visast berre eit bilete av farskiltet ""Ulykke"" med generelle undertekst.

Det bÃ¸r leggast til ein tekst dersom bletet ikkje kan visast i nettlesaren.

Teksten bÃ¸r og vise til kva for feil som har skjedd, Feilkode, dersom nokon vil melde frÃ¥ om feilen vidare.",NVDB-6937,Vegkart,
POLYGON EMPTY ved stedfesting,"h2. Observasjon

POSTÂ /nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=E&vegnummer=18&fase=V&typeVeg=GANG_OG_SYKKELVEG%2CSYKKELVEG%2CGANGVEG%2CG%C3%85GATE%2CFORTAU%2CTRAPP%2CGANGFELT mot ATM medÂ 
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""852"" tempId=""e6dbb25f-c45c-4dfa-b36f-9271c4a81b09""><egenskaper><egenskap typeId=""9721""><geometri><srid>25833</srid><wkt>LINESTRING (135452.51403221354 6498589.168990206 46.677, 135452.6697585481 6498589.861041403 46.7)</wkt><datafangstdato>2019-06-11</datafangstdato><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>96</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>5</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>5</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-11-20</startdato></gyldighetsperiode></vegobjekt></vegobjekter>
{noformat}
gjÃ¸r at Skriv mÃ¥ utvide geometrien ved kallet mot Les. Utvidelsen gir imidlertid fÃ¸lgende kall mot Les
{noformat}
{""geometri"":""POLYGON EMPTY"",""maks_avstand"":""300"",""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""EV18"",""trafikantgruppe"":null,""typeveg"":""gangOgSykkelveg,sykkelveg,gangveg,gÃ¥gate,fortau,trapp,gangfelt"",""tidspunkt_start"":""2020-11-20"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
som git HTTP 500

h2. Analyse

En LineString pÃ¥ ca 0.5 meter skal strekningsstedfestes. Siden ruten ikke har minimumslengde (1.0 m), blÃ¥ses geometrien litt opp slik at det blir et polygon. Etter oppblÃ¥sing gjÃ¸res en Douglas-Peucker for Ã¥ redusere antall punkter. I og med at punktene allerede er tette og terskelverdien er 0.05 m. Kollapser polygonet ved kjÃ¸ring av DP, og det returneres POLYGON EMPTY.

h2. LÃ¸sning

Justerte noen parametere i oppblÃ¥singsalgorirmen + la inn en sjekk pÃ¥ kollapset geometri etter punktreduksjon.",NVDB-6937,Skriv-API,
Script for Ã¥ rydde og rapportere multigeometri,"I forbindelse med strenging for multigeometri der det ikke er tillatt (NVDB-4439) sÃ¥ mÃ¥ ogsÃ¥ Datafangst se pÃ¥ data som er i database fra fÃ¸r.

Vi trenger et script som kan gÃ¥ gjennom og konvertere det som er multigeometri med ett element til singlegeometri, og kanskje ogsÃ¥ slÃ¥ sammen multilinjer som egentlig er en sammenhengende linje.
Scriptet mÃ¥ rapportere pÃ¥ elementer som ikke kan konverteres automatisk, og skille pÃ¥ hva som er sendt inn og hva som ikke er det (READ / WRITE for geometri).",NVDB-6937,Datafangst,
POINT returneres for rutesegment,"h2. Observasjon

POST /rute medÂ 
{noformat}
{""geometri"":""LINESTRING (136845.14 6500207.76, 136845.25 6500214.46, 136843.77 6500219.92, 136837.05 6500231.17)"",""maks_avstand"":""300"",""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""E,K,F,R"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-11-20"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
gir problemer i Skriv pga wkt er POINT for et rutesegment (0.39680943-0.40801584@2804908). Observert i UTV og ATM.

Â 
h2. LÃ¸sning

FÃ¸rste og site segment i en rute kuttes for Ã¥ tilpasse seg geometrien det spÃ¸rres pÃ¥. I tilfellene her ble det som var igjen sÃ¥ kort at det bare ble et punkt i geometrien som var likt med siste koordinat i forrige segment. Dette ble lÃ¸st ved Ã¥ utelate disse potensielle segment-punktene i starten og slutten pÃ¥ en rute.Â ",NVDB-6937,Les-API,
Gang- og sykkleveg mangler under gÃ¥ende og syklende.,"Ved avkryssing av Sykkelveg vises ogsÃ¥ Type Gang- og sykkelveg.
 Ved avkryssing avÂ  Gangveg vises Gang- og sykkel veg.

Det mangler et valg for Gang- og sykkelveg under GÃ¥ende og syklende.
 NÃ¥r vi krysser av for Sykkelveg skal bare denne typen vises, samme med Gangveg og Gang-og Sykkelveg. Valgene her skal gjenspeile veg typene som ligger i NVDB.",NVDB-6937,Vegkart,
NPE ved henting av fartshumper med filtre,"h2. Observasjon

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/103?kartutsnitt=157969.513,6883029.486,446344.757,6968458.324&kommune=3426,3430&segmentering=true&egenskap=(1156%3D3594)+AND+(10288%3E2010+AND+10288%3C%3D2015)&inkluder=metadata,geometri]

gir HTTP 500 NPE

Kom fra Vegkart-sÃ¸k
{noformat}
https://vegkart.utv.atlas.vegvesen.no/#kartlag:geodata/@302157,6925744,8/hva:~(~(category~(id~10288~type~'interval)~intervals~(~2010~2015)~filter~(~(operator~'*3d~type_id~1156~verdi~(~3594)))~id~103)~(category~(id~1298~type~'interval)~intervals~(~50~100~500)~filter~(~(operator~'*3d~type_id~1089~verdi~(~13747)))~id~5))/hvor:~(kommune~(~3430~3426))
{noformat}",NVDB-6937,Les-API,
Driftskontrakt V4: Endre rekkefÃ¸lger pÃ¥ kolonner,"Ã˜nske om Ã¥ endre rekkefÃ¸lgen pÃ¥ kolonner i V4-mengderapporten:Â 

fÃ¸rst NVDB Id (som i dag), sÃ¥ filtreringshjelp, vegsystemreferanse, egenskaper og sÃ¥ resten.Â 

Â 

Â ",NVDB-6827,Rapportgenerator,
StÃ¸tte for bildekomprimering,Ved innsending av bilete som dokumentasjon bÃ¸r det vere automatisk komprimering av bilete (og evt. anna dokumentasjon) for Ã¥ mÃ¸te grense for vedlegg i NVDB.,NVDB-6937,Datafangst,
Analyse: Endre grense for for vedlegg i dokumentasjon,"Grensa for storleik pÃ¥ vedlegg (BLOB-egenskap) i vegobjekttypen Dokumentasjon er for lÃ¥g, spesilet pÃ¥ bilete. Den mÃ¥ aukast til ei fornuftig grense for bÃ¥de brukar og NVDB.
{quote}MÃ¥ undersÃ¸ke om det mÃ¥ endrast noko i NVDB og/eller datakatalog.
{quote}",NVDB-6937,Skriv-API,
Oppdatere pÃ¥loggingshjelp for FK,"Fylkeskommunetilsette med p-brukar har same rutiner for pÃ¥loggingshjelp som SVV. Info under ""Trenger du hjelp?"" mÃ¥ oppdaterast for Ã¥ vise det.",NVDB-6937,Datafangst,
E2E-test av inkrementell lagring,"Det mangler tester som sjekker at features kan lagres pÃ¥ nytt med Korriger etter Ã¥ fÃ¸rst ha blitt lagret som nye objekter. Dette innebÃ¦rer tester pÃ¥ datafanen og stedfestingsfanen, samt re-registrering av korrigerte objekter.",NVDB-6937,Datafangst,
Fjern gammel Skriv-integrasjon,Fjern kode og innstillinger for gammel integrasjon mellom NVDBIND og NVDB API Skriv.,NVDB-6937,NVDB-IND,
Tidssone Â«SISTE HENDELSERÂ»,Tidspunkt pÃ¥ hendelser under Â«SISTE HENDELSERÂ»Â er GMT. Endre til lokal tidssone.,NVDB-6937,Les-API,
Jenkinsfile for integrasjonstester,Ã˜nsker Ã¥ sette opp en jobb pÃ¥ SVV Jenkins som kan kjÃ¸re integrasjonstestene uavhengig av andre jobber. Lager en Jenkinsfile.,NVDB-6937,Datafangst,
Release med tjenestebruker,"I Jenkins mÃ¥ byggeplanene

* NVDB Vegkart - Release
* NVDB Export - Release

omkonfigureres til Ã¥ bruke TjeVegkartDeploy_Atlas som ATLAS_USR og tilhÃ¸rende passord fra PAM som ATLAS_PWD.",NVDB-6937,Vegkart,
E2E-test av stedfesting,E2E-testene av stedfestingsfanen har vÃ¦rt disabled siden fanen ble ny. Oppgaven gÃ¥r pÃ¥ Ã¥ lage nye tester med API Skriv som stedfestingstjeneste.,NVDB-6937,Datafangst,
Integrasjon med API Skriv pÃ¥ Atlas,"(!) Se Installasjon lengre ned
h2. Bakgrunn

NVDB API Skriv er migrert over til Atlas.

URLer mÃ¥ skiftes ut slik:

*STM*
 [https://www.utv.vegvesen.no/nvdb/apiskriv/] => [https://nvdbapiskriv-stm.utv.atlas.vegvesen.no/]

*ATM*
 [https://www.test.vegvesen.no/nvdb/apiskriv/] => [https://nvdbapiskriv.test.atlas.vegvesen.no/]

*PROD*
 [https://www.vegvesen.no/nvdb/apiskriv/] => [https://nvdbapiskriv.atlas.vegvesen.no/]

De gamle URLene vil fungere ca fram til pÃ¥ske, sÃ¥ dette mÃ¥ gjÃ¸res innen da.

AAA-autentisering vil riktignok fungere i Atlas en periode, men autentisering med OpenId Connect bÃ¸r implementeres. Se online dok for detaljer: [https://apiskriv.vegdata.no|https://apiskriv.vegdata.no/]
h2. Installasjon

Konfigurasjon i STM og ATM er riktig som default og trenger ikke Ã¥ endres.

For prod sÃ¥ mÃ¥ URL i /opt/datafangst/config/application.properties endres samtidig med prodsetting.",NVDB-6937,Datafangst,
Ikon for velgemodus i kart vises ikke,"h2. Observasjon

Ikonet for Ã¥ slÃ¥ pÃ¥ Velge-modus vises ikke lenger. observert i UTV og PROD

!image-2020-11-17-19-24-24-742.png!
h2. Analyse

Da den gamle stedfestingsfanen ble slettet fÃ¸rte det til css-for denne knappen i datafanen sluttet Ã¥ virke, fordi datafanen gjenbrukte css-regler fra stedfesting uten at css-reglene ble flyttet opp til et mer globalt scope. Det har fÃ¸rt til at nÃ¥r den gamle stedfestingsfanen ble slettet ble ogsÃ¥ css-reglene for denne knappen i datafanen slettet. (css-filen ble liggende igjen, men den ble aldri importert)


h2. LÃ¸sning

endret navn pÃ¥ html-klassene for knappen til Ã¥ samsvare med klassene for knappen i ny stedfesting.

lÃ¸ftet css-for denne knappen opp til mer globalt nivÃ¥.

slettet den gamle stedfesting-css-filen som ogsÃ¥ hadde bitt liggende igjen.

Â ",NVDB-6937,Datafangst,
Ingen objekter segmentert med nytt kontraktsomrÃ¥de,"KontraktsomrÃ¥de Â«4607 Sunnfjord sÃ¸rÂ» har nÃ¥ tre versjoner, 2021, 2022, og 2032.
https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/580/1010943929/2.json
https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/580/1010943931/2.json
https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/580/1010943932/2.json

Alle har startdato 2020-10-29, men det er kun 2021 det er segmentert objekter med.",NVDB-6937,NVDB-IND,
Disable Sentry,,NVDB-6937,Vegkart,
Last kun geometri i sÃ¸kemodus,"Vegkart bruker nÃ¥ ?inkluder=metadata,egenskaper,lokasjon,geometri.
Ved Ã¥ endre til ?inkluder=metadata,geometri vil responsen bli betydelig mindre.",NVDB-6937,Vegkart,
Rydd bakoverkompatiblitet NVDB-5017,"NVDB-5017 endrer hvordan geometriegenskaper lagres for noder og veglenker. 
Fjern koden som leser det pÃ¥ gammelmÃ¥ten.",NVDB-6937,Les-API,
Avslutte Sentry,,NVDB-6937,Datafangst,
Inkludere konnekteringslenke og filtrere i etterkant,"h2. Bakgrunn

Saken gÃ¥r pÃ¥ at det er mange vegobjekter i Datafangst som ikke fÃ¥r stedfesting gjennom Skriv siden Les gir ingen rute tilbake nÃ¥r konnekteringslenker er satt til false. Gammel stedfesting for Datafangst ga konnekteringslenker tilbake s.a. Datafangst filtrerte selv i etterkant.

*Fra Mattermost* ([https://mattermost.kantega.no/svv/pl/8gbpzzoi77y1dpocdgr9qft4ro])

Har sett pÃ¥ noen vanskelige tilfeller av stedfesting med Skriv. Vedlagte SOSI (843_difficult.sos) er utdrag av stÃ¸rre SOSI (843.sos) med noen vanskelige tilfeller. Manuell stedfesting med Skriv genererer fÃ¸lgende kall mot Les for utvalgte kurver. Problemet er generelt at det ikke finnes ruter. *MEN* om vi setter {{konnekteringslenker=true}} finnes det ruter (da med rutesegmenter som ikke er konnektering OG konnekteringslenker).

Gammel stedfesting finner stedfesting for alle. Er det ikke slik at vi for gammel stedfesting fÃ¥r konnekteringslenker, men filtrerer bort disse i Datafangst?

Hva tenker folk om Ã¥ be om konnekteringslenker ogsÃ¥ for Datafangst og heller filtrere disse bort i Skriv/Datafangst etter at rute er oppnÃ¥dd fra Les? Eksemplene her er typiske eksempler hvor det er veier som mÃ¸tes. Alternativet her blir jo Ã¥ stedfeste alle som gÃ¥r med Skriv og deretter velge gammel for de som ikke gÃ¥r. Alle 1018 objektene i 843.sos er tatt fra Prod og reflekterer reelle situasjoner vi helt sikkert kommer borti mange ganger.
Â 
{noformat}
KURVE 246 
{""geometri"":""LINESTRING (138553.42 6501292.32, 138554 6501288.68, 138546.53 6501278.28, 138489.17 6501242.18)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""FV409"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker 

KURVE 255 {""geometri"":""LINESTRING (138554.32 6501292.18, 138572.76 6501271.68)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""FV409"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker 

KURVE 258 {""geometri"":""LINESTRING (138568.71 6501250.91, 138562.89 6501231.29)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""EV18"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker 

KURVE 278 {""geometri"":""LINESTRING (138591.19 6501078.74, 138598.13 6501077.81, 138601.35 6501076.33, 138604.65 6501071.57)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""EV18"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-13"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true} 
--> Ikke funnet rute 
--> OK med konnekteringslenker
{noformat}

*Kommentar fra Tore:*

Skriv anroper Les /rute med konnekteringsparameter=JA/NEI avhengig av om vegobjekttypen tillater det. Tanken var nok opprinnelig at Les da skulle foreta denne filtreringen, men det har jo runnet en del vann i Gaula siden da. Mulig Skriv skal sende konsekvent JA her og plukke ut konnekteringslenkene etterpÃ¥ selv. Dermed blir det som i gammel DF-lÃ¸sning.

h2. Analyse

Min kommentar ovenfor var nok litt forhastet. Stedfestingstjenesten bruker faktisk allerede strategien som angitt over. Ã…rsaken til at det ikke fungerer som tenkt er at requesten til Les sin rutetjeneste pÃ¥fÃ¸res ""konnekteringslenker"": false nÃ¥r det ikke skal stedfestes pÃ¥ konnekteringslenker (punktstedfesting), mens det *ikke* angis ""konnekteringslenker"": true nÃ¥r det kan stedfestes pÃ¥ konnekteringslenker (strekningsstedfesting, med filtrering i etterkant).

h2. LÃ¸sning

Setter eksplisitt ""konnekteringslenker"" i requesten til Les, enten verdien fra RouteParams.isConnectingRefLinksAllowed() er true eller false",NVDB-6937,Skriv-API,
Visning av stedfesting pÃ¥ flere veger,"h2. Observasjon

Importer denne som Korriger

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/92?segmentering=true&kartutsnitt=267378.496%2C7030892.506%2C268522.821%2C7031490.796&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

Sjekk stedfestingsfanen. Der ligger det noen i venstremeny med ""mangler stedfesting"" selv om de har det. Marker disse og se at det kommer opp ""undefined"" under stedfestingsinformasjonen (se skjermbilde vedlagt). Gjelder bl.a. 1006210798,Â 1006210799 ogÂ 1006210802.

Mulig denne lÃ¸ses ved NVDB-5709.
h2. Analyse

1006210798 er stedfestet pÃ¥ to forskjellige veger (E6 og FV704), men representasjonsmodellen til Datafangst tar bare hÃ¸yde for at et vegobjekt kan vÃ¦re stedfestet pÃ¥ Ã©n veg. Dette gjelder ogsÃ¥ ved import av stedfesting, hvis den er stedfestet pÃ¥ flere veger blir den lagret uten veg.
h2. LÃ¸sning

StÃ¸tte stedfesting pÃ¥ flere veger ved nye importer. StÃ¸tte visning av stedfesting som er stedfestet til flere veger.",NVDB-6937,Datafangst,
Tegning av re-stedfestet NVDB-objekt blir upresis,"h2. Observasjon

Kommer fra test av NVDB-6001.

*Gjenskap*

Importer fÃ¸lgende som Korriger (case fraÂ NVDB-6032)

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/335?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

Stedfest manuelt SkjermÂ 101895592 og AvstandsmÃ¥lingÂ 377099404 til nÃ¦rmeste vei. Da fÃ¥r skjermen vist stedfesting som ikke henger pÃ¥ veien, og avstandsmÃ¥lingen fÃ¥r vist stedfesting langt unna pÃ¥ samme vei. Se vedlagt ""nvdb6032case.png"".

Imidlertid ser selve stedfestingene fine ut (de er like for begge objektene).

*Kommentar fra HÃ¥vard pÃ¥ NVDB-6001*

Jeg klarer fortsatt ikke Ã¥ reprodusere lokalt, men feilen mÃ¥ nok opprettes som en egen sak.

For avstandsmÃ¥ling:
 Jeg sjekker verdiene i databasen, og feature_locational2.projected_from_wkt har verdier som samsvarer med geometrien for objektet, dvs. at vi har generert riktige punkter for stedfesting. Det som imidlertid er feil er feature_locational2.wkt, dvs. beregnet geometri for stedfesting. Det er endepunktene her som gir den store sirkelen, sÃ¥ man kan egentlig se pÃ¥ bildet at Ã¥ finne endepunkter i objektets geometri er riktig.

Ser ogsÃ¥ ut som vi fÃ¥r riktig verdi for wkt for stedfesting fra Skriv, sÃ¥ det skjer noe etterpÃ¥ (og som er utenfor koden som er endret her). Har ikke klart Ã¥ spore det helt, menÂ _antar_Â at det er noe i kode som sjekker om datter er innafor mor og gjÃ¸r eventuell utvidelse av WKT, det er i alle fall det eneste stedet som jeg ser som vi gjÃ¸r endringer pÃ¥ denne.

For skjerm:
 Hvis du ser nÃ¸ye sÃ¥ er det en liten prikk i hver ende av objekter. Jeg tror at dette er linja ned pÃ¥ veg, og at det vises sÃ¥nn fordi det er smÃ¥ forskjeller i geometrien som vi fÃ¥r fra Skriv / Les gjennom stedfesting, og vegnettet fra VisVegInfo.
 Har i alle fall gÃ¥tt gjennom koden og ser at vi finner riktige verdier, og plassering av sirkelen / linje ned pÃ¥ veg kommer uansett fra WKT for stedfesting, som vi ikke rÃ¸rer her.

Et ekstra poeng er at koden i denne saken har allerede kjÃ¸rt Ã©n gang fÃ¸r du endrer stedfesting, siden den kjÃ¸rer nÃ¥r vi importerer vegobjekter fra NVDB, og da kommer jo ikke denne feilen. Forskjellen er at ved import fra NVDB prÃ¸ver vi ikke Ã¥ flytte datter innafor mor.

Dette er ganske mystisk, men jeg tror vi kan gÃ¥ videre med testing av denne, og skrive opp oppfÃ¸rselen for avstandsmÃ¥ling som egen sak.
h2. Analyse

Feilen oppstÃ¥r fordi vi har sammenkoblede objekter der mor har feil i stedfestingen sin. 
 Mor sin stedfestingsfeil er fikset i en annen sak, men det har resultert i at det finnes vegobjekter med denne feilen lagret i NVDB, og det er derfor denne kan gjenskapes her.
 Feilen har oppstÃ¥tt fordi tidligere stedfestingsmetoder har brukt VisVegInfo sin veg-geometri til Ã¥ generere stedfestinger. Problemet med VisVegInfo er at den bruker en forenklet geometri av vegnettet med mye lavere opplÃ¸sning enn det vegnettet egentlig har. det resulterer i at nÃ¥r vi skal manipulere stedfestinger, f.eks ved klipping og trimming og flytte datter innenfor mor, vil fÃ¥ feil verdi nÃ¥r prÃ¸ver Ã¥ mÃ¥le lengdene pÃ¥ veg-geometrien. Resultatet blir stedfestings-posisjoner som er feil, men en wkt som ser riktig ut.

Vi identifiserte dette problemet og har gjort endringer i metodene som flytter datter innenfor mor til Ã¥ bruke geometri fra Les istedet for VVI, men nÃ¥r objektene er lagret med feil stedfestigngs-verdi, vil ogsÃ¥ stedfestingsgeometrien vi genererer basert pÃ¥ disse bli feil.

I dette tilfellet sÃ¥ har mor (rekkverk) feil stedfestingsverdier (men riktig wkt).

Ved stedfesting av datteren (avstandsmÃ¥ling) fÃ¥r vi en stedfesting basert pÃ¥ hÃ¸yopplÃ¸st vegnett fra Les. vi ser sÃ¥ pÃ¥ mor, og genererer en hÃ¸yopplÃ¸st geometri basert pÃ¥ vegnettet fra Les, men med de gamle verdiene som er lagret i stedfestingen til mor som kommer fra VVI. resultatet er at den geometrien vi genererer for mor fÃ¥r en forskyvning i forhold til geometrien vi ville ha fÃ¥tt fra VVI, og blir liggende ganske langt unna datter. Vi prÃ¸ver deretter Ã¥ flytte stedfestingen til datter innenfor denne feilaktige geometrien til mor, og det gir disse merkelige resultatene vi ser her.
h2. LÃ¸sningÂ 

Situasjonen lÃ¸ser seg enkelt ved Ã¥ re-stedfeste mor, fordi mor vil da fÃ¥ en stedfesting basert pÃ¥ hÃ¸yopplÃ¸st vegnett fra Les.

Det er derimot vanskelig for brukerne Ã¥ skjÃ¸nne nÃ¥r vi er i en slik situasjon. For Ã¥ forbedre opplevelsen kan det legges inn tiltak ved Ã¥ prÃ¸ve Ã¥ restedfeste mor og se pÃ¥ om den nye stedfestingen har andre verdier enn den gamle, og sÃ¥ gi tilbakemelding til brukeren om at mor mÃ¥ restedfestes, evt lÃ¸se det automatisk.Â 

Â 

Â 

Â 

Â 

Â ",NVDB-6937,Datafangst,
Kommune gir 0 treff nÃ¥r omrÃ¥defilter er pÃ¥,"Objekttypen ""Kommune"" gir 0 treff nÃ¥r omrÃ¥defilter er pÃ¥.

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@303196,7090016,5/hva:~(~(id~946))/hvor:~(fylke~(~50))]

Utan omrÃ¥defilter fungerer det som det skal.

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@303196,7090016,5/hva:~(~(id~946))]",NVDB-6937,Les-API,
alle_versjoner ikke tatt hensyn til ved vegsystemreferanse,"Richard Virion <richard_virion@trimble.com>:
{quote}
Vi ser at nÃ¥r man henter data med vegsystemreferanse parameteren blir historiske data ikke med. Men hvis vi bruker polygon parameteren blir historiske data returnert.
Er det en begrensing i vegsystemreferanse indeksen?

Her er et eksempel:
https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegobjekter/915?alle_versjoner=true&segmentering=false&vegsystemreferanse=FV6092S1&fylke=15

Vi forventer Ã¥ fÃ¥ disse objektene tilbake: 1002115196 (lukket), 1002115184 (lukket), 1002155011 (gyldig), 1003090402 (lukket). Vi fÃ¥r kun gyldig objektet.

Hvis vi sender en polygon rundt FV6092S1 fÃ¥r vi alle objektene som forventet.
https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegobjekter/915?alle_versjoner=true&segmentering=false&polygon=118290.2680623 7014145.1641853,118633.449190096 7014337.76583866,119078.183916933 7014603.90630511,119529.922340256 7014666.93957348,119750.538779553 7014628.41924281,119978.158915335 7014691.45251118,120282.81971246 7014757.98762779,120576.974964856 7014800.00980671,120664.521170926 7014687.95066294,120366.864070287 7014558.38227795,119964.151522364 7014544.37488498,119648.985180511 7014498.85085783,119347.826231629 7014505.85455431,119092.191309904 7014414.8065,118787.53051278 7014229.20854313,118549.404832269 7014082.13091693,118269.256972844 7014043.61058626,118290.2680623 7014145.1641853
{quote}",NVDB-6937,Les-API,
FKB-typer der to mapper til NVDB-type mangler Ã©n pÃ¥ hjem-fane.,"E-post fra Ann Helen Karlsen (annk@viken.no). Hun pÃ¥peker at i de tilfellene der det er to FKB-typer som mapper til Ã©n NVDB-type i kontraktens objektliste, sÃ¥ vises bare den ene FKB-typen pÃ¥ oversikt pÃ¥ hjem-fanen.

Se hele Ann Helens mail i vedlegg.",NVDB-6937,Datafangst,
Skrivefeil i feilmld-boks,"*Observasjon fra support.*

Feilmeldingsboks (typisk ved registrering og 400-feil) inneholder en skrivefeil:
{noformat}
Registere vegobjekter i NVDB
Det har oppstÃ¥tt en intern feil. Hvis feilen gjentar seg, ta kontakt med datafangst support og oppgi feilkode QkLoMyOv
{noformat}
Det skal vÃ¦re ""RegistRere"".",NVDB-6937,Datafangst,
Fane for oppdrag og transaksjoner i Kontrollpanelet,"API Skriv har offentlige endepunkter for oppslag i oppdrag og transaksjoner. Disse ressursene er nyttige i forbindelse med feilsÃ¸k hos utviklere, men ogsÃ¥ for systemadmins for Ã¥ avdekke kilden til datafeil i NVDB.

Ved overgang til Atlas kan man ikke bruke disse endepunktene direkte fra nettleser uten Ã¥ ha med Authorization: Bearer xyz.

Det foreslÃ¥s derfor Ã¥ etablere ny fane for dette a la dagens fane for lÃ¥ser. Fanen kan f.eks. hete ""Oppdrag"" eller ""Transaksjonsjonslogg"", et begrep som brukes av erfarne NVDB-forvaltere. Denne bÃ¸r kun vÃ¦re tilgjengelig for brukere med fagdata_admin- eller system_admin-rollen. Oppdrag og transaksjoner presenteres grafisk pÃ¥ samme mÃ¥te som i LÃ¥ser-fanen.
",NVDB-6937,Skriv-API,
Byggeplan for Release,"Etabler byggeplan ""NVDB API Skriv - Release"" etter mal av tilsvarende for NVDB API Les. Denne skal utfÃ¸re maven release, deploye til Artifactory og bygge Atlas Docker Image.",NVDB-6937,Skriv-API,
Lokal kjÃ¸ring med Quarkus feiler noen ganger med classloader-feil i Jersey,"Jeg fÃ¥r noen ganger en feil i classloading nÃ¥r jeg kjÃ¸rer lokalt med ""mvn quarkus:dev"".
Hvis jeg starter pÃ¥ nytt sÃ¥ er det som regel OK neste gang. Quarkus bruker flere classloadere ved lokal kjÃ¸ring, men bare Ã©n nÃ¥r det ikke er utviklingsmodus, sÃ¥ sÃ¥ vidt jeg skjÃ¸nner er det ingen sjanse for at dette skjer i prod.

Kan virke som det er en race condition i konfigurasjon, sÃ¥nn at det er mulig at en klasse lastes flere steder.

Alternative lÃ¸sninger er Ã¥ gÃ¥ tilbake til sette eksplisitt classloader for kjÃ¸re jersey Client (sÃ¥nn som det var med RestStop), skrive om til Ã¥ bruke noe annet enn Jersey client, eller finne ut om det er noe spesielt vi gjÃ¸r med konfigurasjon som gjÃ¸r at vi trigger dette. Den gangen vi hadde wrapper for Ã¥ kalle jersey client i integrasjonsmodulen, sÃ¥ virka det fint Ã¥ bruke Jersey client i andre moduler uten wrapper, sÃ¥ det kan virke som vi gjÃ¸r noe litt spesielt der.

Stacktrace:
{noformat}
Caused by: java.lang.ClassCastException: class org.glassfish.jersey.jaxb.internal.JaxbAutoDiscoverable cannot be cast to class org.glassfish.jersey.internal.spi.AutoDiscoverable (org.glassfish.jersey.jaxb.internal.JaxbAutoDiscoverable is in unnamed module of loader 'app'; org.glassfish.jersey.internal.spi.AutoDiscoverable is in unnamed module of loader io.quarkus.bootstrap.classloading.QuarkusClassLoader @508ea8c7)
	at org.glassfish.jersey.model.internal.CommonConfig$2.compare(CommonConfig.java:594)
	at java.base/java.util.TreeMap.compare(TreeMap.java:1292)
	at java.base/java.util.TreeMap.put(TreeMap.java:536)
	at java.base/java.util.TreeSet.add(TreeSet.java:255)
	at java.base/java.util.AbstractCollection.addAll(AbstractCollection.java:352)
	at java.base/java.util.TreeSet.addAll(TreeSet.java:312)
	at org.glassfish.jersey.model.internal.CommonConfig.configureAutoDiscoverableProviders(CommonConfig.java:612)
	at org.glassfish.jersey.client.ClientConfig$State.configureAutoDiscoverableProviders(ClientConfig.java:364)
	at org.glassfish.jersey.client.ClientConfig$State.initRuntime(ClientConfig.java:399)
	at org.glassfish.jersey.client.ClientConfig$State.access$000(ClientConfig.java:90)
	at org.glassfish.jersey.client.ClientConfig$State$3.get(ClientConfig.java:122)
	at org.glassfish.jersey.client.ClientConfig$State$3.get(ClientConfig.java:119)
	at org.glassfish.jersey.internal.util.collection.Values$LazyValueImpl.get(Values.java:340)
	at org.glassfish.jersey.client.ClientConfig.getRuntime(ClientConfig.java:733)
	at org.glassfish.jersey.client.ClientRequest.getConfiguration(ClientRequest.java:286)
	at org.glassfish.jersey.client.JerseyInvocation.validateHttpMethodAndEntity(JerseyInvocation.java:135)
	at org.glassfish.jersey.client.JerseyInvocation.<init>(JerseyInvocation.java:105)
	at org.glassfish.jersey.client.JerseyInvocation.<init>(JerseyInvocation.java:101)
	at org.glassfish.jersey.client.JerseyInvocation.<init>(JerseyInvocation.java:92)
	at org.glassfish.jersey.client.JerseyInvocation$Builder.method(JerseyInvocation.java:420)
	at org.glassfish.jersey.client.JerseyInvocation$Builder.get(JerseyInvocation.java:316)
	at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbWriteApiGateway.lambda$getLdapUser$12(DefaultNvdbWriteApiGateway.java:389)
	at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbWriteApiGateway.catchAndRethrow(DefaultNvdbWriteApiGateway.java:482)
	at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbWriteApiGateway.getLdapUser(DefaultNvdbWriteApiGateway.java:389)
	at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbWriteApiGateway_ClientProxy.getLdapUser(DefaultNvdbWriteApiGateway_ClientProxy.zig:222)
	at no.svv.nvdb.datafangst.nvdb.NvdbUserServiceImpl.getNvdbLdapUser(NvdbUserServiceImpl.java:44)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
	at java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)
	at java.base/java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290)
	at java.base/java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:746)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1020)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1656)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1594)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:183)
{noformat}
",NVDB-6937,Datafangst,
"Vegliste: Lese ""tillatt for modulvogntog""-egenskap fra NVDB","Inntil videre faker vi ""tillatt for modulvogntog"" = Ja pÃ¥ serversiden til den nye modulvogntog-veglisten, for det finnes ikke gyldige data i NVDB (ennÃ¥)

Ganske snart vil NVDB ha gyldige data pÃ¥ denne egenskapverdien, og da bÃ¸r vi legge om til Ã¥ lese rett fra NVDB.Â ",NVDB-6825,Rapportgenerator,
Send med unik ID i kall til Skriv og Les,"Tore oppfordrer om Ã¥ sende med header ""X-REQUEST-ID"" med en unik ID for requester til Skriv og Les. Om den er med til andre systemer her det heller ikke noe Ã¥ si, sÃ¥ kan legges inn pÃ¥ generell interceptor under ""integration"".

Pass ogsÃ¥ pÃ¥ Ã¥ fÃ¥ med bruk av Skriv i SecurityServiceImpl, som ikke dekkes av filter i integration-modulen.

ID mÃ¥ logges hos oss sÃ¥ vi fÃ¥r etablert sammenheng, og den kan gjerne inneholde den request-ID'en som vi genererer nÃ¥r backend mottar et request ogsÃ¥.",NVDB-6937,Datafangst,
FÃ¥r ikke stedfesting med valgt veg,"h2. Observasjon

FÃ¥r denne i prod, og har reprodusert lokalt. NÃ¥r jeg sender inn med valgt veg (EV134) fÃ¥r jeg ikke stedfesting, men hvis jeg dropper Ã¥ velge veg sÃ¥ gÃ¥r det bra.

Request: [https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegkategori=E&vegnummer=134&fase=V&typeVeg=KANALISERT_VEG%2CENKEL_BILVEG%2CRAMPE%2CRUNDKJ%C3%98RING%2CGATETUN]

Data:
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?>
<vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3"">
    <vegobjekt typeId=""92"" tempId=""aee93e82-c506-44f4-be09-06e42433ad6f"">
        <egenskaper>
            <egenskap typeId=""4792"">
                <geometri>
                    <srid>25833</srid>
                    <wkt>LINESTRING (-19111.260646962503 6643191.596462952 3.31, -19099.638620709477 6643195.484930785 2.81, -19085.646802011877 6643200.406781235 3.04, -19085.63681415812 6643200.405873666   3.0700000000000003,   -19041.73912521673 6643214.160913138 3.42, -19015.10926068644 6643222.959460426 3.61,   -18990.687467476353   6643228.182277681 3.17, -18978.581337546697 6643228.200029384 3.0300000000000002,   -18954.863862368453   6643226.5584692415 2.74, -18919.150046994793 6643222.839943237 2.54, -18892.618726656714   6643220.690940182 2.7,   -18874.531661867746 6643219.037346501 2.63, -18847.00154484372 6643216.243720112 2.34,   -18830.974698344187   6643214.636349644 2.24, -18812.079512891534 6643212.345388888 2.5300000000000002,   -18796.152567622077   6643211.190190068 2.46, -18763.97539194103 6643207.672192546 2.67, -18740.77638078481   6643205.201633486 2.7,   -18732.150447438995 6643202.383620459 2.81, -18726.969563099672 6643203.655008901 2.81,   -18683.93381504604   6643198.838148885 2.65, -18667.202387775935 6643197.00563425 2.8000000000000003,   -18665.962967545318   6643196.349216298 2.81, -18663.067402984074 6643195.9652614575 2.83, -18654.76488624455   6643197.2349637905 2.88,   -18624.894126985222 6643196.3736286005 3.14, -18561.088489930436 6643194.0500479555 3.33,   -18550.55405911745   6643192.7302860515 3.49, -18527.516782432678 6643192.026656758 3.42, -18496.8961958164   6643194.319675181 3.37,   -18492.62416109169 6643194.455142525 4.23, -18486.152151656162 6643195.971737502 4.13,   -18480.252170056803   6643197.510099924 4.04, -18466.022546030872 6643202.722491489 3.81, -18462.073803159816 6643204.065556583 3.75, -18448.502514536784 6643210.455567327 3.79, -18412.73153364251 6643225.875436061 3.91)</wkt>
                    <referansegeometri>false</referansegeometri>
                    <kvalitet/>
                </geometri>
            </egenskap>
        </egenskaper>
        <gyldighetsperiode>
            <startdato>2020-11-11</startdato>
        </gyldighetsperiode>
    </vegobjekt>
</vegobjekter>
{noformat}
h2. Analyse

Ruteberegneren til API Les klarer ikke levere sammenhengende rute.

Request:
{noformat}
1 > POST https://nvdbapiles-v3.atlas.vegvesen.no/beta/vegnett/rute
1 > Accept: application/json
1 > X-Client: NVDB API Skriv
1 > Content-Type: application/json
1 > X-REQUEST-ID: aee93e82-c506-44f4-be09-06e42433ad6f
1 > svvguid: 0b49dde8-3bd8-450a-9362-1180575d8a83
{""geometri"":""LINESTRING (-19111.26 6643191.6, -18990.69 6643228.18, -18527.52 6643192.03, -18412.73 6643225.88)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""EV134"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring,gatetun"",""tidspunkt_start"":""2020-11-11"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false,""behold_trafikantgruppe"":true}
{noformat}
Respons:
{noformat}
2 < 200
2 < Access-Control-Allow-Origin: *
2 < Access-Control-Allow-Methods: GET, POST, OPTIONS
2 < X-REQUEST-ID: aee93e82-c506-44f4-be09-06e42433ad6f
2 < Date: Wed, 11 Nov 2020 12:27:27 GMT
2 < Access-Control-Allow-Headers: accept, x-client, x-client-session, origin, content-type
2 < X-Robots-Tag: none
2 < Cache-Control: no-cache
2 < X-Datakatalog-Versjon: 2.22
2 < Set-Cookie: bd9905a474ad1ff0c3612b8d8c7da59d=6a3467d3e7ddb00a10810bb4491f3379; path=/; HttpOnly; Secure
2 < Content-Length: 119
2 < Access-Control-Max-Age: 1728000
2 < Content-Type: application/json;charset=utf-8
{""vegnettsrutesegmenter"":[],""metadata"":{""antall"":0,""lengde"":0.0,""status"":2060,""status_tekst"":""LENGSTE_SAMMENHENGENDE""}}
{noformat}
h2. LÃ¸sning

Om typeVeg er med i request-en brukes denne til Ã¥ bestemme trafikantgruppe, ellers brukes geometri eller punkter som fÃ¸r.",NVDB-6937,Les-API,
Datafangst genererer SOSI som ikke lar seg importere,"Jeg skulle prÃ¸ve Ã¥ reprodusere noe som jeg snubla over pÃ¥ support, og tok SOSI-nedlasting fra eksport-fanen. I dette tilfellet kontrakt 830cfe6e-6ad1-42cb-9bc9-5d339053d232 i prod, og type kabel. Valgte type ""korriger"" (siden data allerede var sendt til NVDB), og tok bort markering for format kompatibelt med NVDB123.

Eksporter fil mangler ""datafangstdato"" og ""kvalitet"", og derfor blir alle vegobjekter avvist ved import. Jeg fÃ¥r ogsÃ¥ noen litt rare feilmeldinger pÃ¥ steder det ser ut om de ikke hÃ¸rer hjemme, men det kan vÃ¦re fÃ¸lgefeil.",NVDB-6937,Datafangst,
Brukerdokumentasjon,"Enkel brukerdokumentasjon.

PÃ¥ samme nivÃ¥ som Les API ([https://www.vegdata.no/nvdb-api-les/)]

WordPress...",,Rapportgenerator,
Store transaksjoner bruker opp minne,"https://nvdbapiles-v3.atlas.vegvesen.no/transaksjoner?fra=2020-10-25T00:00:00&til=2020-10-26T00:00:00
Inneholder transaksjoner som er sÃ¥ store at api-noden i noen tilfeller tryner med OOM.
SÃ¥ vi mÃ¥ strÃ¸mme pÃ¥ lavere nivÃ¥.",NVDB-6937,Les-API,
Release og deploy (Atlas 2.0),"* Back end:Â (/)
 * Front end:Â (/)",,Rapportgenerator,
Eksponer antallet requester som feiler som metrikk,Vi vil ha data om antallet requester som feiler/er ok i Grafana. ,NVDB-6937,Les-API,
V1 vegnettsrapport: Beredskapsveg og serviceveg,"Avklaring - hvordan hÃ¥ndterer vi ""beredskapsveg"" og ""serviceveg"" i vegnettsrapporten? Dette er egne objekttyper med fÃ¥ forekomster, og vi bÃ¸r kunne sjekke for overlapp uten at det gÃ¥r ut over ytelsen.Â 

Ett alternativ er at vi bruker kolonnen ""TypeVeg"" NVDBREF-843 til Ã¥ holde pÃ¥ beredskap- og serviceveg.Â 

Avklares med vegnettsgruppa",NVDB-6827,Rapportgenerator,
Fane for Ã¥ slÃ¥ opp i /les-endepunkter i Kontrollpanelet,"API Skriv har noen ressurser som gir innsyn i NVDB. Disse ressursene er nyttige for Ã¥ se hvordan objekter faktisk er lagret.

Ved overgang til Atlas kan man ikke bruke disse endepunktene direkte fra browser uten Ã¥ ha med Authorization: Bearer xyz.

Oppgaven gÃ¥r ut pÃ¥ Ã¥ opprette en ny fane ""Innsyn"" i kontrollpanel som gjÃ¸r kall mot disse ressursene pÃ¥ vegne av brukeren (da med JWT):

* /rest/v3/les/vegobjekt/{typeId}/{vegobjektId}/{versjon}
* /rest/v3/les/veglenkesekvens/{veglenkesekvensId}
* /rest/v3/les/node/{nodeId}
* /rest/v3/les/omrÃ¥de/{typeId}/{vegobjektId}?veglenkesekvensId={veglenkesekvensId}

Verdier angitt med {} skal kunne angis som parametere.

Fanen skal kun vÃ¦re tilgjengelig for system_admin-brukere.",NVDB-6937,Skriv-API,
Datakontroll inn i Atlas,"Datakontroll skal inn i Atlas-miljÃ¸et heller enn Ã¥ kjÃ¸re pÃ¥ applikasjonstjenerne. Vi mÃ¥ ogsÃ¥ gÃ¥ over fra Ã¥ bruke LDM20 til Ã¥ bruke en ny rest-tjeneste for autentisering og autorisering.

Stegene som mÃ¥ gjÃ¸res i fÃ¸lge Marvin:
â€¢	Opprette miljÃ¸ https://atlas-docs.atlas.vegvesen.no/atlas-dokumentasjon/latest/client/create/create_env.html
â€¢	Opprette deploymentbeskrivelse https://atlas-docs.atlas.vegvesen.no/atlas-dokumentasjon/latest/client/init/init_config.html
â€¢	Opprette et Docker-image basert pÃ¥ en jar/war https://atlas-docs.atlas.vegvesen.no/atlas-dokumentasjon/latest/client/build/build.html
â€¢	Opprette vault https://atlas-docs.atlas.vegvesen.no/atlas-dokumentasjon/latest/client/init/init_vault.html
â€¢	Legge inn databasepassord https://atlas-docs.atlas.vegvesen.no/atlas-dokumentasjon/latest/client/init/init_secret.html
â€¢	Opprette en kjÃ¸rende instans https://atlas-docs.atlas.vegvesen.no/atlas-dokumentasjon/latest/client/create/create_deploy.html
",NVDB-6937,Datakontroll,
Oppdater NVDBIND->Skriv til OIDC og ny url,Implementer ny innlogging mot Skriv siden Skriv nÃ¥ er pÃ¥ Atlas.,NVDB-6937,NVDB-IND,
Vegsystem mangler vegnummer i vegsystemreferansen,"h2. Observasjon

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/1001492.json]Â har vegsystemreferanse med et vegsystem uten vegnummer (kortform blir ""PVnull"").

Vegsystemet har nummer:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/915/1002512240/1.json]

Â ",NVDB-6937,Les-API,
HTTP 500 ved /stedfest,"h2. Observasjon

En bruker (oyslun) rapporterer om konsekvent feil ved stedfesting av et vegobjekt.

Request:

POST https://www.vegvesen.no/nvdb/apiskriv/v3/stedfest?maksimumAvstandTilVeg=300&vegnummer=134&vegkategori=E&fase=V&typeVeg=ENKEL_BILVEG

<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""852"" tempId=""32f37a02-977b-4be1-b3f3-b2ac910001ae""><egenskaper><egenskap typeId=""9721""><geometri><srid>25833</srid><wkt>LINESTRING (-21255.467397820612 6643042.37843815 8.72, -21253.739523636526 6643043.550738106 8.41, -21248.732013696514 6643046.12694282 7.54, -21246.9006521118 6643047.883998728 7.26, -21246.48484532733 6643049.246015512 6.86, -21246.5575353076 6643050.440939918 6.55, -21248.695011539734 6643051.521369989 6.45, -21254.140263362555 6643050.999042361 6.09, -21266.778553300188 6643047.233038662 5.2700000000000005, -21268.616365672147 6643047.732361575 5.5200000000000005, -21269.55438904109 6643049.156973922 5.57, -21270.865609303117 6643050.796766616 6.1000000000000005, -21275.35977134196 6643062.071212064 6, -21276.666490542004 6643064.64715296 5.93)</wkt><referansegeometri>false</referansegeometri><kvalitet/></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-11-10</startdato></gyldighetsperiode></vegobjekt></vegobjekter>

h2. Analyse

DF bruker feil URL til stedfestingsendepunktet. Riktig URL er https://www.vegvesen.no/nvdb/apiskriv/rest/v3/stedfest",NVDB-6937,Skriv-API,
Syntaksfeil i statistikkspÃ¸rring,"h2. Observasjon

Ã…pne
{noformat}
https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@302157,6925744,8/hva:~(~(category~(id~10288~type~'interval)~intervals~(~2010~2015)~filter~(~(operator~'*3d~type_id~1156~verdi~(~3594)))~id~103)~(category~(id~1298~type~'interval)~intervals~(~50~100~500)~filter~(~(operator~'*3d~type_id~1089~verdi~(~13747)))~id~5))/hvor:~(kommune~(~3430~3426))
{noformat}
Legg merke til at enkelte statistikk-kall (de mest ""avanserte"") fÃ¥r HTTP 422 fra API.",NVDB-6937,Vegkart,
"Oppdatere infovindu med ""Bruk av data"" og ""Brukerveiledning""","Oppdatere infovindu med ny tekst og link som viser til betingelser og informasjon om bruka av data pÃ¥ vegdata.no

Gjelder bÃ¥de v2 og v3 (i v2 mÃ¥ eksisterende link fjernes/oppdateres)

Â 

Samtidig er det Ã¸nskelig med link til brukerveiledning for Vegkart V3",NVDB-6937,Vegkart,
Forskjellig nÃ¸yaktighet i tids-variabler,"Windows har en nÃ¸yaktighet pÃ¥ 9 siffer for `Instant` og `LocalDateTime`, mens Linux har nÃ¸yaktighet pÃ¥ 6. Databasene vÃ¥re bruker en nÃ¸yaktighet pÃ¥ 6 siffer. Dette blir problematisk for Windows nÃ¥r testene skal sammenligne tids-eventer.Â 

Â 

ForeslÃ¥tt lÃ¸sning:

`Comment` og `Event` sine sammenligningsmeoder tar ikke hensyn til deres tidsvariabler, hhv. `{{createdInstant}}` og `occurredInstant`.

`TokenRequest` sin sammenligningsmetode oversetter til `epochSeconds`.",NVDB-6937,Datafangst,
Minneproblemer med 577 /versjoner,"/vegobjekter/577/237271712/versjoner laster mange objekter i minne og tryner.
Endre til strÃ¸mmende hÃ¥ndtering.",NVDB-6937,Les-API,
Datter med justert stedfesting bÃ¸r arve konfidens fra mor,"h2. Observasjon
Importer mor og datter som har ulik stedfesting fra NVDB, f.eks. skjerm og avstandsmÃ¥ling her: 
[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/335?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

Gi skjerm 101895592 ny stedfesting uten Ã¥ velge veg. Skjerm er nÃ¥ oransje, mens datter avstandsmÃ¥ling 377099404 har fÃ¥tt endret stedfesting, men er grÃ¸nn.

Det gjelder ogsÃ¥ andre veien, gjÃ¸r bÃ¥de mor og datter oransje ved Ã¥ stedfeste uten valgt veg. Stedfest sÃ¥ mor med valg av veg, mor er grÃ¸nn og datter oransje.",NVDB-6937,Datafangst,
Race condition kan gi feil status nÃ¥r bÃ¥de mor og datter stedfestes,"h2. Observasjon
Dette er en spesialisering av NVDB-6032, som kan leses for bakgrunn.

Endringer i forbindelse med NVDB-5907 for Ã¥ fÃ¥ en progress bar med flere steg gjÃ¸r at stedfesting av en gruppe objekter sendes i flere parallelle kall til server i stedet for ett samlet kall. Server har ingen lÃ¥semekanisme e.l. for Ã¥ si at et vegobjekt er under behandling i dette tilfellet (og selv om den hadde hatt det hadde det uansett vÃ¦rt vanskelig nÃ¥r kallene kommer sÃ¥ tett). Vi fÃ¥r da fort situasjonen at nÃ¥r bÃ¥de mor og datter sendes inn for stedfesting, og en av de fÃ¥r posisjonen justert som fÃ¸lge av den andres stedfesting, sÃ¥ vil det sendes tilbake et objekt med beskjed om at det har fÃ¥tt ny posisjon som fÃ¸lge av endring i relasjon, men dette objektet er henta ut pÃ¥ et tidspunkt der det ikke har fÃ¥tt riktig status med endelig stedfesting.

h3. Steg for Ã¥ reprodusere
# Importer objekter fra NVDB med en relasjon, f.eks. de to lenkene i NVDB-6032
# Stedfest mor og datter samtidig, for tydeligst resultat er det best Ã¥ _ikke_ velge veg
# BÃ¥de mor og datter skulle nÃ¥ hatt oransje prikk, men det er en sjansen for at en av de er grÃ¸nn eller blÃ¥
 
h2. Analyse
Hvis innsendinga ikke hadde vÃ¦rt delt opp hadde eksisterende server-kode hÃ¥ndtert dette greit. SÃ¥ det enkleste alternativet er Ã¥ droppe progress bar (eller leve med at den stÃ¥r pÃ¥ 0 til den er ferdig.)

Det er ogsÃ¥ mulig at klient sjekker om det er relasjoner for det sendes inn, og at disse grupperes i samme innsending. Det som taler i mot det er at fanen ikke har relasjonsinformasjon fra fÃ¸r, og at dette er en type kompleksitet som bedre handteres pÃ¥ server-sida. Kan eventuelt sees i sammenheng med stedfesting av hierarki (NVDB-5060).

Det siste alternativet er Ã¥ skrive om kallet til Ã¥ vÃ¦re en asynkron operasjon, der klient poller for status. Det kan uansett vÃ¦re lurt, hvis bruker stedfester mange vegobjekter (hundrevis, men det er ikke utenkelig) kan det gÃ¥ sÃ¥ lang tid pÃ¥ server at en enkelt synkront kall timer ut fÃ¸r bruker fÃ¥r svar. Det mÃ¥ da vÃ¦re mulig Ã¥ polle for status, sÃ¥nn at vi fÃ¥r en fungerende progress bar. Med en slik lÃ¸sning vil dette ligne mer pÃ¥ automatisk stedfesting, sÃ¥ se pÃ¥ om de har noe felles som kan brukes.",NVDB-6937,Datafangst,
GjÃ¸r fÃ¦rre kall til Solr i ruteberegning for geometri,"Ruteberegning gjÃ¸r nÃ¥ veldig mange kall til Solr for Ã¥ finne nÃ¦rmeste segmenter. 
Dette kan gjÃ¸re mer i minne, noe lignende https://github.com/nvdb-vegdata/nvdb-datafangst/blob/master/plugins/localization/src/main/java/no/svv/nvdb/datafangst/localization/localizer/SingleLineLocalizer.java

AltsÃ¥ beregn nÃ¦rmeste segment i minne, i stedet for Ã¥ spÃ¸rre Solr.",NVDB-6937,Les-API,
Sette operasjon Oppdater som default ved import,"Bakgrunnen for denne saken er NVDB-6158 hvor det blir et problem nÃ¥r man benytter Korriger for mor og endrer dÃ¸tre. Operasjon Korriger bÃ¸r helst brukes nÃ¥r man skal rette en feil pÃ¥ versjon som er inne.

Vi kan legge opp til at Datafangst tilbyr Oppdater som standard med mulighet for aktivt Ã¥ gÃ¥ inn for Ã¥ bruke Korriger.",NVDB-6937,Datafangst,
NVDBIND-status som metrikker,"Eksponer metrikker fra Forvaltning
* Hvor lang er oppgavekÃ¸en
* Hvor mange transaksjoner ligger i kÃ¸en
* Hvor lenge har kjÃ¸rende oppgave kjÃ¸rt
",NVDB-6937,NVDB-IND,
Eksponer helsesjekker som metrikker,Eksponer helsesjekkstatus som metrikker slik at de kan legges inn i et Grafana,NVDB-6937,Les-API,
Avvisning pga. ikke-dekkende stedfesting i morobjekt,"h2. Observasjon

Endringssett https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/3d39a66a-6828-47ba-b2e2-70caa98f6e32/status avvises fordi et vegobjekt ikke dekkes fullstendig av en morobjektversjon. Men denne versjonen lukkes under behandlingen av endringssettet pga oppdatering.

h2. Analyse

I endringssettet oppdateres tre vegobjekter med ny versjon pÃ¥ samme startdato: Skiltpunkt A og B + Skiltplate C

- A fÃ¥r sin assosiasjon til B fjernet
- B fÃ¥r ny assosiasjon til B
- C fÃ¥r ny stedfesting, som er identisk med B sin.

Kort sagt: Skilplaten relokaliseres og fÃ¥r ny mor.

Under validering i CoveredByParentValidator kontrolleres at C dekkes av alle relevante morobjekter. I findParentFeatures() hentes aktuelle morobjektversjoner, men det tas ikke hÃ¸yde for at det kan finnes flere utgaver av hver vegobjektversjon. I dette tilfelle velges READ-varianten, i stedet for CLOSE, av opprinnelig versjon av A. Denne har annen stedfesting enn den nye stedfestingen til C og det trigges en valideringsfeil.

h2. LÃ¸sning

Endret CoveredByParentValidator.findParentFeatures() til Ã¥ hente mest signifikante utgave av hver morobjektversjon.",NVDB-6937,Skriv-API,
Ytelsestest av /rute,"Rute-endepunktet er litt tungt. Det hadde vÃ¦rt en fordel Ã¥ se ytelsen pÃ¥ dette endepunktet. BÃ¥de isolert med bare kall mot /rute og sammen med bakgrunnslast mot API Les.

Bruk reelle kall mot /rute. Her kanÂ 
{noformat}
/nvdb-rest-api/test/e2e-test/src/test/python/makeRouteBody/makeRouteBody.py
{noformat}
benyttes for Ã¥ lage rute-requester til ytelsestesten.",NVDB-6937,Les-API,
Test: Automatiserte tester av eksport fra vegkart,"Vurder hvorvidt man skal lage automatiserte tester av eksport. SpÃ¸rsmÃ¥l rundt dette: * hvordan sjekke resultatet? kan man lagre respons til en bestemt sti? lese fra csv?
 * per nÃ¥ sjekkes kun responstypen
 ** en mulighet Ã¥ kun sjekke at ulike eksporter gÃ¥r bra, men ikke helt nok

Det er nok mest naturlig Ã¥ legge tester av Eksport inn under e2e-testene i Vegkart, men ogsÃ¥ mulig Ã¥ lage helt egne tester for dette. Fordelen med Ã¥ legge inn under e2e-testene i Vegkart er at man kan kontrollere resultatet opp mot hva som vises. Evt kan de ogsÃ¥ legges under API-testene til API Les. OgsÃ¥ her kan man kontrollere resultatet opp mot hva API Les gir som svar pÃ¥ ""vanlige"" API-kall.
h2. LÃ¸sning

Eksport-testene er lagt under API-testene i API Les med et eget usecase ""v3Export"". SOSI- og CVS-eksportene blir konvertert til en intern Json-struktur for enklere Ã¥ bli sammenlignet med tilsvarende API-kall.",NVDB-6937,Eksport,
Test: Utvid Datafangst-API testene,"Her mangler det tester som dekker bl.a. feltene arkivering og henting av alle featurecollections.

BÃ¸r gÃ¥ gjennom testene og se om det er mer som bÃ¸r utvides av tester.",NVDB-6937,Datafangst,
Test: Legg til scenario pÃ¥ e2e-testene,"Her er det flere scenarioer som mangler tester:

Â 
 (/)Â inkrementell lagring
 (/)Â stedfesting (med API Skriv)
 (/)Â NVDB-5413: klikk bort feilmld
 (/)Â NVDB-3720: alle kvalitetsparam
 (/)Â NVDB-5223: Inform.tekst ved overskriv
 (/)Â NVDB-5231: kopiere lÃ¥ste objekter
 (/)Â NVDB-5044: ikke kunne sette sidepos eller felt
 (/)Â NVDB-5361: velge felt
 (/)Â NVDB-5011: vise svv-navn
 (/)Â NVDB-5460: ny topp-meny. flere sjekker her. inkl. lenke til brukerveiledning
 (/)Â NVDB-5552: ny glemt-passord-flyt
(/)Â NVDB-4747: registrer og fÃ¥ systemfeil
 -(x)Â tester pÃ¥ gruppeadmin-",NVDB-6937,Datafangst,
Ytelsestest av Datafangst-API,"Dette er en stegvis prosess.
Â 
1. Det bÃ¸r kjÃ¸res en ytelsestest av Datafangst-API med f.ex 5 brukere over noen timer
2.Â Sjekk antall kall/posts/etc per tid om det mÃ¥ endres noe pÃ¥ oppsettet. Kan analysere med
{noformat}
nvdb-datafangst/performance-test/src/test/python/apiFeaturecollectionLog/apiFeatureCollection_statistics.py{noformat}
3. Om OK, kjÃ¸r lengre test mot Datafangst-API med flere brukere.
Â 
Tillegg:Â Kunne lagt inn noen ""peak-collections"" med type 4000 objekter i: * vanlig scenario med lav sannsynlighet
 * egen test med kun store featurecollections uten alle /feature og importer for Ã¥ fÃ¥ generert mange store kall litt samtidig.",NVDB-6937,Datafangst,
Test: Legg til scenarioer pÃ¥ API-testene,"FÃ¸lgende scenarioer mangler i API-testene:
 Â 
 (/)Â NVDB-5897: Test at for stor bbox pÃ¥ /rute gir riktig svar
 (/)Â NVDB-5736
 (/)Â Testcaser i StatisticsPerformance.scala mÃ¥ legges inn i Statistics.scala med funksjonelle tester
(/)Â NVDB-5990: Testscenario i kommentar i saken",NVDB-6937,Les-API,
Slett ubrukte endepunkter for stedfesting,"Det finnes tre endepunkter for stedfesting, der to av de ser ut til Ã¥ ikke vÃ¦re i bruk (etter at en integrasjonstest ble skrevet om i NVDB-6001).

Ville normalt sett bli gjort som en del av NVDB-6001, men siden den allerede har flere refaktoriseringer som ikke gÃ¥r pÃ¥ kjernen i den saken skiller jeg denne ut som egen sak.",NVDB-6937,Datafangst,
Grafana-dashboard for alle Atlas-miljÃ¸,"Oppgaven gÃ¥r pÃ¥ Ã¥ fÃ¥ satt opp et Grafana-dashboard for Ã¥ visualisereÂ situasjonen pÃ¥ Atlas forÂ  Vegkart, NVDB API les, NVDB API rapport og etter hvert NVDB API skriv.

Â 

*Epost fra Liv Helen under*

Hei Helen.

JÃ¸rn Mauseth og jeg har hatt en samtale med Marvin i dag, vedrÃ¸rende et Grafana Dashboard.

SVV har anskaffet en stor skjerm pÃ¥ 75Â», som i fÃ¸rste omgang skal speile situasjonen pÃ¥ NVDB portefÃ¸ljen via et grensesnitt i Grafana.

Â Grafana er et grafisk verktÃ¸y, som er implementert for Atlas plattformen.

Marvin har i dag et Dashboard pÃ¥ Grafana, som viser situasjonen for NVDB api les.

[https://atlas-app-grafana.atlas.vegvesen.no/d/bHR49LZMz/nvdb-les-v3?orgId=7&refresh=1m]

Neste steg er Ã¥ fÃ¥ opp et Dashboard, som viser hele NVDB portefÃ¸ljen pÃ¥ Atlas, det vil si et skjermbilde med situasjonen pÃ¥ Vegkart, NVDB API les, NVDB API rapport og etter hvert NVDB API skriv.

Vi har et annet fagomrÃ¥de i Vegvesenet, som har noe tilsvarende:

[https://atlas-app-grafana.atlas.vegvesen.no/d/zwO9y9eZk/din-side-felles?orgId=1&refresh=1m]

Â IÂ vÃ¥r samtale med Marvin, har vi avdekket at han har den kompetansen som kan hjelpe oss med en oversikt V1.

Â 

Videre vet vi at det er Ã¸nsker fra fagsiden, om Ã¥ vise en grafisk oversikt fra andre perspektiv. Men det blir i V2.

I og med at vi mÃ¥ se pÃ¥ hvilke verktÃ¸y, som er best egnet for Ã¥ dekke fagsidens behov.

Â 

Vi vet at Grafana teknisk vil fungere pÃ¥ skjermen.

SÃ¥ derfor er vÃ¥r prioritet Ã¥ fÃ¥ opp skjermen med en V1, sÃ¥ bygger vi sten pÃ¥ sten etter det.

Â 

Mitt spÃ¸rsmÃ¥l er da: Kan Marvin bistÃ¥ oss med en V1?

Â 

Med vennlig hilsen

Liv Helen RÃ¸dal

NVDB teamet",NVDB-6937,Les-API,
Treg hÃ¥ndtering av transaksjoner med mange slettede strekninger,"{quote}
Updated 250000 road systems and deleted 195477 sections, 0 intersections, 25 intersection parts, 0 sideareas and 0 sidearea parts in task 4984890
{quote}

Behandlingen av denne transaksjonen gikk megatregt. Det som brukte veldig mye tid var Ã¥ finne veglenkesekvenser for de 195477 strekningene. Det ble gjort et kall mot cache for hver at de 195477 strekningene. 
Denne delen av transaksjonshÃ¥ndteringen kommer fra NVDB-5099.

Vi har forsÃ¸kt Ã¥ forbedre denne delen ved Ã¥ gjÃ¸re fÃ¦rre kall med flere strekninger om gangen.
",NVDB-6937,NVDB-IND,
Systemfeil pga NPE i JobResultWriter,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/a071ade0-06bb-4b1f-b799-8b065187014d havarerer med SYSTEMFEIL pga. NullPointerException ved skriving til jobbdatabase:

{code:java}
java.lang.NullPointerException
	at java.util.regex.Pattern.<init>(Pattern.java:1350)
	at java.util.regex.Pattern.compile(Pattern.java:1028)
	at java.lang.String.replaceAll(String.java:2223)
	at no.vegvesen.vt.nvdb.apiskriv.domain.issue.Issue.replaceTempIdWithNvdbId(Issue.java:110)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobResultWriter.lambda$null$6(JobResultWriter.java:216)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobResultWriter.lambda$collectGlobalAndJobExtensionIssues$7(JobResultWriter.java:214)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobResultWriter.collectGlobalAndJobExtensionIssues(JobResultWriter.java:213)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobResultWriter.writeResultAfterNvdbIdPopulation(JobResultWriter.java:88)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.updateNvdb(JobWorker.java:705)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:207)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:54)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:145)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

Feilen oppstÃ¥r nÃ¥r bruk av tempId skal erstattes med nvdbId for globale varsler relatert til nye vegobjekter (registrer-operasjon). Et vegobjekt av type 60, nvdbId 274136682 har bÃ¥de versjon 0 og 1 i NVDB (https://www.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/60/274136682). Den fÃ¸rste har startdato 1950-01-01 og Ã¥pen sluttdato og oppfattes derfor av AdaptFeaturesToClosedNetworkEnricherFilter som gjeldende (siste) versjon som derfor mÃ¥ oppdateres. Filteret har derfor etablert ny versjon 1 med redusert stedfesting. I JobResultWriter oppfattes denne som nytt vegobjekt, siden NvdbAction er ADD og versjonen er 1. NÃ¥r tempId er da er null, havarerer dette i Issue.replaceTempIdWithNvdbId().

 h2. LÃ¸sning

Dette er en datafeil som mÃ¥ rettes i NVDB, fÃ¸r endringssettet restartes. Det er imidlertid implementert en kontroll pÃ¥ versjonsnummere i SanitationJobFilter slik at slike tilfeller rapporteres med litt mer forstÃ¥elig feilmelding.
",NVDB-6937,Skriv-API,
Eksport: Flytting av mor ved lukking av barn gir feil,"h2. Observasjon

Under debugging av problem for Raymond. Scenario er at NVDB-mor (Korriger) med NVDB-barn (Lukk) er importert. NVDB-mor fÃ¥r nytt barn (Opprett) og endrer stedfesting fÃ¥r Ã¥ samsvare med nytt barn. Alt ser fint ut. Men registrering feiler pga historikken. Hvis NVDB-mor (v1) endrer stedfesting sÃ¥ vil ikke denne dekke lukkede barns stedfesting i deres tid.

Selv om mor er importert som Korriger vil det riktige her vÃ¦re Ã¥ ta inn mor som Oppdater s.a. mor fÃ¥r ny versjon samtidig som den fÃ¥r nye barn.

Usikker pÃ¥ om vi her burde benytte Oppdater ved innsending selv om bruker har satt Korriger - eller om vi burde kunne gi beskjed om det pÃ¥ en eller annen mÃ¥te.

*Oppdatering*: NVDB-6182 er opprettet for Ã¥ lede bruker inn pÃ¥ Ã¥ heller benytte Oppdater enn Korriger. Dersom denne saken skal gjÃ¸res blir den mer a la ""hindre bruker i Ã¥ endre assosiasjoner nÃ¥r mor sin operasjon er Korriger"".",NVDB-6937,Datafangst,
Ansvarlig bruker trenger ikke vÃ¦re SVV-bruker,"h2. Bakgrunn

ElRapp, og kanskje andre, har mange brukarar som ikkje nÃ¸dvendigvis har SVV-brukar. Dei kan registrere data som generer eksport til NVDB, men fÃ¥r feil nÃ¥r det skal lagrast/sendast. Tenestebrukaren til ElRapp har tilstrekkelig rettar til Ã¥ skrive til NVDB, men endringssettet vert avvist pÃ¥ grunn av ansvarleg ikkje er godkjend brukar.

Det skulle ikkje vere noko i vegen for at ansvarleg kan vere andre enn SVV-brukarar sÃ¥ lenge det er mogleg Ã¥ kome i kontakt med brukaren.
Det vil vere ei betre lÃ¸ysing enn at det er ein fellesbrukar som stÃ¥r som ansvarelg pÃ¥ alle datasett frÃ¥ ElRapp (og evt. andre).",NVDB-6937,Skriv-API,
"Ny veglisterapport: Modulvogntog pÃ¥ tÃ¸mmertransport Fv,Kv","Vi mÃ¥ tilby en rapport for et subsett av tÃ¸mmertransport, uoffisiell. Behovet er kommunikasjon mellom SVV og vegeier (fylkeskommunene, kommunene).Â 

Vi tar utgangspunkt i rapporten for BK tÃ¸mmertransport, uoffisiell og lager en ny rapporttype slik:Â 
 * RÃ¥data = BK tÃ¸mmertransport, uoffisiell
 * Vegfilter: Fv,Kv
 * Egenskapfilter: Maks. vogntoglengde = 24.00 meterÂ 

I tillegg til eksisterende informasjon (vegnr, lengde, BK-verdier etc) sÃ¥ fÃ¸yer vil til fÃ¸lgende informasjon:Â 
 * Kommaseparert liste ned NVDB ID til de BK-objektene som bidrar pÃ¥ strekningen (kan vÃ¦re flere enn ett, eller et NVDB-objekt kan bidra pÃ¥ flere strekninger. Begge deler er helt OK)Â 
 * Gatenavn (ble lÃ¸st 2.11)Â 
 * ""Tillatt modulvogntog"" (Ja/Nei).Â 
 * Kommentar fra vegeier (blankt tekstfelt)Â 

Â 

Rapporten tilbys som en ny rapporttype i nedtrekksmeny for vegliste arbeid, med tittel: ""Modulvogntog basert pÃ¥ tÃ¸mmertransport Fv og Kv"".Â 

Vi mÃ¥ passe pÃ¥ at rapportuttak ikke gir snÃ¥le resultater ved kombinasjon av filter.
 * VÃ¥rt standard vegfilter = Fv,Kv
 * Dette kan overstyres, dvs hvis jeg angir Ev6 sÃ¥ er det det jeg fÃ¥r
 * Valg av kommune vs fylke pÃ¥virker ikke vegfilter, jeg fÃ¥r de vegene som matcher vegfilter innafor valgt omrÃ¥deÂ 

Â 

Â 

Â ",NVDB-6825,Rapportgenerator,
Gi bedre advarsel nÃ¥r eksport feiler ved store eksporter,"En bruker (Erlend Dysvik) Ã¸nsker Ã¥ laste ned store mengder data via CSV. I dette tilfellet er det Kurvatur for hele landet. Dette er nÃ¦rmere 1 million objekter. Innmelder melder forÃ¸vrig at det typisk ogsÃ¥ feiler nÃ¥r man deler opp denne eksporten pÃ¥ fylkesbasis.

CSV-eksport starter Ã¥ laste ned, men etter en del MB fÃ¥r man feil. Chrome melder om nettverksfeil. Kan det vÃ¦re en eller annen timeout som slÃ¥r inn?

Jeg er usikker pÃ¥ om vi skal stÃ¸tte eksport av sÃ¥ store mengder data. Men hvis ikke bÃ¸r vi nok gi en eller annen beskjed om dette nÃ¥r man prÃ¸ver Ã¥ eksportere sÃ¥ mange objekter.

Aktuell url: [https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@600000,7225000,4/hva:~(~(id~640))]

Â ",NVDB-6937,Eksport,
Forbedre automatisk valg av trafikantgruppe pÃ¥ ruteberegning,"Hvis ruteberegningen ikke klarer Ã¥ gjette trafikantgruppe kan det likevel finnes mulig rute for f.eks K.

Om det ikke blir funnet trafikantgruppe, legg inn at det forsÃ¸kes med K og deretter G fÃ¸r den gir opp helt.

Ble oppdaget under test av NVDB-5990 i ATM (pga gammel datadump i ATM).

Â 
h3. LÃ¸sning

Lagt inn et steg pÃ¥ slutten som gjÃ¸r et siste forsÃ¸k med trafikantgruppe kjÃ¸rende hvis den ikke finner rute for Ã¥ bestemme trafikantgruppe.",NVDB-6937,Les-API,
Typedefinisjoner for all frontendkode,"Datafangst ble opprinnelig skrevet i JavaScript, og senere konvertert til TypeScript. Typer i TypeScript har blit lagt til etter hvert, men det er fortsatt en god del som mangler, spesielt i definisjon av respons fra server-kall og i gammel Angular-kode.

Ã… ha typer for hele kodebasen vil gjÃ¸re den mye lettere Ã¥ jobbe med, spesielt for den som er ny til kodebasen. MÃ¥let bÃ¸r vÃ¦re Ã¥ kunne skru pÃ¥ ""noImplicitAny"" for TypeScript.",NVDB-6937,Datafangst,
StÃ¸tte brukerprofiler for tjenestebrukere via LDAP-API,"h2. Bakgrunn

NVDB API Skriv som kjÃ¸rer i Atlas-miljÃ¸ er nÃ¥ integrert med det nye LDAP-API, i stedet for SoaBasis. LDAP-API kan imidlertid ikke p.t. levere brukerprofiler for tjenestebrukere. Har sendt henvendelse til systemeier (Mats Faugli) for LDAP-API. NÃ¥r dette stÃ¸ttes mÃ¥ NVDB API Skriv tilpasses det nye endepunktet for sÃ¸k pÃ¥ tjenestebrukere.

h2. LÃ¸sning

Mats Faugli har oppdatert LDAP-API med stÃ¸tte for tjenestebrukere via endepunktet api/wsclients. Oppdaterte DefaultLdapGateway med sÃ¸k pÃ¥ dette endepunktet for tjenestebrukere.",NVDB-6937,Skriv-API,
Kontraktsliste vises med nylig endret sist,"Etter at det ble rydda opp i standart sortering pÃ¥ kontraktslista med stigende pÃ¥ fÃ¸rste klikk, sÃ¥ ser det ut til Ã¥ ha blitt feil pÃ¥ standard visning fÃ¸r sortering. Vi viste tidligere sist endret fÃ¸rst, men nÃ¥ kommer sist endret sist.

Visning ved oppstart mÃ¥ fikses sÃ¥nn at den vises sist endret Ã¸verst, selv om default sortering ellers er stigende.",NVDB-6937,Datafangst,
SortÃ©r vegobjekter i liste riktig numerisk,"En del steder der vi viser lister med vegobjekter tar vi ikke hensyn til riktig sortering av tall som en del av navn. Vises spesielt godt der vi fÃ¥r rekkefÃ¸lgen ""KURVE 1"", ""KURVE 10"", ""KURVE 2"", men det vil ogsÃ¥ gjelde for NVDB-ID'er.

Dette gjelder i alle fall for utlisting av vegobjekter pÃ¥ stedfesting og sammenkobling, men sikkert ogsÃ¥ andre steder.

Dette kan enkelt fikses ved Ã¥ bruke Intl-API'en for sortering, sÃ¥nn som det er gjort for kontraktslista.",NVDB-6937,Datafangst,
Fjern apilesv3,Fjern dispatcher nvdbapi-v3-old i prod. Mengden trafikk som gÃ¥r gjennom den: https://atlas-grafana.atlas.vegvesen.no/d/haproxy/load-balancer-haproxy?orgId=1&var-runtime_env=prod&var-ns=nvdbapil-produksjon-v3&var-route=All&from=now-7d&to=now&viewPanel=30,NVDB-6937,Les-API,
Fjern tom side for sammenkobling v3,"Under ""Smertefri lagring"" ble det sÃ¥vidt pÃ¥begynt en ny side for sammenkobling, men dette er bare et skjelett (NVDB-4498). Kan vÃ¦re greit Ã¥ fjerne dette fra kildekode, sÃ¥nn at det ikke ligger der og forvirrer.

Etter tidligere diskusjon i forbindelse med overgang til ny leverandÃ¸r er det bestemt at vi ikke skal gÃ¥ videre med skissene fra smertefri lagring nÃ¥.",NVDB-6937,Datafangst,
FÃ¥ ned minnebruk for Gate-cache og eksponer gate,"NVDB-6040 introduserte indeksering av vegnett pÃ¥ Gate(538) . PÃ¥ grunn av at omrÃ¥decache tar veldig mye minne, med neste 500 000 gateobjekter er det deaktivert.
FÃ¥ ned minnebruken og fullfÃ¸r eksponering av Gate.",NVDB-6937,Les-API,
Tilgang til bintray,"Utviklere pÃ¥ LES mÃ¥ fÃ¥ tilgang pÃ¥ https://bintray.com/nvdb-vegdata, releaser av api-klienten legges her",NVDB-6065,,
Slette kode for eksport2,"Etter diskusjon i teamet er det enighet om at ""ny"" eksportfane som ble pÃ¥begynt under ""Smertefri lagring"" ikke er verdt Ã¥ fullfÃ¸re sÃ¥nn den stÃ¥r nÃ¥, sÃ¥ det er bedre Ã¥ slette denne koden.",NVDB-6937,Datafangst,
Legge om til bruk av Atlas og OIDC i ytelsestestene,"Ytelsestestene har i dag ikke konfig for Ã¥ bli kjÃ¸rt mot de nye Atlas-instansene, samtidig som OIDC ikke brukes. Oppgaven gÃ¥r ut pÃ¥ Ã¥ legge om til Ã¥ benytte Atlas-instansene og bruke OIDC ved kall mot Skriv.",NVDB-6937,Skriv-API,
Forenkle sub-domener til bakgrunnskart,"h2. Bakgrunn

Kan vi fÃ¥ justert lenken til bakgrunnskart?

Vi har ogsÃ¥ en logikk hvor vi itererer over subdomener. Dette er av hensyn til MS-IE, som ikke klarer laste ned parallelt fra samme domene. Ã… skru om slik at vi kun laster ned fra domenet services.geodataonline.no/ vil funke helt fint i moderne nettlesere (parallelt), mens IE vil kun laste ned en og en kartflis (litt treigere, men det driter vi i).

Jan

Â 

*From:* Joachim Eckbo Juell <[joachim.juell@geodata.no|mailto:joachim.juell@geodata.no]> 
 *Sent:* onsdag 28. oktober 2020 22:52
 *To:* NedrebÃ¸ Ole Johannes <[ole.nedrebo@vegvesen.no|mailto:ole.nedrebo@vegvesen.no]>; Jensen Jan Kristian <[jan.kristian.jensen@vegvesen.no|mailto:jan.kristian.jensen@vegvesen.no]>
 *Subject:* Forenkle sub-domener til NVDB-bakgrunnskartet

Hei Ole Johs og Jan Kristian,

Vi har i dag veldig mange DNS-aliaser knyttet til NVDB-bakgrunnskartet vi drifter for dere (se listen under). Dette stammer nok fra Â«gamle dagerÂ», da nettlesere kun stÃ¸ttet et begrenset antall parallelle http-kall til samme adresse. Men dette er jo nÃ¥ lÃ¸st med http 2.0.

Alle disse sub-domenene Ã¸ker kompleksiteten i konfigurasjonen vÃ¥r, og Ã¸ker sjansene for feilsituasjoner. Vi er veldig interessert i Ã¥ fÃ¥ ryddet opp i dette. Men dere har vel diverse klienter som er satt opp med disse sub-domenene? Jeg kjenner kun til Vegkart og Trafikkdata, og der er de i bruk. Er det mulig for dere Ã¥ fÃ¥ endret dette? Det beste hadde vÃ¦rt om dere kun benyttet services.geodataonline.no - [https://services.geodataonline.no/arcgis/rest/services/Trafikkportalen/GeocacheTrafikkJPG/MapServer/].

Vi Ã¸nsker ogsÃ¥ Ã¥ flytte tjenesten over til et nytt cluster vi har i AWS Stockholm, noe som vil bedre responstiden ganske mye. Men det krever at vi fÃ¥r ryddet opp i antall sub-domener.

FÃ¸lgende subdomener til geodataonline.no finnes i dag:
 * nvdbcache
 * m1 til m10-nvdbcache
 * m1 til m10.nvdbcache

Â -Joachim",NVDB-6937,Vegkart,
Importere Kantegas jiraprosjekt inn i SVV-jira,Test ut med en prÃ¸ve eksport i fÃ¸rste omgang.,NVDB-6065,,
Eksportere Kantega-jira,"Start med en prÃ¸ve eksport, for Ã¥ se om SVV er i stand til Ã¥ importere den.

Â 

Gjelder 3 jiraprosjekter:
 * Statens Vegvesen - NVDB Ã…pne vegdata
 * Statens vegvesen - NVDB Klassisk
 * Statens Vegvesen - NVDB Referansesystem: Modell & TNE

Â 

SVV har tatt tak i arbeidet med Ã¥ migrere:

[https://www.vegvesen.no/wiki/display/SOAprosjektet/Migrering+av+Kantega+Jira+og+Confluence+til+SVV+Jira+og+Confluence]Â 

[https://www.vegvesen.no/jira/browse/NVDBFOR-377]Â ",NVDB-6065,,
Git - avklare om koden skal flyttes,"NB! NVDB API Skriv har sin online dokumentasjon pÃ¥ GitHub, med hosting pÃ¥ GitHub Pages. Denne kan ikke flyttes sÃ¥nn uten videre.",NVDB-6065,,
Cypresstestene mÃ¥ kjÃ¸re pÃ¥ SVV jenkins,,NVDB-6065,,
Datafangst - Endre domenenavn,"Forslaget til nytt domenenavn er datafangst.vegvesen.no

Domenenavnet bÃ¸r endres sÃ¥ snart som mulig, etter at TorbjÃ¸rn har fÃ¥tt sjekket om ""vegvesen"" kan brukes i URL'en.
h2. Forslag til lÃ¸ysing

Nytt domene vert datafangst.vegvesen.no med redirect til dagens plassering.

UndersÃ¸ker med IT om vi kan ta i bruk datafangst.atlas.vegvesen.no med redirect.",NVDB-6065,,
Egenposisjon er ikke stabil,"h2. Observasjon

Vist posisjon hopper og spretter og kan vÃ¦re opptil en kilometer feil.Â Problemet er visning av ""egenposisjon"" (""blÃ¥ prikk"").Â 
h3. Innmelder

POB: 3683004
Navn:: Kjell Hauge
E-postadresse: kjell.hauge@vegvesen.no",NVDB-6937,Vegkart,
Bruker vi noe infrastruktur hos Triona?,,NVDB-6065,,
Les-bruker for tilgang til database i ATM og PROD,"Det kunne vÃ¦re nyttig Ã¥ ha en bruker med read-only tilgang i databasenene for Ã¥ kunne danne seg et bilde av bruken av systemet nÃ¥r det gjelder omfang, frekvenser og volum. Nyttig for statistikkformÃ¥l, og for Ã¥ lÃ¦re mer om bruken av NVDB Rapporter. Det er ikke alt som er like lett Ã¥ se ut fra loggene i Splunk.",,Rapportgenerator,
Migrere til REST-baserte SoaBasis-tjenester,"h2. Bakgrunn

NVDB API Skriv bruker i dag SOAP-baserte webtjenester for oppslag i LDAP (SoaBasis). Det finnes nÃ¥ REST-baserte tjenester som har tatt over for disse. Det er kommet anmodning fra IKT om Ã¥ fÃ¥ dette gjort snarest.

Den nye tjenesten og detaljer kan finnes i mail fra Mats Faugli fra august 2019, eller her: https://www.vegvesen.no/wiki/display/SOAprosjektet/LDAP-API
 
h2. LÃ¸sning

Etablerte LdapGateway som nytt interface, der dagens SoaBasis-lÃ¸sning avledes og fortsatt brukes i de gamle AutoPro-miljÃ¸ene. Dette fordi LDAP-API krever OIDC-autentisering og Ã¸nsker ikke Ã¥ registrere egen AutoPro-klient for dette. I Atlas-miljÃ¸et derimot kan eksisterende OIDC-klienter brukes til dette. LDAP-API brukes derfor kun i Atlas-miljÃ¸ene. Dette realiseres med DefaultLdapGateway som tar seg av kommunikasjonen med LDAP-API.

LDAP-API stÃ¸tter p.t. ikke oppslag pÃ¥ tjenestebrukere. Har sendt forespÃ¸rsel til Mats Faugli om dette og registrert egen Jira-sak for Ã¥ stÃ¸tte nytt endepunkt for LDAP-API nÃ¥r dette blir klart.",NVDB-6937,Skriv-API,
Etablere ATM- og PROD-miljÃ¸ pÃ¥ Atlas-plattformen,"ApplikasjonsmiljÃ¸ for ATM og PROD i Atlas (nvdbapiskriv-akseptansetest/nvdbapiskriv-produksjon) er bestilt. NÃ¥r dette er klart mÃ¥ det settes opp Atlas-konfigurasjon for tjenester, velv etc og rulle ut NVDB API Skriv.

Etter ytelsestesting mot ATM, mÃ¥ det bestilles server-redirect fra https://www.vegvesen.no/nvdb/apiskriv/* til https://nvdbapiskriv.atlas.vegvesen.no/*",NVDB-6937,Skriv-API,
Mer intuitiv kodestruktur i Datafangst,"Uten RestStop stÃ¥r vi friere til hvordan vi organiserer kode i Datafangst, og vi kan rydde opp i noen gamle synder. Spesielt struktur for frontendkode er barokk og lite hensiktsmessig, men ogsÃ¥ katalogen ""plugins"" som all kode ligger under gir ikke mening som navn uten RestStop.

Dette er en liten og rask endring, men det bÃ¸r gjÃ¸res nÃ¥r det skjer minst mulig annet (spesielt pÃ¥ frontend), siden flytting av filer gjÃ¸r merge mer komplisert.

FÃ¸lgende endringer bÃ¸r gjÃ¸res:
* Flytte ./plugins/dataforvalter til ./frontend
* Rename ./plugins til ./backend for det gjenvÃ¦rende
* Legge Typescript-kode i src/main/typescript
* SASS i src/main/sass, og ressurser ellers uten assets/dataforvalter
* Pluss kanskje Ã¥ drepe CONTEXT_PATH med det samme",NVDB-6937,Datafangst,
Kan ikke kopiere feierode,"Charlie Martin HÃ¥vik (charlie.martin.havik@vegvesen.no) fÃ¥r systemfeil nÃ¥r han skal kopiere importert feierode.

Har feilsÃ¸kt litt mer, og ser ut til Ã¥ gjelde uavhengig av objekt. Feierode er heller ikke tilgjengelig som objekttype for kopiering til annen type nÃ¥r jeg kopierer linjeobjekt.

Feil i logg er ""Feature type 884 Did not have SpatialAttributeType LINE"" som er nÃ¥r vi sjekker datakatalog, men sÃ¥ vidt jeg kan se fra vegobjekttype (https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekttyper/884.json?pretty=true) sÃ¥ stÃ¸tter den linje. Kan vÃ¦re problemer med vÃ¥r parsing av datakatalog, eller datafeil i datakatalog som gjÃ¸r at det ikke virker.

Har prÃ¸vd med bl.a. disse dataene pÃ¥ import: https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/884.json?segmentering=true&kartutsnitt=-47046.887%2C6623599.745%2C-36886.867%2C6629415.298&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter

Stacktrace:
{noformat}
java.lang.IllegalArgumentException: Feature type 884 Did not have SpatialAttributeType LINE
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.ChangesetTransform.lambda$getSpatialAttributeType$29(ChangesetTransform.java:517)
	at java.util.Optional.orElseThrow(Optional.java:290)
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.ChangesetTransform.getSpatialAttributeType(ChangesetTransform.java:517)
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.ChangesetTransform.toGeometri(ChangesetTransform.java:506)
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.ChangesetTransform.toNyttVegobjekt(ChangesetTransform.java:489)
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.ChangesetTransform.lambda$toChangesetForValidation$3(ChangesetTransform.java:174)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
{noformat}
",NVDB-6937,Datafangst,
Sammenkobling til uendret datter hindrer eksport,"h2. Observasjon

export krever at sammenkoblede objekter mÃ¥ sendes inn i samme endringssett, men det fÃ¥r man ikke til Ã¥ gjÃ¸re i datafangst hvis datter allerede er exportert.

Problemet kan gjenskapes ved Ã¥ importere sosi-objekter som skal sammenkobles, men man lagrer datterobjektene fÃ¸r sammenkoblingen gjÃ¸res. dette er bare mulig bare for objekter som ikke krever mor. Vedlagt ligger sosi for holdeplassutrustning som mor, og leskur som datter. leskur krever ikke mor og kan lagres til skriv uten Ã¥ vÃ¦re sammenkoblet med holdeplassutrustningen.

NÃ¥r man havner i dette scenariet, vil submittability_report si at endringssettet ikke kan sendes inn pga manglende assosierte objekter i endringssettet, men GUI tar ikke hÃ¸yde for manglende assosiasjoner, nÃ¥r de som mangler ikke er satt til dirty. Effekten er at GUI grÃ¥er ut knappen for innsending, men gir ikke noe beskjed om hvorfor.
h2. Analyse

Submittability_report ser bare pÃ¥ om det er sammenkoblinger til andre objekter, og sier fra hvis disse ikke sendes inn som en del av endringssettet. Dette henger igjen fra gamle dager da datafangst ikke skulle stÃ¸tte Ã¥ endre objekter som allerede eksisterer i NVDB.Â 
 De faktiske kravene til Skriv er at ved sammenkobling sÃ¥ kreves kun NVDB-ID for barnene. sÃ¥ nÃ¥r vi gÃ¸r sammenkobling med eksisterende barn som har NVDB-ID, sÃ¥ trenger vi ikke sende inn barnene samtidig.
h2. LÃ¸sning

Submittability_report endres til Ã¥ bare varsle om missing associated types hvis de assosierte barnene ikke har NVDB-ID",NVDB-6937,Datafangst,
TopologyException,"h2. Observasjon

Sender POST mot [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?debug=true]Â med
{code:json}
{""geometri"":""LINESTRING (310057.05 6762422.79, 310057.19 6762420.79, 310057.45 6762420.83, 310063.29 6762421.58, 310067.37 6762422.1, 310077.29 6762423.37, 310077.03 6762425.35, 310076.97 6762425.85, 310075.55 6762436.94, 310075.53 6762436.95, 310075.16 6762436.93, 310074.81 6762436.91, 310074.04 6762436.87, 310073.69 6762436.86, 310073.63 6762436.85, 310073.25 6762436.83, 310072.28 6762436.78, 310071.12 6762436.72, 310070.35 6762436.68, 310069.73 6762436.65, 310069.31 6762436.62, 310068.53 6762436.58, 310068.13 6762436.56, 310066.29 6762436.47, 310066.11 6762436.46, 310065.61 6762436.47, 310065.38 6762436.5, 310065.31 6762436.51, 310064.91 6762436.6, 310064.79 6762436.64, 310064.27 6762436.85, 310064.05 6762436.96, 310063.6 6762437.27, 310063.53 6762437.32, 310063.13 6762437.7, 310063.04 6762437.81, 310062.72 6762438.25, 310062.58 6762438.49, 310062.45 6762438.78, 310062.32 6762439.11, 310061.54 6762445.02, 310060.72 6762444.92, 310060.22 6762444.87, 310055.77 6762444.34, 310054.78 6762444.23, 310055.17 6762440.87, 310055.46 6762440.9, 310055.73 6762440.94, 310055.91 6762440.95, 310056.69 6762441.04, 310058.45 6762441.24, 310058.51 6762441.25, 310058.95 6762441.3, 310059.31 6762441.34, 310059.72 6762441.38, 310060.42 6762441.46, 310060.49 6762441.47, 310060.62 6762441.49, 310060.5 6762442.48, 310060.75 6762442.51, 310061 6762442.53, 310061.27 6762440.26, 310060.77 6762440.2, 310060.52 6762440.17, 310060.11 6762440.13, 310059.72 6762440.09, 310059.7 6762440.08, 310059.28 6762440.04, 310059.06 6762440.01, 310059.01 6762440.01, 310058.97 6762440, 310058.85 6762439.99, 310058.43 6762439.94, 310057.99 6762439.89, 310057.38 6762439.82, 310056.82 6762439.76, 310055.72 6762439.64, 310055.32 6762439.59, 310055.72 6762439.63, 310055.77 6762439.14, 310056.17 6762435.86, 310056.26 6762434.56, 310056.93 6762424.59, 310057.02 6762423.29, 310057.05 6762422.79)"",""maks_avstand"":""100"",""konnekteringslenker"":true,""detaljerte_lenker"":false,""vegsystemreferanse"":""R,E,F,K"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-09-16"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":true}
{code}
og fÃ¥r HTTP 500 med
{noformat}
Caused by: org.locationtech.jts.geom.TopologyException: found non-noded intersection between LINESTRING ( 310051.318 6762420.936, 310051.174 6762422.064 ) and LINESTRING ( 310051.307 6762421.02, 310051.172 6762422.086 ) [ (310051.2725882276, 6762421.291725551, NaN) ]
{noformat}
Setter vi imidlertid _vegsystemreferanse: null_ kommer det svar.",NVDB-6937,Les-API,
Java oppgradering fra 8 til 11,"Java 11 er tilgjengelig pÃ¥ Atlas nÃ¥.

Oppgraderer Java for NVDB Rapporter fra 8 til 11.",,Rapportgenerator,
Driftskontrakt V2-oppsummering tilstand/skade,"DriftsmiljÃ¸et Ã¸nsker seg et produkt tilsvarende funkra T2-listene, dvs en oppsummering av ulike typer etterslep og tilstand/skade pÃ¥ V2-nivÃ¥. BÃ¸r ideelt sett integreres i eksisterend eV2-lista (egen fane?). Se eksempel pÃ¥ T2-liste fra Funkra (9305_Sunnfjord-Std-20201019.xlsx).Â 

Det blir nok en del pirkete spesialregler for oppsummering, gjerne en per tilstand/skade objekttype, kan hende fler. (F.eks. generiske tilstand/skade objekt har kanskje en oppsummering per type morobjekt)?Â 

Trenger mer detaljering / gjennomgang fÃ¸r vi gÃ¥r lÃ¸s pÃ¥ implementering.Â ",NVDB-6938,Rapportgenerator,
OmdÃ¸ping et par rader i V2/V3,"DÃ¸pe om rad ""Alle NVDB data kum"" => Kum, alle NVDB data og ""Hjelpesluk => Kum, hjelpesluk"" slik at radene kommer inntil hverandre

DÃ¸pe om rad ""Alle NVDB-data for skiltplate unntatt tunnelmarkering"" => ""Skiltplate, alle NVDB-data unntatt tunnelmarkering"".",,Rapportgenerator,
Vegobjekt i liste mangler geometri,"Vi ser enkelte vegobjekter i spÃ¸rringer som mangler geometri, f.eks. objekt nummer 8 i denne spÃ¸rringa: [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/9.json?segmentering=true&kommune=5401&inkluder=lokasjon%2Cgeometri%2Cegenskaper%2Cmetadata%2Crelasjoner]

NÃ¥r jeg gÃ¥r rett pÃ¥ vegobjektet sÃ¥ er geometri med: [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/9/91526367/1.json]

Â 
h2. LÃ¸sning

Lagt til et felt pÃ¥ vegobjektsegmenter i solr som sier om et segment er aktivt eller ikke. Nyeste segment merkes som aktivt. Det gjÃ¸r at for objekter som er stedfestet pÃ¥ lukket vegnett og kun har segmenter med end_date vil det likevel finnes segmenter som er merket som aktivt og da gir geometri ut i sÃ¥nne tilfeller.

Denne endringen krever full indeksering, men skal fungere som fÃ¸r inntil full indeksering er kjÃ¸rt.",NVDB-6937,Les-API,
Oppdatere ytelsestester,"Oppdatere ytelsestester ihht til reell bruksmÃ¸nster i Prod.

Som ""mal"" er kan uke 41 benyttes.",NVDB-6937,Les-API,
Rutesegment med utstrekning leveres med punktgeometri,"h2. Observasjon

FÃ¸lgende exchange med /rute leverer et rutesegment (det siste) med utstrekning, men med punktgeometri:


{noformat}
3 > POST https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute
3 > Accept: application/json
3 > X-Client: NVDB API Skriv
3 > Content-Type: application/json
3 > X-REQUEST-ID: 7c04dda4-d157-4c46-a53e-a58795156abd
{""geometri"":""LINESTRING (-40807.4 6563722.45, -40727.32 6563611.72, -40609.92 6563532.75, -39376.57 6563019.8, -40609.65 6563528.7, -40731.96 6563611.35, -40807.4 6563722.45)"",""maks_avstand"":""100"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""E,F,R,K"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring"",""tidspunkt_start"":""2020-01-01"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}

2020-10-19T14:55:24.526 INFO  [qtp938750341-69] [] n.v.v.nvdb.apiskriv.jersey.LoggingFilter 4 * LoggingFilter - Response received on thread qtp938750341-69
4 < 200
4 < Transfer-Encoding: chunked
4 < X-Robots-Tag: none
4 < Cache-Control: no-cache
4 < Access-Control-Allow-Origin: *
4 < Access-Control-Allow-Methods: GET, POST, OPTIONS
4 < X-Datakatalog-Versjon: 2.22
4 < X-REQUEST-ID: 7c04dda4-d157-4c46-a53e-a58795156abd
4 < Access-Control-Max-Age: 1728000
4 < Date: Mon, 19 Oct 2020 12:55:00 GMT
4 < Access-Control-Allow-Headers: accept, x-client, x-client-session, origin, content-type
4 < Content-Type: application/json;charset=utf-8
{""vegnettsrutesegmenter"":[{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.03605462,""sluttposisjon"":0.11568015,""kortform"":""0.03605462-0.11568015@320684"",""veglenkenummer"":37,""sluttnode"":""2020686"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-39373.351 6563027.688 10.263, -39387.1 6563033.3 10.207, -39411.5 6563043.2 10.007, -39436 6563053.5 9.907, -39464.5 6563065.1 9.807, -39488.7 6563075.1 9.607, -39515.7 6563086.1 9.407, -39539.8 6563096.1 9.307, -39565.8 6563106.7 9.207, -39589.6 6563116.4 9.006, -39615.2 6563127 8.806, -39639.7 6563137 8.706, -39663.4 6563146.8 8.606, -39688.7 6563157.2 8.506, -39705.7 6563164.38 8.306)"",""srid"":5973},""lengde"":359.229,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":163.109,""til_meter"":522.338,""retning"":""MED""},""kortform"":""FV4524 S1D1 m163-522""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.11568015,""sluttposisjon"":0.12982024,""kortform"":""0.11568015-0.12982024@320684"",""veglenkenummer"":29,""startnode"":""2020686"",""sluttnode"":""348337"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-39705.7 6563164.38 8.306, -39714.3 6563168 8.206, -39739.7 6563178.3 8.206, -39764.7 6563188.7 8.006)"",""srid"":5973},""lengde"":63.818,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":522.338,""til_meter"":586.156,""retning"":""MED""},""kortform"":""FV4524 S1D1 m522-586""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.12982024,""sluttposisjon"":0.16180515,""kortform"":""0.12982024-0.16180515@320684"",""veglenkenummer"":6,""startnode"":""348337"",""sluttnode"":""348586"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-39764.7 6563188.7 8.006, -39797.7 6563202.6 7.906, -39824.3 6563213.4 7.606, -39850.2 6563224.2 7.506, -39872.1 6563232.8 7.306, -39898.2 6563243.6 7.106)"",""srid"":5973},""lengde"":144.0,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":586.156,""til_meter"":730.156,""retning"":""MED""},""kortform"":""FV4524 S1D1 m586-730""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.16180515,""sluttposisjon"":0.20055436,""kortform"":""0.16180515-0.20055436@320684"",""veglenkenummer"":7,""startnode"":""348586"",""sluttnode"":""348874"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-39898.2 6563243.6 7.106, -39933.7 6563258.1 6.606, -39952.7 6563266 6.405, -39972 6563274 6.205, -40008.7 6563289.1 6.005, -40029.9 6563297.7 6.005, -40059.9 6563310.2 5.905)"",""srid"":5973},""lengde"":175.0,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":730.156,""til_meter"":905.156,""retning"":""MED""},""kortform"":""FV4524 S1D1 m730-905""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.20055436,""sluttposisjon"":0.20804552,""kortform"":""0.20055436-0.20804552@320684"",""veglenkenummer"":8,""startnode"":""348874"",""sluttnode"":""2020688"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40059.9 6563310.2 5.905, -40085.7 6563320.8 5.805, -40091.22 6563322.93 5.805)"",""srid"":5973},""lengde"":33.77,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":905.156,""til_meter"":938.926,""retning"":""MED""},""kortform"":""FV4524 S1D1 m905-939""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.20804552,""sluttposisjon"":0.23760021,""kortform"":""0.20804552-0.23760021@320684"",""veglenkenummer"":30,""startnode"":""2020688"",""sluttnode"":""349122"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40091.22 6563322.93 5.805, -40106.4 6563329.4 5.805, -40127.3 6563338.4 5.805, -40147.9 6563346.7 5.805, -40170.6 6563356.1 5.905, -40191.7 6563364.7 6.005, -40214.4 6563374.1 6.105)"",""srid"":5973},""lengde"":133.39,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":938.926,""til_meter"":1072.316,""retning"":""MED""},""kortform"":""FV4524 S1D1 m939-1072""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.23760021,""sluttposisjon"":0.34520237,""kortform"":""0.23760021-0.34520237@320684"",""veglenkenummer"":9,""startnode"":""349122"",""sluttnode"":""349833"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40214.4 6563374.1 6.105, -40240 6563384.4 6.205, -40262.7 6563393.7 6.305, -40282.1 6563401.6 6.405, -40305.8 6563411.4 6.504, -40327.4 6563420.2 6.504, -40352.5 6563430.7 6.604, -40376 6563440.3 6.704, -40400.6 6563450.5 6.704, -40421.7 6563459.2 6.604, -40444.8 6563468.4 6.604, -40461.4 6563475.6 6.604, -40496.4 6563489.9 6.304, -40509.2 6563495.2 6.204, -40533.7 6563505.4 6.004, -40556.7 6563514.9 5.704, -40593.2 6563530.8 5.304, -40605.963 6563536.69 5.126, -40605.963 6563536.69 5.126, -40607.5 6563537.4 5.104, -40632 6563549.9 4.804, -40645 6563557.1 4.804, -40659.9 6563566.4 4.804)"",""srid"":5973},""lengde"":486.0,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":1072.316,""til_meter"":1558.316,""retning"":""MED""},""kortform"":""FV4524 S1D1 m1072-1558""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.34520237,""sluttposisjon"":0.37031206,""kortform"":""0.34520237-0.37031206@320684"",""veglenkenummer"":10,""startnode"":""349833"",""sluttnode"":""349994"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40659.9 6563566.4 4.804, -40684.7 6563583 5.003, -40709.9 6563602.9 4.903, -40720 6563612.1 4.803, -40725.506 6563617.698 4.834, -40725.506 6563617.698 4.834, -40737.9 6563630.3 4.903, -40746 6563639.4 4.903)"",""srid"":5973},""lengde"":113.0,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":1558.316,""til_meter"":1671.316,""retning"":""MED""},""kortform"":""FV4524 S1D1 m1558-1671""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/320684"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":320684,""startposisjon"":0.37031206,""sluttposisjon"":0.37498969,""kortform"":""0.37031206-0.37498969@320684"",""veglenkenummer"":11,""startnode"":""349994"",""sluttnode"":""2942433"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40746 6563639.4 4.903, -40757.72 6563653.53 5.143)"",""srid"":5973},""lengde"":18.36,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459111,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":1671.316,""til_meter"":1689.676,""retning"":""MED""},""kortform"":""FV4524 S1D1 m1671-1690""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/2829303"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":2829303,""startposisjon"":0.0,""sluttposisjon"":0.53105123,""kortform"":""0.0-0.53105123@2829303"",""veglenkenummer"":1,""startnode"":""2942433"",""sluttnode"":""3020658"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40757.72 6563653.53 5.143, -40759.89 6563656.37 5.173, -40763.23 6563660.75 5.213, -40768.34 6563667.46 5.263, -40769.29 6563668.74 5.273, -40771.6 6563672.02 5.303, -40773.79 6563675.38 5.333, -40775.83 6563678.84 5.373, -40777.74 6563682.36 5.423, -40779.5 6563685.98 5.493, -40781.11 6563689.65 5.563, -40782.02 6563691.89 5.613, -40782.335 6563692.743 5.628)"",""srid"":5973},""lengde"":46.517,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459112,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":1689.676,""til_meter"":1736.193,""retning"":""MED""},""kortform"":""FV4524 S1D1 m1690-1736""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/2829303"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":2829303,""startposisjon"":0.53105123,""sluttposisjon"":0.74946142,""kortform"":""0.53105123-0.74946142@2829303"",""veglenkenummer"":3,""startnode"":""3020658"",""sluttnode"":""2829334"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40782.335 6563692.743 5.628, -40783.27 6563695.27 5.673, -40783.78 6563696.79 5.703, -40784.65 6563699.57 5.763, -40785.06 6563701.01 5.783, -40785.58 6563702.9 5.823, -40785.98 6563704.44 5.853, -40786.24 6563705.42 5.873, -40786.76 6563707.39 5.903, -40787.26 6563709.35 5.943, -40787.417 6563709.945 5.955)"",""srid"":5973},""lengde"":17.951,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459112,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":1736.193,""til_meter"":1754.145,""retning"":""MED""},""kortform"":""FV4524 S1D1 m1736-1754""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/2829303"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":2829303,""startposisjon"":0.74946142,""sluttposisjon"":1.0,""kortform"":""0.74946142-1.0@2829303"",""veglenkenummer"":2,""startnode"":""2829334"",""sluttnode"":""2829355"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase"",""typeVeg"":""Kanalisert veg"",""typeVeg_sosi"":""kanalisertVeg"",""feltoversikt"":[""1"",""2""],""geometri"":{""wkt"":""LINESTRING Z(-40787.417 6563709.945 5.955, -40787.78 6563711.32 5.983, -40788.25 6563713.14 6.013, -40788.76 6563715.08 6.053, -40789.26 6563717.02 6.093, -40789.77 6563718.96 6.133, -40790.26 6563720.86 6.163, -40790.78 6563722.84 6.203, -40791.24 6563724.62 6.233, -40791.75 6563726.53 6.263, -40792.651 6563729.944 6.783)"",""srid"":5973},""lengde"":20.714,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151166,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459112,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":1754.145,""til_meter"":1774.859,""retning"":""MED""},""kortform"":""FV4524 S1D1 m1754-1775""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/2829307"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":2829307,""startposisjon"":0.78830758,""sluttposisjon"":0.88485326,""kortform"":""0.78830758-0.88485326@2829307"",""veglenkenummer"":11,""startnode"":""2829354"",""sluttnode"":""2829355"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""RundkjÃ¸ring"",""typeVeg_sosi"":""rundkjÃ¸ring"",""feltoversikt"":[""1""],""geometri"":{""wkt"":""LINESTRING Z(-40801.74 6563730.4 6.783, -40799.89 6563729.79 6.783, -40798.11 6563729.5 6.783, -40796.59 6563729.4 6.783, -40794.96 6563729.48 6.783, -40793.94 6563729.62 6.783, -40792.651 6563729.944 6.783)"",""srid"":5973},""lengde"":9.265,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151165,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459112,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""meter"":1774.859,""retning"":""MED""},""kryssystem"":{""id"":1004489128,""versjon"":1,""kryssystem"":1000,""kryssdel"":1,""fra_meter"":69.916,""til_meter"":79.181,""retning"":""MED"",""trafikantgruppe"":""K""},""kortform"":""FV4524 S1D1 m1775 KD1 m70-79""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/2829307"",""metadata"":{""startdato"":""2019-11-07""},""veglenkesekvensid"":2829307,""startposisjon"":0.76731209,""sluttposisjon"":0.78830758,""kortform"":""0.76731209-0.78830758@2829307"",""veglenkenummer"":10,""sluttnode"":""2829354"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""RundkjÃ¸ring"",""typeVeg_sosi"":""rundkjÃ¸ring"",""feltoversikt"":[""1""],""geometri"":{""wkt"":""POINT Z(-40801.74 6563730.4 6.783)"",""srid"":5973},""lengde"":1.629,""fylke"":11,""kommune"":1124,""vegsystemreferanse"":{""vegsystem"":{""id"":1002151165,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":4524},""strekning"":{""id"":1003459112,""versjon"":1,""strekning"":1,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""meter"":1774.859,""retning"":""MED""},""kryssystem"":{""id"":1004489128,""versjon"":1,""kryssystem"":1000,""kryssdel"":1,""fra_meter"":68.287,""til_meter"":69.916,""retning"":""MED"",""trafikantgruppe"":""K""},""kortform"":""FV4524 S1D1 m1775 KD1 m68-70""},""kontraktsomrÃ¥der"":[{""id"":587871979,""nummer"":1103,""navn"":""1103 Stavanger 2017-2022""},{""id"":642925409,""nummer"":1153,""navn"":""1153 SÃ¸r Rogaland 2018-2023""},{""id"":1009569601,""nummer"":1103,""navn"":""1103 Stavanger 2021-2026""}],""riksvegruter"":[]}],""metadata"":{""antall"":14,""lengde"":1622.643,""status"":2000,""status_tekst"":""KOMPLETT""}}
{noformat}
",NVDB-6937,Les-API,
Ã…pne endringslogg direkte i Vegkart,"-Endringsloggen er ikkje oppdatert pÃ¥ GitHub. Vi linkar no til den frÃ¥ vegdata.no, og den bÃ¸r dÃ¥ vÃ¦re oppdatert.-
Legg til url-flagg for Vegkart slik at endringsloggen vises. Endre https://github.com/nvdb-vegdata/endringslogg/blob/master/vegkart.md til Ã¥ peke pÃ¥ vegkart#endringslogg.",NVDB-6937,Vegkart,
Bruk veg ved automatisk stedfesting med Skriv selv om fase ikke er satt,"Endringer i Skriv i NVDB-6023 gjÃ¸r at ""fase"" for veg ikke lengre er obligatorisk, sÃ¥ vi kan sende inn kun vegkategori og vegnummer ved automatisk stedfesting.
Hvis jeg forstÃ¥r Tore riktig sÃ¥ gir det ogsÃ¥ mening Ã¥ sende inn vegkategori hvis ingen av de andre er satt, men vegkategori er pÃ¥krevd hvis en av de andre to er satt.",NVDB-6937,Datafangst,
Segmetering av vegnett og Gate,Segmenter vegnett basert pÃ¥ Gate(538) i tillegg til KontraktsomrÃ¥de og Riksvegrute,NVDB-6937,NVDB-IND,
Sikre minimumslengde pÃ¥ strekningsstedfesting pÃ¥ en mer effektiv mÃ¥te,"h2. Bakgrunn

Stedfestingstjenesten til API Skriv skal sikret at en strekningsstedfesting basert pÃ¥ rute fra API Les har minimumslengde (p.t. 1 m). Dette gjÃ¸res i dag ved Ã¥ blÃ¥se opp den opprinnelige geometrien (Geometry.buffer() i JTS) og beregne rute pÃ¥ nytt. Dette gjentas inntil ruten har minimumslengde. Ved oppblÃ¥sing blir imidlertid en LINESTRING-geometri til en POLYGON-geometri med svÃ¦rt mange punkter, noe som drastisk Ã¸ker responstiden. 

Mekanismen for Ã¥ sikre minimumslengde bÃ¸r justeres. Ting Ã¥ vurdere:

1) Angi parameter til Geometry.buffer() for Ã¥ redusere antall punkter i den oppblÃ¥ste geometrien.
2) KjÃ¸re Douglas-Peucker fÃ¸r reberegning av rute.
3) Reimplementere ved Ã¥ utvide stedfestingen langs vegnettet selv.",NVDB-6937,Skriv-API,
"Systemfeil pga for mange listeelementer i ""IN""-uttrykk i SQL","h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/6602ec76-cd81-4277-96d9-4a9f5e7c51cd (og https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/6602ec76-cd81-4277-96d9-4a9f5e7c51cd) havarerer med systemfeil:

{code:java}
no.vegvesen.vt.nvdb.apiskriv.api.FaultException: java.sql.SQLSyntaxErrorException: ORA-01795: maximum number of expressions in a list is 1000

	at no.vegvesen.vt.nvdb.apiskriv.nvdbrepository.JdbcFeatureRepository.getFeatureVersions(JdbcFeatureRepository.java:283)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.JobFilter$Context.getFeaturesFromNvdb(JobFilter.java:223)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.ReadMissingParentFeaturesEnricherFilter.lambda$null$6(ReadMissingParentFeaturesEnricherFilter.java:166)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.ReadMissingParentFeaturesEnricherFilter.lambda$getCoParentFeaturesFromNvdb$7(ReadMissingParentFeaturesEnricherFilter.java:145)
	at java.util.ArrayList.forEach(ArrayList.java:1257)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.ReadMissingParentFeaturesEnricherFilter.getCoParentFeaturesFromNvdb(ReadMissingParentFeaturesEnricherFilter.java:141)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.ReadMissingParentFeaturesEnricherFilter.getMissingCoParentFeatures(ReadMissingParentFeaturesEnricherFilter.java:96)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.ReadMissingParentFeaturesEnricherFilter.doFilter(ReadMissingParentFeaturesEnricherFilter.java:58)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:117)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:455)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:177)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:54)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:145)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

SQL-setningen som forÃ¥rsaken feilen:

{code:sql}
with UNIQUE_FEATURE_VERSIONS as (
  select distinct
    f.feature.persistentid FID,
    fv.featureversion.versionid VID
  from
    nvdb.features_0086 f,
    table(f.featureversions) fv,
    table(fv.list_220026.attrs_200026) laa
  where
    laa.attr_200026.fid in (1006715834,1006715833,1006717326,1006717325,1006717324,1006717323,1006717322,1006717321,1006717320,1006717319,1006717318,1006717383,1006717382,1006717380,1006717379,1006717378,1006717377,1006717376,1006717375,1006717374,1006717373,1006717372,1006717371,1006717370,1006717369,1006717368,1006717367,1006717366,1006717365,1006717364,1006717363,1006717362,1006717361,1006717360,1006717359,1006717358,1006717357,1006717356,1006717355,1006717354,1006717353,1006717352,1006717351,1006717350,1006717349,1006717348,1006717347,1006717346,1006717345,1006717344,1006717343,1006717342,1006717341,1006717340,1006717339,1006717338,1006717337,1006717336,1006717335,1006717334,1006717333,1006717332,1006717331,1006717330,1006717329,1006717328,1006717327,1006717290,1006717289,1006717288,1006717287,1006717286,1006717285,1006717284,1006717283,1006717282,1006717281,1006717280,1006717279,1006717278,1006717277,1006717276,1006717275,1006717274,1006717273,1006717272,1006717271,1006717270,1006717269,1006717268,1006717267,1006717266,1006717265,1006717264,1006717263,1006717262,1006717261,1006717260,1006717259,1006717258,1006717257,1006717256,1006717255,1006717254,1006717253,1006717252,1006717251,1006717250,1006717249,1006717248,1006717247,1006717246,1006717245,1006717244,1006717243,1006717242,1006717241,1006717240,1006717239,1006717238,1006717237,1006717236,1006717235,1006717234,1006717233,1006717232,1006717231,1006717230,1006717229,1006717228,1006717227,1006717226,1006717225,1006717224,1006717223,1006717222,1006717221,1006717220,1006717219,1006717218,1006717217,1006717216,1006717215,1006717214,1006717213,1006717212,1006717211,1006717210,1006717209,1006717208,1006717207,1006717206,1006717205,1006717204,1006717203,1006717202,1006717201,1006717200,1006717199,1006717198,1006717197,1006717196,1006717195,1006717194,1006717193,1006717192,1006717191,1006717190,1006717189,1006717188,1006717187,1006717186,1006717185,1006717184,1006717183,1006717182,1006717181,1006717180,1006717179,1006717178,1006717177,1006717176,1006717175,1006717174,1006717173,1006717172,1006717171,1006717170,1006717169,1006717168,1006717167,1006717166,1006717165,1006717164,1006717163,1006717162,1006717161,1006717160,1006717159,1006717158,1006717157,1006717156,1006717155,1006717154,1006717153,1006717152,1006717151,1006717150,1006717317,1006717316,1006717315,1006717314,1006717313,1006717312,1006717311,1006717310,1006717309,1006717308,1006717307,1006717306,1006717305,1006717304,1006717303,1006717302,1006717301,1006717300,1006717299,1006717298,1006717297,1006717296,1006717295,1006717294,1006717293,1006717292,1006717291,1006717047,1006717046,1006717045,1006717044,1006717043,1006717042,1006717041,1006717040,1006717039,1006717038,1006717037,1006717036,1006717035,1006717034,1006717033,1006717032,1006717031,1006717030,1006717029,1006717028,1006717027,1006717026,1006717025,1006717024,1006717023,1006717022,1006717021,1006717020,1006717019,1006717018,1006717017,1006717016,1006717015,1006717014,1006717013,1006717012,1006717011,1006717010,1006717009,1006717008,1006717007,1006717006,1006717005,1006717004,1006717003,1006717002,1006717001,1006717000,1006717149,1006717148,1006717147,1006717146,1006717145,1006717144,1006717143,1006717142,1006717141,1006717140,1006717139,1006717138,1006717137,1006717136,1006717135,1006717134,1006717133,1006717132,1006717131,1006717130,1006717129,1006717128,1006717127,1006717126,1006717125,1006717124,1006717123,1006717122,1006717121,1006717120,1006717119,1006717118,1006717117,1006717116,1006717115,1006717114,1006717113,1006717112,1006717111,1006717110,1006717109,1006717108,1006717107,1006717106,1006717105,1006717104,1006717103,1006717102,1006717101,1006717100,1006717099,1006717098,1006717097,1006717096,1006717095,1006717094,1006717093,1006717092,1006717091,1006717090,1006717089,1006717088,1006717087,1006717086,1006717085,1006717084,1006717083,1006717082,1006717081,1006717080,1006717079,1006717078,1006717077,1006717076,1006717075,1006717074,1006717073,1006717072,1006717071,1006717070,1006717069,1006717068,1006717067,1006717066,1006717065,1006717064,1006717063,1006717062,1006717061,1006717060,1006717059,1006717058,1006717057,1006717056,1006717055,1006717054,1006717053,1006717052,1006717051,1006717050,1006717049,1006717048,1006716999,1006716998,1006716997,1006716996,1006716995,1006716994,1006716993,1006716992,1006716991,1006716990,1006716989,1006716988,1006716987,1006716986,1006716985,1006716984,1006716983,1006716982,1006716981,1006716980,1006716979,1006716978,1006716977,1006716976,1006716975,1006716974,1006716973,1006716972,1006716971,1006716970,1006716969,1006716968,1006716967,1006716966,1006716965,1006716964,1006716963,1006716962,1006716961,1006716960,1006716959,1006716958,1006716957,1006716956,1006716955,1006716954,1006716953,1006716952,1006716951,1006716950,1006716949,1006716948,1006716947,1006716946,1006716945,1006716944,1006716943,1006716942,1006716941,1006716940,1006716939,1006716938,1006716937,1006716936,1006716935,1006716934,1006716933,1006716932,1006716931,1006716930,1006716929,1006716928,1006716927,1006716926,1006716925,1006716924,1006716923,1006716922,1006716921,1006716920,1006716919,1006716918,1006716917,1006716916,1006716915,1006716914,1006716913,1006716912,1006716911,1006716910,1006716909,1006716908,1006716907,1006716906,1006716905,1006716904,1006716903,1006716902,1006716901,1006716900,1006716899,1006716898,1006716897,1006716896,1006716895,1006716894,1006716893,1006716892,1006716891,1006716890,1006716889,1006716888,1006716887,1006716886,1006716885,1006716884,1006716883,1006716882,1006716881,1006716880,1006716879,1006716878,1006716877,1006716876,1006716875,1006716874,1006716873,1006716872,1006716871,1006716870,1006716869,1006716868,1006716867,1006716866,1006716865,1006716864,1006716863,1006716862,1006716861,1006716860,1006716859,1006716858,1006716857,1006716856,1006716855,1006716854,1006716853,1006716852,1006716851,1006716850,1006716849,1006716848,1006716847,1006716846,1006716845,1006716844,1006716843,1006716842,1006716841,1006716840,1006716839,1006716838,1006716837,1006716836,1006716835,1006716834,1006716833,1006716832,1006716831,1006716830,1006716829,1006716828,1006716827,1006716826,1006716825,1006716824,1006716823,1006716822,1006716821,1006716820,1006716819,1006716818,1006716817,1006716816,1006716815,1006716814,1006716813,1006716812,1006716811,1006716810,1006716809,1006716808,1006716807,1006716806,1006716805,1006716804,1006716803,1006716802,1006716801,1006716800,1006716799,1006716798,1006716797,1006716796,1006716795,1006716794,1006716793,1006716792,1006716791,1006716790,1006716789,1006716788,1006716787,1006716786,1006716785,1006716784,1006716783,1006716782,1006716781,1006716780,1006716779,1006716778,1006716777,1006716776,1006716775,1006716774,1006716773,1006716772,1006716771,1006716770,1006716769,1006716768,1006716767,1006716766,1006716765,1006716764,1006716763,1006716762,1006716761,1006716760,1006716759,1006716758,1006716757,1006716756,1006716755,1006716754,1006716753,1006716752,1006716751,1006716750,1006716749,1006716748,1006716747,1006716746,1006716745,1006716744,1006716743,1006716742,1006716741,1006716740,1006716739,1006716738,1006716737,1006716736,1006716735,1006716734,1006716733,1006716732,1006716731,1006716730,1006716729,1006716728,1006716727,1006716726,1006716725,1006716724,1006716723,1006716722,1006716721,1006716720,1006716719,1006716718,1006716717,1006716716,1006716715,1006716714,1006716713,1006716712,1006716711,1006716710,1006716709,1006716708,1006716707,1006716706,1006716705,1006716704,1006716703,1006716702,1006716701,1006716700,1006716699,1006716698,1006716697,1006716696,1006716695,1006716694,1006716693,1006716692,1006716691,1006716690,1006716689,1006716688,1006716687,1006716686,1006716685,1006716684,1006716683,1006716682,1006716681,1006716680,1006716679,1006716678,1006716677,1006716676,1006716675,1006716674,1006716673,1006716672,1006716671,1006716670,1006716669,1006716668,1006716667,1006716666,1006716665,1006716664,1006716663,1006716662,1006716661,1006716660,1006716659,1006716658,1006716657,1006716656,1006716655,1006716654,1006716653,1006716652,1006716651,1006716650,1006716649,1006716648,1006716647,1006716646,1006716645,1006716644,1006716643,1006716642,1006716641,1006716640,1006716639,1006716638,1006716637,1006716636,1006716635,1006716634,1006716633,1006716632,1006716631,1006716630,1006716629,1006716628,1006716627,1006716626,1006716625,1006716624,1006716623,1006716622,1006716621,1006716620,1006716619,1006716618,1006716617,1006716616,1006716615,1006716614,1006716613,1006716612,1006716611,1006716610,1006716609,1006716608,1006716607,1006716606,1006716605,1006716604,1006716603,1006716602,1006716601,1006716600,1006716599,1006716598,1006716597,1006716596,1006716595,1006716594,1006716593,1006716592,1006716591,1006716590,1006716589,1006716588,1006716587,1006716586,1006716585,1006716584,1006716583,1006716582,1006716581,1006716580,1006716579,1006716578,1006716577,1006716576,1006716575,1006716574,1006716573,1006716572,1006716571,1006716570,1006716569,1006716568,1006716567,1006716566,1006716565,1006716564,1006716563,1006716562,1006716561,1006716560,1006716559,1006716558,1006716557,1006716556,1006716555,1006716554,1006716553,1006716552,1006716551,1006716550,1006716549,1006716548,1006716547,1006716546,1006716545,1006716544,1006716543,1006716542,1006716541,1006716540,1006716539,1006716538,1006716537,1006716536,1006716535,1006716534,1006716533,1006716532,1006716531,1006716530,1006716529,1006716528,1006716527,1006716526,1006716525,1006716524,1006716523,1006716522,1006716521,1006716520,1006716519,1006716518,1006716517,1006716516,1006716515,1006716514,1006716513,1006716512,1006716511,1006716510,1006716509,1006716508,1006716507,1006716506,1006716505,1006716504,1006716503,1006716502,1006716501,1006716500,1006716499,1006716498,1006716497,1006716496,1006716495,1006716494,1006716493,1006716492,1006716491,1006716490,1006716489,1006716488,1006716487,1006716238,1006716237,1006716236,1006716235,1006716234,1006716233,1006716232,1006716231,1006716230,1006716229,1006716228,1006716227,1006716226,1006716225,1006716224,1006716223,1006716222,1006716221,1006716220,1006716219,1006716218,1006716217,1006716216,1006716486,1006716485,1006716484,1006716483,1006716482,1006716481,1006716480,1006716479,1006716478,1006716477,1006716476,1006716475,1006716474,1006716473,1006716472,1006716471,1006716470,1006716469,1006716468,1006716467,1006716466,1006716465,1006716464,1006716463,1006716462,1006716461,1006716460,1006716459,1006716458,1006716457,1006716456,1006716455,1006716454,1006716453,1006716452,1006716451,1006716258,1006716257,1006716256,1006716255,1006716254,1006716253,1006716252,1006716251,1006716250,1006716249,1006716248,1006716247,1006716246,1006716245,1006716244,1006716243,1006716242,1006716241,1006716240,1006716239,1006716215,1006716214,1006716213,1006716212,1006716211,1006716210,1006716209,1006716208,1006716207,1006716206,1006716205,1006716204,1006716203,1006716202,1006716201,1006716200,1006716199,1006716198,1006716197,1006716196,1006716195,1006716194,1006716193,1006716192,1006716191,1006716190,1006716189,1006716188,1006716187,1006716186,1006716185,1006716184,1006716183,1006716182,1006716181,1006716180,1006716179,1006716178,1006716177,1006716176,1006716175,1006716174,1006716173,1006716172,1006716171,1006716170,1006716169,1006716168,1006716167,1006716166,1006716165,1006716164,1006716163,1006716162,1006716161,1006716160,1006716159,1006716158,1006716157,1006716156,1006716155,1006716154,1006716153,1006716152,1006716151,1006716150,1006716149,1006716148,1006716147,1006716146,1006716145,1006716144,1006716143,1006716142,1006716141,1006716140,1006716139,1006716138,1006716137,1006716136,1006716135,1006716134,1006716133,1006716132,1006716131,1006716130,1006716129,1006716128,1006716127,1006716126,1006716125,1006716124,1006716123,1006716122,1006716121,1006716120,1006716119,1006716118,1006716117,1006716116,1006716115,1006716114,1006716113,1006716112,1006716111,1006716110,1006716109,1006716108,1006716107,1006716106,1006716105,1006716104,1006716103,1006716102,1006716101,1006716100,1006716099,1006716098,1006716097,1006716096,1006716095,1006716094,1006716093,1006716092,1006716091,1006716090,1006716089,1006716088,1006716087,1006716086,1006716085,1006716084,1006716083,1006716082,1006716081,1006716080,1006716079,1006716078,1006716077,1006716076,1006716075,1006716074,1006716073,1006716072,1006716071,1006716070,1006716069,1006716068,1006716067)
    and (fv.featureversion.enddate is null or fv.featureversion.enddate > to_date('2020-10-15', 'yyyy-mm-dd'))
)
select
  f.feature.persistentid FID,
  fv.featureversion.versionid VID,
  fv.featureversion.startdate SDATE,
  fv.featureversion.enddate EDATE,
  fv.list_120086.attrs_100086 LIST_120086,
  fv.list_220026.attrs_200026 LIST_220026,
  fv.list_221440.attrs_201440 LIST_221440,
  fv.list_220558.attrs_200558 LIST_220558,
  fv.list_220246.attrs_200246 LIST_220246
from
  nvdb.features_0086 f,
  table(f.featureversions) fv,
  UNIQUE_FEATURE_VERSIONS ufv
where
  ufv.FID = f.feature.persistentid
  and ufv.VID = fv.featureversion.versionid
order by
  FID,
  VID, OriginalSql = with UNIQUE_FEATURE_VERSIONS as (
  select distinct
    f.feature.persistentid FID,
    fv.featureversion.versionid VID
  from
    nvdb.features_0086 f,
    table(f.featureversions) fv,
    table(fv.list_220026.attrs_200026) laa
  where
    laa.attr_200026.fid in (1006715834,1006715833,1006717326,1006717325,1006717324,1006717323,1006717322,1006717321,1006717320,1006717319,1006717318,1006717383,1006717382,1006717380,1006717379,1006717378,1006717377,1006717376,1006717375,1006717374,1006717373,1006717372,1006717371,1006717370,1006717369,1006717368,1006717367,1006717366,1006717365,1006717364,1006717363,1006717362,1006717361,1006717360,1006717359,1006717358,1006717357,1006717356,1006717355,1006717354,1006717353,1006717352,1006717351,1006717350,1006717349,1006717348,1006717347,1006717346,1006717345,1006717344,1006717343,1006717342,1006717341,1006717340,1006717339,1006717338,1006717337,1006717336,1006717335,1006717334,1006717333,1006717332,1006717331,1006717330,1006717329,1006717328,1006717327,1006717290,1006717289,1006717288,1006717287,1006717286,1006717285,1006717284,1006717283,1006717282,1006717281,1006717280,1006717279,1006717278,1006717277,1006717276,1006717275,1006717274,1006717273,1006717272,1006717271,1006717270,1006717269,1006717268,1006717267,1006717266,1006717265,1006717264,1006717263,1006717262,1006717261,1006717260,1006717259,1006717258,1006717257,1006717256,1006717255,1006717254,1006717253,1006717252,1006717251,1006717250,1006717249,1006717248,1006717247,1006717246,1006717245,1006717244,1006717243,1006717242,1006717241,1006717240,1006717239,1006717238,1006717237,1006717236,1006717235,1006717234,1006717233,1006717232,1006717231,1006717230,1006717229,1006717228,1006717227,1006717226,1006717225,1006717224,1006717223,1006717222,1006717221,1006717220,1006717219,1006717218,1006717217,1006717216,1006717215,1006717214,1006717213,1006717212,1006717211,1006717210,1006717209,1006717208,1006717207,1006717206,1006717205,1006717204,1006717203,1006717202,1006717201,1006717200,1006717199,1006717198,1006717197,1006717196,1006717195,1006717194,1006717193,1006717192,1006717191,1006717190,1006717189,1006717188,1006717187,1006717186,1006717185,1006717184,1006717183,1006717182,1006717181,1006717180,1006717179,1006717178,1006717177,1006717176,1006717175,1006717174,1006717173,1006717172,1006717171,1006717170,1006717169,1006717168,1006717167,1006717166,1006717165,1006717164,1006717163,1006717162,1006717161,1006717160,1006717159,1006717158,1006717157,1006717156,1006717155,1006717154,1006717153,1006717152,1006717151,1006717150,1006717317,1006717316,1006717315,1006717314,1006717313,1006717312,1006717311,1006717310,1006717309,1006717308,1006717307,1006717306,1006717305,1006717304,1006717303,1006717302,1006717301,1006717300,1006717299,1006717298,1006717297,1006717296,1006717295,1006717294,1006717293,1006717292,1006717291,1006717047,1006717046,1006717045,1006717044,1006717043,1006717042,1006717041,1006717040,1006717039,1006717038,1006717037,1006717036,1006717035,1006717034,1006717033,1006717032,1006717031,1006717030,1006717029,1006717028,1006717027,1006717026,1006717025,1006717024,1006717023,1006717022,1006717021,1006717020,1006717019,1006717018,1006717017,1006717016,1006717015,1006717014,1006717013,1006717012,1006717011,1006717010,1006717009,1006717008,1006717007,1006717006,1006717005,1006717004,1006717003,1006717002,1006717001,1006717000,1006717149,1006717148,1006717147,1006717146,1006717145,1006717144,1006717143,1006717142,1006717141,1006717140,1006717139,1006717138,1006717137,1006717136,1006717135,1006717134,1006717133,1006717132,1006717131,1006717130,1006717129,1006717128,1006717127,1006717126,1006717125,1006717124,1006717123,1006717122,1006717121,1006717120,1006717119,1006717118,1006717117,1006717116,1006717115,1006717114,1006717113,1006717112,1006717111,1006717110,1006717109,1006717108,1006717107,1006717106,1006717105,1006717104,1006717103,1006717102,1006717101,1006717100,1006717099,1006717098,1006717097,1006717096,1006717095,1006717094,1006717093,1006717092,1006717091,1006717090,1006717089,1006717088,1006717087,1006717086,1006717085,1006717084,1006717083,1006717082,1006717081,1006717080,1006717079,1006717078,1006717077,1006717076,1006717075,1006717074,1006717073,1006717072,1006717071,1006717070,1006717069,1006717068,1006717067,1006717066,1006717065,1006717064,1006717063,1006717062,1006717061,1006717060,1006717059,1006717058,1006717057,1006717056,1006717055,1006717054,1006717053,1006717052,1006717051,1006717050,1006717049,1006717048,1006716999,1006716998,1006716997,1006716996,1006716995,1006716994,1006716993,1006716992,1006716991,1006716990,1006716989,1006716988,1006716987,1006716986,1006716985,1006716984,1006716983,1006716982,1006716981,1006716980,1006716979,1006716978,1006716977,1006716976,1006716975,1006716974,1006716973,1006716972,1006716971,1006716970,1006716969,1006716968,1006716967,1006716966,1006716965,1006716964,1006716963,1006716962,1006716961,1006716960,1006716959,1006716958,1006716957,1006716956,1006716955,1006716954,1006716953,1006716952,1006716951,1006716950,1006716949,1006716948,1006716947,1006716946,1006716945,1006716944,1006716943,1006716942,1006716941,1006716940,1006716939,1006716938,1006716937,1006716936,1006716935,1006716934,1006716933,1006716932,1006716931,1006716930,1006716929,1006716928,1006716927,1006716926,1006716925,1006716924,1006716923,1006716922,1006716921,1006716920,1006716919,1006716918,1006716917,1006716916,1006716915,1006716914,1006716913,1006716912,1006716911,1006716910,1006716909,1006716908,1006716907,1006716906,1006716905,1006716904,1006716903,1006716902,1006716901,1006716900,1006716899,1006716898,1006716897,1006716896,1006716895,1006716894,1006716893,1006716892,1006716891,1006716890,1006716889,1006716888,1006716887,1006716886,1006716885,1006716884,1006716883,1006716882,1006716881,1006716880,1006716879,1006716878,1006716877,1006716876,1006716875,1006716874,1006716873,1006716872,1006716871,1006716870,1006716869,1006716868,1006716867,1006716866,1006716865,1006716864,1006716863,1006716862,1006716861,1006716860,1006716859,1006716858,1006716857,1006716856,1006716855,1006716854,1006716853,1006716852,1006716851,1006716850,1006716849,1006716848,1006716847,1006716846,1006716845,1006716844,1006716843,1006716842,1006716841,1006716840,1006716839,1006716838,1006716837,1006716836,1006716835,1006716834,1006716833,1006716832,1006716831,1006716830,1006716829,1006716828,1006716827,1006716826,1006716825,1006716824,1006716823,1006716822,1006716821,1006716820,1006716819,1006716818,1006716817,1006716816,1006716815,1006716814,1006716813,1006716812,1006716811,1006716810,1006716809,1006716808,1006716807,1006716806,1006716805,1006716804,1006716803,1006716802,1006716801,1006716800,1006716799,1006716798,1006716797,1006716796,1006716795,1006716794,1006716793,1006716792,1006716791,1006716790,1006716789,1006716788,1006716787,1006716786,1006716785,1006716784,1006716783,1006716782,1006716781,1006716780,1006716779,1006716778,1006716777,1006716776,1006716775,1006716774,1006716773,1006716772,1006716771,1006716770,1006716769,1006716768,1006716767,1006716766,1006716765,1006716764,1006716763,1006716762,1006716761,1006716760,1006716759,1006716758,1006716757,1006716756,1006716755,1006716754,1006716753,1006716752,1006716751,1006716750,1006716749,1006716748,1006716747,1006716746,1006716745,1006716744,1006716743,1006716742,1006716741,1006716740,1006716739,1006716738,1006716737,1006716736,1006716735,1006716734,1006716733,1006716732,1006716731,1006716730,1006716729,1006716728,1006716727,1006716726,1006716725,1006716724,1006716723,1006716722,1006716721,1006716720,1006716719,1006716718,1006716717,1006716716,1006716715,1006716714,1006716713,1006716712,1006716711,1006716710,1006716709,1006716708,1006716707,1006716706,1006716705,1006716704,1006716703,1006716702,1006716701,1006716700,1006716699,1006716698,1006716697,1006716696,1006716695,1006716694,1006716693,1006716692,1006716691,1006716690,1006716689,1006716688,1006716687,1006716686,1006716685,1006716684,1006716683,1006716682,1006716681,1006716680,1006716679,1006716678,1006716677,1006716676,1006716675,1006716674,1006716673,1006716672,1006716671,1006716670,1006716669,1006716668,1006716667,1006716666,1006716665,1006716664,1006716663,1006716662,1006716661,1006716660,1006716659,1006716658,1006716657,1006716656,1006716655,1006716654,1006716653,1006716652,1006716651,1006716650,1006716649,1006716648,1006716647,1006716646,1006716645,1006716644,1006716643,1006716642,1006716641,1006716640,1006716639,1006716638,1006716637,1006716636,1006716635,1006716634,1006716633,1006716632,1006716631,1006716630,1006716629,1006716628,1006716627,1006716626,1006716625,1006716624,1006716623,1006716622,1006716621,1006716620,1006716619,1006716618,1006716617,1006716616,1006716615,1006716614,1006716613,1006716612,1006716611,1006716610,1006716609,1006716608,1006716607,1006716606,1006716605,1006716604,1006716603,1006716602,1006716601,1006716600,1006716599,1006716598,1006716597,1006716596,1006716595,1006716594,1006716593,1006716592,1006716591,1006716590,1006716589,1006716588,1006716587,1006716586,1006716585,1006716584,1006716583,1006716582,1006716581,1006716580,1006716579,1006716578,1006716577,1006716576,1006716575,1006716574,1006716573,1006716572,1006716571,1006716570,1006716569,1006716568,1006716567,1006716566,1006716565,1006716564,1006716563,1006716562,1006716561,1006716560,1006716559,1006716558,1006716557,1006716556,1006716555,1006716554,1006716553,1006716552,1006716551,1006716550,1006716549,1006716548,1006716547,1006716546,1006716545,1006716544,1006716543,1006716542,1006716541,1006716540,1006716539,1006716538,1006716537,1006716536,1006716535,1006716534,1006716533,1006716532,1006716531,1006716530,1006716529,1006716528,1006716527,1006716526,1006716525,1006716524,1006716523,1006716522,1006716521,1006716520,1006716519,1006716518,1006716517,1006716516,1006716515,1006716514,1006716513,1006716512,1006716511,1006716510,1006716509,1006716508,1006716507,1006716506,1006716505,1006716504,1006716503,1006716502,1006716501,1006716500,1006716499,1006716498,1006716497,1006716496,1006716495,1006716494,1006716493,1006716492,1006716491,1006716490,1006716489,1006716488,1006716487,1006716238,1006716237,1006716236,1006716235,1006716234,1006716233,1006716232,1006716231,1006716230,1006716229,1006716228,1006716227,1006716226,1006716225,1006716224,1006716223,1006716222,1006716221,1006716220,1006716219,1006716218,1006716217,1006716216,1006716486,1006716485,1006716484,1006716483,1006716482,1006716481,1006716480,1006716479,1006716478,1006716477,1006716476,1006716475,1006716474,1006716473,1006716472,1006716471,1006716470,1006716469,1006716468,1006716467,1006716466,1006716465,1006716464,1006716463,1006716462,1006716461,1006716460,1006716459,1006716458,1006716457,1006716456,1006716455,1006716454,1006716453,1006716452,1006716451,1006716258,1006716257,1006716256,1006716255,1006716254,1006716253,1006716252,1006716251,1006716250,1006716249,1006716248,1006716247,1006716246,1006716245,1006716244,1006716243,1006716242,1006716241,1006716240,1006716239,1006716215,1006716214,1006716213,1006716212,1006716211,1006716210,1006716209,1006716208,1006716207,1006716206,1006716205,1006716204,1006716203,1006716202,1006716201,1006716200,1006716199,1006716198,1006716197,1006716196,1006716195,1006716194,1006716193,1006716192,1006716191,1006716190,1006716189,1006716188,1006716187,1006716186,1006716185,1006716184,1006716183,1006716182,1006716181,1006716180,1006716179,1006716178,1006716177,1006716176,1006716175,1006716174,1006716173,1006716172,1006716171,1006716170,1006716169,1006716168,1006716167,1006716166,1006716165,1006716164,1006716163,1006716162,1006716161,1006716160,1006716159,1006716158,1006716157,1006716156,1006716155,1006716154,1006716153,1006716152,1006716151,1006716150,1006716149,1006716148,1006716147,1006716146,1006716145,1006716144,1006716143,1006716142,1006716141,1006716140,1006716139,1006716138,1006716137,1006716136,1006716135,1006716134,1006716133,1006716132,1006716131,1006716130,1006716129,1006716128,1006716127,1006716126,1006716125,1006716124,1006716123,1006716122,1006716121,1006716120,1006716119,1006716118,1006716117,1006716116,1006716115,1006716114,1006716113,1006716112,1006716111,1006716110,1006716109,1006716108,1006716107,1006716106,1006716105,1006716104,1006716103,1006716102,1006716101,1006716100,1006716099,1006716098,1006716097,1006716096,1006716095,1006716094,1006716093,1006716092,1006716091,1006716090,1006716089,1006716088,1006716087,1006716086,1006716085,1006716084,1006716083,1006716082,1006716081,1006716080,1006716079,1006716078,1006716077,1006716076,1006716075,1006716074,1006716073,1006716072,1006716071,1006716070,1006716069,1006716068,1006716067)
    and (fv.featureversion.enddate is null or fv.featureversion.enddate > to_date('2020-10-15', 'yyyy-mm-dd'))
)
select
  f.feature.persistentid FID,
  fv.featureversion.versionid VID,
  fv.featureversion.startdate SDATE,
  fv.featureversion.enddate EDATE,
  fv.list_120086.attrs_100086 LIST_120086,
  fv.list_220026.attrs_200026 LIST_220026,
  fv.list_221440.attrs_201440 LIST_221440,
  fv.list_220558.attrs_200558 LIST_220558,
  fv.list_220246.attrs_200246 LIST_220246
from
  nvdb.features_0086 f,
  table(f.featureversions) fv,
  UNIQUE_FEATURE_VERSIONS ufv
where
  ufv.FID = f.feature.persistentid
  and ufv.VID = fv.featureversion.versionid
order by
  FID,
  VID
{code}

Situasjonen oppstÃ¥r i ReadMissingParentFeaturesEnricherFilter som skal berike jobben med relevante morobjekter til vegobjekte i jobben. FeatureSpecification sin ChildHavingId-kriterium brukes for Ã¥ finne vegobjekter med assosiasjon til aktuelle datterobjekter, men antallet datterobjekter er stÃ¸rre enn 1000, slik at SQL-uttrykket fÃ¥r en IN-klausul med mer enn 1000 verdier, hvilket ikke er tillatt i Oracle.

h2. LÃ¸sning

Etablerer partisjonering av FeatureSpecification pÃ¥ assosiasjonsverdi slik som vi allerede har for instansverdier. Dette realiseres med ny metode partition() pÃ¥ AssociationCriterion, som gjen brukes av ny metode partitionForOracleSql() pÃ¥ FeatureSpecification.",NVDB-6937,Skriv-API,
Assosiasjon: hÃ¥ndterer ikke NVDB-mors versjoner,"*Problem*

Datafangst sender oppdatering pÃ¥ NVDB-mor som ikke lenger har kobling til NVDB-datter i siste versjon, men som Datafangst ikke vet noe om.

*Diskusjon pÃ¥ Mattermost*

Jeg importer et nytt skiltpunkt, kobler til en NVDB-datter og forsÃ¸ker Ã¥ registrere. Da fÃ¥r jeg opp feilmld fra Skriv 1007893667: _Fjernet verdi 1007893666 finnes ikke i egenskapen_

Dette skjÃ¸nner jeg godt hvis jeg slÃ¥r opp denne NVDB-mora (1007893667) som fra DF sin side er mor til NVDB-datter som skal flyttes til nytt skiltpunkt. For siste versjon av denne NVDB-mora har ikke relasjon til NVDB-datter lengre, men forrige versjon har dette.
 * Siste versjon av NVDB-mor (har ikke ass til aktuell datter): [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/95/1007893667/4]
 * Forrige versjon av NVDB-mor (har ass til aktuell datter): [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/95/1007893667/3]
 * Siste versjon av NVDB-datter (som fortsatt har 1007893667 som mor): [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/96/1007893666/1]

DF-kontrakt: [https://datafangst-utv.kantega.no/#!/contract/b3c2dbe7-4e6a-4f83-ba62-72c564e32e7a/export]

Jeg tror at vi ved henting av NVDB-datter ved assosiasjon sÃ¥ ser vi fra Les at denne har en mor, men vi vet ikke versjon fra kall mot Les. Legger derfor inn mor med versjon 0 (mor vil vises med <nvdb-id>:0 i GUI). NÃ¥r vi sÃ¥ endrer noe i sammenkoblingen her, henter vi inn siste versjon av mor som videre blir lagt i endringssettet med sletting av kjobling mot denne datteren. Skriv vil derfor klage over at denne siste versjonen ikke har denne assosiasjonen.

*Fra Marvin*:Â Relasjoner peker kun pÃ¥ id, ikke versjon, sÃ¥ alle dÃ¸tre blir koblet til alle mÃ¸dre

-> Dette gjÃ¸r at Datafangst antar at siste versjon av mor alltid vil ha denne koblingen hvis det oppgis at en datter har en mor.

*Fra Espen*: Dette forklarer problemet i NVDB-6011: nÃ¥r datafangst lager-assoc objektet mellom mor og datter i nvdb, sÃ¥ setter den nvdbref med 0 som versjon, som da fÃ¸rer til at vi fÃ¥r null nÃ¥r vi prÃ¸ver Ã¥ finne dette objektet i kontrakten siden objektet vi leter etter egentlig har en annen versjon enn 0 i nvdbrefÂ ",NVDB-6937,Datafangst,
Enkelte tegn fungerer ikke i passord,"h2. Deffinert problem

SVV-brukarar med norske tegn (i alle fall Ã˜) i passordet fÃ¥r ikkje logga inn. FÃ¥r ""Feil brukernavn eller passord"".
h3. KurriÃ¸st problem

I STM/ATM fungerer heller ikkje '-', men det fungerer i PROD.

Passordet var det same i STM og ATM, men ikkje i PROD. Med Ã¥ bytte ut '-' med'.' fungerte passardet. Kan vere kombinasjonen av andre tegn og '-' som skaper problem.",NVDB-6937,Datafangst,
Endrede stedfestinger oppdateres ikke i GUI,"h2. Observasjon

FÃ¸lg observasjon i NVDB-6003. Etter stedfesting oppdateres et av objektene i GUI, men ikke begge. Etter reload er alt pÃ¥ plass; bÃ¥de grÃ¸nt symbol for de endrede objektene og grÃ¸nt symbol for selve typene.

Se vedlagte skjermbilder.",NVDB-6937,Datafangst,
FÃ¥r en rute som ikke er koblet sammen,"h2. Observasjon

Kall
{noformat}
https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/beta/vegnett/rute?geometri=LINESTRING%20(136672.43%206500140.11,%20136671.64%206500119.29,%20136671.64%206500119.23,%20136674.15%206500098.12,%20136675.73%206500083.43,%20136675.73%206500083.4,%20136676.44%206500069.33,%20136676.44%206500069.29,%20136677.35%206500054.53,%20136677.35%206500054.49,%20136677.21%206500045.88,%20136677.21%206500045.84,%20136677.62%206500030.2,%20136677.62%206500030.15,%20136677.21%206500023.1,%20136677.2%206500023.02,%20136675.76%206500015.07,%20136675.74%206500014.98,%20136673.76%206500008.96,%20136673.71%206500008.85,%20136670.9%206500003.79,%20136670.87%206500003.75,%20136667.23%206499998.23,%20136667.17%206499998.16,%20136662.17%206499992.63,%20136662.11%206499992.58,%20136658.67%206499989.69,%20136658.62%206499989.66,%20136653.88%206499986.48,%20136653.85%206499986.46,%20136650.82%206499984.67,%20136650.77%206499984.64,%20136646.63%206499982.7,%20136646.56%206499982.67,%20136641.38%206499980.98,%20136635.91%206499979.36,%20136635.84%206499979.35,%20136629%206499978.16,%20136628.97%206499978.15,%20136625.67%206499977.71,%20136595.42%206499978.31,%20136595.16%206499978.31)&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&kortform=true
{noformat}
gir tilbake bl.a. rutesegmentene
{noformat}
<vegnettrutesegment>
  <type>Linje</type>
  <veglenkesekvensid>2077351</veglenkesekvensid>
  <startposisjon>0.13488073</startposisjon>
  <sluttposisjon>0.37951174</sluttposisjon>
  <kortform>0.13488073-0.37951174@2077351</kortform>
</vegnettrutesegment>
<vegnettrutesegment>
  <type>Linje</type>
  <veglenkesekvensid>3158628</veglenkesekvensid>
  <startposisjon>0.98046837</startposisjon>
  <sluttposisjon>1.0</sluttposisjon>
  <kortform>0.98046837-1.0@3158628</kortform>
</vegnettrutesegment>
{noformat}
HvorÂ 0.37951174@2077351 er koblet til nodeÂ 3120474

[https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/2077351]

Og 0.0@3158628 er koblet til nodeÂ 3120474

[https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/3158628]

Men altsÃ¥ hverkenÂ 0.98046837@3158628 eller 1.0@3158628 er koblet til denne.

Her skulle det ha vÃ¦rt 0.0@3158628 som var oppgitt i rute-responsen.

Observasjonen er gjenskapt i alle miljÃ¸ene.

Â 
h3. LÃ¸sning

Problemet var at noen av de riktige segmentene ble filtrert bort under beregning av ruten, som skjedde ved at en rute fra punkt til punkt i geometrien ble beregnet og deretter sammensatt. Endet pÃ¥ behandling av geometri ved ruteberegning slik at segmenter mellom punktene i geometrien fÃ¸rst blir samlet inn, og deretter blir de matet inn i ruteberegningen med resten av parametrene. Da unngÃ¥r vi problemene med at ruten bestÃ¥r av mange smÃ¥ ruter som ikke nÃ¸dvendigvis henger sammen som en helhet.

Rute for polygon beregnes med den gamle metoden.",NVDB-6937,Les-API,
Funksjon for Ã¥ angre sletting av assosiasjon,"Man kan nÃ¥ slette en assosiasjon mellom 2 objekter som er lagret i NVDB.

Denne slettingen mÃ¥ effektueres ved Ã¥ sende et endringssett til Skriv.

Vi mÃ¥ tillate Ã¥ angre en slik sletting av assosiasjon. Hvis en bruker feilaktig sletter en slik assoisiasjon kommer hun seg ikke ut av det uten Ã¥ slette objektene fra kontrakten.

Â 

!image-2020-10-13-14-45-20-566.png!",NVDB-6937,Datafangst,
fikse opp UI og oppfÃ¸rsel for sletting av sammenkobling,"Man kan slette sammenkoblinger pÃ¥ objekter som er importert fra NVDB, men GUI reflekterer ikke hva man kan og ikke kan gjÃ¸re.

NÃ¥r en sammenkobling er merkert for sletting, kan man fortsatt trykke pÃ¥ knappen for Ã¥ slette den, selv om det ikke har noen effekt

NÃ¥r en sammenkobling er merket for sletting, kan man trykke pÃ¥ knappen for Ã¥ koble sammen de valgte objektene, selv om det ikke har noen effekt.
 * nÃ¥ nÃ¥r vi bruker beskrivende navn pÃ¥ objektene i sammenkobling, fÃ¥r vi dobbelt opp av navngiving. vi kan fjerne den ene.
 * 

Â 

!image-2020-10-13-14-43-32-850.png!

Â ",NVDB-6937,Datafangst,
rydde opp ikoner pÃ¥ sammenkobling,"ikonene legger seg over NVDB-badgen og tekst

rydd opp i ikonvisningen

Â 

!image-2020-10-13-14-12-12-513.png!",NVDB-6937,Datafangst,
"Send inn ""trafikantgruppe"" for typeVeg ved stedfesting med Skriv","h2. Observasjon

NÃ¥r bruker klikker pÃ¥ en veg for stedfesting, sÃ¥ henter vi typeVeg fra Les for Ã¥ sende inn dette for Ã¥ fÃ¥ riktig veg. Ã… bruke kun en typeVeg her kan bli for spesifikt, sÃ¥ vi bÃ¸r mappe typeveg til en gruppe med typeVeg'er, sÃ¥nn at vi f.eks. fÃ¥r med alle typer bilveg nÃ¥r bruker har klikket bilveg, i stedet for bare akkurat den typen som bruker klikket pÃ¥.
h2. LÃ¸sning

Lagde en enum for mapping til og fra NVDB-verdier med funksjon for Ã¥ hente ut relaterte enumer.

Sender liste med relaterte enumer til stedfesting med Skriv

EnhetstesterÂ ",NVDB-6937,Datafangst,
Feil sorteringsrekkefÃ¸lge pÃ¥ egenskapsverdier,"h2. Observasjon

(Fra support ved Stein Idar Dyngen)

Egenskapsverdiene til Skiltnummer er ikke sortert ihht Datakatalogen. Se i Datafangst hvor f.ex verdi 146.X kommer. Denne skal sorteres etter 144 og fÃ¸r 148 i fÃ¸lge DK. Og det er flere eksempler her.",NVDB-6937,Datafangst,
Bedre deteksjon av datafeil i SingleParentValidator,"h2. Observasjon

Fra Tor Kjetil:

Denne kommer fra Datafangst https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/b6051bcb-5bb6-44c5-8859-a5777656975f (kontrakt a7654020-294a-4442-831e-32d010da52fb)
Feilmeld sier bl.a. at en datter har flere mÃ¸dre. En av disse
Endringssett: Objektet har mer enn ett morobjekt i en komposisjonssammenheng: VEGOBJEKTTYPE=86; ID=656220958; VERSJON=6; STARTDATO=2019-10-15; SLUTTDATO=null. Morobjektversjoner: VEGOBJEKTTYPE=461; ID=846923099; VERSJON=3; STARTDATO=2020-01-10; SLUTTDATO=2020-10-09, VEGOBJEKTTYPE=461; ID=846923099; VERSJON=4; STARTDATO=2020-10-09; SLUTTDATO=null og VEGOBJEKTTYPE=461; ID=792006062; VERSJON=5; STARTDATO=2020-01-10; SLUTTDATO=2020-10-09

Men jeg finner ikke at v3 av mor er avsluttet, og finner ingen v4 av samme objekt: https://www.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/461/846923099/3

h2. Analyse

461/846923099/3 blir oppdatert i endringssettet. v3 blir da lukket og v4 lagt til. Begge disse versjonene har assosiasjon til (og felles levetid med) 86/656220958/6. Det gjÃ¸res ingen endring pÃ¥ assosiasjonen under oppdateringen. I tillegg oppdateres 461/792006062/5 i endringssettet. Dermed lukkes v5 og v6 legges til. Oppdatering bestÃ¥r bl.a. i at assosiasjon til 656220958 fjernes (i v6).

Det er dermed korrekt at det er flere morobjekter, men i og med at disse morobjektene finnes i NVDB er det strengt tatt en datafeil. Jeg har undersÃ¸kt opphavet og ser at det er klassisk klient-api som er synderen.

API Skriv mÃ¥ unnlate Ã¥ trigge slike avvisninger nÃ¥r det er datafeil. Det er allerede en slags sjekk pÃ¥ dette i SingleParentValidator, men den ser ikke pÃ¥ hva som faktisk gjÃ¸res med hver enkelt assosiasjonsattributt.

h2. LÃ¸sning

Utvider SingleParentValidator.isValidFeature() med kontroll pÃ¥ at assosiasjonsverdien faktisk er oppdatert i endringssettet fÃ¸r valideringsfeil trigges.",NVDB-6937,Skriv-API,
Advarer om manglende assosiasjon som er der,"h2. Observasjon

(Fra support ved Raymond)

Hvis man kobler en datter til en mor vil fortsatt mor ha advarsel i datafanen om at assosiert type av datterens type mangler som en advarsel.

*Gjenskap*

Last inn vedlagte SOSI. Koble disse. GÃ¥ til datafanen og observer at mor som nÃ¥ har fÃ¥tt en datter har advarsel
{noformat}
Objektet, av typen Skiltpunkt (95), mangler egenskaper med viktighet 'pÃ¥krevd, ikke absolutt': [Assosierte Variabelt skilt (220006), Assosierte Skiltplate (220004)]
{noformat}
Se ogsÃ¥ kontrakt: [https://datafangst-utv.kantega.no/#!/contract/3005eabf-a757-43ed-aeb1-111880c3825e/features3]
h2. Analyse

Det gjÃ¸res ingen revalidering etter assosiasjons-operasjonerÂ 
h2. LÃ¸sning

refaktoriserte og eksponerte metoder for Ã¥ re-validere en liste med objekter eller en liste med objekttyper

sammenkoblingsoperasjoner (auto, manuell, slett) sender nÃ¥ objektene til revalidering. ved auto og slett revalideres de beÃ¸rte objekktypene, for Ã¥ fange opp tilfeller der mor har blitt flyttet og evt andre bieffekter som kan oppstÃ¥.",NVDB-6937,Datafangst,
Feil advarsel om mangler pÃ¥ objekt,"h2. Observasjon

(fra support ved Raymond)

Hvis man i datafanen kopierer et NVDB-objekt til et nytt objekt sÃ¥ kan man fÃ¥ advarsler om at egenskaper mangler som det nye objektet faktisk har. I aktuelt tilfelle rapporteres det om at nytt objekt mangler Rekkverkstype og BruksomrÃ¥de - noe som er feil.

For Ã¥ gjenskape

Last inn vedlagte SOSI. Finn NVDB-objekter i kartet (datafanen). Importer det nÃ¦rmeste som Oppdater. Kopier sÃ¥ dette NVDB-objektet som et nytt objekt og observer advarslene mot hva objektet faktisk har av egenskaper. Se ogsÃ¥ kontrakt: [https://datafangst-utv.kantega.no/#!/contract/a4e65373-fc1e-4f9c-af65-dcea602b25fc/features3]
h2. Analyse

Disse validerings-feilene genereres av API skriv. Vi sender inn ett endringsÃ¸nske, og sender det til Skriv for validering, for Ã¥ se hva som mangler for Ã¥ kunne lagre vegobjektene.
For Ã¥ fÃ¥ til det mÃ¥ vi mappe om objektene til et endringssett. denne mapperen mapper bare egenskaper som er satt til lagreing (opprett, oppdater, korriger). Hvis man kopierer et objekt som har egenskaper satt til les, vil ikke disse egenskapene mappes over til endringssettet, og Skriv gir valideringsfeil pÃ¥ at de mangler.

Det gjÃ¸res et forsÃ¸k for Ã¥ ta hÃ¸yde for dette, men timingen blir feil og egenskapene setter til ""opprett"" etter at de valideres.
h2. LÃ¸sningÂ 

Fiks timing for Ã¥ nÃ¥r egenskapene settes til Skriv.

I denne koden ligger det ogsÃ¥ en assert, som antakelig er ment Ã¥ skulle funke som feilhÃ¥ndtering, men det vil aldri funke noe bra (og asserts er slÃ¥tt av som default). Denne asserten fjernes.

Â ",NVDB-6937,Datafangst,
Vegsystemreferanse blir ikke slÃ¥tt sammen,"{quote}
hvis man gjÃ¸r dette kallet: https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/99?srid=4326&inkluder=lokasjon&vegsystemreferanse=FV864S2
og ser pÃ¥ objektet med id: 204249035 sÃ¥ har det Ã¥tte vegsystemreferanser der objektet er stedfestet.

Hvis man gjÃ¸r dette kallet: https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/99/204249035
sÃ¥ ser man at vegsystemreferansene der objektet er stedfestet pÃ¥ er slÃ¥tt sammen og har fra_meter 0 og til_meter 2997.371.

Er det, eller kan det bli, en mulighet for Ã¥ fÃ¥ slÃ¥tt sammen sammenhengende vegsystemreferanser ogsÃ¥ for kall tilsvarende det fÃ¸rste?

I tillegg i det andre kallet sÃ¥ har objektet med id: 204249035 fÃ¥tt en stedfesting pÃ¥ strekning 1 fra_meter 3168.287 og til_meter 3168.315 som jeg ikke helt forstÃ¥r hvor kommer fra, men det er en annen sak.
{quote}

",NVDB-6937,Les-API,
Velg alle/ingen ved auto stedfesting,"Fra support (Kemal Kurumahmut)

Hvis man har mange objekttyper i en kontrakt, sÃ¥ hadde det vÃ¦rt fint Ã¥ ha en knapp som sier noe a la ""velg alle / ingen"" i popup for auto stedfesting. I dag velges alle per default, sÃ¥ om man Ã¸nsker Ã¥ stedfeste en og en er det en tung prosess.",NVDB-6937,Datafangst,
Bruk Cache API for lagring av Datakatalogen,"Endringer i NVDB-4303 gjÃ¸r at hele Datakatalogen nÃ¥ caches i nettleser. StÃ¸rrelsen har Ã¸kt til 2,5 MB, som fortsatt er godt innenfor det vi kan ha i localStorage, men det er en mulighet for at endringer i Datakatalogen eller endring i hvor mye nettlesere tillater i localStorage vil gjÃ¸re at dette slutter Ã¥ virke. I tillegg er det problemer med ytelse for localStorage og store objekter, siden det er en synkron API.

Cache API er bedre egnet til den type (\*ahem\*) _caching_ som gjÃ¸res her, sÃ¥ skriver om caching av Datakatalogen til Ã¥ bruke den.",NVDB-6937,Datafangst,
stedfesting: flytt bare objekter vi finner i prosjektet,"Ved flytting mÃ¥ vi pÃ¥se at vi bare flytter objekter som er importert i DF.

assosiasjoner har DF-ID-er eller NVDB-ID-er som referanse og begge disse kan brukes for Ã¥ referere til objekter importert i NVDB.

NVDB-5978 fikset et problem der lagrede objekter (som har bÃ¥de DF- og NVDB-id) genererte nullpotinere.

Denne saken sÃ¸rger for at vi ikke fÃ¥r nullpointer nÃ¥r assosiasjoner inneholder en referanse til en tidligere versjon av objektene som er importert i DF.

Det er ogsÃ¥ lagt til en ekstra mekanisme som sÃ¸rger for at vi ikke kaster en exception nÃ¥r assosiasjoner inneholder referanser til objekter som ikke er importert, som dermed flytter ansvaret til hvilke objekter som skal flyttes hÃ¸yere opp i arkitekturen.

Dette skal underbygge at nÃ¥r bruker skal gjÃ¸re endringer pÃ¥ objekter mÃ¥ de flyttes inn i prosjektet.

Â ",NVDB-6937,Datafangst,
FÃ¥r ikke alle objekter hver gang,"Sjekk ut dette, meldt inn via gitter (https://gitter.im/nvdb-vegdata/api-les-v3?at=5f7f124066ee4e44a88db4b6):

Â 

I gÃ¥r dreiv eg Ã¥ henta ut trafikkmengdeobjekt for alle riksvegar via Java-klienten. Eg kÃ¸yrde programmet mitt ein del gonger og observerte at den totale lengden veg kunne variere ganske drastisk mellom kÃ¸yringar. Her er antal kilometer med veg for kvar kÃ¸yring:
 * 10286.183671561386 km
 * 7534.98141968181 km
 * 6526.802729395468 km
 * 10286.149466227213 km
 * 210.47337508706784 km
 * 10286.148208214528 km

Ser ut til at eg ikkje nÃ¸dvendigvis fÃ¥r alle trafikkmengdeobjekta ved kvar kÃ¸yring. Kva er Ã¥rsaken til det?",NVDB-6937,Les-API,
Etablere STM-miljÃ¸ pÃ¥ Atlas-plattformen,"Har fÃ¥tt etablert applikasjonsmiljÃ¸ for STM i Atlas (nvdbapiskriv-systemtest). Det gjenstÃ¥r da Ã¥ sette opp Atlas-konfigurasjon for tjenester, velv etc og rulle ut NVDB API Skriv.

QA: Se konfigurasjonsfiler for Atlas: https://git.vegvesen.no/projects/NVDBDATA/repos/atlas-config/browse/nvdbapis/systemtest",NVDB-6937,Skriv-API,
Linjeobjekt med to like punkter slipper inn,"h2. Observasjon

SOSI-fil vedlagt er et objekt som er hentet fra et reellt sett med objekter i en SOSI.

DF fjerner et punkt som duplikat, og tar inn objektet. Men det som da stÃ¥r igjen av objektet er to helt like punkter i geometrien.Â Lagret geometri:
{noformat}
{""type"":""LINE"",""representationPoint"":null,""shape"":{""@class"":""no.svv.nvdb.datafangst.domainmodel.geometry.shapes.LineString"",""positions"":[{""northing"":6759744.286657475,""easting"":310719.2902437562,""height"":204.966},{""northing"":6759744.286657475,""easting"":310719.2902437562,""height"":204.966}]},""srid"":25833,""heightRef"":""NN2000"",""properties"":{""map"":{}},""length"":0.0020000765930742255,""operation"":""WRITE""}
{noformat}
Dette objektet skulle blitt avvist ved import pga gurba-data. Tas det inn blir det avvist av Skriv sin stedfesting med _GEOMETRI_MED_FOR_TETTE_PUNKTER_.

[https://datafangst-test.kantega.no/#!/contract/536b5cad-4461-46eb-bb83-e465cc47ea21/files]

Â ",NVDB-6937,Datafangst,
Feilmld om at datter ikke flytter hjem nÃ¥r hun gjÃ¸r det,"h2. Observasjon

Importer fÃ¸lgende url-er som Korriger

[[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/335?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]]

[[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]]

GÃ¥ til stedfesting.Â Stedfesting er som ""stedfesting_fÃ¸r.png"". Bruk Skriv og manuelt stedfest SkjermÂ 101895592 og AvstandsmÃ¥lingÂ 377099404 til nÃ¦rmeste vei. Da popper det opp flere rÃ¸de feilmld + en gul infoboks om at datter ikke kan flyttes inn under mor. Skriv gir forÃ¸vrig svar pÃ¥ begge objektene. Loggen sier
{noformat}
2020-10-08T07:35:33.993 INFOÂ  [http-nio-127.0.0.1-8080-exec-44] [exttxm] [0ec22eaa-2f80-4d0c-820f-1d8197f97604] n.s.n.d.a.ParentChildLocationalTrimmer Ensuring child features are inside parent features 
2020-10-08T07:35:34.007 INFOÂ  [http-nio-127.0.0.1-8080-exec-45] [exttxm] [0ec22eaa-2f80-4d0c-820f-1d8197f97604] n.s.n.d.a.ParentChildLocationalTrimmer Ensuring child features are inside parent features 
2020-10-08T07:35:34.008 ERROR [http-nio-127.0.0.1-8080-exec-45] [exttxm] [0ec22eaa-2f80-4d0c-820f-1d8197f97604] n.s.n.datafangst.rest.ContractResource Unable to locate feature with unifiedId 377099404:0 
2020-10-08T07:35:34.008 INFOÂ  [http-nio-127.0.0.1-8080-exec-45] [exttxm] [0ec22eaa-2f80-4d0c-820f-1d8197f97604] n.s.n.datafangst.rest.ContractResource Unable to move locationals inside parent
{noformat}
Imidlertid ser stedfesting etterpÃ¥ ut som ""stedfesting_etter.png"" (ogsÃ¥ etter reload).

Hvorfor alle feilmld nÃ¥r det tilsynelatende ser ut som om de har fÃ¥tt ny stedfesting OG blitt flyttet under mor? For svaret fra Skriv er ikke eksakt likt for de to.

h2. Analyse
Etter en runde med debugging viser det seg at feilen er at metoden som skal hente kobling til foreldre gitt et barn ikke virker som den skal nÃ¥r barn har en NBDB-ID. Da fÃ¥r vi *alle* koblinger til gitt NVDB-ID som barn, uavhengig av kontrakt. GÃ¥r bra for noen tilfeller / bruk, men hvis NVDB-ID er brukt i flere koblinger (igjen, uavhengig av kontrakt) sÃ¥ er det tilfeldig hvilken vi fÃ¥r.

h2. LÃ¸sning
Fikse FeatureDao.getParentAssociations til Ã¥ ta hensyn til kontrakt nÃ¥r det spÃ¸rres etter kobling til parent.",NVDB-6937,Datafangst,
Ruteberegner: Graf tolererer ikke loops,"Observasjon fra [~tormos]:
{code:java}
{
""geometri"":""LINESTRING (10478.2 6507631.35, 10467.8 6507606.99, 10456.23 6507588)"",
""maks_avstand"":""300"",
""konnekteringslenker"":false,
""detaljerte_lenker"":false,
""vegsystemreferanse"":""EV39"",
""trafikantgruppe"":null,
""typeveg"":""enkelBilveg"",
""tidspunkt_start"":""2020-10-07"",
""tidspunkt_slutt"":null,
""pretty"":false,
""kortform"":false
}
{code}
gir ikke rute, feilmelding for punkt-til-punkt er IKKE_FUNNET_SEGMENTER_I_UTSNITT.

Rute fra datafangst:

!Screenshot_datafangst.png|thumbnail!",NVDB-6937,Les-API,
Stadfesting med objekt som svingar tilbake vert feil,"h1. Obesrvasjon

NÃ¥r rekkverk som svingar tilbake der det kom frÃ¥ skal stadfestast treff ikkje rekkverket og rekkversende pÃ¥ samme punkt.
h2. Default stadfesting:

!screencapture-datafangst-test-kantega-no-2020-10-07-12_14_09.png|thumbnail!
h2. Stadfesting med skriv:

!screencapture-datafangst-test-kantega-no-2020-10-07-12_14_54.png|thumbnail!",NVDB-6937,Datafangst,
Betre informasjon ved avvist pga. ikkje siste versjon,"h1. Melding frÃ¥ brukar

Ved overfÃ¸ring til nvdb, kan slike feil forekomme:

80239720: Versjon oppgitt for lukking er allerede lukket 2020-06-03
80239721: Versjon oppgitt for lukking er ikke siste versjon. Siste versjon er 4

Her foreslÃ¥r jeg Ã¥ skrive Â«Vegobjektet oppgitt â€¦Â» i stedet for versjon pÃ¥ den fÃ¸rste linjen, da det er objektet som sÃ¥dan som er lukket.

Dette vil ogsÃ¥ skille bedre mellom de to feil-typene, og man ser raskere hva som mÃ¥ gjÃ¸res for Ã¥ korrigere feilen.
{quote}Innmeldar:Â Lund Ã˜ystein BjÃ¸ndal <Oystein.bjondal.lund@vegvesen.no>
{quote}
h2. Forslag til lÃ¸ysing

â€¦ eller bare legge til aktuelt versjonsnr. i begge tilfellene, f.eks.:

80239720v2: â€¦Â Â  Â Â -- tipper at versj.nr. er angitt i endringssettet
80239721v3: â€¦Â Â Â Â  -- nyttig Ã¥ fÃ¥ repetert versj.nr.et, tenker jeg.

Jeg vet ikke hva som vil vÃ¦re best.
{quote}Hilsen NVDB-forvaltningen, Hans Anton
{quote}
h3. Tilleggskommentar

Jo mer informasjon som vises, jo bedre, som oftest.

Poenget i dette tilfellet mÃ¥ vÃ¦re Ã¥ gi en indikasjon pÃ¥ hvordan feilen skal fikses. Ved Ã¥ si at vegobjektet som sÃ¥dan er lukket, forstÃ¥r man at det mÃ¥ slettes fra kontrakten, da man ikke skal lukke objektet en gang til (uavhengig av versjoner)

PrÃ¸ver man imidlertid Ã¥ lukke en versjon for lavt, betyr bare det at noen andre har lukket i mellomtiden, og da mÃ¥ man (slette objektet i datafangst for deretter Ã¥) hente ned siste versjon for lukking.Â 

(Alternativet mÃ¥ jo vÃ¦re at datafangst selv avviser det fÃ¸rste, og selv lukker riktig versjon for det siste eksempelet (men det koster sikkert litt mer utviklingstid enn bare Ã¥ endre i hva som skrives til feil loggen)",NVDB-6937,Datafangst,
Legge til vegobjekttype i feilmelding,"h1. Melding frÃ¥ brukar

Vegobjektene ble avvist fordi det ble funnet feil under validering
141841407: Versjon oppgitt for lukking er allerede lukket 2020-09-24

Her bÃ¸r det i tillegg legges ut hvilken vegobjekt type dette gjelder, sÃ¥ sparer vi tid nÃ¥r vi skal finne feilen!
{quote}Innmeldt av:Â Lund Ã˜ystein BjÃ¸ndal <Oystein.bjondal.lund@vegvesen.no>
{quote}",NVDB-6937,Datafangst,
Oppdater lenke til SINTEF datakatalog,"h2. Observasjon

Lenke til SINTEF datakatalog (ex type 5) er nÃ¥: [http://tfprod1.sintef.no:8080/datakatalog/eksport/produktspesifikasjon/5.htm]

Men den korrekte er: [https://www.vegvesen.no/nvdb/datakatalog/eksport/produktspesifikasjon/5.htm] (redirect via SVV)

Â ",NVDB-6937,Datafangst,
Ruteberegning: Parameter for Ã¥ unngÃ¥ rute pÃ¥ tvers av Trafikantgrupper,"h2. Opprinnelig observasjon

Automatisk stedfesting med Skriv av vedlagte SOSI (mot UTV) gir tilbake 4 rutesegmenter hvor en av disse er pÃ¥ typeVeg _Gang- og sykkelveg,_Â mens de tre andre er pÃ¥ typeVeg _enkelBilveg_. Dette er typeVeg-er som gÃ¥r pÃ¥ tvers av trafikantgruppe.Â 

Merk at ATM ikke gir ulike typeVeg-er da datagrunnlaget nok er forskjellig.

Kall mot Skriv:

POST [https://pm1.utv.vegvesen.no/nvdb/apiskrivbeta/rest/v3/stedfest?maksimumAvstandTilVeg=300]
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""62"" tempId=""f19e76fb-e32d-4d7e-99a0-0956a14977a2""><egenskaper><egenskap typeId=""4765""><geometri><srid>25833</srid><wkt>LINESTRING (-21252.169081652944 6643074.797794869 7.26, -21255.52226438414 6643073.36029179 7.19, -21260.87664281932 6643071.067369547 6.93, -21264.54671549675 6643069.578097077 6.8100000000000005, -21269.259146525234 6643067.478605227 6.57, -21275.200999789988 6643065.14842999 6.12, -21277.961267874634 6643063.918883092 5.71, -21282.465775004996 6643062.001907458 5.37, -21287.05290469533 6643059.951452257 5.12, -21289.08860274579 6643059.048815356 6.44, -21297.744401590666 6643055.112274033 4.5, -21301.558831787785 6643053.253438639 4.49, -21305.208920193487 6643051.540798004 4.34, -21311.322363643092 6643048.652194137 4.29, -21316.38436367351 6643046.252138065 4.23, -21321.598004274012 6643043.956495468 4.11, -21325.074670816422 6643042.379153579 4.03, -21329.513801066263 6643040.405883191 4.09, -21332.253181890992 6643039.073732074 4.04, -21334.257101296214 6643038.18834785 3.87, -21336.576998423378 6643037.150406309 3.73, -21338.05247322988 6643036.539260265 3.63, -21338.5028380141 6643036.459337355 3.1, -21340.31154388131 6643035.727413284 2.32, -21341.456515074184 6643035.317857134 2.27, -21342.92381240864 6643034.575051343 2.2600000000000002, -21343.06091759837 6643034.506945568 2.2600000000000002)</wkt><datafangstdato>2019-10-31</datafangstdato><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>96</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>5</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>5</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-10-05</startdato></gyldighetsperiode></vegobjekt></vegobjekter>
{noformat}
Som videre spÃ¸r Les:

POSTÂ [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""geometri"":""LINESTRING (-21252.17 6643074.8, -21255.52 6643073.36, -21260.88 6643071.07, -21264.55 6643069.58, -21269.26 6643067.48, -21275.2 6643065.15, -21277.96 6643063.92, -21282.47 6643062, -21287.05 6643059.95, -21289.09 6643059.05, -21297.74 6643055.11, -21301.56 6643053.25, -21305.21 6643051.54, -21311.32 6643048.65, -21316.38 6643046.25, -21321.6 6643043.96, -21325.07 6643042.38, -21329.51 6643040.41, -21332.25 6643039.07, -21334.26 6643038.19, -21336.58 6643037.15, -21338.05 6643036.54, -21338.5 6643036.46, -21340.31 6643035.73, -21341.46 6643035.32, -21342.92 6643034.58, -21343.06 6643034.51)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""E,F,K,R"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-09-16"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}
{noformat}
Oppdatert body etter optimaliseringer i Skriv:
{noformat}
{""geometri"":""LINESTRING (-21252.17 6643074.8, -21343.06 6643034.51)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""F,E,R,K"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-10-05"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}
{noformat}
h2. Etter diskusjoner

Ruteberegning i Les skal legge opp til Ã¥ kunne vÃ¦re mer enn en tjeneste for API Skriv sin stedfesting. Derfor vil det kunne forekomme at en rute gÃ¥r pÃ¥ tvers av trafikantgruppe. Men siden API Skriv er per nÃ¥ den viktigste klienten, og denne trenger en rute som ikke gÃ¥r pÃ¥ tvers, sÃ¥ vil det innfÃ¸res en ekstra parameter som Skriv kan sette i kallene mot /rute for Ã¥ tvinge /rute til Ã¥ oppgi en rute som *ikke* gÃ¥r pÃ¥ tvers av trafikantgruppe.

h3. LÃ¸sning
Ny paramter ""behold_trafikantgruppe"" som gjÃ¸r at ruten som blir returnert ikke hopper mellom de 2 trafikantgruppene K og G. Trafikantgruppe velges fra start- og sluttpunkt til ruten. Om begge er like velges den aktuelle, om de er ulike foretrekkes kjÃ¸rende. Implementert for oppslag pÃ¥ geometri, punkt og posisjon.
Man kan fortsatt tvinge gjennom en trafikantgruppe ved Ã¥ sette det eksplisitt i requesten.
Nvdb-visrute er oppdatert med valg for den nye parameteren.
",NVDB-6937,Les-API,
stedfesting for barnlÃ¸se morlÃ¸se oppdateres ikke i GUI,"h2. Observasjon

Last inn vedlagte SOSI. Stedfest manuelt med Skriv (auto finner ikke rute). Det gÃ¥r kall tilbake til Skriv som gir resultater. Det samme med det interne kalletÂ /rest/vegobjekt/<contractid>/stedfesting som gir 200 og success: true. Men selve objektet blir liggende rÃ¸dt i GUI.

Reload av stedfestingsfanen viser at objektet er blitt stedfestet og er nÃ¥ markert grÃ¸nt.
h2. Analyse

feilen oppstÃ¥r for barnlÃ¸se, morlÃ¸se objekter. Det er en feil i opptelling som ikke teller med objektet som stedfestes.
h2. LÃ¸sning

Teller opp alle berÃ¸rte objekter.

Fikser ogsÃ¥ en corner case som gjÃ¸r at stedfestingsgeometri fra locationalService ble returnert for hovedobjektet, som fÃ¸rer til feil visning nÃ¥r localizationService gÃ¥r pÃ¥ en error eller ikke finner noe hvis objektet er for langt unna valgt veg.",NVDB-6937,Datafangst,
Fjern kode for gammel stedfesting,"Kan vÃ¦re lurt Ã¥ fjerne gammel stedfesting fÃ¸r vi gjÃ¸r endringer som Ã¥ skru pÃ¥ stedfesting med Skriv som default (NVDB-5706), for Ã¥ slippe Ã¥ vedlikeholde ting to steder.

Logg sier at gammel stedfesting er togglet 5 ganger siste 90 dager, og det er ikke usannsynlig at alle disse var oss under testing.",NVDB-6937,Datafangst,
FÃ¥r ikke manuelt stedfestet med Skriv pga feil fase,"h2. Observasjon

Testet i df-test/ATM.

Vedlagte SOSI lar seg ikke stedfeste automatisk med Skriv:

POSTÂ /nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""852"" tempId=""596fbda2-61df-4388-adcb-94662b0acb68""><egenskaper><egenskap typeId=""9721""><geometri><srid>25833</srid><wkt>LINESTRING (136985.0714155052 6500454.363244808 40.394, 136975.1664273205 6500454.605032915 40.15)</wkt><datafangstdato>2019-06-11</datafangstdato><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>96</mÃ¥lemetode><mÃ¥lemetodeHÃ¸yde>96</mÃ¥lemetodeHÃ¸yde><nÃ¸yaktighet>5</nÃ¸yaktighet><nÃ¸yaktighetHÃ¸yde>5</nÃ¸yaktighetHÃ¸yde><synbarhet>0</synbarhet></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-10-02</startdato></gyldighetsperiode></vegobjekt></vegobjekter>{noformat}
Den lar seg heller ikke stedfeste manuelt ved Ã¥ markere veien:

POSTÂ /rest/v3/stedfest?maksimumAvstandTilVeg=300&vegnummer=18&vegkategori=E&typeVeg=ENKEL_BILVEG%2CKANALISERT_VEG&fase=A

med samme body

Derimot vil man fÃ¥ treff pÃ¥ POSTÂ /rest/v3/stedfest?maksimumAvstandTilVeg=300&vegnummer=18&vegkategori=E&typeVeg=ENKEL_BILVEG%2CKANALISERT_VEG&fase=V (merk faseendringen)

IfÃ¸lge Vegkart ligger det ingen EA her:

[https://vegkart.test.atlas.vegvesen.no/#kartlag:topo4/@137025,6500426,17/vegnett:~'geometri+~()/valgt:22151:111:12]
h2. SpÃ¸rsmÃ¥l

Hvor er det fase=A kommer fra?",NVDB-6937,Datafangst,
Ruteberegning: Beregn lengste delrute i geometri-spÃ¸rring,Vi fÃ¥r i dag for punkt-til-punkt beregnet den lengste sammenhengende ruten via en fallback-graf dersom en historisk rute ikke kan beregnes pÃ¥ normal mÃ¥te. Denne pluss en statusmelding blir returnert. Oppgaven bestÃ¥r i Ã¥ utvide dette til ogsÃ¥ Ã¥ gjelde geometri-spÃ¸rringer.,NVDB-6937,Les-API,
NullPointerException ved sletting fra kontrakt,"h2. Observasjon
Jeg finner en del tilfeller i logg av NPE i forbindelse med sletting av vegobjekt fra kontrakt. Ser ut som dette skjer nÃ¥r vi skal sjekke om fil er tom, sÃ¥nn at kommentarer pÃ¥ fil ogsÃ¥ skal slettes.

h2. Analyse
Koden her er litt uheldig siden den starter en ny transaksjon inne i transaksjonen som sletter, tror det gÃ¥r an Ã¥ vÃ¦re litt smartere her med hvordan data hentes og forhÃ¥pentligvis unngÃ¥ dette. Ser ogsÃ¥ at inne i dette API-kallet sÃ¥ fÃ¥r vi ofte (alltid?) en database-exception med transaksjonsproblemer.

Eksempel fra logg: https://vegdata.kantega.no/kibana/goto/051df23b9edb429683346215ac7af702

Stacktrace:
{noformat}
java.lang.NullPointerException: null
	at no.svv.nvdb.datafangst.domainmodel.feature.FeatureList.get(FeatureList.java:78)
	at no.svv.nvdb.datafangst.orm.FeatureStorageImpl.purgeEmptyFile(FeatureStorageImpl.java:552)
	at no.svv.nvdb.datafangst.orm.FeatureStorageImpl.lambda$deleteFeature$57(FeatureStorageImpl.java:547)
	at no.svv.nvdb.datafangst.jdbc.Jdbc.lambda$transactional$0(Jdbc.java:85)
	at no.svv.nvdb.datafangst.jdbc.Jdbc.transactional(Jdbc.java:107)
	at no.svv.nvdb.datafangst.jdbc.Jdbc.transactional(Jdbc.java:84)
	at no.svv.nvdb.datafangst.database.DatabaseImpl.transactional(DatabaseImpl.java:103)
	at no.svv.nvdb.datafangst.orm.FeatureStorageImpl.deleteFeature(FeatureStorageImpl.java:543)
	at no.svv.nvdb.datafangst.contract.ContractManagerImpl.deleteFeature(ContractManagerImpl.java:1231)
	at no.svv.nvdb.datafangst.rest.ContractResource.deleteFeature(ContractResource.java:1692)
{noformat}

h2. LÃ¸sning
Jeg klarer ikke Ã¥ reprodusere denne lokalt, mistenker at det har noe med timing Ã¥ gjÃ¸re siden sletting av flere objekter gÃ¥r som separate slettekall. 
Uansett er det uheldig at vi gjÃ¸r kall som kan opprette nye transaksjoner inne i en aktiv transaksjon, sÃ¥ har skrevet om databasekall til Ã¥ bruke eksisterende connection.",NVDB-6937,Datafangst,
"Sentry: NPX i toolsMenu, datafanen","Sentry rapporterer 146 tilfeller / 2 uker .

[https://sentry.kantega.org/kantega/datafangst/issues/32/]

det gjÃ¸res en sjekk pÃ¥ datakatalog-versjon fÃ¸r datakatalogen er hentet

skriv som selectoren til Ã¥ hÃ¥ndtere null
{code:java}
TypeError: Cannot read property 'dataCatalogVersions' of nullarguments[{""message"":""Cannot read property 'dataCatalogVersions' of null"",""name"":""TypeError"",""stack"":""TypeError: Cannot read property 'dataCatalogVersions' of null\n    at Object.t.nvdbDatacatalogVersion (https://datafangst.kantega.no/assets/dataforvalter/app.js?c29ceabde26b574f1f5d:1:44487)\n    at Function.mapToProps (https://datafangst.kantega.no/assets/dataforvalter/app.js?c29ceabde26b574f1f5d:1:331100)\n    at i (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:26:149253)\n    at Function.i.mapToProps (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:26:149371)\n    at i (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:26:149235)\n    at https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:26:150594\n    at https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:26:147615\n    at Object.useMemo (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:56550)\n    at useMemo (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:101:5425)\n    at p (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:26:147559)\n    at Hr (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:53011)\n    at wo (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:59808)\n    at _o (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:59627)\n    at bo (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:59346)\n    at ko (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:68934)\n    at Ba (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:90411)\n    at ja (https://datafangst.kantega.no/assets/dataforvalter/vendors~app.js?c29ceabde26b574f1f5d:109:90795)\n    at Es (https...""}]
{code}
Â 
h2. LÃ¸sning
Det artige her er jo at verdien ikke var i bruk! SÃ¥ sletta selector og verdi fra state.",NVDB-6937,Datafangst,
NullPointerException ved import av vegobjekter,"Jeg ser noen tilfeller av NullPointerException ved import av vegobjekter i loggen. Ut i fra stacktrace og kode ser det ut som det kan vÃ¦re for enkelte objekter som ikke har egengeometri.

Ett eksempel fra logg: https://vegdata.kantega.no/kibana/goto/c01b7390ba00d85182992f1bc037f048

Ser ut som URL som importeres er denne: https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/9?segmentering=true&kommune=5401&inkluder=lokasjon%2Cgeometri%2Cegenskaper%2Cmetadata%2Crelasjoner

Stacktrace:
{noformat}
java.lang.NullPointerException: null
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.NvdbReadApiTransform.toFeature(NvdbReadApiTransform.java:138)
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.NvdbReadApiTransform.lambda$toFeatures$1(NvdbReadApiTransform.java:104)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1384)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)
	at no.svv.nvdb.datafangst.integration.nvdbapi.transform.NvdbReadApiTransform.toFeatures(NvdbReadApiTransform.java:104)
	at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbReadApiGateway.lambda$getFeaturesFromPagedResponse$10(DefaultNvdbReadApiGateway.java:468)
	at no.svv.nvdb.datafangst.integration.ClientInvoker.invokeWithLocalContextClassLoader(ClientInvoker.java:22)
	at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbReadApiGateway.getFeaturesFromPagedResponse(DefaultNvdbReadApiGateway.java:452)
	at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbReadApiGateway.getFeaturesFromUri(DefaultNvdbReadApiGateway.java:319)
	at no.svv.nvdb.datafangst.contract.ContractManagerImpl.importNvdbFeatures(ContractManagerImpl.java:981)
	at no.svv.nvdb.datafangst.rest.ContractResource.addExistingFeatures(ContractResource.java:1836)
{noformat}
",NVDB-6937,Datafangst,
NullPointerException ved parsing av veg og stedfesting med Skriv,"Finner noen tilfeller av NPE med stedfesting med Skriv der det feiler nÃ¥r vi skal parse veg i request. Kode antar av veg er med, med stedfesting uten veg er ogsÃ¥ gyldig. Det mÃ¥ sjekkes om veg er satt fÃ¸r vi prÃ¸ver Ã¥ konvertere.

Ett eksempel: https://vegdata.kantega.no/kibana/goto/9b62db06e806c1dc3f19c0c16f70b0cd

Steg for Ã¥ reprodusere:
# GÃ¥ til Admin-side (skiftnÃ¸kkel) og skru pÃ¥ ""Stedfesting med Skriv""
# GÃ¥ til stedfesting og velg et vegobjekt
# Trykk pÃ¥ ""Stedfest vegobjekt"" uten Ã¥ velge veg

",NVDB-6937,Datafangst,
NullPointerException nÃ¥r bruker som ikke har satt passord forsÃ¸ker innlogging,"Jeg ser en del tilfeller av NullPointerException i loggen i forbindelse med innlogging. Ser ut som vi fÃ¥r dette nÃ¥r noen som har fÃ¥tt opprettet e-postbruker prÃ¸ver Ã¥ logge inn fÃ¸r hen har satt passord. Vi prÃ¸ver da Ã¥ parse et passord-objekt som er null, og det gÃ¥r jo dÃ¥rlig. GjÃ¸r en sjekk pÃ¥ om passord finnes, og logg en passende melding hvis det ikke gjÃ¸r det.

Eksempel fra logg: https://vegdata.kantega.no/kibana/goto/dcc69ce318369e3089f2a1f02c8ecba0

Stacktrace:
{noformat}
java.lang.NullPointerException: null
	at com.fasterxml.jackson.core.JsonFactory.createParser(JsonFactory.java:889)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3005)
	at no.svv.nvdb.datafangst.security.database.hashing.HashJsonEncoder.decode(HashJsonEncoder.java:22)
	at no.svv.nvdb.datafangst.security.database.DatabasePasswordManager.checkPassword(DatabasePasswordManager.java:55)
	at no.svv.nvdb.datafangst.security.database.DatabasePasswordManager.passwordCheck(DatabasePasswordManager.java:32)
	at no.svv.nvdb.datafangst.security.SecurityServiceImpl.login(SecurityServiceImpl.java:92)
	at no.svv.nvdb.datafangst.rest.SessionResource.login(SessionResource.java:52)
{noformat}
",NVDB-6937,Datafangst,
LocationalTrimmer bruker feilaktig NVDB-id nÃ¥r den tolker assosiasjoner,"h2. Observasjon

Loggen viser en del NPE i ParentChildLocationTrimmer. Ett eksempel (med kontekst): [https://vegdata.kantega.no/kibana/goto/6dca3f1529ace0a43e15d0b3d3bd31df]

Stacktrace:
{noformat}
java.lang.NullPointerException: null
	at no.svv.nvdb.datafangst.association.ParentChildLocationalTrimmer.ensureParentCoversChildren(ParentChildLocationalTrimmer.java:182)
	at no.svv.nvdb.datafangst.association.ParentChildLocationalTrimmer.lambda$ensureParentsCoverChildren$2(ParentChildLocationalTrimmer.java:121)
	at java.util.LinkedHashMap.forEach(LinkedHashMap.java:684)
	at no.svv.nvdb.datafangst.association.ParentChildLocationalTrimmer.ensureParentsCoverChildren(ParentChildLocationalTrimmer.java:117)
	at no.svv.nvdb.datafangst.association.AssociationServiceImpl.ensureInsideParent(AssociationServiceImpl.java:310)
	at no.svv.nvdb.datafangst.association.AssociationServiceImpl.ensureInsideParent(AssociationServiceImpl.java:300)
	at no.svv.nvdb.datafangst.association.AssociationServiceImpl.associateWithinContract(AssociationServiceImpl.java:211)
	at no.svv.nvdb.datafangst.association.AssociationServiceImpl.associateByProximity(AssociationServiceImpl.java:156)
	at no.svv.nvdb.datafangst.association.AssociationServiceImpl.associateByGeometricProximity(AssociationServiceImpl.java:66)
	at no.svv.nvdb.datafangst.rest.ContractResource.createAssociations(ContractResource.java:923)
{noformat}
Annen variant av stacktrace:
{noformat}
java.lang.NullPointerException: null
	at java.util.stream.MatchOps$1MatchSink.accept(MatchOps.java:90)
	at java.util.ArrayList$ArrayListSpliterator.tryAdvance(ArrayList.java:1361)
	at java.util.stream.ReferencePipeline.forEachWithCancel(ReferencePipeline.java:126)
	at java.util.stream.AbstractPipeline.copyIntoWithCancel(AbstractPipeline.java:499)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:486)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.MatchOps$MatchOp.evaluateSequential(MatchOps.java:230)
	at java.util.stream.MatchOps$MatchOp.evaluateSequential(MatchOps.java:196)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.allMatch(ReferencePipeline.java:521)
	at no.svv.nvdb.datafangst.association.ParentChildLocationalTrimmer.ensureParentCoversChildren(ParentChildLocationalTrimmer.java:182)
	at no.svv.nvdb.datafangst.association.ParentChildLocationalTrimmer.lambda$ensureParentsCoverChildren$2(ParentChildLocationalTrimmer.java:121)
	at java.util.LinkedHashMap.forEach(LinkedHashMap.java:684)
	at no.svv.nvdb.datafangst.association.ParentChildLocationalTrimmer.ensureParentsCoverChildren(ParentChildLocationalTrimmer.java:117)
	at no.svv.nvdb.datafangst.association.AssociationServiceImpl.ensureInsideParent(AssociationServiceImpl.java:304)
	at no.svv.nvdb.datafangst.association.AssociationServiceImpl.createAssociation(AssociationServiceImpl.java:118)
	at no.svv.nvdb.datafangst.rest.ContractResource.createAssociationManually(ContractResource.java:1018)
{noformat}
h2. Analyse

se
 [https://vegdata.kantega.no/kibana/app/kibana#/context/datafangst-logs-*/doc/90Yk5HQBAp1uBLZqqwBW?_a=(columns:!(_source),filters:!(),predecessorCount:5,sort:!('@timestamp',desc),successorCount:5)&_g=(refreshInterval:(pause:!t,value:0),time:(from:now%2FM,mode:quick,to:now%2FM))]

SÃ¥vidt jeg skjÃ¸nner sÃ¥ handler begge disse om at vi ikke har filtrert bort null-objekter nÃ¥r vi setter sammen listene. Kontrakten det refereres til over logger denne feilen nÃ¥r det prÃ¸ves Ã¥ gjÃ¸re en automatisk sammenkobling internt mellom SkjÃ¦ring og Bergsikring, men denne sammekoblingen ser ut til Ã¥ gÃ¥ helt fint nÃ¥. Kontrakten ligger i dev-miljÃ¸et.Â 

I det Ã¸verste tilfellet virker det innlysende at det er parent som er null. i det andre virker det plausibelt at det er en av children som er null. Det gjÃ¸res ikke noen filter pÃ¥ null eller isPresent i de underliggende kallene.

Siden jeg ikke klarer Ã¥ gjenskape denne feilen i praksis, sÃ¥ blir det litt spekulasjon. Ut i fra logikken vil denne feilen oppstÃ¥ hvis vi har vegobjekter som har bÃ¥de nvdbId og df-id, og vi gjÃ¸r en autoassosiasjon internt i prosjektet. Autoassosiasjonen gir oss en liste med assosiasjoner mellom DF-id,er men det er pÃ¥fÃ¸lgende logikk som reduserer vegobjektId-en til enten NVDB-id eller DF-id, og NVDB-id fÃ¥r prioritet. vegobjekterÂ  mappes om til Hashmap mellom NVDB-id og vegobjekt, og nÃ¥r det da itereres over assosiasjoner og vi setter sammen lister med parent- og child-vegojekter, refererer assosiasjonene til DF-IDer som resulterer i bom i oppslaget i hashmappen, og vi sender null-objekter til LocationalTrimmeren.

Og der fikk jeg til Ã¥ gjenskape feilen ogsÃ¥!

Feilen oppstÃ¥r som beskrevet over, fremsgangsmÃ¥te beskrevet i test-beskrivelsen.

Feilen oppstÃ¥r nÃ¥r foreldre lagres til Skriv fÃ¸r foreldrene fÃ¥r assosiasjon til barna. Da vil foreldrene fÃ¥ bÃ¥de NVDB-ID og DF-ID, og situasjonen som er beskrevet over oppstÃ¥r. Situasjonen vil ikke oppstÃ¥ hvis man ogsÃ¥ lagrer barna til NVDB fÃ¸r sammenkobling, fordi det ligger logikk i sammenkobling som forbyr sammenkobling til barn med NVDB-ID

Â Dette er feil i logikken som antakelig henger igjen fra gamle dager da vi ikke tillot endringer pÃ¥ NVDB-objekter.

Variant 2 vil pÃ¥ samme mÃ¥te kunne oppstÃ¥r nÃ¥r barn er lagret fÃ¸r parent ved en manuell sammenkobling (her gjÃ¸res ingen sjekk pÃ¥ pÃ¥ om barn har NVDB-ID)
h2. LÃ¸sning

Logikken som mapper om assosiasjoner til ID-er mÃ¥ tas bort, og istedet mÃ¥ foreldre og barn hentes ut basert pÃ¥ id-ene i assosiasjonene.

Helst bÃ¸r hele assosiasjons-bitenÂ  egentlig overhales.
 Dette henger sammen med importerte objekter og deres assosiasjoner, muligheten til Ã¥ assosiere imorterte barn, sletting av eksisterende assosiasjoner og muligheten til Ã¥ lagre vegobjekter flere ganger pÃ¥ en dag.Â 

Fjernet kall til Associaion.getUnifiedId() som alltid returnerte NVDB-id hvis den fantes.

Endret logikken som itererte over assocs og laget maps mellom parent og children til Ã¥ bruke genereation objekter. det gjÃ¸r koden mer lesbar og mer gjenbrukbar.

Det er en antakelse her om at en assosciation alltid har kun en parent og en child, enten i DF eller i NVDB. jeg ser ingenting som tyder pÃ¥ at det ikke alltid stemmer.Â 

Â 

Â 

Â ",NVDB-6937,Datafangst,
KontraktsomrÃ¥der og riksvegruter med mange stedfestinger,"API-et takler ikke kontraktsomrÃ¥der med veldig mange objekter. En rask lÃ¸sning pÃ¥ dette problemet ble Ã¥ fikse dette i databasen ved Ã¥ slÃ¥ sammen disse objektene (NVDB-5869).

Vi bÃ¸r ogsÃ¥ lÃ¸se dette i API-et for eventuelle nye tilfeller.

Forslag til lÃ¸sning (fra NVDB-5869):
 * Vi lagrer kontraktsnavn i tillegg til id for segmenter. Da kan vi bruke navn ved sÃ¸k, og fortsatt liste ut med id som nÃ¥.
 * /omrader/kontraktsomrader mÃ¥ forbedres litt for Ã¥ stÃ¸tte at det finnes flere objekter med samme navn. Enten et felt med alle id'ene eller et felt med en liste med urler til alle objektene(/vegobjekter/580/123/1).
 * Vi gjÃ¸r det samme for riksvegruter.",NVDB-6937,Les-API,
Sortere kontrakter stigande fÃ¸rst,"h1. Observasjon

Veg klikk pÃ¥ kolonneheader for Ã¥ sortere kontraker etter Ã¸nske vert dei sortert etter den kolonna i synkande rekkefÃ¸lge (Ã…â€“>A). Ved neste klikk vert dei sortert stigande.
h1. Ã˜nske

Stigande sortering er default ved fÃ¸rste klikk.",NVDB-6937,Datafangst,
Linje fra stedfesting er pÃ¥ tur,"h2. Observasjon

Se vedlagt bilde av Skjerm i kontrakt:Â [https://datafangst-test.kantega.no/#!/contract/7102bbbb-7835-413f-81e0-6cf234a7dc29/locational2]

Her gÃ¥r linjen fra stedfestingspunkt til vegen og ikke til objektet.
h2. Analyse

Feilen kan gjenskapes ved Ã¥ forÃ¸ke Ã¥ importere linjeobjekter fra API:

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

Alle stedfestede objekter mÃ¥ ha en projection WKT. projection er ikke noe som ligger lagret i NVDB, men er noe Datafangst bruker for Ã¥ visualisere hvor en stedfesting ligger i forhold til objektet som er stedfestet, i stedfestingsfanen vises projection som strekene som gÃ¥r fra objektets ender og til veien de er stedfesteet.

Ved import fra API genereres det ikke noen projection WKT, men projection WKT settes istedet til Ã¥ vÃ¦re det samme som stedfestings-WKTen. Dermed tegnes linjene men de blir helt feil. i dette eksempelet slÃ¥r det ut slik at projection tegnes som en linje fra starten av stedfestingen til slutten.
h2. LÃ¸sningÂ 

Iterere over de importerte vegobjektene og generere projectionÂ 

Â ",NVDB-6937,Datafangst,
UnngÃ¥ lÃ¥sekonflikt mot vegnett,"h2. Bakgrunn

Vi Ã¸nsker Ã¥ fjerne sekundÃ¦rlÃ¥s mot vegsystem ved reine fagdatainnsjekk for Ã¥ unngÃ¥ lÃ¥sekonflikt der vegnett gjer ""stÃ¸rre"" oppdateringar. Det vil gi ein stor gevist for betre flyt under objektoppdatering og ha ein minimal risikoauke for feil.Â 

Ref: e-postsak med Tore, Hans Anton og Vilhelm m.fl.

Â 
{quote}*Fra:*Â Tore Eide Andersen <[Tore.Eide.Andersen@kantega.no|mailto:Tore.Eide.Andersen@kantega.no]>Â 
 *Sendt:*Â mandag 14. september 2020 13:54
 *Til:*Â Ã…lien Hans Anton <[hans.alien@vegvesen.no|mailto:hans.alien@vegvesen.no]>
 *Kopi:*Â Jensen Jan Kristian <[jan.kristian.jensen@vegvesen.no|mailto:jan.kristian.jensen@vegvesen.no]>; StÃ¸eng Linda Therese <[linda.stoeng@vegvesen.no|mailto:linda.stoeng@vegvesen.no]>; Gjendem TorbjÃ¸rn <[torbjorn.gjendem@vegvesen.no|mailto:torbjorn.gjendem@vegvesen.no]>; BÃ¸rnes Vilhelm <[vilhelm.bornes@vegvesen.no|mailto:vilhelm.bornes@vegvesen.no]>; Ekker Hans JÃ¸rgen <[hans.jorgen.ekker@vegvesen.no|mailto:hans.jorgen.ekker@vegvesen.no]>; RÃ¸nningen Kjetil <[kjetil.ronningen@vegvesen.no|mailto:kjetil.ronningen@vegvesen.no]>; RÃ¸dal Liv Helen <[liv.rodal@vegvesen.no|mailto:liv.rodal@vegvesen.no]>; Mauseth JÃ¸rn <[jorn.mauseth@vegvesen.no|mailto:jorn.mauseth@vegvesen.no]>
 *Emne:*Â Re: LÃ¥sekonflikter i SKRIV
Â 

Hei,Â 

LÃ¥sing av de objekttypene som skal registreres skjer â€œmidtveisâ€ i behandlingen, etter at all beriking og innlesing fra NVDB er ferdig. De lÃ¥ses altsÃ¥ samtidig med de sekundÃ¦rlÃ¥sene vi snakker om her.

Det er ingen andre konsekvenser enn potensiell â€œfeilâ€ autorisasjon av endringssettet, dersom Vegsystem ikke sekundÃ¦rlÃ¥ses. Men som nevnt tidligere, sannsynligheten er liten. Fagdatainnsjekk tar sjelden mer enn et par sekunder. NÃ¥r bÃ¥de sannsynlighet og konsekvens er liten, blir ogsÃ¥ risikoen minimal.

Hans Anton skriver â€œSlik jeg oppfatter det, vil fjerning av denne sekundÃ¦rlÃ¥sen medfÃ¸re at vi validerer mot vegnettet slik det faktisk er nÃ¥r fagdatainnsjekekt skjer, ogÂ ikke slik det vil bli nÃ¥r evt. pÃ¥gÃ¥ende vegnettsinnsjekk er ferdig.â€

I et ekstremt tilfelle kan et vegnettsinnsjekk vÃ¦re fullfÃ¸rt 1 millisekund etter at Vegsystem-objektene er lest inn under behandling av vÃ¥rt endringssett. Halvparten av behandlingen gjenstÃ¥r og vil da validere og autorisere mot et annet vegnett enn det som finnes i NVDB. Men, dette er hvis, sÃ¥fremt, i fall. Og som sagt er det ingen risiko for datakvaliteten. Faren for vranglÃ¥s er minimal, mener jeg. Denne mekanismen for lÃ¥sing under behandling (optimistisk lÃ¥sing) er har vÃ¦rt i drift siden 2014, uten problemer.

Ã… droppe sekundÃ¦rlÃ¥sing av Vegsystem for rene fagdatainnsjekk er en enkel sak. Jeg estimerer en halv dags jobb, inkludert testing.

Tore
Â 

On 14 Sep 2020, at 10:01, Ã…lien Hans Anton <[hans.alien@vegvesen.no|mailto:hans.alien@vegvesen.no]> wrote:


Takk, Tore, for tydelig og konkret oppklaring!

Jeg mener vi kan leve godt med Ã¥ fjerne denne ekstra lÃ¥seprosessen i forbindelse med validering av fagdataredigeringsinnsjekk. Fordelen er Ã¥penbar â€“ fÃ¦rre lÃ¥sekonflikter og dermed enklere og raskere lagring av data til NVDB.

Slik jeg oppfatter det, vil fjerning av denne sekundÃ¦rlÃ¥sen medfÃ¸re at vi validerer mot vegnettet slik det faktisk er nÃ¥r fagdatainnsjekekt skjer, og ikke slik det vil bli nÃ¥r evt. pÃ¥gÃ¥ende vegnettsinnsjekk er ferdig.

Jeg antar at vegobjektet som skal sjekkes inn uansett allerede er lÃ¥st pÃ¥ dette tidspunktet, slik at vi ikke risikerer vranglÃ¥s med evt. lÃ¥s i forb. Med fÃ¸lgeoppdatering av pÃ¥gÃ¥ende vegnettsinnsjekk.

Tore, er min antakelse riktig? Â Ser du noen negative konsekvenser ved Ã¥ fjerne denne sekundÃ¦rlÃ¥sprosessen ved validering av fagdatainnsjekk, i tillegg til det du nevner ang. tilgangskontroll? Hvordan vil du anslÃ¥ estimat for gjennomfÃ¸ring og testbehov for en slik endring?

Jeg vet ikke hvem som skal bestemme dette, men hÃ¥per det kan skje raskt.Â  Fins det noen historikk her, dvs. spor av en diskusjon/beslutning om Ã¥ benytte nÃ¥vÃ¦rende metode?

Uansett, hva mener dere andre?

Hilsen NVDB-forvaltningen,

Hans Anton
Â 

*Fra:*Â Tore Eide Andersen <[Tore.Eide.Andersen@kantega.no|mailto:Tore.Eide.Andersen@kantega.no]>Â 
 *Sendt:*Â sÃ¸ndag 13. september 2020 20:49
 *Til:*Â Ã…lien Hans Anton <[hans.alien@vegvesen.no|mailto:hans.alien@vegvesen.no]>
 *Kopi:*Â Jensen Jan Kristian <[jan.kristian.jensen@vegvesen.no|mailto:jan.kristian.jensen@vegvesen.no]>; StÃ¸eng Linda Therese <[linda.stoeng@vegvesen.no|mailto:linda.stoeng@vegvesen.no]>; Gjendem TorbjÃ¸rn <[torbjorn.gjendem@vegvesen.no|mailto:torbjorn.gjendem@vegvesen.no]>; Ekker Hans JÃ¸rgen <[hans.jorgen.ekker@vegvesen.no|mailto:hans.jorgen.ekker@vegvesen.no]>; RÃ¸nningen Kjetil <[kjetil.ronningen@vegvesen.no|mailto:kjetil.ronningen@vegvesen.no]>
 *Emne:*Â Re: LÃ¥sekonflikter i SKRIV

Hei,

Endringssettet Ã¸nsker bl.a. Ã¥ etablere fÃ¸lgende sekundÃ¦rtlÃ¥ser under behandling:

1) \{featureTypes=[{ftid=532, lt=SECONDARY, lr=REFLINK_OR_NETNODE_RELEVANT}], refLinks=[0.0-1.0@1215887,Â [0.0-1.0@922839|mailto:0.0-1.0@922839],Â [0.0-1.0@922835|mailto:0.0-1.0@922835]], isLockingNetwork=false}

2) \{featureTypes=[{ftid=915, lt=SECONDARY, lr=REFLINK_OR_NETNODE_RELEVANT}], refLinks=[0.0-1.0@1215934,Â [0.0-1.0@1215887|mailto:0.0-1.0@1215887],Â [0.0-1.0@922839|mailto:0.0-1.0@922839],Â [0.0-1.0@2804983|mailto:0.0-1.0@2804983],Â [0.0-0.12747561@928126|mailto:0.0-0.12747561@928126],Â [0.0-1.0@1215731|mailto:0.0-1.0@1215731],Â [0.0-1.0@1215885|mailto:0.0-1.0@1215885],Â [0.0-1.0@1215957|mailto:0.0-1.0@1215957],Â [0.0-1.0@1215972|mailto:0.0-1.0@1215972],Â [0.0-1.0@2722940|mailto:0.0-1.0@2722940],Â [0.0-1.0@2722944|mailto:0.0-1.0@2722944],Â [0.0-1.0@2722945|mailto:0.0-1.0@2722945],Â [0.0-1.0@922835|mailto:0.0-1.0@922835],Â [0.0-1.0@922861|mailto:0.0-1.0@922861]], isLockingNetwork=false}

Disse kommer i konflikt med fÃ¸lgende eksisterende lÃ¥s:Â [https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/locks?blockingJobId=69313562-efef-4a92-8394-d183a6b6c082]

Hvorfor skal det etableres sekundÃ¦rlÃ¥s pÃ¥ Vegreferanse (532) og Vegsystem (915)?

I endringssettet registreres tre nye vegobjekter av type 905. Under behandling hentes de veglenkesekvensene som de tre vegobjektene er stedfestet pÃ¥ fra NVDB. Dette er veglenkesekvensene 922839, 922835 og 1215887. Som en del av valideringen skal det undersÃ¸kes om bruker har rettigheter til Ã¥ registrere vegobjekter pÃ¥ vegnett med gitte vegkategorier. Nettelementene har ikke denne informasjonen, derfor mÃ¥ Vegsystem-objektene som dekker det aktuelle vegnettet leses inn fra NVDB. Vegobjekter som er innlest for Ã¥ brukes under validering mÃ¥ vÃ¦re uendrede sÃ¥ lenge valideringen pÃ¥gÃ¥r. Derfor lÃ¥ses Vegsystem-objektene med en sekundÃ¦rlÃ¥s pÃ¥ det vegnettet de stedfestet pÃ¥. De aktuelle Vegsystem-objektene kan ha stedfesting som gÃ¥r utenfor de tre interessante veglenkesekvensene og vil derfor kunne komme i konflikt med vegnettsredigering i ""nÃ¦romrÃ¥det"".

Ã…rsaken til at Vegreferanse-objekter hentes inn skyldes at det skal valideres at nytt og endret vegnett er dekket av Vegreferanse-objekter (der det er aktuelt). I endringssettet gjÃ¸res ingen endring pÃ¥ vegnettet, sÃ¥ innlesingen av 532 kunne vÃ¦rt droppet. At det fortsatt hentes Vegreferanse-objekter for innlest (uendret) vegnett er noe som henger igjen fra den gangen vegkategori ble hentet fra slike vegobjekttyper. Ã… fikse dette er sÃ¥ enkelt som Ã¥ slette 4 tegn (READ).

Hva sÃ¥ med Vegsystem, trenger vi egentlig sekudÃ¦rlÃ¥s pÃ¥ disse? Om vi dropper det vil fagdatainnsjekk kunne slippe gjennom med endring pÃ¥ vegkategorier som brukeren ikke har tilgang til, men bare dersom det gjÃ¸res et vegnettsinnsjekk der vegkategori endres pÃ¥ de aktuelle Vegsystem-objektene i lÃ¸pet av den normalt svÃ¦rt korte behandlingstiden som fagdatainnsjekk har. Risikoen handler altsÃ¥ om tilgangskontroll og ikke datakvalitet i NVDB. Sannsynligheten for at dette skal skje er rimelig liten, vil jeg tro. Men, dere fÃ¥r vurdere om jeg skal gjÃ¸re noe med dette.

Vennlig hilsen

Tore Eide Andersen
Â 

On 11 Sep 2020, at 14:15, Ã…lien Hans Anton <[hans.alien@vegvesen.no|mailto:hans.alien@vegvesen.no]> wrote:


Dette mÃ¥ vi finne ut av. Takk, Jan Kristian, for konkret Â»caseÂ»!

Vedlagte skript-logg viser alle lÃ¥ser i NVDB for litt siden, bl.a. ransko sin lÃ¥s og hvilke objekttyper som lÃ¥ses.

Og jeg finner ikke 905 blant dem, men derimot div. vegnettsrelaterte objekttyper.

grep '18381709 .* 905' listAllLocksWithTypes.log

gir ingen treff.

Tore, kan du lÃ¸se mysteriet for oss?

Hilsen Hans Anton â€“ og Linda og Jan Kristian m.fl.
Â 

*Fra:*Â Jensen Jan Kristian <[jan.kristian.jensen@vegvesen.no|mailto:jan.kristian.jensen@vegvesen.no]>Â 
 *Sendt:*Â fredag 11. september 2020 13:58
 *Til:*Â Tore Eide Andersen <[Tore.Eide.Andersen@kantega.no|mailto:Tore.Eide.Andersen@kantega.no]>; StÃ¸eng Linda Therese <[linda.stoeng@vegvesen.no|mailto:linda.stoeng@vegvesen.no]>
 *Kopi:*Â Gjendem TorbjÃ¸rn <[torbjorn.gjendem@vegvesen.no|mailto:torbjorn.gjendem@vegvesen.no]>; Ã…lien Hans Anton <[hans.alien@vegvesen.no|mailto:hans.alien@vegvesen.no]>; Ekker Hans JÃ¸rgen <[hans.jorgen.ekker@vegvesen.no|mailto:hans.jorgen.ekker@vegvesen.no]>; RÃ¸nningen Kjetil <[kjetil.ronningen@vegvesen.no|mailto:kjetil.ronningen@vegvesen.no]>
 *Emne:*Â RE: LÃ¥sekonflikter i SKRIV

Bruksklasse-objektene har ingen relasjoner til noe som helst.

Men dette endringssettet er like fullt blokkert av en vegnettslÃ¥s: 69313562-efef-4a92-8394-d183a6b6c082
Â 

*From:*Â Tore Eide Andersen <[Tore.Eide.Andersen@kantega.no|mailto:Tore.Eide.Andersen@kantega.no]>Â 
 *Sent:*Â fredag 11. september 2020 12:50
 *To:*Â StÃ¸eng Linda Therese <[linda.stoeng@vegvesen.no|mailto:linda.stoeng@vegvesen.no]>
 *Cc:*Â Gjendem TorbjÃ¸rn <[torbjorn.gjendem@vegvesen.no|mailto:torbjorn.gjendem@vegvesen.no]>; Jensen Jan Kristian <[jan.kristian.jensen@vegvesen.no|mailto:jan.kristian.jensen@vegvesen.no]>; Ã…lien Hans Anton <[hans.alien@vegvesen.no|mailto:hans.alien@vegvesen.no]>; Ekker Hans JÃ¸rgen <[hans.jorgen.ekker@vegvesen.no|mailto:hans.jorgen.ekker@vegvesen.no]>; RÃ¸nningen Kjetil <[kjetil.ronningen@vegvesen.no|mailto:kjetil.ronningen@vegvesen.no]>
 *Subject:*Â Re: LÃ¥sekonflikter i SKRIV

Hei,Â 

Jeg har laget et nytt testcase som fÃ¸rst etablerer en vegnettslÃ¥s pÃ¥ en vehglenkesekvens og inkluderer en vegobjekttype. Deretter prÃ¸ver jeg Ã¥ etablere en fagdatalÃ¥s pÃ¥ samme veglenkesekvens, men for en annen vegobjekttype. Dette gÃ¥r fint, ingen konflikt blir rapportert.

Det er imidlertid en â€œgotchaâ€ her. LÃ¥sedefinisjonen fra klienten blir jo som kjent utvidet med sekunderlÃ¥ser for alle vegobjekttyper som angitt vegobjekttype har assosiasjon til. Dette kan fort skape konflikter i scenariet over. Hvis f.eks. den andre lÃ¥sen inneholder en vegobjekttype som er datterobjekt av den vegobjekttypen som ble lÃ¥st i fÃ¸rste lÃ¥s, vil vi fÃ¥ en konflikt.

Tore
Â 

On 10 Sep 2020, at 14:00, StÃ¸eng Linda Therese <[linda.stoeng@vegvesen.no|mailto:linda.stoeng@vegvesen.no]> wrote:

Hei!

I Ã¸yeblikket jobbes det hardt med oppdatering av bruksklasse-objektene i NVDB. De som jobber med disse har lagt opp til en arbeidsprosess som gjÃ¸r at de bare tar ut det vegnettet de skal oppdatere pÃ¥, uavhengig av om objektene dekker stÃ¸rre omrÃ¥de. Konkret betyr dette at de fÃ¥r problemer dersom et objekt er stedfestet pÃ¥ f.eks. bÃ¥de kommunal veg og fylkesveg, eller om et objekt er stedfestet pÃ¥ to forskjellige vegnummer. (Dette er bare litt bakgrunnsinfo, og har ikke noe med selve problemet vÃ¥rt Ã¥ gjÃ¸re.)

For Ã¥ lette pÃ¥ denne arbeidsprosessen for denne gjengen, sÃ¥ har Jan Kristian laget et opplegg der han henter ut alle bruksklasseobjekter som er stedfestet pÃ¥ flere vegkategorier eller flere vegnummer. (Og flere trafikantgrupper tror jeg.) NÃ¥r han da skal sjekke inn endringen til NVDB gjennom Skriv, sÃ¥ fÃ¥r han lÃ¥sekonflikt dersom noen av disse objektene er stedfestet pÃ¥ lenker som er lÃ¥st i et vegnettsredigeringsprosjekt. Dette gjelder da selv om vegnettsredigeringsprosjektet ikke har med seg den objekttypen Jan Kristian endrer.Â 

Dersom det faktisk er sÃ¥nn skriv fungerer, og er ment Ã¥ fungere (?), sÃ¥ betyr vel ogsÃ¥ dette at man ikke fÃ¥r sjekket inn noen endringer pÃ¥ skilt eller dekker eller hva det mÃ¥tte vÃ¦re i alle omrÃ¥dene vi har et vegnettsprosjekt ute? SÃ¥nn kan det i sÃ¥ fall ikke vÃ¦reâ€¦ I klassisk fÃ¥r man sjekket inn endringer i slike tilfeller.

Mvh Linda
{quote}

h2. Analyse

Som angitt i epostutvekslingen over skal vi droppe sekundÃ¦rlÃ¥sing av innleste Vegsystem-objekter under behandling av rene fagdatainnsjekk.

h2. LÃ¸sning

Filtrerer bort vegobjekter av Vegsystem med operasjon READ i JobWorker.lockOptimistically() ved kall til LockService.getLocksNeededForFeatures().
",NVDB-6937,Skriv-API,
Feil i sortering av kategori,"Kategoriar er ikkje alltid rett sortert (alfabetisk/numerisk).

Innmeldt sak av Nikolaj Fyhn
E-postadresse: nikolaj.fyhn@vegvesen.no:
{quote}Utdypning av hva henvendelsen gjelder: 
NÃ¥r man kategoriser en objekttype i vegkart bÃ¸r verdiene alltid sorteres i henhold til ""sorteringsnummeret"" fra datakatalogen.

Eksempler pÃ¥ feil:

Funksjonsklasse skal sorteres med A fÃ¸rst og E til slutt:
https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@199905,6563117,10/hva:~(~(category~(type~'enum~id~11216)~id~912))/hvor:~(kommune~(~3806))

Fartsgrense skal sorteres med lavest fartsgrense fÃ¸rst:
https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@199905,6563117,10/hva:~(~(category~(type~'enum~id~2021)~id~105))/hvor:~(kommune~(~3806))
{quote}",NVDB-6937,Vegkart,
Feilaktig returnert rutesegment gitt tid,"h2. Observasjon

Denne er riktig

[https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute?start=13538.741999999387,6696449.226&slutt=15041.6770000002,6696842.327999998&maks_avstand=10&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&pretty=true&tidspunkt_start=2011-03-20&tidspunkt_slutt=2011-03-24&kortform=false]

Men denne gir samme svar

[https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute?start=13538.741999999387,6696449.226&slutt=15041.6770000002,6696842.327999998&maks_avstand=10&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&pretty=true&tidspunkt_start=2011-03-20&kortform=false]

Her er sluttdato satt Ã¥pen, og da bÃ¸r ikke segment med sluttdato 2011-03-25 vÃ¦rt med.",NVDB-6937,Les-API,
"Systemfeil med ""unable to locate feature"" ved stedfesting","Ser ut som denne dukka opp med 2.4.0, finner i alle fall ikke feilen fÃ¸r det.
Vi feiler nÃ¥r vi skal finne et NVDB-objekt ved koordinering av stedfesting.
Eksempel fra logg: https://vegdata.kantega.no/kibana/goto/d05807b308d71c7a89788a41ed027312",NVDB-6937,Datafangst,
Automatisk stedfesting stedfester FKB-objekter,"NÃ¥r jeg tar automatisk stedfesting for en vegobjektstype viser det seg at evetuelle FKB-vegobjekter med sakke type i kontrakten ogsÃ¥ fÃ¥r stedfesting. FKB-objekter har ikke behov for stedfesting, siden dette er spesifikt til NVDB.

Antar at spÃ¸rring som henter relevante vegobjekter for automatisk stedfesting trenger et ekstra parameter for Ã¥ kun hente NVDB-objekter.

I tillegg bÃ¸r vi rydde i databasen og slette alle stedfestinger som er gjort pÃ¥ FKB-objekter. Vi trenger et Flyway-script som kan rydde opp i eksisterende stedfestinger.

For Ã¥ reprodusere, last opp to vedlagte filer (""FKB46_veg.sos"" som FKB, den andre som NVDB) og kjÃ¸r automatisk stedfesting.",NVDB-6937,Datafangst,
Tillate bruker Ã¥ trykke `enter` i stedet for OK,"`enter` bÃ¸r kunne brukes i stedet for museklikk for:

Kontraktgrupper og brukere -> Ny kontraktgruppe: ""OK""

Kontraktgrupper og brukere -> Brukere: ""Legg til""",NVDB-6937,Datafangst,
NullPointerException ved stedfesting med Skriv,"h2. Observasjon
Finner en del av denne i loggen:
java.lang.NullPointerException: null at no.svv.nvdb.datafangst.integration.nvdbapi.DefaultNvdbWriteApiGateway.toFase(DefaultNvdbWriteApiGateway.java:270)

I det ene tilfellet jeg har kikket nÃ¸yere pÃ¥ sÃ¥ skjer dette i forbindelse med redigering av geometri, og formodentlig at objekt automatisk blir stedfestet pÃ¥ nytt ved redigering: https://vegdata.kantega.no/kibana/goto/04e6350d7be3c09bd4b1bd086d0d049e
Har ikke sett pÃ¥ om det er det samme for andre.

h2. Analyse
Alle disse kommer fra automatisk stedfesting nÃ¥r vegkategori og -nummer er satt i kontrakten, men status ikke er satt.

h2. LÃ¸sning
Problemet var at vi prÃ¸ver Ã¥ mappe en null-verdi fra kontrakten. Testing viser imidlertid at denne ikke kan vÃ¦re tom ved innsending, sÃ¥ skrevet om til Ã¥ alltid oppgi verdier som beskrevet i analyse.",NVDB-6937,Datafangst,
Feiler med endring av sideposisjon,"h2. Observasjon

(fra support pÃ¥ Datafangst, Raymond).

Et 335-objekt er datter av et 3-objekt. Begge NVDB-objekter. Disse ligger med sideposisjon V i NVDB. I Endringen fra Datafangst er begge endret til H. Men Skriv klager over at datter ikke har samme sideposisjon som mor.

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/335/377099404/1]
[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3/101895592/5]
[https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/0e432a08-d641-4381-9f28-bdc36bbd4b7f]

*MERK* at det ogsÃ¥ er en overlappsfeil i endringen, men den er grei nok.

h2. Analyse

h3. STEDFESTING_UTENFOR_MOROBJEKT (CoveredByParentValidator)

Feilmelding: 377099398:1 DelvisOppdater Objektet har ikke stedfesting som fullstendig dekkes av morobjekt av type Skjerm (3): nvdbId 377099396:1

*Morobjektversjon*

{noformat}
typeId=3,operation=READ,nvdbId=377099396,version=1,validFrom=2013-04-30,validTo=2020-07-22,attributes=[LocationalAttribute{typeId=120003, operation=READ, values=[LocationalValue{typeId=100003, operation=READ, data=521397: 0.70615913<-0.71041502 | RIGHT}]}, AssociationAttribute{typeId=220454, operation=READ, values=[AssociationValue{typeId=200454, operation=READ, data=377099398}]}],procInfo=ProcessingInfo{nvdbAction=NONE, extension=true, extensionOrigin='ReadMissingParentFeaturesEnricherFilter', validationRequired=false, cascadingOperation=false, lifetimeChanged=false, removedAttributeTypeIds=[]}]
{noformat}

Stedfesting: 521397: 0.70615913<-0.71041502 | RIGHT

I endringssettet: v2 med gyldighet fra 2020-07-22 oppdateres med overskriv til 521397: 0.70615909->0.71041488 | LEFT

*Datterobjektversjon*

{noformat}
typeId=335,operation=MODIFY_IN_PLACE,nvdbId=377099398,version=1,validFrom=2013-04-30,validTo=<null>,attributes=[RealAttribute{typeId=2248, operation=READ, values=[RealValue{typeId=2248, operation=READ, data=5.0}]}, RealAttribute{typeId=7566, operation=READ, values=[RealValue{typeId=7566, operation=READ, data=9.0}]}, LocationalAttribute{typeId=120335, operation=UPDATE, values=[LocationalValue{typeId=100335, operation=IMPLICIT, data=521397: 0.70613329-0.71039652 | LEFT}]}],procInfo=ProcessingInfo{nvdbAction=UPDATE, extension=false, extensionOrigin='null', validationRequired=true, cascadingOperation=false, lifetimeChanged=false, removedAttributeTypeIds=[]}]
{noformat}

Stedfesting: 521397: 0.70613329-0.71039652 | LEFT

*Konklusjon*

Korrekt feilmelding fordi v1 av morobjektet i NVDB har overlappende gyldighet med datterobjektet, men dekker ikke stedfestingen til den oppdaterte datterobjektversjonen i endringssettet.

h3. STEDFESTING_INNENFOR_MOROBJEKT_MEN_ANNEN_SIDEPOSISJON (CoveredByParentValidator)

Feilmelding: 377099404:1 DelvisOppdater Objektet har stedfesting som fullstendig dekkes av morobjekt av type Skjerm (3), men sideposisjonene er forskjellige: nvdbId 101895592:4

*Morobjektversjon*

{noformat}
typeId=3,operation=READ,nvdbId=101895592,version=4,validFrom=2013-04-30,validTo=2020-07-24,attributes=[LocationalAttribute{typeId=120003, operation=READ, values=[LocationalValue{typeId=100003, operation=READ, data=521397: 0.6900282<-0.69876732 | LEFT}]}, AssociationAttribute{typeId=220454, operation=READ, values=[AssociationValue{typeId=200454, operation=READ, data=377099404}]}],procInfo=ProcessingInfo{nvdbAction=NONE, extension=true, extensionOrigin='ReadMissingParentFeaturesEnricherFilter', validationRequired=false, cascadingOperation=false, lifetimeChanged=false, removedAttributeTypeIds=[]}]
{noformat}

Stedfesting: 521397: 0.6900282<-0.69876732 | LEFT

I endringssettet: v5 med gyldighet fra 2020-07-24 oppdateres med overskriv til 521397: 0.69002807->0.69876715 | RIGHT

*Datterobjektversjon*

{noformat}
typeId=335,operation=MODIFY_IN_PLACE,nvdbId=377099404,version=1,validFrom=2013-04-30,validTo=<null>,attributes=[RealAttribute{typeId=2248, operation=READ, values=[RealValue{typeId=2248, operation=READ, data=10.0}]}, RealAttribute{typeId=7566, operation=READ, values=[RealValue{typeId=7566, operation=READ, data=10.0}]}, LocationalAttribute{typeId=120335, operation=UPDATE, values=[LocationalValue{typeId=100335, operation=IMPLICIT, data=521397: 0.69002807-0.69876715 | RIGHT}]}],procInfo=ProcessingInfo{nvdbAction=UPDATE, extension=false, extensionOrigin='null', validationRequired=true, cascadingOperation=false, lifetimeChanged=false, removedAttributeTypeIds=[]}]
{noformat}

Stedfesting: 521397: 0.69002807-0.69876715 | RIGHT

*Konklusjon*

Korrekt feilmelding fordi v4 av morobjektet i NVDB har overlappende gyldighet med den oppdaterte datterobjektversjonen i endringssettet, og dekker datterobjektversjonens stedfesting (med litt toleranse), men har ulik sideposisjon (og typeId 335 krever identisk sideposisjon).

h3. STEDFESTING_DEKKER_IKKE_DATTEROBJEKT (CoversChildValidator)

Feilmelding: 377099396:2 DelvisOppdater Objektet har ikke stedfesting som fullstendig dekker datterobjekt av type AvstandsmÃ¥ling (335): nvdbId 377099398:1

*Morobjektversjon*

{noformat}
typeId=3,operation=MODIFY_IN_PLACE,nvdbId=377099396,version=2,validFrom=2020-07-22,validTo=<null>,attributes=[AssociationAttribute{typeId=220454, operation=READ, values=[AssociationValue{typeId=200454, operation=READ, data=377099398}]}, RealAttribute{typeId=1352, operation=READ, values=[RealValue{typeId=1352, operation=READ, data=78.0}]}, StringAttribute{typeId=1546, operation=READ, values=[StringValue{typeId=1546, operation=READ, data=Fylkeskommune}]}, StringAttribute{typeId=1549, operation=READ, values=[StringValue{typeId=1549, operation=READ, data=Fylkeskommune}]}, RealAttribute{typeId=1296, operation=READ, values=[RealValue{typeId=1296, operation=READ, data=31.0}]}, RealAttribute{typeId=9823, operation=READ, values=[RealValue{typeId=9823, operation=READ, data=2.5}]}, StringAttribute{typeId=1247, operation=READ, values=[StringValue{typeId=1247, operation=READ, data=StÃ¸yskjerm}]}, LocationalAttribute{typeId=120003, operation=UPDATE, values=[LocationalValue{typeId=100003, operation=IMPLICIT, data=521397: 0.70615909-0.71041488 | LEFT}]}, StringAttribute{typeId=1087, operation=READ, values=[StringValue{typeId=1087, operation=READ, data=Tre}]}],procInfo=ProcessingInfo{nvdbAction=UPDATE, extension=false, extensionOrigin='null', validationRequired=true, cascadingOperation=false, lifetimeChanged=false, removedAttributeTypeIds=[]}]
{noformat}

Stedfesting: 521397: 0.70615909-0.71041488 | LEFT

*Datterobjektversjon*

{noformat}
typeId=335,operation=MODIFY_IN_PLACE,nvdbId=377099398,version=1,validFrom=2013-04-30,validTo=<null>,attributes=[RealAttribute{typeId=2248, operation=READ, values=[RealValue{typeId=2248, operation=READ, data=5.0}]}, RealAttribute{typeId=7566, operation=READ, values=[RealValue{typeId=7566, operation=READ, data=9.0}]}, LocationalAttribute{typeId=120335, operation=UPDATE, values=[LocationalValue{typeId=100335, operation=IMPLICIT, data=521397: 0.70613329-0.71039652 | LEFT}]}],procInfo=ProcessingInfo{nvdbAction=UPDATE, extension=false, extensionOrigin='null', validationRequired=true, cascadingOperation=false, lifetimeChanged=false, removedAttributeTypeIds=[]}]
{noformat}

Stedfesting: 521397: 0.70613329-0.71039652 | LEFT

*Konklusjon*
Samme som fÃ¸rste tilfelle, bare sett fra morobjektet.
",NVDB-6937,Datafangst,
Feil mapping av valgt veg fra bruker,"h2. Observasjon

Importer fÃ¸lgende url-er som Korriger

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/335?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

GÃ¥ til stedfesting og manuelt stedfest (med Skriv) SkjermÂ 101895592 og AvstandsmÃ¥lingÂ 377099404 til nÃ¦rmeste vei. Da gir Skriv beskjed om _Ingen relevant vegnettstilknytning ble funnet._

Kallet som gÃ¥r til Skriv er

/nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegnummer=32&vegkategori=F&typeVeg=ENKEL_BILVEG&fase=V

Fra Vegkart ser det ut til at det her ikke eksisterer noen typeVeg ""enkelBilveg"", men kun ""kanalisertVeg"". Se

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@194926,6567452,18/hva:~(~(id~335)~(id~3))/vegnett:~'geometri+~(typeveg~(~'enkelBilveg))]

vs

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@194926,6567452,18/hva:~(~(id~335)~(id~3))/vegnett:~'geometri+~(typeveg~(~'kanalisertVeg))]

Derfor vil man ikke fÃ¥ stedfestet disse objektene.

h2. LÃ¸sning
Vi spÃ¸r fra fÃ¸r Les om typeVeg for vegsegment, siden vi ikke har dette fra VisvegInfo. SÃ¥ ENKEL_BILVEG kommer ogsÃ¥ fra Les. Men vi har sÃ¥ langt bare gitt det fÃ¸rste svaret vi finner for typeVeg fra Les, men Skriv (og les) stÃ¸tter en liste med parametre. SÃ¥ kode er endret til at vi sender inn alle typer for et vegsegment.",NVDB-6937,Datafangst,
Finner ingen stedfesting oppdaterer feilaktig venstremeny,"h2. Observasjon

Importer fÃ¸lgende url-er som Korriger

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/335?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3?segmentering=true&kartutsnitt=194782.071%2C6567374.944%2C195070.715%2C6567529.56&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter]

GÃ¥ til stedfesting og manuelt stedfest (med Skriv) SkjermÂ 101895592 og AvstandsmÃ¥lingÂ 377099404 til nÃ¦rmeste vei. Da gir Skriv beskjed om _Ingen relevant vegnettstilknytning ble funnet_ og objektene blir oppdaterte i venstremenyen med mangler stedfesting. Reload sÃ¥ ser du at de fortsatt har samme stedfesting. Ingenting er endret.

Her bÃ¸r ikke GUI oppdateres med _mangler stedfesting_.",NVDB-6937,Datafangst,
HTTP 500 for /rute,"h2. Observasjon

POST [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?debug=true]
{noformat}
{""geometri"":""LINESTRING (229301.02 7039446.87, 229301.41 7039449.31, 229299.77 7039455.35, 229299.01 7039463.36, 229299.22 7039472.76, 229300.56 7039481.37, 229306.87 7039503.02, 229307.37 7039513.2, 229307.59 7039519.65, 229309.22 7039530.13, 229312.88 7039538.3, 229316.38 7039543.5, 229322.49 7039549.66, 229327.61 7039555.05, 229333.64 7039561.17, 229337.46 7039565.74, 229341.86 7039570.04, 229345.01 7039573.93, 229350.93 7039586.31, 229353.64 7039591.51, 229358.44 7039597.88, 229370.03 7039611.57, 229373.83 7039617.57, 229376.88 7039628.2, 229378.28 7039633.68, 229379.99 7039640.6, 229383.44 7039652.78, 229386.12 7039659.54, 229395.47 7039677.39, 229402.85 7039688.27, 229405.27 7039692.48, 229405.78 7039693.41, 229406.8 7039696.09, 229407.78 7039698.85, 229408.88 7039702.42, 229409.98 7039706.3, 229412.98 7039713.01, 229414.93 7039717.26, 229417.8 7039722.91, 229418.94 7039724.74, 229422.98 7039729.05, 229426.79 7039733.04, 229433.23 7039739.18, 229441.5 7039742.49, 229449.49 7039743.55, 229457.8 7039747.08, 229463.75 7039750.63, 229470.23 7039751.84, 229476.96 7039750.1, 229482.5 7039748.55, 229487.1 7039747, 229489.89 7039746.14, 229494.65 7039744.3, 229499.38 7039741.89)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""R,E,F,K"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-09-25"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}
{noformat}
gir HTTP 500 med mld
{noformat}
Caused by: java.lang.IllegalArgumentException: no such edge in graph: RoadNetSegment{locational=2610207@0.40644294-0.57466358, partNumber=6, segmentNumber=6, type=MAIN, superExtent=null, startDate=2020-08-19, endDate=null, startConnection=2874174-1-null-null-2, endConnection=2874175-1-null-null-2, contracts=[706925699, 376882576, 902857769], routes=[], municipality=5059, county=50, laneset=[1, 2, 4], topologyLevel=null, typeOfRoad=ENKEL_BILVEG, detailLevel=VEGTRASE_OG_KJOREBANE, measurementMethod=2, dateOfMeasurement=null, lastModifiedDate=null, roadSysRef=RoadSysRef{roadSystem=RoadSystem{id=1002134449, version=1, roadNumber=714, roadCategory='F', phase='V'}, section=Section{id=1003440352, version=1, sectionNumber=2, sectionPartNumber=1, arm=false, sepratePassages='NEI', sepratePassagesNumber='null', trafficType='K', sequenceNumber=7000, direction=WITH, startMeter=5007.205, endMeter=5522.599}, sideArea=null, intersection=null}}Caused by: java.lang.IllegalArgumentException: no such edge in graph: RoadNetSegment{locational=2610207@0.40644294-0.57466358, partNumber=6, segmentNumber=6, type=MAIN, superExtent=null, startDate=2020-08-19, endDate=null, startConnection=2874174-1-null-null-2, endConnection=2874175-1-null-null-2, contracts=[706925699, 376882576, 902857769], routes=[], municipality=5059, county=50, laneset=[1, 2, 4], topologyLevel=null, typeOfRoad=ENKEL_BILVEG, detailLevel=VEGTRASE_OG_KJOREBANE, measurementMethod=2, dateOfMeasurement=null, lastModifiedDate=null, roadSysRef=RoadSysRef{roadSystem=RoadSystem{id=1002134449, version=1, roadNumber=714, roadCategory='F', phase='V'}, section=Section{id=1003440352, version=1, sectionNumber=2, sectionPartNumber=1, arm=false, sepratePassages='NEI', sepratePassagesNumber='null', trafficType='K', sequenceNumber=7000, direction=WITH, startMeter=5007.205, endMeter=5522.599}, sideArea=null, intersection=null}} 
at org.jgrapht.graph.BaseIntrusiveEdgesSpecifics.getEdgeSource(BaseIntrusiveEdgesSpecifics.java:99)
{noformat}
Denne feilen kommer av lang kabel som vedlagt i skjermbilde. SOSI-fil er ogsÃ¥ vedlagt. Det er veldig godt mulig at det ikke finnes rute her, men man skal ikke fÃ¥ HTTP 500",NVDB-6937,Les-API,
Geometri i kontraktsomrÃ¥de vert representert feil frÃ¥ Les,"h1. Feilmelding frÃ¥ brukar
{quote}{{POB-sak: 3666540}}
{{Meldt av: Randi Skoglund}}
{quote}
Jeg kom over denne opptegningen av kontraktsomrÃ¥de i vegkart. Dette bÃ¸r det gjÃ¸res noe med.

[!image-2020-09-25-13-45-32-315.png!|https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@995843,7841781,14/hva:~(~(id~580]

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@995843,7841781,14/hva:~(~(id~580]))

Med hilsen
 Randi Skoglund",NVDB-6937,Les-API,
Ny type: Vedlikeholdskontrakt og Samlekontrakt,"Innmeldt Ã¸nske frÃ¥ Steinar Johansen i Innlandet FK (steinar.johansen@innlandetfylke.no):

Innlandet fylke har to kontrakstyper som gÃ¥r igjen, men som ikkje er valgbar type i Datafangst.
 * Samlekontrakt
 * Vedlikeholdskontrakt

Et raskt sÃ¸k i kontrakslisten i DF viser at liknande tekstar gÃ¥r igjen i mange fylker, og kommunar.

Behovet ser ut til Ã¥ vÃ¦re til stede, sÃ¥ dei bÃ¸r nok leggast til.
Vedlikeholdskontrakt er ei klar definert kontrakstype. Samlekontrakt er meir vagt, og kjenner ikkje denne betegnelsen frÃ¥ SVV. Men det er tydeleg at fylka har deffinert dette som ein mal, og Ã¸nsker dÃ¥ sikkert Ã¥ dele dette frÃ¥ samletypen ""Andre"".",NVDB-6937,Datafangst,
Er det mogleg Ã¥ vise kontraktsomrÃ¥de med TilDato og FraDato fram og tilbake i tid i Vegkart?,"Det er Ã¸nske om Ã¥ vise kontraksomrÃ¥der i Vegkart som ikkje er innanfor gyldig TilDato og FraDato, men som ikkje er sett historisk (lukka).

Utfordringa er at kontraktsomrÃ¥de har gyldigdata frÃ¥ og til tidsrommet kontrakta gjeld, men mange av objekta er gyldige og etter at kontrakte ikkje gjeld lenger.

Ei anna utfordring er framtidige kontrakter. Det er mange som har interesse i Ã¥ sjÃ¥ kontraktsomrÃ¥de som er klare, men ikkje er gyldige for Ã¥ planlegge aktivitet.

Oprinneleg melding frÃ¥Â [Torgeir.Boyum@vlfk.no|mailto:Torgeir.Boyum@vlfk.no]
{quote}Mange brukarar opplever at ikkje alle kontraktsomrÃ¥da blir tilgjengeleg som filter i Vegkart. Det er spesielt dette kontraktsomrÃ¥det (1405 Indre Sunnfjord 2015-2020) som ikkje er tilgjengeleg:

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@26278,6850383,7/hvor:~(kontraktsomrade~(~'1405*20Indre*20Sunnfjord*202015-2020))]

Â 

Kan det ha noko Ã¥ seie at eigenskapen Dato til er passert? Objektet er fortsatt tilgjengeleg i NVDB og er ikkje lagt historisk. Har sjekka opp mot andre kontraktsomrÃ¥der som ogsÃ¥ har passert Dato til-eigenskapen, og desse er heller ikkje tilgjengeleg (eks. 0504 SÃ˜R-GUDBRANDSDALEN 2015-2020). Uansett merkeleg at det er mange som fÃ¥r det opp i sÃ¸kefeltet og andre ikkje.
{quote}
Â 

*LÃ¸sning*

For kontraktsomrÃ¥der bruker vi nÃ¥ objektets gyldighetsperiode og ikke egenskapene fra og til. Det gjÃ¸r at alle kontrakter der objektet ikke er lukket vil komme opp i lista underÂ /omrader/kontraktsomrader som brukes av vegkart.

Â ",NVDB-6937,Les-API,
Objekter med for tette punkter lar seg ikke stedfeste,"h2. Observasjon

Vedlagte SOSI inneholder to objekter som har en geometri med for tette punkter. Dette blir rapportert som feil ved import, noe som fÃ¸rer til at Datafangst opplyser om at for tette punkter er fjernet.

*MEN:* Stedfesting med Skriv gÃ¥r ikke pga feil-kodeÂ GEOMETRI_MED_FOR_TETTE_PUNKTER. De lar seg derfor ikke lagre.
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><stedfestingResultat xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt tempId=""04bd8ad3-2544-4d85-bb1d-88d339b4dc77""><feil><feil kode=""GEOMETRI_MED_FOR_TETTE_PUNKTER""><melding >Geometrien har nabopunkter som er nÃ¦rmere hverandre enn 0.01 m</melding><referanse>https://datakatalogen.vegdata.no/15</referanse><egenskapTypeId>4723</egenskapTypeId><geometrideler srid=""5973""><wkt>LINESTRING Z (298317.0029693155 6749194.52900 4241 237.978, 298317.0029693155 6749194.529004241 237.978)</wkt></geometrideler></feil></feil></vegobjekt><vegobjekt tempId=""c2209ac4-23aa-4edf-82b7-fb098d5e6c44""><feil><feil kode=""GEOMETRI_MED_FOR_TETTE_PUNKTER""><melding>Geometrien har nabopunkter som er nÃ¦rmere hverandre enn 0.01 m</melding><referanse>https://datakatalogen.vegdata.no/15</referanse><egenskapTypeId>4723</egenskapTypeId><geometrideler srid=""5973""><wkt>LINESTRING Z (298317.0039679891 6749194.528950906 237.978, 298317.0039679891 6749194.528950906 237.978)</wkt></geometrideler></feil></feil></vegobjekt></stedfestingResultat>
{noformat}
Stedfesting uten Skriv gÃ¥r fint, men da stopper objektene ved registrering.

Â 

Her virker det som om Datafangst ikke klarer Ã¥ fjerne alle punktene som ligger for nÃ¦rme hverandre.",NVDB-6937,Datafangst,
NullPointerException nÃ¥r ikke tilgang til objekttype - forbedre feilmelding,"Egendefinert driftskontrakt-rapport V4 med skjermet objekttype.

Feiler med NullPointerException - bÃ¸r feile med noe a'la ""ikke tilgang"" siden underliggende Ã¥rsak er 403.

Â 

Log fra PROD:

2020-09-24 10:53:52,988 ERROR [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-0) Server returned 403 for object 895
2020-09-24 10:53:52,988 INFOÂ  [no.svv.vei.eng.ReportGenerator] (ForkJoinPool.commonPool-worker-0) 0 features found
2020-09-24 10:53:52,988 INFOÂ  [no.svv.vei.eng.ReportGenerator] (ForkJoinPool.commonPool-worker-0) Starting download of roadnet from NVDB
2020-09-24 10:53:52,989 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-0) Downloading VT+KB in bulk; this might take some time
2020-09-24 10:53:54,502 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-0) Downloaded 366 segment IDs.
2020-09-24 10:53:54,502 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-0) Downloading VT in bulk
2020-09-24 10:53:54,556 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-0) Downloaded 2 segment IDs.
2020-09-24 10:53:54,556 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-0) Hunting for missing segments
2020-09-24 10:53:54,556 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-0) 0 missing Segmentlinks founds.
2020-09-24 10:53:54,556 INFOÂ  [no.svv.vei.eng.ReportGenerator] (ForkJoinPool.commonPool-worker-0) 4076 segments found amongst 368 IDs
2020-09-24 10:53:54,556 INFOÂ  [no.svv.vei.eng.ReportGenerator] (ForkJoinPool.commonPool-worker-0) Working on subreport 1 out of 1
2020-09-24 10:53:54,556 ERROR [no.veg.nvd.RapportResource] (ForkJoinPool.commonPool-worker-0) Handling exception for job c9724d6c-305e-4bc7-8d53-bdeacbc1e6ac: java.util.concurrent.CompletionException: java.lang.NullPointerException
 at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
 at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606)
 at java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1596)
 at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
 at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)
 at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)
 at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:163)
Caused by: java.lang.NullPointerException
 at no.svv.veirapporter.engine.ReportGenerator.getObjectsReport(ReportGenerator.java:125)
 at no.svv.veirapporter.engine.ReportGenerator.getReport(ReportGenerator.java:93)
 at no.svv.veirapporter.engine.ReportGenerator.getReport(ReportGenerator.java:100)
 at no.svv.veirapporter.engine.ReportGenerator.createReport(ReportGenerator.java:83)
 at no.vegvesen.nvdbrapportapi.RapportService.getDriftskontrakt(RapportService.java:306)
 at no.vegvesen.nvdbrapportapi.RapportService_ClientProxy.getDriftskontrakt(RapportService_ClientProxy.zig:223)
 at no.vegvesen.nvdbrapportapi.RapportResource.lambda$getDriftskontrakt$4(RapportResource.java:285)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604)
 ... 5 more",,Rapportgenerator,
Sjekk om det mangler data for 532,"Fra gitter
{quote}
Daniel StrÃ¸mme Solberg
15:18
PÃ¥ et litt hÃ¸yere nivÃ¥; Vet du om det er noen forskjellig pÃ¥ datakvaliteten til 532-vegreferansene vi fÃ¥r fra NVDB sitt API sammenlignet med VisVegInfo? NÃ¥r jeg sammenligner historikkene finner jeg litt forskjeller mellom dem og litt avvik pÃ¥ begge sider (dvs manglende vegreferanser for enkelte tidsintervall). Er det noe forskjellig i kvalitet/pÃ¥litelighet mellom datasettene?

Marvin Bredal Lillehaug
15:21
Dataene kommer jo fra NVDB, sÃ¥ vil tro det skal vÃ¦re rett der. Eksempler?

Daniel StrÃ¸mme Solberg
15:30
For eksempel her https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/532?srid=6173&veglenkesekvens=0.14877@22180&alle_versjoner=true. Her mangler NVDB de to fÃ¸rste innslagene som vi har fra VisVegInfo (NVDB sin fÃ¸rste er fra 1992)

1950-01-01 - 1987-08-20: RV9 HP 2 Meter 2890
1987-08-20 - 1992-06-16: RV9 HP 2 Meter 2875


Daniel StrÃ¸mme Solberg
15:36
Et annet eksempel er pÃ¥ punktet 0.04293@1060674, som har historikk fra 1950 til nÃ¥tid, men hos NVDB er det et hull i historikken fra 1989-06-27 til 1992-06-16
{quote}",NVDB-6937,NVDB-IND,
FÃ¥r ikke koblet korrigert datter til oppdatert mor,"h2. Observasjon

(Fra support. Innmelder Lisbeth By)

Har importert inn en NVDB-mor som Oppdater og en NVDB-datter som Korriger. PrÃ¸ver Ã¥ koble disse ved Ã¥ velge NVDB-mor i assosiasjonsfanen og koble til NVDB-datteren. BÃ¥de kobling til datter i kontrakt og datter i NVDB gir konsoll-feil (se scenario pÃ¥ skjermbildene):
{noformat}
Uncaught TypeError: Cannot read property 'typeId' of null at actions.ts:1220 
at index.js:8 
at Object.onFetchNvbdObjects (redux.js:475) 
at i.handleFetchFeaturesFromNvdb (NvdbChildAssociationsTab.tsx:57) 
at onClick (NvdbChildAssociationsTab.tsx:136) 
at Object.l (react-dom.production.min.js:14)
{noformat}
Aktuell test-kontrakt i ATM: [https://datafangst-test.kantega.no/#!/contract/606cc7b1-85a6-4197-9ea4-6a9defcab313/association]

Â ",NVDB-6937,Datafangst,
FÃ¥ med fase i vegsystemreferanse-visning,"[~tormos]Â added a comment -Â 43 minutes ago
Â 
NÃ¥r jeg legger til filter pÃ¥ ""R"" kommer ""Riksveg"" som filter, men legger jeg til ""RV"" kommer ""R"" som filter. Tilsvarende for ""F"" vs ""FV"" og ""E"" vs ""EV"".",NVDB-6937,Vegkart,
Stedfesting feiler nÃ¥r mor bare har assosiasjoner til NVDB.,"h2. Observasjon

Stedfesting feiler nÃ¥r et objekt har assosiasjoner, men alle assosiasjonene er assosiasjoner til NVDB-objekter som ikke er importert i prosjektet.

Feilen oppstÃ¥r fordi objektet har barn, men siden ingen av dem ligger i datafangst, kastes en illegal argument exception fordi listen av barn som skal flyttes blir tom.
h2. LÃ¸sning

Sjekk pÃ¥ om listen er tom

Â 

Â ",NVDB-6937,Datafangst,
GEOMETRYCOLLECTION EMPTY,"h2. Observasjon

Datafangst fikk en feil ved uthenting av wkt for noen trÃ¦r. Hele kontrakten lÃ¥ste seg. Dette kom av at noen importerte NVDB-TrÃ¦r haddeÂ GEOMETRYCOLLECTION EMPTY som wkt under lokasjon.geometri:
{noformat}
""geometri"": { ""wkt"": ""GEOMETRYCOLLECTION EMPTY"", ""srid"": 5973 }
{noformat}
[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/199/784933441/1.json]

De berÃ¸rte trÃ¦rne var
{noformat}
784933439 784933443 784933441 784933438 784933437 784933440 784933436
{noformat}
Mangler vegnettet geometri, er det feil pÃ¥ objektet, eller er det Les/NVDBIND som ikke henter inn riktig?",NVDB-6937,Les-API,
Feil med geometri for vegfunksjon pÃ¥ kryssdel,"Geometri vises som punkt, men rundkjÃ¸ringen dekkes hvis man trykker pÃ¥ punktet.

Flere eksempler i vedlagte bilder.

https://vegkart.utv.atlas.vegvesen.no/#kartlag:topo4/@255796,6594154,18/hva:~(~(id~577))/hvor:~(vegsystemreferanse~(~'FV118))/valgt:909980951:577



I prod vises geometri som en kort strek og ikke punkt.",NVDB-6937,Les-API,
For lang streng i X-Client trigger SQLException,"h2. Observasjon

En del endringssett (f.eks. https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/d88cffdb-d179-4ff1-ae7c-a418599d65d8) fra Jan Kristian havarer med SYSTEMFEIL pga for lang streng i X-Client header:

{code:java}
java.lang.RuntimeException: Failed to execute update
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Executors.executeUpdate(Executors.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Executors.lambda$executeUpdate$1(Executors.java:52)
	at java.util.stream.ReferencePipeline$4$1.accept(ReferencePipeline.java:210)
	at java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.IntPipeline.reduce(IntPipeline.java:457)
	at java.util.stream.IntPipeline.sum(IntPipeline.java:415)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Executors.executeUpdate(Executors.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobrepository.JdbcStatisticsRepository.saveChangesetStats(JdbcStatisticsRepository.java:43)
	at no.vegvesen.vt.nvdb.apiskriv.statistics.DefaultStatisticsService.saveStats(DefaultStatisticsService.java:42)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$22(JobWorker.java:702)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.lambda$transactional$0(Jdbc.java:110)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:135)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:109)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:105)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$updateNvdb$23(JobWorker.java:683)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.lambda$transactional$0(Jdbc.java:110)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:135)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:109)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:105)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.updateNvdb(JobWorker.java:683)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:201)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:54)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
	at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1390)
	at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131)
	at org.apache.activemq.ActiveMQSessionExecutor.execute(ActiveMQSessionExecutor.java:81)
	at org.apache.activemq.ActiveMQSession.dispatch(ActiveMQSession.java:1678)
	at org.apache.activemq.ActiveMQConnection$3.processMessageDispatch(ActiveMQConnection.java:1885)
	at org.apache.activemq.command.MessageDispatch.visit(MessageDispatch.java:113)
	at org.apache.activemq.ActiveMQConnection.onCommand(ActiveMQConnection.java:1865)
	at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)
	at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)
	at org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:209)
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)
	at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: ORA-12899: value too large for column ""NVDBAPISKRIV"".""STATS_CHANGESET"".""CLIENT"" (actual: 67, maximum: 64)
{code}

h2. Analyse

Verdien i X-Client er pÃ¥ 67 tegn. Endringssettet registreres i JOB-tabellen, der CLIENT-kolonnen er pÃ¥ 100 tegn. Dette gÃ¥r bra. I etterkant av behandlingen av endringssettet skal det registreres noe statistikk, inkludert hvilken klient det var. I STATS_CHANGESET-tabellen er imidlertid CLIENT-kolonnen pÃ¥ bare 64 tegn.

h2. LÃ¸sning

Utvider kolonnen STATS_CHANGESET.CLIENT til 100 tegn og trunkerer X-Client-headeren til 100 tegn dersom for lang.
",NVDB-6937,Skriv-API,
Skjul koblede skjuler alle,"h2. Observasjon

Fra support (Ã˜ystein Lund). PÃ¥ assosiasjonsfanen kan man skjule koblede objekter undre manuell assosiering for enklere Ã¥ se hvem som skal kobles. Denne funksjonen skjuler nÃ¥ alle.

For Ã¥ gjenskape, last opp vedlagte SOSI-filer og assosier auto. Fjern koblingen for et par objekter. Merk deretter et rekkverksobjekt, og se pÃ¥ datterobjekter som kan assosieres fra kontrakten (se skjermbilde). Her er da alle koblet - med unntak av de du nettopp fjernet. PrÃ¸v sjekkboks ""Skjul koblede"". Da skjules alle - ikke bare koblede.",NVDB-6937,Datafangst,
"gÃ¥ tilbake til Geodata-kart, Ã¸ke zoomnivÃ¥ pÃ¥ geodata-kart","h2. Observasjon

Vi har i en periode prÃ¸vd ut webatlas/norkart-kartene som default i stedfesting, siden geodata-kartene hadde for dÃ¥rlig opplÃ¸sning ved hÃ¸ye zoomnivÃ¥, og man fikk ""ingen kartdata tilgjengelig"" hvis man prÃ¸vde Ã¥ zoome inn for mye.

Problemet er at webatlas-kartene er veldig mye tregere, sÃ¥ lÃ¸sningen fÃ¸les veldig treg.

Webatlas/norkart skulle egentlig Ã¸ke ytelsen sin, men detÂ  har de ikke gjort.

Vi bÃ¸r gÃ¥ tilbake til geodatakartene som default, siden det er det kartet de bruker for Ã¥ lete fram og fÃ¥ oversikt. vi kan sette en toggle som sier til leaflet at den skal gjenbruke kart-tiles fra lavere zoomnivÃ¥, slik at kart vises, men med dÃ¥rligere opplÃ¸sning.

NÃ¥r brukere har funnet sin plass kan de bytte til norkart hvis de trenger flere detaljer.
h2. LÃ¸sning

sette geodatakart som default, gjenbruke lavere zoominvÃ¥.",NVDB-6937,Datafangst,
HTTP 500 segmentLengthFraction,"h2. Observasjon

POSTÂ /nvdb/apiskrivbeta/rest/v3/stedfest?maksimumAvstandTilVeg=300
{noformat}
<vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""853"" tempId=""031b85a7-c90e-4e65-8774-5e14dae76f1c""><egenskaper><egenskap typeId=""9843""><geometri><srid>25833</srid><wkt>POINT (302975.53973862587 6751349.649176841 267.38800000000003)</wkt><referansegeometri>false</referansegeometri><kvalitet/></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-09-18</startdato></gyldighetsperiode></vegobjekt></vegobjekter>
{noformat}
gir HTTP 500 og _segmentLengthFraction must be <= 1.0_

Rute-kall mot Les: POST [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""geometri"":""POINT (302975.53973862587 6751349.649176841)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""F,K,E,R"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-09-18"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}{noformat}

h2. Analyse

Etablerte testcase, men fikk ikke reprodusert feilen, sannsynligvis fordi koden som trigger denne exception'en ble omarbeidet i NVDB-5914.",NVDB-6937,Skriv-API,
HTTP 500 NPE for /rute,"h2. Observasjon

POSTÂ https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?debug=true
{noformat}
{""geometri"":""LINESTRING (136413.38 6499763.59, 136414.4 6499768.35, 136414.47 6499768.58, 136416.32 6499773.77, 136416.45 6499774.05, 136416.6 6499774.31, 136419.89 6499779.09, 136419.92 6499779.14, 136422.64 6499782.92, 136422.8 6499783.12, 136422.98 6499783.3, 136425.07 6499785.17, 136425.17 6499785.25, 136432.13 6499790.79, 136432.25 6499790.91, 136435.74 6499794.34, 136435.8 6499794.4, 136441.48 6499800.34, 136441.52 6499800.38, 136446.61 6499805.97, 136446.69 6499806.06, 136455.39 6499814.9, 136455.5 6499815.03, 136466.55 6499828.92, 136466.63 6499829.02, 136476.37 6499843.16, 136476.66 6499843.5, 136485.27 6499852, 136485.41 6499852.13, 136491.82 6499857.69, 136491.88 6499857.75, 136501.92 6499866.09, 136502.02 6499866.16, 136512.42 6499873.96, 136512.47 6499874, 136519.61 6499879.83, 136519.76 6499879.97, 136519.89 6499880.12, 136523.29 6499884.7, 136523.39 6499884.86, 136523.48 6499885.02, 136525.36 6499889.1, 136525.46 6499889.34, 136526.88 6499894.02, 136526.89 6499894.05, 136528.58 6499899.37, 136528.62 6499899.49, 136535.45 6499918.9, 136535.53 6499919.2, 136537.52 6499931.56, 136537.54 6499931.74, 136537.86 6499937.67, 136537.87 6499937.83, 136537.8 6499940.93, 136537.76 6499941.21, 136537.68 6499941.49, 136537.56 6499941.74, 136537.39 6499941.97, 136535.57 6499944.03, 136535.48 6499944.14, 136527.49 6499953.41, 136527.33 6499953.62, 136523.28 6499959.12, 136523.06 6499959.49, 136522.9 6499959.9, 136522.83 6499960.33, 136522.84 6499960.76, 136523.06 6499961.35, 136524.22 6499968.64)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""E,R,K,F"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-09-17"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}
{noformat}
gir HTTP 500 og en NPE.",NVDB-6937,Les-API,
HTTP 500 med Failed to calculate geometry pÃ¥ stedfesting,"h2. Observasjon

POST /nvdb/apiskrivbeta/v3/stedfest?maksimumAvstandTilVeg=300
{noformat}
<vegobjekter xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><vegobjekt typeId=""181"" tempId=""d01adb10-dd4a-4339-86e8-bc5749b7fa13""><egenskaper><egenskap typeId=""4838""><geometri><srid>25833</srid><wkt>POINT (225407.25 6584218.62 0)</wkt><referansegeometri>false</referansegeometri><kvalitet><mÃ¥lemetode>99</mÃ¥lemetode></kvalitet></geometri></egenskap></egenskaper><gyldighetsperiode><startdato>2020-09-16</startdato></gyldighetsperiode></vegobjekt></vegobjekter>
{noformat}
gir HTTP 500
{noformat}
""Failed to calculate geometry for extent [0.64301822, 0.64301822] from ref link 1150508, period 2020-09-16 - >""
{noformat}
Kallet som gÃ¥r mot Les er: POST [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""geometri"":""POINT (225407.25 6584218.62)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""R,E,K,F"",""trafikantgruppe"":null,""typeveg"":null,""tidspunkt_start"":""2020-09-16"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}
{noformat}
Legger videre merke til at Les da gir tilbake et segmentÂ 0.39576997-0.64301822@1150508 hvor det ikke finnes gyldig segment fraÂ 0.64301822 -> ([https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/1150508)]

h2. Analyse

Det kastes exception fra ComputedLocational.createFromPointExtent() fordi punktstedfestingen det skal beregnes geometri fra er identisk med sluttposisjonen til den ene relevante veglenken. Sluttposisjonen er ikke-inklusiv og det finnes derfor ingen match mellom stedfestingen [0.64301822] og veglenkens utstrekning [0.39576997, 0.64301822). Veglenken som har 0.64301822 som startposisjon er ikke gyldig i det aktuelle tidsrommet (2020-09-16 ->).

h2. LÃ¸sning

Laget nye metoder i RefLink (getGeometryForPosition) og RefLinkPart (getGeometryForPosition) som beregner punktgeometri ut fra en punktstedfesting (singular extent). Denne vil finne siste posisjon/punkt i veglenkegeometrien som representerer sluttposisjonen til veglenken. Stedfestingen er i dette tilfelle (sluttposisjon pÃ¥ veglenke) egentlig ugyldig, men API Skriv godtar 1 mm avvik fra nÃ¦rmeste gyldige veglenkeposisjon, ved validering av stedfestingen.
",NVDB-6937,Skriv-API,
Rute gir POINT-geometri tilbake for type Linje,"h2. Observasjon

Skriv kaster en feil _om.vividsolutions.jts.geom.Point cannot be cast to com.vividsolutions.jts.geom.LineString_ pÃ¥ fÃ¸lgende spÃ¸rring

POST [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute]
{noformat}
{""geometri"":""LINESTRING (67443.5 6597165, 67441.69 6597162.98, 67432.64 6597151.15, 67422.76 6597154.71, 67422.74 6597154.75, 67418.13 6597152.69, 67413.09 6597147.2, 67412.62 6597146.03, 67411.16 6597141.56, 67410.42 6597137.82, 67407 6597127.36, 67406.62 6597126.69, 67405.52 6597122.86)"",""maks_avstand"":""300"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""RA9"",""trafikantgruppe"":null,""typeveg"":""enkelBilveg"",""tidspunkt_start"":""2020-09-16"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}
{noformat}
Responsen gir geometri for hvert enkelt segment. Segment #2 gir kun {{type: Linje}} med kortform=true, men pÃ¥ aktuelt kall er kortform=false og gir da tilbake
{noformat}
""geometri"": { ""wkt"": ""POINT Z(67434.87 6597157.95 410.816)"", ""srid"": 5973 }
{noformat}
Denne kan re-testes med Ã¥ stedfeste vedlagte SOSI i Datafangst.",NVDB-6937,Les-API,
Stedfesting med Skriv: En feil avbryter stedfesting for alle,"h2. Observasjon

Vedlagte SOSI-fil 92a.sos kaster (per nu) en feil i ATM fra Skriv pga /rute i Les.
{code:java}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1""><message>com.vividsolutions.jts.geom.Point cannot be cast to com.vividsolutions.jts.geom.LineString</message></fault> 

2020-09-15T15:47:18.526 ERROR [LocalizationWorker-1] [exttxm] [b78361ff-d1dc-4672-b1ed-7cd9f9a125f1] n.s.n.d.l.async.SkrivLocalizationWorker Failed while localizing feature(s) for contract b78361ff-d1dc-4672-b1ed-7cd9f9a125f1 
2020-09-15T15:47:18.526 ERROR [LocalizationWorker-1] [] [] n.s.n.d.l.async.LocalizationScheduler Skriv worker failed
{code}
Dette gjÃ¸r at stedfesting avbrytes og ikke alle objekter som kan stedfestes blir det.

Stedfester man fÃ¸rst 226 og deretter 92a, blir alle 226 stedfestet, mens stedfestingen av 92a avbrytes ved samme feil.

*MERK*:Â Merk at dette ikke gjelder om Skriv rapporterer om feil i en 200-respons, kun om Skriv kaster en 500 tilbake.

*MERK 2*: Hvis feilen i /rute rettes fÃ¸r denne saken tas vil man evt mÃ¥tte mocke en feil fra Skriv for Ã¥ fremprovosere oppfÃ¸rselen.",NVDB-6937,Datafangst,
Stedfesting med Skriv: DÃ¸tre flytter ikke inn,"h2. Observasjon # 1

Autoassosier vedlagte SOSI (5_ed og 14_ed) og stedfest. Registrer.

UTEN Skriv som stedfesting flytter dÃ¸trene hjem og ting blir lagret.

MED Skriv som stedfesting flytter dÃ¸trene IKKE hjem.
h2. Analyse

Innflytting er ikke aktivert for stedfesting med skriv
h2. LÃ¸sning

Legge inn innflytting med Skriv

Omskriving av metoden for Ã¥ stÃ¸tte Ã¥ kunne sende berÃ¸rte barn til GUI for oppdatering

omskriving av handleren pÃ¥ GUI for Ã¥ stÃ¸tte batch-innsending av stedfestinger for Ã¥ fikse progressbaren som var Ã¸delagt med Skriv. Stedfestinger deles inn i opptil 10 batches nÃ¥r multiple stedfestinger gjÃ¸res samtidig.

Enhetstester pÃ¥ Frontend for Ã¥ teste batch-oppdelingen

Â ",NVDB-6937,Datafangst,
ClassCastException i AbsoluteMaximumValidator,"h2. Observasjon

Endringssett https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/e01d76ae-c3f8-4e2c-be13-e444a92c28cd havarerer i AbsoluteMaximumValidator:

{code:java}
java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.String
	at java.lang.String.compareTo(String.java:111)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.value.AbsoluteMaximumValidator.isValid(AbsoluteMaximumValidator.java:13)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.value.AbsoluteMaximumValidator.isValid(AbsoluteMaximumValidator.java:8)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.ConstraintEnforcer.enforce(ConstraintEnforcer.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.validation.value.ConstraintValueFilter.doFilter(ConstraintValueFilter.java:33)
	at no.vegvesen.vt.nvdb.apiskriv.validation.attribute.AttributeValueFilters.doFilter(AttributeValueFilters.java:32)
	at no.vegvesen.vt.nvdb.apiskriv.validation.feature.FeatureAttributeFilters.doFilter(FeatureAttributeFilters.java:32)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.JobFeatureFilters.doFilter(JobFeatureFilters.java:36)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:117)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:449)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:171)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:54)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

I endringssettet delviskorrigeres vegobjektversjon 296004:1 (Gate) der egenskap 4588 (Gatekode) settes til 8092. I tillegg delvisoppdateres samme vegobjekt der kun stedfestingen endres i ny versjon (2). I PartialFeatureEnricherJobFilter kompletteres den delvise korreksjonen med manglende egenskaper fra originalen i NVDB. Det samme gjÃ¸res for oppdateringen, men egenskap 4588 kopieres fra korreksjonen. I det fÃ¸rste tilfellet er egenskapen av korrekt datatype, IntegerAttribute, mens i det andre tilfellet er datatypen StringAttribute. Alle egenskaper som er innlest fra NVDB har operation READ. I et senere filter, TransformAttributeFilter, transformeres eventuelle StringAttribute til sin sterkt typede variant. Her ville normalt egenskap 4588 i oppdatering blitt omdannet til IntegerAttribute, men filteret behandler ikke egenskaper med operation READ, fordi de ansees Ã¥ vÃ¦re innlest fra NVDB og derfor allerede er typet riktig. Denne svakheten ble introdusert da vi implementerte stÃ¸tte for korrigering og oppdatering av/fra samme vegobjektversjon i NVDB-5270.

h2. LÃ¸sning

Fjerner filteret pÃ¥ operation READ i TransformAttributeFilter.",NVDB-6937,Skriv-API,
Systemfeil i SanitationJobFilter,"h2. Observasjon

Endringssett https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/bfaa50a0-2625-4a3e-a8a1-47c7c4a115a3 havarerer med systemfeil i SanitationJobFilter:

{code:java}
java.lang.IllegalStateException: Detected conflicting actions on 3 feature version(s):

  op:DISCONTINUE_CASCADING tid:538 id:844165507 v:1 sd:2017-11-10 ed:2020-07-07 - ac:CLOSE or:changeset vr:true co:true - [LocationalAttribute{typeId=120538, operation=READ, values=[LocationalValue{typeId=100538, operation=READ, data=367437: 0.0->1.0}]}, AssociationAttribute{typeId=200699, operation=READ, values=[AssociationValue{typeId=200699, operation=READ, data=256}]}, AssociationAttribute{typeId=202184, operation=READ, values=[AssociationValue{typeId=202184, operation=READ, data=1002101665}]}],  op:CORRECT tid:538 id:844165507 v:1 sd:2017-11-10 ed:2020-07-07 - ac:UPDATE or:changeset vr:true co:false - [StringAttribute{typeId=9793, operation=READ, values=[StringValue{typeId=9793, operation=READ, data=Ja}]}, AssociationAttribute{typeId=200699, operation=READ, values=[AssociationValue{typeId=200699, operation=READ, data=256}]}, LocationalAttribute{typeId=120538, operation=READ, values=[LocationalValue{typeId=100538, operation=READ, data=367437: 0.0->1.0}]}, IntegerAttribute{typeId=4588, operation=READ, values=[IntegerValue{typeId=4588, operation=READ, data=2133}]}, StringAttribute{typeId=4589, operation=READ, values=[StringValue{typeId=4589, operation=READ, data=Standalsvegen}]}],  op:DISCONTINUE_CASCADING tid:538 id:844165507 v:1 sd:2017-11-10 ed:2020-07-07 - ac:CLOSE or:AdaptFeaturesToClosedNetworkEnricherFilter vr:false co:true - [StringAttribute{typeId=9793, operation=IMPLICIT, values=[StringValue{typeId=9793, operation=IMPLICIT, data=Ja}]}, AssociationAttribute{typeId=200699, operation=IMPLICIT, values=[AssociationValue{typeId=200699, operation=IMPLICIT, data=256}]}, LocationalAttribute{typeId=120538, operation=IMPLICIT, values=[LocationalValue{typeId=100538, operation=IMPLICIT, data=367437: 0.0->1.0}]}, AssociationAttribute{typeId=202184, operation=IMPLICIT, values=[AssociationValue{typeId=202184, operation=IMPLICIT, data=1002101665}]}, IntegerAttribute{typeId=4588, operation=IMPLICIT, values=[IntegerValue{typeId=4588, operation=IMPLICIT, data=2133}]}, StringAttribute{typeId=4589, operation=IMPLICIT, values=[StringValue{typeId=4589, operation=IMPLICIT, data=Standalsvegen}]}]
,

  op:DISCONTINUE_CASCADING tid:538 id:844165574 v:1 sd:2017-11-10 ed:2020-07-07 - ac:CLOSE or:changeset vr:true co:true - [LocationalAttribute{typeId=120538, operation=READ, values=[LocationalValue{typeId=100538, operation=READ, data=368100: 0.0->1.0}]}, AssociationAttribute{typeId=200699, operation=READ, values=[AssociationValue{typeId=200699, operation=READ, data=256}]}, AssociationAttribute{typeId=202184, operation=READ, values=[AssociationValue{typeId=202184, operation=READ, data=1002101665}]}],  op:CORRECT tid:538 id:844165574 v:1 sd:2017-11-10 ed:2020-07-07 - ac:UPDATE or:changeset vr:true co:false - [StringAttribute{typeId=9793, operation=READ, values=[StringValue{typeId=9793, operation=READ, data=Ja}]}, AssociationAttribute{typeId=200699, operation=READ, values=[AssociationValue{typeId=200699, operation=READ, data=256}]}, LocationalAttribute{typeId=120538, operation=READ, values=[LocationalValue{typeId=100538, operation=READ, data=368100: 0.0->1.0}]}, IntegerAttribute{typeId=4588, operation=READ, values=[IntegerValue{typeId=4588, operation=READ, data=2129}]}, StringAttribute{typeId=4589, operation=READ, values=[StringValue{typeId=4589, operation=READ, data=Brufjordvegen}]}],  op:DISCONTINUE_CASCADING tid:538 id:844165574 v:1 sd:2017-11-10 ed:2020-07-07 - ac:CLOSE or:AdaptFeaturesToClosedNetworkEnricherFilter vr:false co:true - [StringAttribute{typeId=9793, operation=IMPLICIT, values=[StringValue{typeId=9793, operation=IMPLICIT, data=Ja}]}, AssociationAttribute{typeId=200699, operation=IMPLICIT, values=[AssociationValue{typeId=200699, operation=IMPLICIT, data=256}]}, LocationalAttribute{typeId=120538, operation=IMPLICIT, values=[LocationalValue{typeId=100538, operation=IMPLICIT, data=368100: 0.0->1.0}]}, AssociationAttribute{typeId=202184, operation=IMPLICIT, values=[AssociationValue{typeId=202184, operation=IMPLICIT, data=1002101665}]}, IntegerAttribute{typeId=4588, operation=IMPLICIT, values=[IntegerValue{typeId=4588, operation=IMPLICIT, data=2129}]}, StringAttribute{typeId=4589, operation=IMPLICIT, values=[StringValue{typeId=4589, operation=IMPLICIT, data=Brufjordvegen}]}]
,

  op:DISCONTINUE_CASCADING tid:538 id:844165503 v:1 sd:2017-11-10 ed:2020-07-07 - ac:CLOSE or:changeset vr:true co:true - [LocationalAttribute{typeId=120538, operation=READ, values=[LocationalValue{typeId=100538, operation=READ, data=368021: 0.0->1.0}]}, AssociationAttribute{typeId=200699, operation=READ, values=[AssociationValue{typeId=200699, operation=READ, data=256}]}, AssociationAttribute{typeId=202184, operation=READ, values=[AssociationValue{typeId=202184, operation=READ, data=1002101665}]}],  op:CORRECT tid:538 id:844165503 v:1 sd:2017-11-10 ed:2020-07-07 - ac:UPDATE or:changeset vr:true co:false - [StringAttribute{typeId=9793, operation=READ, values=[StringValue{typeId=9793, operation=READ, data=Ja}]}, AssociationAttribute{typeId=200699, operation=READ, values=[AssociationValue{typeId=200699, operation=READ, data=256}]}, LocationalAttribute{typeId=120538, operation=READ, values=[LocationalValue{typeId=100538, operation=READ, data=368021: 0.0->1.0}]}, IntegerAttribute{typeId=4588, operation=READ, values=[IntegerValue{typeId=4588, operation=READ, data=2133}]}, StringAttribute{typeId=4589, operation=READ, values=[StringValue{typeId=4589, operation=READ, data=Standalsvegen}]}],  op:DISCONTINUE_CASCADING tid:538 id:844165503 v:1 sd:2017-11-10 ed:2020-07-07 - ac:CLOSE or:AdaptFeaturesToClosedNetworkEnricherFilter vr:false co:true - [StringAttribute{typeId=9793, operation=IMPLICIT, values=[StringValue{typeId=9793, operation=IMPLICIT, data=Ja}]}, AssociationAttribute{typeId=200699, operation=IMPLICIT, values=[AssociationValue{typeId=200699, operation=IMPLICIT, data=256}]}, LocationalAttribute{typeId=120538, operation=IMPLICIT, values=[LocationalValue{typeId=100538, operation=IMPLICIT, data=368021: 0.0->1.0}]}, AssociationAttribute{typeId=202184, operation=IMPLICIT, values=[AssociationValue{typeId=202184, operation=IMPLICIT, data=1002101665}]}, IntegerAttribute{typeId=4588, operation=IMPLICIT, values=[IntegerValue{typeId=4588, operation=IMPLICIT, data=2133}]}, StringAttribute{typeId=4589, operation=IMPLICIT, values=[StringValue{typeId=4589, operation=IMPLICIT, data=Standalsvegen}]}]

	at no.vegvesen.vt.nvdb.apiskriv.validation.job.SanitationJobFilter.ensureNonConflictingActions(SanitationJobFilter.java:74)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.SanitationJobFilter.doFilter(SanitationJobFilter.java:43)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:117)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateAfterLocking(DefaultValidationService.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateAfterLock(JobWorker.java:575)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:192)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:54)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

I endringssettet korrigeres og lukkes samme vegobjektversjon. Dette er tillatt siden de angir samme sluttdato. I forbindelse med vegnettslukking berikes imidlertid jobben med ny lukking av samme vegobjektversjon med samme sluttdato. Dette kommer ikke i konflikt med de to operasjonene i endringssettet. Behandlingen havarerer imidlertid i det siste filteret i pipeline som foretar sanity check av jobben og eventuelt fjerner overflÃ¸dige vegobjektversjoner (korrigeringen dekker begge de to lukkingene). SanitationJobFilter sjekker bl.a. om multiple operasjoner pÃ¥ samme vegobjektversjon er kompatible, men tar bare hÃ¸yde for at det er to operasjoner, ikke flere som her. Feilen her er imidlertid i EnrichmentEvaluator som ikke dropper lukking fra fÃ¸lgeoppdateringen, nÃ¥r den allerede finnes i jobben.

h2. LÃ¸sning

Oppdaterer EnrichmentEvaluator til Ã¥ ta hÃ¸yde for at samme lukking allerede finnes i jobben.",NVDB-6937,Skriv-API,
CSV-eksport feiler med merkelig inkluder-feilmelding,"Â 
{panel:title=Mail om feilmelding}
Â 

Hei,

Det kjem feilmelding

HTTP error 422 for request f6028ea1-409c-08da-0a55-a5e1a0c8e848: Error 4006: Ugyldig verdi for parameteren 'inkluder': 'polygon'. Gyldige verdier: [kartutsnitt, senterpunkt, alle, vegobjekt]

ved cvs-eksport av dette datasettet:

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@30330,6847059,7/hva:~(~(id~517))/hvor:~(kontraktsomrade~(~'9305*20Sunnfjord))]

Â 
{panel}
Â ",NVDB-6937,Eksport,
Stedfesting feiler med feil deserialisering av Long,"h2. Observasjon

POST [https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300]Â med body som vedlagt feiler med beskjed
{noformat}
<fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1""><message>Error reading entity from input stream.</message><message>Cannot deserialize value of type `java.lang.Long` from String ""320576-1-7 0"": not a valid Long value at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor$UnCloseableInputStream); line: 1, column: 1653] (through reference chain: no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.RuteResponse[""vegnettsrutesegmenter""]- &gt;java.util.ArrayList[1]-&gt;no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.DetaljertRuteSegment[""sluttnode""])</message></fault>
{noformat}

h2. Analyse

Responsen fra /rute (API Les) inneholder ""sluttnode"":""320576-1-70"" i DetaljertRuteSegment. API Skriv forventer at dette er et gyldig heltall (nodeId). Dette forÃ¥rsaker havari ved deserialisering.

h2. LÃ¸sning

Endrer startnode og sluttnode fra Long til String i DetaljertRuteSegment og innkapsler innholdet i ny domeneklasse, NodeRef.",NVDB-6937,Skriv-API,
Ruteberegning: Hindre for stor bbox ved parsing av punkter og omkrets,Det tittelen sier. Skal forhindre for store sÃ¸k som krÃ¦sjer Solr-nodene.,NVDB-6937,Les-API,
Feil med indeksering av objekt med MANGE stadfestingar,"Der ser ut som det er ein feil i Les pÃ¥ objekt med veldig mange stadfestingar. Datakatalog 577-Vegfunksjon har gjerne eitt objekt for alle vegar i ein funksjon i eit stÃ¸rre geografisk omrÃ¥de (typisk fylke-2019). Problemet er tydeleg beskrevet og dokumentert i vedlagt e-post.

Det set no ein stoppar for produksjon av veglister etter at det var gjort endring i eit objekt som kryssar ny fylkesgrense Vestland/MÃ¸re og Romsdal. FÃ¸r endring i objektet fungerte rapport, men no gir Les 200-error i retur.

Det ser ut som om de gigantiske 577-objektene (vegfunksjon) gir fÃ¸lgefeil og kluss i NVDB api LES.

Â 

I og for seg er det ingenting galt med 577 vegfunksjon: Et objekt uten egeongeometri, stedfestet pÃ¥ en eller flere lenkesekvenser. I praksis stedfestet pÃ¥ *_utrolig +mange+_* lenkesekvenser, gjerne ett objekt som dekker store deler av fylkesvegnettet i et fylke.

Â 

Jeg tror at antallet stedfestinger er sÃ¥ stort at indekseringen og/eller nvdbapi fÃ¥r problemer. Med sÃ¥ digre objekter blir det uhorvelig mange segmenteringer, i tid og rom.

Â 

Symptom nr 1: SpÃ¸rring etter 577-objekter pÃ¥ fylkesveg i fylke 15 feiler, men fungerer uten filter

[https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/577?fylke=15&inkluder=alle]

Â 

feiler, mens spÃ¸rring pÃ¥ andre fylker eller for hele landet fungerer. Inklusive paginering. SÃ¸ket kan innsnevres med vegsystemreferanse=F, feiler fortsatt, men fungerer for vegsystemreferanse=E,R.

Â 

Feilen ser ut til Ã¥ inntreffe pÃ¥ fÃ¸rste side i paginering

Â 

Java klienten feiler med http 200 â€“ error,

2020-09-11 12:54:37,185 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-1) Preparing to fetch data for 577, 1 out of 2

2020-09-11 12:55:14,825 ERROR [no.veg.nvd.RapportResource] (ForkJoinPool.commonPool-worker-1) Handling exception for job 75c031b1-dba3-4410-a837-54ed8515d3c4: java.util.concurrent.CompletionException: HTTP error 200 for request 745536aa-e8e2-a58d-bc15-71cadc9e0676: at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
 at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606)
 at java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1596)
 at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
 at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)
 at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)
 at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:163)
 Caused by: HTTP error 200 for request 745536aa-e8e2-a58d-bc15-71cadc9e0676: at no.vegvesen.nvdbapi.client.clients.AsyncResult.doPage(AsyncResult.java:113)
 at no.vegvesen.nvdbapi.client.clients.AsyncResult.lambda$null$0(AsyncResult.java:52)
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
 at java.lang.Thread.run(Thread.java:748)
 Caused by: org.apache.http.ConnectionClosedException: Premature end of chunk coded message body: closing chunk expected
 atÂ [org.apache.http.impl.io|https://slack-redir.net/link?url=http%3A%2F%2Forg.apache.http.impl.io].ChunkedInputStream.getChunkSize(ChunkedInputStream.java:263)
 atÂ [org.apache.http.impl.io|https://slack-redir.net/link?url=http%3A%2F%2Forg.apache.http.impl.io].ChunkedInputStream.nextChunk(ChunkedInputStream.java:222)
 at org.apache.http.impl.io.ChunkedInputStream.read(ChunkedInputStream.java:183)
 at org.apache.http.conn.EofSensorInputStream.read(EofSensorInputStream.java:135)
 atÂ [java.io|https://slack-redir.net/link?url=http%3A%2F%2Fjava.io].BufferedInputStream.read1(BufferedInputStream.java:284)
 at java.io.BufferedInputStream.read(BufferedInputStream.java:345)
 at java.io.FilterInputStream.read(FilterInputStream.java:133)
 atÂ [java.io|https://slack-redir.net/link?url=http%3A%2F%2Fjava.io].BufferedInputStream.read1(BufferedInputStream.java:284)
 at java.io.BufferedInputStream.read(BufferedInputStream.java:345)
 at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)
 at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
 at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)
 at java.io.InputStreamReader.read(InputStreamReader.java:184)
 at com.google.gson.stream.JsonReader.fillBuffer(JsonReader.java:1291)
 at com.google.gson.stream.JsonReader.nextNonWhitespace(JsonReader.java:1329)
 at com.google.gson.stream.JsonReader.doPeek(JsonReader.java:468)
 at com.google.gson.stream.JsonReader.hasNext(JsonReader.java:415)
 at no.vegvesen.nvdbapi.client.clients.AsyncResult.doPage(AsyncResult.java:87)
 ... 4 more

Â 

Â 

Python:

Â 

ChunkedEncodingError: ('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))

> /home/jajens/anaconda3/envs/mars2020/lib/python3.8/site-packages/requests/models.py(754)generate()

Â Â Â  752Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  yield chunk

Â Â Â  753Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  except ProtocolError as e:

--> 754Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  raise ChunkedEncodingError(e)

Â Â Â  755Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  except DecodeError as e:

Â Â Â  756Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  raise ContentDecodingError(e)

Â 

Med hÃ¥p om Ã¥ forenkle debugging har jeg brukt X-Client = ""jajens_debug_577feil"" pÃ¥ denne spÃ¸rringen.

Â 

*Symptom nr 2: Kartvisning av vegsegmenter er rotete spagetti*

 _[Bilete 1]_

Dette er definitivt ikke et godt tegn!

Â 

Â 

NÃ¥r jeg leser inn 577-objekt for hele landet i QGIS ser det slik ut:

Â _[Bilete 2]_

Min metode for innlesning i QGIS er Ã¥ spÃ¸rre etter 577?inkluder=alle. SÃ¥ tar jeg ett og ett vegsegment (gyldige i dag, dvs uten sluttdato), spleiser egenskapverdier og legger vegsegmentet i kartet.

Â 

Det normale er jo at det ser slik ut: Ett objekt mappet til et eller flere (mange) vegsegmenter:

Â _[Bilete 3]_

ObjektId 237271713 er her markert med rÃ¸dt. Ett objekt, fordelt pÃ¥ 17 vegsegmenter fÃ¥r jeg det til.

Â 

Mens objektidÂ Â  218016717 er fordelt pÃ¥ et eneste monster-spagettisegment pÃ¥ 884km.Â 

Â _[Bilete 4]_

Â 

Min teori: Dette blir for uhÃ¥ndterlig for leseAPI.

Â 

Vennlig hilsen
 Jan Kristian Jensen

Statens vegvesen, Transport og samfunn
 Transportutvikling, Transportdata
 *BesÃ¸ksadresse:*Â Abels gate 5,Â TRONDHEIM
 *Mobil:*Â +47Â 40202790Â *epost:*Â [jan.kristian.jensen@vegvesen.no|mailto:jan.kristian.jensen@vegvesen.no]
 [www.vegvesen.no|http://www.vegvesen.no/]Â *epost:*Â [firmapost@vegvesen.no|mailto:firmapost@vegvesen.no]

Â ",NVDB-6937,Les-API,
"Sortere kontrakter, kontraktgrupper og brukere i admingrensesnitt","Se https://jira.kantega.no/browse/NVDB-5627

MÃ¥ oppdateres til Ã¥ ogsÃ¥ fungere for brukere med Chrome pÃ¥ engelsk.",NVDB-6937,Datafangst,
Leveranseinformasjon,"*Test i AT av leverandÃ¸r:*
 * NVDB-5605: Sjekk opplasting av SOSI-fil i saken
 * NVDB-5833: Sjekk at varsel ikke er der
 * NVDB-5766: Verifiser at kontraktsgruppenavn vises

*Test i AT av SVV:*
 * NVDB-5157: Verifiser testbeskrivelsen
 * NVDB-5721: GjÃ¸r klar en registrering til NVDB. Vent 6 timer - eller natta over og sjekk at man fÃ¥r beskjed om Ã¥ logge inn pÃ¥ nytt nÃ¥r man forsÃ¸ker Ã¥ registrere.

Sak NVDB-5867 trenger ikke Ã¥ eksplisitt testes i ATM.",NVDB-6937,Datafangst,
Gje notabene om mogleg overlapp,"h2. Bakgrunn

Lang sak i support/nvdb.

Det er aktuelt Ã¥ lagre til dÃ¸mes fortau med sideposisjon H og V, men det kan og vere aktuelt med eit 3. alternativ ""ingen sidepossisjon"".

Det same kan gjelde vegdekke med felt 1, 2 osb. og ""felt ikkje angitt"".

Det bÃ¸r vere ein sjekk i Skriv pÃ¥ om det finnst objekt med og utan spesifisert possisjon og gje ei Ã¥tvaring/notabene om mogleg overlapp og be om Ã¥ kontrollere.

h2. Analyse

Overlapp detekteres via Job-constrainten NoOverlaps. Constraints har kun ett utfall gitt en verdi som skal valideres: gyldig eller ugyldig. Dersom utfallet er ugyldig, oversettes dette til et varsel med grad feil eller advarsel avhengig av hvordan constrainten er konfiguert. Det er med andre ord ingen mekanisme for Ã¥ formidle notabener ut av constraints.

h2. LÃ¸sning

Utvider constraint-rammeverket til Ã¥ levere ut violations (ugyldig verdi) som i dag, men i tillegg ogsÃ¥ notabener. Dette krever i tillegg endringer i ConstraintEnforcer og alle filtere pÃ¥ ulike nivÃ¥er som hÃ¥ndhever constraints. Notabener oversettes til varsler med grad notabene.",NVDB-6937,Skriv-API,
Avvist endringssett pga overlapp,"h2. Observasjon

Fra Hans JÃ¸rgens test av NVDB-5716:

Testet i ATM: https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/328dca78-a2d8-48d4-b0c5-125cdfab4e72

Fikk prosjektet avvist med melding om overlapp mellom to objekter, 100348667 og 100348668. Dette er to strekningsobjekter som fÃ¸rst fikk korrigert stedfesting, deretter ble de lukket.

I endringssettet havner lukkingen i ""Lukk"" og korreksjonen i ""DelvisKorriger"".

Det kan hende Trimble mÃ¥ gjÃ¸re en liten jobb her om dette ikke er i henhold - eks. at bÃ¥de korreksjon og lukking havner i delvisKorriger? Vi hadde jo en prat om dette fÃ¸r sommeren.

h2. Analyse

I NoOverlapsValidator kontrolleres at endrede vegobjekter i endringssettet ikke overlapper med eksisterende vegobjekter i NVDB eller andre endrede vegobjekter i endringssettet. Den sistnevnte gruppen bruker imidlertid den lukkede versjonen av vegobjektet ikke den med korrigerte stedfesting. I den lukkede versjonen er det gammel stedfesting og validatoren tolker derfor dette som overlapp.

h2. LÃ¸sning

Ved uthenting av underliggende vegobjektversjoner i validatoren mÃ¥ eventuelle lukkede versjoner erstattes med de korrigerte om det finnes. Ã… kopiere over korrigerte egenskaper fra korrigering til lukking i PrepareForDiscontinueEnricherFilter er ikke en lÃ¸sning, fordi gammel stedfesting brukes til lÃ¥sing (lukking fÃ¸rer til normallÃ¥s pÃ¥ gammel stedfesting, korrigering fÃ¸rer til sekundÃ¦rlÃ¥s pÃ¥ gammel stedfesting via innlest READ-versjon) og mÃ¥ reflektere hvilket vegnett det manipuleres pÃ¥. ",NVDB-6937,Skriv-API,
Systemfeil ved lukking av deassosierte vegobjekter,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/cd41d795-438b-46e2-8ae3-bb82657af992 havner i status SYSTEMFEIL:


{code:java}
java.util.NoSuchElementException: No value present
          at java.util.Optional.get(Optional.java:135)
          at no.vegvesen.vt.nvdb.apiskriv.validation.job.TruncateDeassociatedFeaturesEnricherFilter.lambda$null$7(TruncateDeassociatedFeaturesEnricherFilter.java:141)
          at java.util.ArrayList.forEach(ArrayList.java:1257)
          at no.vegvesen.vt.nvdb.apiskriv.validation.job.TruncateDeassociatedFeaturesEnricherFilter.lambda$createEnrichments$8(TruncateDeassociatedFeaturesEnricherFilter.java:140)
          at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
          at java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:352)
          at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:483)
          at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
          at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
          at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
          at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
          at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
          at no.vegvesen.vt.nvdb.apiskriv.validation.job.TruncateDeassociatedFeaturesEnricherFilter.createEnrichments(TruncateDeassociatedFeaturesEnricherFilter.java:139)
          at no.vegvesen.vt.nvdb.apiskriv.validation.job.TruncateDeassociatedFeaturesEnricherFilter.doFilter(TruncateDeassociatedFeaturesEnricherFilter.java:84)
          at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:117)
          at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
          at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
          at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
          at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:449)
          at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:171)
          at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
          at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
          at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
          at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

Feilen oppstÃ¥r i TruncateDeassociatedFeaturesEnricherFilter som har som oppgave Ã¥ lukke eller fjerne versjoner fra datterobjektet nÃ¥r assosiasjonen i morobjektet er fjernet i en oppdatering (med eller uten overskriving). I dette caset oppdateres morobjekt 1008991281:1 av type 919 og assosiasjonen til 1008991282:1 av type 920 er tatt vekk. I samme endringssett fjernes imidlertid datterobjektet. TruncateDeassociatedFeaturesEnricherFilter tar hensyn til eksplisitt fjernede datterobjekter, men prÃ¸ver likevel (feilaktig) Ã¥ gjennomfÃ¸re trunkering nÃ¥r det ikke er noen datterobjekter igjen Ã¥ trunkere. Metoden createEnrichments anropes med tom childCandidates-liste. Metoden forventer at det finnes vegobjekter der for hver fjernede assosiasjon i morobjektet og feiler derfor med NoSuchElementException.

h2. LÃ¸sning

I metoden createEnrichments kontrolleres om det faktisk finnes ikke-fjernede datterobjektversjoner fÃ¸r beriking skjer.",NVDB-6937,Skriv-API,
Veglenkesekvenser med Ã¥pne veglenker pÃ¥ tidspunkt,"Det var mulig Ã¥ ha ?historisk og tidspunktpÃ¥ /veglenkesekvenser uten at det har noen effekt. 
Dette ble fjernet i https://github.com/nvdb-vegdata/nvdb-rest-api/commit/4ab1b215e526f65ad3e66f6e6be7f2f499a5c1ca 

Forslag til reintrodusering av Â«tidspunktÂ»: Dersom veglenkesekvensen har en eller flere veglenkesekvenser som er Ã¥pne pÃ¥ tidspunktet kommer den ut.",NVDB-6937,Les-API,
Leaflet fÃ¥r av og til ugyldige coordinater og kaster exception,"Leaflet fÃ¥r av og til ugyldige koordinater og kaster en exception som ikke hÃ¥ndteres, som kan fÃ¸re til at DF slutter Ã¥ respondere.

ca 160 tilfeller siste uke

[https://sentry.kantega.org/kantega/datafangst/issues/453/]

analyser og hÃ¥ndter
h2. Analyse

Feilen oppstÃ¥r nÃ¥r man har valgt norkart og er zoomet inn til nederste nivÃ¥ og dobbelklikker i kartet. leaflet prÃ¸ver Ã¥ zoome til klikket posisjon, men fÃ¥r ugyldige koordinater.

Dette er en feil i leaflet, og den er ikke fikset pÃ¥ nyeste versjon. Det finnes en toggle slik atÂ  man kan slÃ¥ av at dobbelklikk-zoom zoomer tilÂ  musepekeren, og istedet zoomer til senter av kartvinduet. ved Ã¥ toggle denne av, vil ikke feilen lenger oppstÃ¥, og det vil i de aller fleste tilfeller vÃ¦re ubetydelig for brukerne siden zoom til musepeker ved scroll-zoom fungerer som fÃ¸r.
h2. LÃ¸sning

toggle av zoom til musepeker ved dobbelklikk

Â ",NVDB-6937,Datafangst,
Logg hele request og response ved feil mot Skriv,"400-feil mot Skriv er vanskelige Ã¥ feilsÃ¸ke i logg fordi vi bare logger et utdrag av request, og det blir som regel kutta av fÃ¸r dataene vi trenger.

NÃ¥r det oppstÃ¥r en 4xx eller 5xx burde vi ha en eksplisitt logg av hele request og response, sÃ¥nn at vi kan finne ut av det.",NVDB-6937,Datafangst,
Presentere 400-feil fra Skriv for bruker,"Forrige runde da vi sÃ¥ pÃ¥ 400-feil fra Skriv ble vi etter litt diskusjon (med Tore) enige om Ã¥Â _ikke_ prÃ¸ve Ã¥ parse disse og presentere de til bruker. Ser i det siste at vi har fÃ¥tt sÃ¥pass mange av dem, og det er en gjenganger pÃ¥ support. Dette er bl.a. fordi antall stedfestingsfeil har Ã¸kt, og mye verdivalidering pÃ¥ stedfesting gjÃ¸res pÃ¥ en mÃ¥te som gir 400 heller enn 200 med feilrapport.

Mye stedfestingsfeil er forhÃ¥pentligvis en forbigÃ¥ende fase, men siden Skriv validerer sÃ¥ mye i den fasen som gir 400-feil sÃ¥ bÃ¸r det vurderes Ã¥ gjÃ¸re noe for Ã¥ presentere disse meldingene til bruker.

Vi mÃ¥ kunne parse feilmelding, men den er strukturert og kan mappes tilbake til request, som vi fortsatt har i dette tilfellet. Siden dette er en mekanisme som ligger i XML-biblioteket sÃ¥ risiker at formatet endrer seg uten at det er villet fra Skriv, men det vil antakeligvis i verste fall bare skje i en ny major-versjon av biblioteket.",NVDB-6937,Datafangst,
Sentry: UhÃ¥ndtert feilsituasjon ved henting av vegnet,"h2. Observasjon

[https://sentry.kantega.org/kantega/datafangst/issues/11/events/81073/]

Det ser ut som kall til vegnettet av og til feiler. nÃ¥r det skjer, kastes det en exeption som ikke hÃ¥ndteres, og som kan forÃ¥rsake at DF ikke responderer.

ca 70 tilfeller siste 14 dager

Analyser og legg inn feilhÃ¥ndtering
h2. Analyse

Her er det snakk om feil som oppstÃ¥r nÃ¥r DF ikke hÃ¥ndterer at kall til vegnett feiler av ymse Ã¥rsaker. NÃ¥r det skjer, kastes en exception fordi en promise blir rejected og ikke hÃ¥ndtert.

Kan gjenskapes ved Ã¥ f.eks blokkere kallet i devtool.
h2. LÃ¸sning

Legg inn error hÃ¥ndtering som returnerer null ved feilet kall. NÃ¥r null returneres til redux, vil redux bare ignorere det og fortsette Ã¥ vise vegnettet vi allerede har og prÃ¸ve pÃ¥ nytt ved neste panorering, og vise en feilmelding.

Â ",NVDB-6937,Datafangst,
"FÃ¥r ikkje med alle objekt i CSV-eskport ved ""store"" kartutsnitt","Melding om mogleg feil frÃ¥ Jan Kristian Jensen. Det er vel ei Ã¸vre grense for talet pÃ¥ objekt som vert med i Vegkart og i eksport ved store kartutsnitt, men det han viser til her ser ikkje ut til Ã¥ skulle ha sÃ¥ store mengder data.

Melding:Â 

CSV-eksport av _Bruksklasse, tÃ¸mmertransport_ fÃ¥r ikke med alt av data innafor kartutsnitt nÃ¥r kartutsnittet dekker store omrÃ¥der. Eksempel pÃ¥ omrÃ¥de som feiler nedenfor. Lett Ã¥ verifisere: Last ned CSV og hiv dem i kart, sÃ¥ ser du at vi er langt unna Ã¥ ha heldekkende data. SpÃ¸rring direkte mot NVDB api gir Ã¸nsket resultat, uavhengig av kartutsnitt.

Â 

Zoomer man inn til mindre omrÃ¥de sÃ¥ fÃ¥r man heldekkende data for det mindre omrÃ¥det. Uavklart hvor eksakt grense for stort kartutsnitt / antall objekter kan vÃ¦re fÃ¸r problemet inntreffer.

Â 

_En observasjon fra dem som knadde pÃ¥ data fra det store kartutsnittet: Ingen objektId som startet med sifrene Â«10Â» eller Â«8Â». Aner ikke om dette er verdifullt for feilsÃ¸king._",NVDB-6937,Eksport,
Leveranseinformasjon,"*Test i AT av leverandÃ¸r:*
 * NVDB-5799: Ta inn et eksisterende NVDB-objekt og verifiser brukergrensesnittet nÃ¥r man sletter/angrer koblinger. Sjekk at objektene ikke er dirty etter Ã¥ ha angret en kobling.
 * NVDB-5877: Sjekk at NVDB-tilstand tilbakestilles etter at ny kobling slettes.
 * NVDB-5834: Manipuler opplastet data til 6173/NN54 og registrer. Verifiser at 5973 da benyttes.

*Test i AT av SVV:*
 * NVDB-5847: Logg inn med en SVV- og epost-bruker. Bruk gjerne en SVV-bruker som har Ã¦/Ã¸/Ã¥ i passordet.

NVDB-5866 trenger ikke Ã¥ testes eksplisitt i ATM.",NVDB-6937,Datafangst,
"Sletting av ny kobling oppdaterer ikke ""dirty""","h2. Observasjon
# Koble et nytt skilt til et importert skiltpunkt
# Fjern kobling igjen, skiltpunkt skal da ikke ha noen endringer
# Skiltpunkt vises fortsatt med endringer (""dirty"" satt i database)

h2. Analyse
Ved sletting av ny kobling (som da blir fjernet fra database) trenger vi en sjekk pÃ¥ om parent er uendret, pÃ¥ samme mÃ¥te som det er gjort i NVDB-5799.",NVDB-6937,Datafangst,
Punktgeometri ruteberegnes til to like punktstedfestinger,"h2. Observasjon

FÃ¸lgende input til rute-endepunktet:

 geometri = ""POINT (270196.99 7041858.13)""
 maks_avstand = ""100""
 konnekteringslenker = false
 detaljerte_lenker = false
 vegsystemreferanse = ""F,K,E,R""
 trafikantgruppe = null
 typeveg = ""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring""
 tidspunkt_start = ""2020-01-01""
 tidspunkt_slutt = null
 pretty = false
 kortform = false

Responderer to instanser av samme punktstedfesting:

vegnettsrutesegmenter = {java.util.ArrayList@19885}  size = 2
 0 = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.DetaljertRuteSegment@19888} 
  veglenkesekvensid = {java.lang.Long@19903} 2510771
  startposisjon = {java.lang.Double@19904} 0.1429407
  sluttposisjon = {java.lang.Double@19905} 0.1429407
  kortform = ""0.1429407@2510771""
  veglenkenummer = {java.lang.Integer@19894} 1
  startnode = null
  sluttnode = null
  type = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.Type@19895} ""HOVED""
  detaljnivÃ¥ = ""Vegtrase""
  typeVeg = ""Kanalisert veg""
  feltoversikt = {java.util.ArrayList@19909}  size = 4
  geometri = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.Geometri@19910} 
  lengde = {java.lang.Double@19911} 0.0
  vegsystemreferanse = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.Vegsystemreferanse@19912} 
 1 = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.DetaljertRuteSegment@19889} 
  veglenkesekvensid = {java.lang.Long@19890} 2510771
  startposisjon = {java.lang.Double@19891} 0.1429407
  sluttposisjon = {java.lang.Double@19892} 0.1429407
  kortform = ""0.1429407@2510771""
  veglenkenummer = {java.lang.Integer@19894} 1
  startnode = null
  sluttnode = null
  type = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.Type@19895} ""HOVED""
  detaljnivÃ¥ = ""Vegtrase""
  typeVeg = ""Kanalisert veg""
  feltoversikt = {java.util.ArrayList@19898}  size = 4
  geometri = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.Geometri@19899} 
  lengde = {java.lang.Double@19900} 0.0
  vegsystemreferanse = {no.vegvesen.vt.nvdb.apiskriv.localization.nvdbapiread.binding.Vegsystemreferanse@19901} ",NVDB-6937,Les-API,
Leveranseinformasjon,"*Test i ATM av leverandÃ¸r:*
 * NVDB-5874: Kall url i beskrivelsen for Ã¥ verifisere at norske tegn stÃ¸ttes. SÃ¸rg for at en bruker med norske tegn testes.

Ã˜vrige saker pÃ¥ 2020.13 leveranser trenger ikke eksplisitt testing i AT.

Denne leveransen vil forÃ¸vrig inkludere 2020.12.1, hvor NVDB-5874 er fix pÃ¥ denne. Se derfor ogsÃ¥ NVDB-5850.",NVDB-6937,Skriv-API,
Anrop SoaBasis feiler for bruker med norske tegn i navnet,"h2. Observasjon

Bruker JÃ¸rn Maurseth fÃ¥r exception-respons fra https://www.test.vegvesen.no/nvdb/apiskriv/rest/v1/ldap/bruker/jormau etter utrulling av 2020-12.1:

{code:xml}
<fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1"">
  <message>javax.xml.ws.WebServiceException: java.lang.IndexOutOfBoundsException: start 0, end 4496, s.length() 4493</message>
  <message>java.lang.IndexOutOfBoundsException: start 0, end 4496, s.length() 4493</message>
  <message>start 0, end 4496, s.length() 4493</message>
</fault>{code}

h2. Analyse

Problemet oppstÃ¥r i LoggingSoapHandler. Innholdet i responsen fra SoaBasis skal logges, men bare inntil et visst antall tegn eller hele meldingen om den er liten nok. Antall tegn som skal logges beregnes imidlertid fra stream'ens size() ikke lengden pÃ¥ den encodede strengen. Dersom meldingen inneholder norske tegn vil disse to stÃ¸rrelsene vÃ¦re forskjellige. Dermed oppstÃ¥r IndexOutOfBoundsException.

h2. LÃ¸sning

Hentet meldingen inn i en lokal strengvariabel (encodet) og bruker denne sin lengde ved logging.",NVDB-6937,Skriv-API,
StÃ¸tte realm external,"Legg til mulighet til Ã¥ ha usertype: external, og sett opp tokenvalidatorer for dette. ",NVDB-6937,Les-API,
Noen brukere fÃ¥r ikke hentet roller ved innlogging,"Etter at henting av roller ble innfÃ¸rt ved innlogging feiler innlogging for noen brukere fordi rolle-kallet feiler. Skriv krever en gitt rolle av bruker, selv om det er brukers egne data som hentes.

LÃ¸sning er Ã¥ bruke systembruker ved henting av roller.",NVDB-6937,Datafangst,
500 for request med kontraktsomrÃ¥de,"https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/570?kartutsnitt=-32466.553,6734380.598,-32307.886,6734474.525&kontraktsomrade=4604+Bergen-Os-Austevoll++2021-2026&segmentering=true&inkluder=metadata,egenskaper,lokasjon,geometri",NVDB-6937,Les-API,
Exception lekker til std. out.,"Disse havner i std. out. Og muligens ogsÃ¥ i vanlig logg. 
Forhindre at de havner i std. out.
{quote}
2020-09-07 09:44:49.438 level=""SEVERE"" message=""An I/O error has occurred while writing a response message entity to the container output stream."" source=""org.glassfish.jersey.server.ServerRuntime$Responder writeResponse"" trace=""
org.glassfish.jersey.server.internal.process.MappableException: HTTP[500] Error[Code=(5001) Message=(Error from server at http://svvpnvdbsolr06.vegvesen.no:8983/solr/nvdb-roadobjects:  org.apache.catalina.connector.ClientAbortException: java.io.IOException: Connection reset by peer)] 
	at org.glassfish.jersey.server.internal.MappableExceptionWrapperInterceptor.aroundWriteTo(MappableExceptionWrapperInterceptor.java:67)
	at org.glassfish.jersey.message.internal.WriterInterceptorExecutor.proceed(WriterInterceptorExecutor.java:139)
	at org.glassfish.jersey.message.internal.MessageBodyFactory.writeTo(MessageBodyFactory.java:1115)
	at org.glassfish.jersey.server.ServerRuntime$Responder.writeResponse(ServerRuntime.java:638)
	at org.glassfish.jersey.server.ServerRuntime$Responder.processResponse(ServerRuntime.java:371)
	at org.glassfish.jersey.server.ServerRuntime$Responder.process(ServerRuntime.java:361)
	at org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:256)
	at org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)
	at org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:292)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:274)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:244)
	at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265)
	at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:232)
	at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680)
	at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:392)
	at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346)
	at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:365)
	at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:318)
	at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at io.smallrye.metrics.jaxrs.JaxRsMetricsServletFilter.doFilter(JaxRsMetricsServletFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at ch.qos.logback.classic.selector.servlet.LoggerContextFilter.doFilter(LoggerContextFilter.java:69)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at no.vegvesen.nvdb.shared.web.filters.RateLimiterFilter.lambda$doFilter$0(RateLimiterFilter.java:73)
	at io.github.resilience4j.ratelimiter.RateLimiter.lambda$decorateCheckedRunnable$3(RateLimiter.java:248)
	at io.vavr.control.Try.run(Try.java:118)
	at no.vegvesen.nvdb.shared.web.filters.RateLimiterFilter.doFilter(RateLimiterFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at no.vegvesen.nvdb.shared.web.filters.AcceptFilter.doFilter(AcceptFilter.java:71)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.logging.log4j.web.Log4jServletFilter.doFilter(Log4jServletFilter.java:71)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:543)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:609)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:818)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1623)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: HTTP[500] Error[Code=(5001) Message=(Error from server at http://svvpnvdbsolr06.vegvesen.no:8983/solr/nvdb-roadobjects:  org.apache.catalina.connector.ClientAbortException: java.io.IOException: Connection reset by peer)] 
	at no.vegvesen.nvdbapi.common.solr.SolrClientWrapperImpl.translate(SolrClientWrapperImpl.java:144)
	at no.vegvesen.nvdbapi.common.solr.SolrClientWrapperImpl.queryAndStreamResponse(SolrClientWrapperImpl.java:99)
	at no.vegvesen.nvdbapi.common.solr.SolrBulkHead.lambda$queryAndStreamResponse$1(SolrBulkHead.java:42)
	at io.github.resilience4j.bulkhead.Bulkhead.lambda$decorateCallable$4(Bulkhead.java:177)
	at io.github.resilience4j.bulkhead.Bulkhead.executeCallable(Bulkhead.java:525)
	at no.vegvesen.nvdbapi.common.solr.SolrBulkHead.tryQuery(SolrBulkHead.java:48)
	at no.vegvesen.nvdbapi.common.solr.SolrBulkHead.queryAndStreamResponse(SolrBulkHead.java:42)
	at no.vegvesen.nvdbapi.data.service.roadobject.RoadObjectService.query(RoadObjectService.java:247)
	at no.vegvesen.nvdbapi.data.service.roadobject.RoadObjectService.segmented(RoadObjectService.java:220)
	at no.vegvesen.nvdbapi.data.service.roadobject.RoadObjectService.executeRequest(RoadObjectService.java:206)
	at no.vegvesen.nvdbapi.v3.web.resources.RoadObjectResource.lambda$getObjectList$1(RoadObjectResource.java:146)
	at no.vegvesen.nvdb.shared.StreamingOutputWrapper.write(StreamingOutputWrapper.java:52)
	at org.glassfish.jersey.message.internal.StreamingOutputProvider.writeTo(StreamingOutputProvider.java:55)
	at org.glassfish.jersey.message.internal.StreamingOutputProvider.writeTo(StreamingOutputProvider.java:37)
	at org.glassfish.jersey.message.internal.WriterInterceptorExecutor$TerminalWriterInterceptor.invokeWriteTo(WriterInterceptorExecutor.java:242)
	at org.glassfish.jersey.message.internal.WriterInterceptorExecutor$TerminalWriterInterceptor.aroundWriteTo(WriterInterceptorExecutor.java:227)
	at org.glassfish.jersey.message.internal.WriterInterceptorExecutor.proceed(WriterInterceptorExecutor.java:139)
	at org.glassfish.jersey.server.internal.JsonWithPaddingInterceptor.aroundWriteTo(JsonWithPaddingInterceptor.java:85)
	at org.glassfish.jersey.message.internal.WriterInterceptorExecutor.proceed(WriterInterceptorExecutor.java:139)
	at org.glassfish.jersey.server.internal.MappableExceptionWrapperInterceptor.aroundWriteTo(MappableExceptionWrapperInterceptor.java:61)
	... 58 more
Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://svvpnvdbsolr06.vegvesen.no:8983/solr/nvdb-roadobjects:  org.apache.catalina.connector.ClientAbortException: java.io.IOException: Connection reset by peer
	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:638)
	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:265)
	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:248)
	at org.apache.solr.client.solrj.impl.LBSolrClient.doRequest(LBSolrClient.java:368)
	at org.apache.solr.client.solrj.impl.LBSolrClient.request(LBSolrClient.java:296)
	at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.sendRequest(BaseCloudSolrClient.java:1128)
	at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.requestWithRetryOnStaleState(BaseCloudSolrClient.java:897)
	at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.request(BaseCloudSolrClient.java:829)
	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:211)
	at no.vegvesen.nvdbapi.common.solr.SolrClientWrapperImpl.queryAndStreamResponse(SolrClientWrapperImpl.java:95)
	... 76 more
Caused by: java.lang.RuntimeException: org.apache.catalina.connector.ClientAbortException: java.io.IOException: Connection reset by peer
	at com.google.common.base.Throwables.propagate(Throwables.java:241)
	at no.vegvesen.nvdbapi.data.service.roadobject.RoadObjectStreamer.streamSolrDocument(RoadObjectStreamer.java:63)
	at no.vegvesen.nvdbapi.common.solr.SolrClientWrapperImpl$TimingStreamingResponseCallback.streamSolrDocument(SolrClientWrapperImpl.java:208)
	at org.apache.solr.client.solrj.impl.StreamingBinaryResponseParser$3.readSolrDocument(StreamingBinaryResponseParser.java:135)
	at org.apache.solr.common.util.JavaBinCodec.readObject(JavaBinCodec.java:330)
	at org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:281)
	at org.apache.solr.client.solrj.impl.StreamingBinaryResponseParser$3.readSolrDocumentList(StreamingBinaryResponseParser.java:164)
	at org.apache.solr.common.util.JavaBinCodec.readObject(JavaBinCodec.java:332)
	at org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:281)
	at org.apache.solr.common.util.JavaBinCodec.readOrderedMap(JavaBinCodec.java:225)
	at org.apache.solr.common.util.JavaBinCodec.readObject(JavaBinCodec.java:299)
	at org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:281)
	at org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:194)
	at org.apache.solr.client.solrj.impl.StreamingBinaryResponseParser.streamDocs(StreamingBinaryResponseParser.java:170)
	at org.apache.solr.client.solrj.impl.StreamingBinaryResponseParser.processResponse(StreamingBinaryResponseParser.java:62)
	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:636)
	... 85 more
Caused by: org.apache.catalina.connector.ClientAbortException: java.io.IOException: Connection reset by peer
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:330)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:293)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:118)
	at org.glassfish.jersey.servlet.internal.ResponseWriter$NonCloseableOutputStreamWrapper.flush(ResponseWriter.java:306)
	at org.glassfish.jersey.message.internal.CommittingOutputStream.flush(CommittingOutputStream.java:263)
	at org.glassfish.jersey.message.internal.WriterInterceptorExecutor$UnCloseableOutputStream.flush(WriterInterceptorExecutor.java:281)
	at java.io.FilterOutputStream.flush(FilterOutputStream.java:140)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1153)
	at no.vegvesen.nvdbapi.common.serialization.json.JsonGeneratorEx.flush(JsonGeneratorEx.java:257)
	at no.vegvesen.nvdbapi.serialization.roadobjects.RoadObjectJsonSerializer.write(RoadObjectJsonSerializer.java:113)
	at no.vegvesen.nvdbapi.serialization.roadobjects.RoadObjectsJsonSerializer.write(RoadObjectsJsonSerializer.java:55)
	at no.vegvesen.nvdbapi.data.service.roadobject.RoadObjectStreamer.streamSolrDocument(RoadObjectStreamer.java:59)
	... 99 more
Caused by: java.io.IOException: Connection reset by peer
	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
	at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:47)
	at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:93)
	at sun.nio.ch.IOUtil.write(IOUtil.java:65)
	at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:468)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:136)
	at org.apache.tomcat.util.net.NioBlockingSelector.write(NioBlockingSelector.java:101)
	at org.apache.tomcat.util.net.NioSelectorPool.write(NioSelectorPool.java:157)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1308)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:692)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:645)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:635)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:646)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:166)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:252)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1379)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:405)
	at org.apache.coyote.Response.action(Response.java:206)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:326)
	... 110 more
{quote}",NVDB-6937,Les-API,
Oppgradere til Flyway 5,"Mellomsteg i oppdatering, kreves for Ã¥ kunne gÃ¥ opp pÃ¥ Flyway 6 som er versjonen som Quarkus bruker.

MÃ¥ gjÃ¸res etter at Flyway 4 (NVDB-5866) er i prod.",NVDB-6937,Datafangst,
Oppgradere Flyway til versjon 4,"Flyway kan bare oppdateres Ã©n major-versjon om gangen, detter er fÃ¸rste steg for Ã¥ komme Ã  jour.",NVDB-6937,Datafangst,
Logging av Exceptions i IntelliJ,"Logging lokalt i console i IntelliJ er litt hÃ¥plÃ¸st.

Fiks slik at det logges feilmelding (log ERROR ikke WARN i Exceptionmapper)
Slutt Ã¥ log request payloads i console",NVDB-6937,Datafangst,
Mangler filtrering pÃ¥ kryss og sideanlegg ved vegsystemreferansesÃ¸k i /veg,"https://nvdbapiles-v3.atlas.vegvesen.no/veg\?vegsystemreferanse\=Fv704S1D1m0 gir vekslende svar. 
Det er fordi det er kryss og sideanlegg der, vi mÃ¥ legge pÃ¥ ekskludering av kryss og sideanlegg nÃ¥r det ikke inngÃ¥r i vegsystemreferansen.",NVDB-6937,Les-API,
Endepunkt for etablering av OIDC-token,"For Ã¥ forenkle livet til NVDB API Skriv sine klienter ved overgang til Atlas, skal det utvikles endepunkter for Ã¥:

- etablere OIDC-tokens (idToken + refreshToken)
- refreshe et idToken

Inspirasjon kan hentes fra AuthResource i NVDB API Les.",NVDB-6937,Skriv-API,
Omruting til OIDC pÃ¥logging i Kontrollpanel og Generator,"SSO fungerer ikke med OpenIdConnect-baserte applikasjoner og de mÃ¥ derfor selv rute om til pÃ¥loggingssiden for Ã¥ fÃ¥ etablert et JWT-token. Generator og Kontrollpanel mÃ¥ utvides med denne omrutingen i den versjonen av NVDB API Skriv som kjÃ¸rer pÃ¥ Atlas.

Atlas-gjengen har ferdiglaget JavaScript som kan brukes til dette formÃ¥let.

Se ogsÃ¥:

https://github.com/nvdb-vegdata/nvdb-admin/tree/master/src/main/webapp/browser/svv-login-page
https://github.com/nvdb-vegdata/nvdb-admin/blob/master/src/main/webapp/browser/app.jsx
https://www.npmjs.com/package/oidc-client
https://git.vegvesen.no/projects/NVDBDATA/repos/atlas-config/browse/nvdbapil/utvikling-v3/services.json#12",NVDB-6937,Skriv-API,
Stedfesting gir like start og sluttpunkt,"h2. Observasjon

Fra support. Stedfest vedlagte SOSI automatisk. Deretter stedfest KURVE 2 til RA9 (veien ligger rett ved). Da blir stedfestingen delt i to hvor hver bit har lik start og slutt. Gjenskapt pÃ¥ df-utv.

[https://datafangst.kantega.no/#!/contract/81f608cd-c711-46f0-9923-df63846a1ea7/locational2]

[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.12-2020.09.02/doc/?id=r4XvTXQBsUoQFJJym18g]

Fra Prod:Â select * from feature_locational2 where feature_id='5af85066-4058-4a5c-82c6-96bbcb2245f3';

Se forÃ¸vrig KURVE 1 og KURVE 3 hvor KURVE 2 burde fÃ¥tt posisjon mellom disse. Ta ogsÃ¥ en titt pÃ¥Â [https://nvdb-vegdata.github.io/nvdb-visrute/PROD/]Â som viser hvilken rute Les ville valgt, hvor den inkluderer delene mellom KURVE 1 og KURVE 3 (bruk startposisjon ""66235.3397186895,6598615.837483798"" og sluttposisjon ""66652.66353714647,6597105.584636308"" med vegsystemreferanse ""RA"". Da fÃ¥r du lenker somÂ 

[https://nvdbapiles-v3.atlas.vegvesen.no/beta/vegnett/rute?start=66235.3397186895,6598615.837483798&slutt=66652.66353714647,6597105.584636308&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&vegsystemreferanse=RA&pretty=true&kortform=true]

Dvs at stedfesting skulle vÃ¦rt noe a laÂ 

0.0-003@3103849

0.0-1.0@3103848

0.999-1.0@3103847",NVDB-6937,Datafangst,
"Meir informasjon i ""Velkommen til Datafangst!""-mailen.","[~hans.alien@vegvesen.no]Â foreslÃ¥r Ã¥ legge til meir informasjon i ""Velkommen""-mailen som nye brukarar i DF fÃ¥r:

Jeg foreslÃ¥r at invitasjonseposten utvides til Ã¥ inneholde navn og kontaktinfo pÃ¥ forvalteren som inviterer, samt muligens tips om Ã¥ kontakte vedkommende dersom fristen er passert.
----
Etter litt diskusjon tror vi at det som Hans Anton egentlig vil oppnÃ¥ er at brukere som blir invitert inn pÃ¥ kontrakt vet hva de skal gjÃ¸re nÃ¥r de 7 dagene som lenke for registrering har gÃ¥tt ut.

En god mÃ¥te Ã¥ oppnÃ¥ det pÃ¥ er Ã¥ vise til veiviseren for innloggingsproblemer ([https://datafangst.kantega.no/noauth/#!/user/login-help)] nederst i malen for mail som sendes nÃ¥r ny bruker er gitt tilgang pÃ¥ kontrakt.

I fÃ¸rste omgang trenger vi ikke Ã¥ ha med navn og kontaktinfo for forvalter, dette var basert pÃ¥ en feilaktig antakelse om at forvalter kunne lÃ¸se dette ved Ã¥ legge til deltaker pÃ¥ kontrakten pÃ¥ nytt.",NVDB-6937,Datafangst,
"Autentisering med AAA-tjenesten, avvikle OpenAM","OpenAM fases ut.
Datafangst mÃ¥ ta i bruk AAA-tjenesten.

OpenAM er pÃ¥ veg ut, sÃ¥ DF bÃ¸r snarest omprogrammeres til Ã¥ autentisere via AAA-tjenesten. Dette er en fasade-tjeneste som dekobler klienter fra underliggende IAM-teknologi og gjÃ¸r derfor livet enklere for alle parter.

https://apiskriv.vegdata.no/autentisering",NVDB-6937,Datafangst,
Rettigheter blir ikke satt riktig for brukere,"h2. Observasjon

Fra support. En bruker ""ERLSON"" var lagt til som kontraktsgruppeforvalter pÃ¥ gruppe ""TOG BjB40"". Denne fikk ikke de rettighetene denne skulle ha. Etter at han ble lagt inn som ""erlson"" fikk han de rettighetene han skulle ha. Se vedlegg som viser rettigheter for ""eivgil"" pÃ¥ samme gruppe.

select * from user_role where username in ('eivgil', 'EIVGIL');

For Ã¥ se om jeg fikk gjenskapt fjernet jeg ""rikrye"" fra ""TEST"" i df-utv og la henne inn som ""RIKRYE"". Da kommer pÃ¥ spÃ¸rringen over innslag for ""rikrye"" og ""RIKRYE"". Dette observerte jeg imidlertid ikke i Prod da caps-lock bruker ikke var med overhodet. Men det bÃ¸r sees pÃ¥ hva som skjer nÃ¥r man legger inn bruker med smÃ¥ vs store boksatver.

h2. Forslag til lÃ¸sning
Brukernavn konverteres til smÃ¥ bokstaver fÃ¸r det lagres i database.",NVDB-6937,Datafangst,
Sjekk at transaksjon under behandling blir tatt ved oppstart,"Vi trenger sjekke at transaksjonen som er under behandling ved restart av NVDBIND blir tatt opp pÃ¥ nytt nÃ¥r applikasjonen starter igjen. 

Transaksjon 4923822 2020-08-31 14:35:06 ble avbrutt, og en annen transaksjon var fÃ¸rste som ble behandlet etter oppstart.


*Analyse*
I dette tilfellet er det flere ting som tilsammen gjÃ¸r at dette skjedde. Transaksjoner blir lest inn i batcher til IND, og de blir sortert pÃ¥ tid fra transaksjonsid-en fÃ¸r de legges i kÃ¸ for prosessering. Det er noe tidsforsinkelse pÃ¥ tidspunkt i transaksjonsid og nÃ¥r transkasjonen er skrevet til NVDB. Dette har gjort at den ikke ble lest og sortert riktig av IND, den har sansyligvis kommet i neste batch og blitt sortert sammen med transaksjonene der.

NÃ¥r en transaksjon er ferdig behandlet i IND blir syncInfo-fila oppdatert med tidspunktet til den aktuelle transaksjonen.
I dette tilfellet ble en transaksjon med senere tidspunkt prosessert fÃ¸rst slik at syncInfo hadde tidspunkt som var senere og derfor ble ikke den aktuelle transaksjonen plukket opp igjen ved start.

Det er ogsÃ¥ en mekanisme i IND som gjÃ¸r at IND sjekker 10 minutter (konfigurerbart) tilbake i tid ved oppstart igjen. Da er det 10 minutter fra sist sjekket tidspunkt. I tilfellet her lÃ¥ vi noen timer bak, sÃ¥ derfor ble ikke transaksjonen fanget opp av denne mekanismen.

Behandling i skriv, https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/e69edce1-4d9b-4760-a9cd-01acbd94b9fb, ser at ""4923822 2020-08-31 14:35:06"" ble skrevet ca 30 sekunder etter, ""2020-08-31 14:35:36.742	STORED_IN_NVDB""


*LÃ¸sning*
GjÃ¸r ikke noe med dette nÃ¥, men det vil bli lÃ¸st av https://jira.kantega.no/browse/NVDB-4181 der kÃ¸a skrives til disk. Da mister man ikke transaksjoner som allerede er lagt til kÃ¸a ved omstart.",NVDB-6937,NVDB-IND,
StatistikkspÃ¸rringer med omrÃ¥de feiler,"PÃ¥ grunn av endringer i dokumentene i NVDB-5738 feiler statistikkspÃ¸rringer.
Apiet:
{quote}
2020-09-01T13:59:47,798+0200 TRANSID=""b906016b-2c43-6ed1-96f8-188a0466ae85"" SEVERITY=""ERROR"" ORIGIN=""GenericExceptionMapper"" MESSAGE=""Unexpected exception encountered for URL: http://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/902/statistikk?kartutsnitt=-93364.246%2C7289338.623%2C1640612.555%2C8165809.709&vegsystemreferanse=P&segmentering=true""
no.vegvesen.nvdbapi.common.exceptions.SolrCommunicationException: HTTP[500] Error[Code=(5001) Message=(No live SolrServers available to handle this request:[http://svvpnvdbsolr12.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr11.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr14.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr07.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr13.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr08.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr09.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr15.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr06.vegvesen.no:8983/solr/nvdb-roadobjects])] 
	at no.vegvesen.nvdbapi.common.solr.SolrClientWrapperImpl.translate(SolrClientWrapperImpl.java:124)
	at no.vegvesen.nvdbapi.common.solr.SolrClientWrapperImpl.query(SolrClientWrapperImpl.java:66)
	at no.vegvesen.nvdbapi.common.solr.SolrBulkHead.lambda$query$0(SolrBulkHead.java:37)
	at io.github.resilience4j.bulkhead.Bulkhead.lambda$decorateCallable$4(Bulkhead.java:177)
	at io.github.resilience4j.bulkhead.Bulkhead.executeCallable(Bulkhead.java:525)
	at no.vegvesen.nvdbapi.common.solr.SolrBulkHead.tryQuery(SolrBulkHead.java:48)
	at no.vegvesen.nvdbapi.common.solr.SolrBulkHead.query(SolrBulkHead.java:37)
	at no.vegvesen.nvdbapi.data.service.roadobject.RoadObjectService.getStats(RoadObjectService.java:153)
	at no.vegvesen.nvdbapi.v3.web.resources.RoadObjectResource.lambda$getStats$2(RoadObjectResource.java:178)
	at no.vegvesen.nvdb.shared.StreamingOutputWrapper.write(StreamingOutputWrapper.java:52)
	...
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request:[http://svvpnvdbsolr12.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr11.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr14.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr07.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr13.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr08.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr09.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr15.vegvesen.no:8983/solr/nvdb-roadobjects, http://svvpnvdbsolr06.vegvesen.no:8983/solr/nvdb-roadobjects]
	at org.apache.solr.client.solrj.impl.LBSolrClient.request(LBSolrClient.java:345)
	at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.sendRequest(BaseCloudSolrClient.java:1128)
	at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.requestWithRetryOnStaleState(BaseCloudSolrClient.java:897)
	at org.apache.solr.client.solrj.impl.BaseCloudSolrClient.request(BaseCloudSolrClient.java:829)
	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:211)
	at org.apache.solr.client.solrj.SolrClient.query(SolrClient.java:1035)
	at no.vegvesen.nvdbapi.common.solr.SolrClientWrapperImpl.query(SolrClientWrapperImpl.java:61)
	... 74 common frames omitted
Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://svvpnvdbsolr08.vegvesen.no:8983/solr/nvdb-roadobjects: Error from server at null: Parent query must not match any docs besides parent filter. Combine them as must (+) and must-not (-) clauses to find a problem doc. docID=6234
	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:665)
	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:265)
	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:248)
	at org.apache.solr.client.solrj.impl.LBSolrClient.doRequest(LBSolrClient.java:368)
	at org.apache.solr.client.solrj.impl.LBSolrClient.request(LBSolrClient.java:319)
	... 80 common frames omitted
{quote}
Solr:
{quote}
2020-09-01T11:11:20.542+0000 ERROR (qtp124734309-36389) [c:nvdb-roadobjects s:shard1 r:core_node56 x:nvdb-roadobjects_shard1_replica_n55] o.a.s.s.HttpSolrCall null:java.lang.IllegalStateException: Parent query must not match any docs besides parent filter. Combine them as must (+) and must-not (-) clauses to find a problem doc. docID=748
	at org.apache.lucene.search.join.ToChildBlockJoinQuery$ToChildBlockJoinScorer.validateParentDoc(ToChildBlockJoinQuery.java:276)
	at org.apache.lucene.search.join.ToChildBlockJoinQuery$ToChildBlockJoinScorer.access$300(ToChildBlockJoinQuery.java:132)
	at org.apache.lucene.search.join.ToChildBlockJoinQuery$ToChildBlockJoinScorer$1.nextDoc(ToChildBlockJoinQuery.java:178)
	at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:265)
{quote}
",NVDB-6937,Les-API,
Takler ikke datakatalogoppdatering nÃ¥r IND er stoppet,"Dersom NVDB fÃ¥r en datakatalogoppdatering mens NVDBIND er stoppet vil NVDBIND stoppe med 
{quote}
2020-08-31 17:39:54 [taskexecutor] ERROR TaskExecutor - Task FullExport() failed 
no.vegvesen.nvdbind.OutdatedDatakatException: Exported datakatalog is out of date, exported version: 2.21 current version: 2.22
	at no.vegvesen.nvdbind.tasks.DatakatTask.checkCurrent(DatakatTask.java:61)
	at no.vegvesen.nvdbind.tasks.DatakatTask.run(DatakatTask.java:41)
	at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:209)
	at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:149)
	at no.vegvesen.nvdbind.tasks.DefaultTaskExecutionContext.execute(DefaultTaskExecutionContext.java:42)
	at no.vegvesen.nvdbind.tasks.FullExportTask.run(FullExportTask.java:36)
	at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:201)
	at no.vegvesen.nvdbind.tasks.TaskExecutor.start(TaskExecutor.java:115)
	at no.vegvesen.nvdbind.NvdbindCore$TaskExecutorThread.run(NvdbindCore.java:503)
{quote}
ved oppstart.",NVDB-6937,NVDB-IND,
Systemfeil pga NPE i NoOverlapsValidator,"h2. Observasjon

Dette endringssettet fÃ¥r NPE og systemfeil:

[https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/9bd15214-1dcd-425b-852c-d5030654caa8]

Stacktrace:

{code:java}
java.lang.NullPointerException: from can't be null
	at java.util.Objects.requireNonNull(Objects.java:228)
	at no.vegvesen.vt.nvdb.apiskriv.domain.Lifetime.<init>(Lifetime.java:52)
	at no.vegvesen.vt.nvdb.apiskriv.domain.Lifetime.between(Lifetime.java:48)
	at no.vegvesen.vt.nvdb.apiskriv.domain.feature.Feature.getLifetime(Feature.java:294)
	at no.vegvesen.vt.nvdb.apiskriv.domain.feature.Feature.hasCommonLifetimeWith(Feature.java:312)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.job.NoOverlapsValidator.shouldValidateOverlap(NoOverlapsValidator.java:100)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.job.NoOverlapsValidator.isValid(NoOverlapsValidator.java:52)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.job.NoOverlapsValidator.isValid(NoOverlapsValidator.java:30)
	at no.vegvesen.vt.nvdb.apiskriv.domain.validation.ConstraintEnforcer.enforce(ConstraintEnforcer.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.ConstraintJobFilter.doFilter(ConstraintJobFilter.java:28)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:117)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:449)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:171)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

I endringssettet bestilles lukking vegobjekt type 301, id 82383926, versjon 1. I NVDB er imidlertid versjon 2 den siste versjonen: https://www.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/301/82383926. Dette avdekkes korrekt i filteret PrepareForDiscontinueEnricherFilter, og en valideringsfeil registreres. Videre behandling avbrytes imidlertid ikke med anrop til ValidationResult.abortProcessing(). Dermed fortsetter valideringen og i JobConstraint'en NoOverlapsValidator havarerer behandlingen fordi vegobjektet som lukkes mangler startdato. I endringssettet er kun sluttdato angitt ved lukking, men PrepareForDiscontinueEnricherFilter vil kopiere inn startdato fra originalen i NVDB. I og med at det ble avdekket valideringsfeil der, skjedde ikke det.

h2. LÃ¸sning

I PrepareForDiscontinueEnricherFilter anropes ValidationResult.abortProcessing() dersom det er versjonsfeil eller vegobjektversjonen allerede er lukket. Dermed vil behandling avsluttes korrekt med valideringsfeil i dette tilfellet.",NVDB-6937,Skriv-API,
Konvertering av geometri ved innsending fungerer ikke,"En live case fra support der et vegobjekt med geometri med srid 6173 / NN54, som Skriv ikke godtar, skulle ha blitt konvertert ved innsending, men det blir det ikke.

Skriv avviser med validerings-feilmelding om at geometritype er ugyldig.

Geometrien er lagret slik i databasen :


{code:java}
{
   ""type"":""POINT"",
   ""representationPoint"":null,
   ""shape"":{
      ""@class"":""no.svv.nvdb.datafangst.domainmodel.geometry.shapes.Point"",
      ""position"":{
         ""northing"":6964293.98026751,
         ""easting"":173496.768292179,
         ""height"":14.4938896217843
      }
   },
   ""srid"":6173,
   ""heightRef"":""NN54"",
   ""properties"":{
      ""map"":{
         ""MEASUREMENT_METHOD"":""97"",
         ""ACCURACY_HEIGHT"":""0""
      }
   },
   ""length"":0.0,
   ""operation"":""WRITE""
}
{code}
",NVDB-6937,Datafangst,
Fjern varsel om ny stedfesting,"pÃ¥ stedfesting vises et varsel om at du bruker ny stedfesting, og at man kan klikke her for Ã¥ gÃ¥ til gammel.

Fjern varselet, men behold feature toggle i admin.",NVDB-6937,Datafangst,
Mangler informasjon om barn under relasjoner,"h2. Observasjon

Ved Ã¥ inkludere relasjoner sÃ¥ er det enkelte barn som ikke gir annen info enn kun id. Mangler href og relasjoner.

Eksempler:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/67/78728421/3.json?dybde=3&inkluder=relasjoner]

(sÃ¸k etterÂ _78728481_)

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/67/78729244/9.json?dybde=3&inkluder=relasjoner]

(sÃ¸k etterÂ _78729865)_

Analyse:
Eksempel 1) Type 461 er ikke indeksert i UTV, sannsynligvis derfor objektinfo ikke kommer ut, det kommer i de andre miljÃ¸ene
Eksempel 2) Objektet som kun har id er lukket, derfor blir det ikke hentet ut i solr-spÃ¸rringen som bruker dato som del av spÃ¸rreparamter.",NVDB-6937,Les-API,
Startdato blir ikke oppdatert for kontinuerlig sammenhengende segmenter i tid med ulik ID,"For sÃ¸k som dette, der segmenter har fÃ¥tt oppdatert Locational-objektet gjennom tid, fÃ¥r vi ikke oppdatert datofeltet:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?start=13538.741999999387,6696449.226&slutt=15041.6770000002,6696842.327999998&maks_avstand=10&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&pretty=true&tidspunkt_start=2011-03-20&tidspunkt_slutt=2011-03-26&kortform=false]

SÃ¸ket treffer disse to segmentene:

!Screenshot from 2020-08-25 16-42-43.png|thumbnail!

Det mÃ¥ altsÃ¥ utfÃ¸res en ekstra sjekk pÃ¥ start- og sluttnode for Ã¥ avgjÃ¸re om to segmenter skal ""slÃ¥s sammen"" i tid.

Â ",NVDB-6937,Les-API,
MÃ¸dre og dÃ¸tre fra NVDB mÃ¥ ogsÃ¥ kunne flyttes inn til mor,"h2. Observasjon

Vi har logikk fra gamle dager da NVDB-objekter kun ble brukt som referanse, som hindrer dÃ¸tre fra nvdb til Ã¥ flyttes inn til sin mor.

NÃ¥ i moderne dager kan vi importere objekter fra nvdb for endring, og de kan fÃ¥ ny stedfesting, og da mÃ¥ vi ogsÃ¥ tillate at vi flytter dem inn til sin mor.

I praksis betyr dette at hvis dataforvalter re-stedfester NVDB-objekter (bÃ¥de datter og mor) der de har miniskule forskjeller i geometrisk posisjon, ikke vil fÃ¥ godkjent endringssettet av SKRIVÂ  fordi datter ikke er innenfor mor.

Per nÃ¥ flytter vi bare dÃ¸tre inn til mor ved sammenkobling, sÃ¥ denne saken bÃ¸r ogsÃ¥ sees i sammenheng med NVDB-5822 (flytte datter ogsÃ¥ ved stedfesting)

Â 

Â 

Â ",NVDB-6937,Datafangst,
Ikke segmentere historiske objekter for kontrakt/riksvegrute,"OppfÃ¸lging av saken NVDB-5674 etter antallet segmenter ikke ble som forventet.

*LÃ¸sning*
Etter ny gjennomgang ble det oppdaget at ikke alle historiske kontraktsomrÃ¥der og riksvegruter ble droppet ved segmentering. Dette er nÃ¥ rettet og verifisert med integrasjonstest.",NVDB-6937,NVDB-IND,
Vegsystemreferanse pÃ¥ overgang E39 F710,"{quote}Har stÃ¸tt pÃ¥ en edge case i overgang mellom vegsystemreferanser. Trafikkulykke 264593895 har koordinatene (240233, 7030667.4) og ligger pÃ¥ EV39 S4D1 m2347.
 /posisjon-oppslag gir 0.25636204@72837 - EV39 S4D1 m2347.
 /veg?veglenkesekvens=0.25636204@72837 gir FV710 S1D1 m0.
{quote}
[https://nvdbapiles-v3.utv.atlas.vegvesen.no/veg.json?veglenkesekvens=0.25636204@72837]
 [https://nvdbapiles-v3.utv.atlas.vegvesen.no/posisjon.json?ost=240233&nord=7030667.4&maks_antall=2]

/veg veksler mellom dem.

EV39 S4D1 m2347 slutter der, FV710 S1D1 m0 starter der.

Â 

*Test*

Sjekk trafikkulykker stedfestet i krysset her (mellom EV39 og FV710). De som er stedfestet pÃ¥Â 0.25636204@72837 skal ha vegSysRef FV710 nÃ¥.

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@240242,7030658,18/hva:~(~(id~570))/vegsystemreferanse:240231.371:7030664.807]

Bildet vedlagt viser objektene med vegSysRef EV39 slik det har vÃ¦rt. Det er vegSysRef fra slutten av lenka som stopper iÂ 0.25636204@72837.

Â ",NVDB-6937,NVDB-IND,
Ny stedfesting mÃ¥ prÃ¸ve Ã¥ flytte seg innenfor sin mor,"h2. Observasjon

I dag flyttes dÃ¸tre innenfor sin mor bare nÃ¥r de blir sammenkoblet, men i de tilfellene der man lager en ny stedfesting etter at en sammenkobling er gjort, sÃ¥ flyttes ikke datter inn til mor, og brukeren fÃ¥r sannsynligvis en feilmelding fra Skriv. I tillegg gjÃ¸r dagens lÃ¸sning det nÃ¸dvendig Ã¥ lage enÂ  ny sammenkobling til mor for Ã¥ fÃ¥ flyttet datter inn, som lager unÃ¸dvendige endingssett, og vil fremprovosere duplikat-assosiasjons-buggen.Â 
h2. Implementasjon

Ved stedfesting hentes forelder til objektet. vi gjÃ¸r sÃ¥ et forsÃ¸k pÃ¥ Ã¥ flytte objektet inn til forelder. Hvis det ikke gÃ¥r, bevares stedfestingen, men den blir markert som uncertain, og en beskrivende tilbakemelding sendes til brukeren.

Deretter hentes barn til objektet. barnene forsÃ¸kes Ã¥ flyttes inn til mor. Hvis en eller flere av barnene ikke kan flyttes, bevares stedfestingen de hadde, men stedfestingen blir markert som uncertain og en forklarende tilbakemelding sendes til brukeren.Â 

Ved begge tilfellene forsÃ¸ker vi aldri Ã¥ flytte mor, men flytter alltid barnene, og vi begynner Ã¸verst i hierarkiet. sÃ¥ det er bestemor som styrer hvor barnebarna blir plassert.

Vi ser kun pÃ¥ den umiddelbare mor til objektet som skal stedfestes, og de umiddelbare barna. sÃ¥ kun 3 nivÃ¥er av hierarkiet forsÃ¸kes flyttet. Det bÃ¸r likevel vÃ¦re tilstrekkelig for Ã¥ kunne flytte et stÃ¸rre hierarki ved Ã¥ gjÃ¸re operasjonen i flere ledd, der man begynner hÃ¸y og slutter lavt i hierarkiet.

Ved endt stedfesting, sendes oppdaterte vegobjekter til frontend. Stedfestingsfanen er endret for Ã¥ kunne ta i mot flere objekter ved stedfesting (tidligere bare ett), og de oppdaterte stedfestingene vises umiddelbart nÃ¥r de mottas.Â 
h2. NB!

Denne oppgraderingen gjelder ikke automatisk stedfesting. Vi kan implementere det senere, men det er teknisk litt mer utfordrende, siden autostedfesting kjÃ¸res asynkront. Helt klart lÃ¸selig, men siden Skriv skal ta over stedfesting og ta innflytting til mor automatisk gir det mer mening Ã¥ avvente dette. Denne oppgaven skal fÃ¸rst og fremst lÃ¸se problemet med at manuell stedfesting ikke flyttet dÃ¸tre, og krevde at brukeren mÃ¥tte fjerne sammenkobling og lage enÂ  ny sammenkobling for Ã¥ fÃ¥ flyttet dÃ¸tre.",NVDB-6937,Datafangst,
Ingen strekningsmeter for kryssdel i annen kommune enn kryssystem,"KV9999 K1000D1 kommune: 1103 veglenkesekvens:2343045

*Analyse*
 Ser ut til Ã¥ skyldes datafeil. Vegsystemet for kommunal veg KV9999, med id 1002896754, har to ulike kommuner. 1103 og 1124. I vegkart ser det ut som rundkjÃ¸ringa ligger i 2 kommuner. Hvis vegsystemet deles i 2 objekter, 1 for hver kommune skal meterberegningen gÃ¥ bra.

Siden det er kommunal veg forventes det bare 1 kommune pÃ¥ vegsystemet, sÃ¥ det er bare den ene kommuenen som blir lagt til i cache. Ved uthenting for den andre kommunen under beregning av meterverdier er det ikke noe innslag i cachen, da blir meterverdi satt til -1.

Vegsystemet med 2 kommuner:
 [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/915/1002896754/1]
{quote}""lokasjon"": {
 ""kommuner"": [
 1103,
 1124
 ],
{quote}

https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-34965,6566738,16/hva:~(~(id~915)~(id~917))/hvor:~(vegsystemreferanse~(~'KV9999))

*LÃ¸sning*
Endret til Ã¥ hente kommunenummer fra stedfestingen til kryssystemet/sideanlegget for meterberegning til punket der krysset/sideanlegget er stedfestet. Tidligere ble det brukt kommunenummer fra stedfesting til den delen det ble beregnet meterverdi pÃ¥.
I tillegg er det gjort en  jobb i prod med Ã¥ dele vegsystemet i 2 objekter, 1 objekt for hver kommune i krysset.",NVDB-6937,NVDB-IND,
Bedre UI for stedfestinger i kartet,"h2. Observasjon

NÃ¥r man har flere objekter tett pÃ¥ hverandre, og man skal prÃ¸ve Ã¥ finne ut hvilken av de som har feil stedfesting, sÃ¥ kan det vÃ¦re vanskelig, fordi det er vanskelig Ã¥ se hvilken stedfesting som tilhÃ¸rer hvilke objekter.

- stedfesting bÃ¸r markeres sammen med objektet som er valgt
- stedfestinger bÃ¸r bli klikkbare, slik at man kan klikke pÃ¥ en stedfesting som er feil og fÃ¥ markert det objektet den tilhÃ¸rert

!image-2020-08-25-08-29-57-760.png!",NVDB-6937,Datafangst,
Leveranseinformasjon NVDBIND V3 2020.12.2,"Kan testes ved Ã¥ kjÃ¸re en transaksjon, stoppe NVDBIND og sjekke at Â«Cloud - Tree - nvdb - transactionÂ» har innhold Â«syncÂ» og Â«latestÂ» under seg.",NVDB-6937,NVDB-IND,
Â«sist_prosesserte_transaksjonÂ» er feil ved reindeksering,"Sinus Infra frÃ¥ Triona mÃ¥ ha verdiÂ Â«sist_prosesserte_transaksjonÂ» for Ã¥ fungere. Under reindeksering 22/8-20 feila den, og Sinus Infra var utilgjengeleg for brukarane til indeksering var ferdig mandag ettermiddag/kveld.

Triona ber om endring og viser til tidlegare melding:

Ja, nÃ¥ er Â«sist_prosesserte_transaksjonÂ» satt og SINUS infra virker Ok igjen ğŸ˜Š.

Â 

Sist dette skjedde fikk vi inntrykk av at det er unÃ¸dvendig for NVDB Ã¥ ta vekk dette tidspunktet ifb. med reindeksering og at man skulle la tidspunktet stÃ¥. Jeg vet ikke om man etterpÃ¥ har tenkt annerledes eller om man bare glemte Ã¥ justere det.

Â 

Om ikke NVDB lÃ¸ser det mÃ¥ SINUS lÃ¸se det, men da Ã¸nsker vi synspunkter pÃ¥ hvilket tidspunkt vi skal sette. Hva er rett? Er det tidspunktet for nÃ¥r vi leser ned dataene vi skal bruke?

Â ",NVDB-6937,Les-API,
Retning pÃ¥ stedfesting skrives ikke til NVDB,"h2. Observasjon

Fra Sigmund Fredriksen:

NÃ¥r vi sletter geometrien pÃ¥ f.eks. et rekkverk med Oppdater sÃ¥ kan det se ut som den nye versjonen som dannes i NVDB SKRIV mangler Retning pÃ¥ Stedfestingen.
 
Aktuelt endringssett: https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/502dc74c-3003-4e9a-90d3-bd678b853a1e . Versjon 1 har retning pÃ¥ stedfesting, mens versjon 2 av objektet (som ikke lenger har egengeometri) mangler retning.
 
I SINUS bruker vi retning ved uttegning av strekningsobjekter uten egengeometri med SIDEPOS=H eller V (parallellforskyve ift. vegnettsgeometrien). Uten retning blir objektene tegnet ihht vegnettsgeometrien (senterlinja) selv om de har SIDEPOS H eller V.

h2. Analyse

I endringssettet utfÃ¸res delvis oppdatering pÃ¥ tre vegobjekter. Samtlige vegobjekter har oppgitt stedfesting. Ingen av stedfestingene inneholder imidlertid retning. Stedfestingene for de versjonene som registreres i NVDB skrives inn slik de er definert i endringssettet. At foregÃ¥ende versjon har retning pÃ¥ stedfestingene pÃ¥virker ikke dette. Stedfestingen mÃ¥ oppgis komplett, inkludert retning, ved oppdatering/korrigering/registrering (inkl. delvise varianter) i endringssett. 
",NVDB-6937,Skriv-API,
Redirect-URL for /vegobjekter/id fungerer ikke lenger,"Denne redirecten er hardkodet til Ã¥ vise til hash-komponenten #vegobjekt:id som ble tatt bort i forbindelse med utvidelsen der man ogsÃ¥ kan lenke direkte til vegnettslenke-segmenter. Ny komponent har navnet #valgt:id, der id-en kan bestÃ¥ av flere felter for Ã¥ antyde vegobjekttype, segmentdel osv.

Oppgaven bestÃ¥r i Ã¥ tilpasse redirect til nytt format, og bonuspoeng om man lager en tilsvarende redirect for vegnettslenker som har et litt annerledes format.",NVDB-6937,Vegkart,
Importere liste med INVD-ID,"*[Jan.O.Pedersen@agderfk.no|mailto:Jan.O.Pedersen@agderfk.no]Â spÃ¸r:*

*Savner en mulighet for Ã¥ importere en excelfil som inneholder masse NVDB-Id til vegkart for visning.*",NVDB-6937,Vegkart,
Bedre hÃ¥ndtering av OutOfMemoryError,"NVDBIND havner i limbo dersom heap blir full og GC ikke klarer fikse det. 
Legg til logging for mer informasjon og gjÃ¸r det mulig Ã¥ definere oppfÃ¸rsel ved OutOfMemoryError.",NVDB-6937,NVDB-IND,
Info om siste behandlede transaksjon slettes ved stopp,Informasjonen slettes fra ZK nÃ¥r NVDBIND stoppes. ,NVDB-6937,NVDB-IND,
VerktÃ¸y for Ã¥ konvertere lukket kurve-geometri til flate,"Mail fra Raymond KrossÃ¸y Hermansen (raymond.hermansen@vtfk.no), som lurer pÃ¥ om vi har noe som kan konvertere en kurve-geometri til en flate-geometri.

Har sett i data ellers at det er ganske vanlig at entreprenÃ¸r mÃ¥ler inn en kurve som omslutter objektet, og da i realiteten er en flate i stedet. Ã… enkelt kunne konvertere disse til en flate vil forbedre datakvaliteten i NVDB.

Det hjelper ogsÃ¥ Raymond som fÃ¥r automatisk utregnet areal for vegobjektet nÃ¥r det er en flate.",NVDB-6937,Datafangst,
Oppgradere sÃ¥rbare avhengigheter,"Bygg med NPM rapporterer om en rekke sÃ¥rbare avhengigheter, noen med hÃ¸y alvorlighetsgrad. 

Avhengigheter for Java bÃ¸r ogsÃ¥ sjekkes.",NVDB-6937,Datafangst,
SÃ¸ke pÃ¥ NVDB-ID i Vegkart,"*[Jan.O.Pedersen@agderfk.no|mailto:Jan.O.Pedersen@agderfk.no]Â spÃ¸r:*

*Savner en mulighet i vegkart til Ã¥ kunne spÃ¸rre pÃ¥ NVDB-ID*",NVDB-6937,Vegkart,
Se pÃ¥ flaky integrasjonstester,"Det er stadig vekk at bygging av Datafangst pÃ¥ Jenkins feiler pga integrasjonstestene. Feilene som kommer _kan_ vÃ¦re reelle, men i de fleste tilfeller er det en flaky test som gÃ¥r fint om man re-kjÃ¸rer jobben.

Denne oppgaven gÃ¥r pÃ¥ Ã¥ se om man kan finne noen fellestrekk pÃ¥ de gangene testene feiler. Det er laget en jobb pÃ¥ Jenkins som jevnlig kun kjÃ¸rer integrasjonstestene ([https://ci.kantega.org/view/Datafangst/job/Datafangst%20Integration%20Tests/]) for Ã¥ se om det er noen gjengangere eller om det er tilfeldig.

Vedlagte html-fil viser en oversikt over Datafangst sine integrasjonstester og resultatet av disse for de 20 siste kjÃ¸ringene (per 2020-08-21 12:30).",NVDB-6937,Datafangst,
Filter pÃ¥ NVDB / FKB for samlinger til ekstern API,"Mail fra Sinus ved Sigmund Fredriksen, de fÃ¥r ut vegobjekter uten ""operation"" satt, som forvirrer Sinus. Viser seg at dette er en samling med FKB-data, men det er ikke synlig pÃ¥ noen mÃ¥te for Sinus.

Det hadde vÃ¦rt bedre for alle om de bare fÃ¥r ut det de trenger, sÃ¥ vi kunne lagt pÃ¥ et query-parameter for ""destination"" pÃ¥ spÃ¸rring etter feature collections i API.",NVDB-6937,Datafangst,
kommuner og fylker ut pÃ¥ /omrader/kontraktsomrader og /omrader/riksvegruter,Gi ut kommuner og fylker for kommuner og fylker ut pÃ¥ /omrader/kontraktsomrader og /omrader/riksvegruter,NVDB-6937,Les-API,
Fjern metrikk-logger som ikke virker,"Hvert 30. sekund er det en feil i loggen med ""Reporting returned code 302 Moved Temporarily: {}"". Dette er fra en metrikk-logger som ikke har virka pÃ¥ lenge. Fikses ved Ã¥ fjerne ubrukt metrikklogging.",NVDB-6937,Datafangst,
"500 pÃ¥ grunn av feil ved utpakking av ""","SpÃ¸rringer med Â«?egenskap=""id=verdi""Â» ble ikke pakket ut rett, sÃ¥ requesten feiler med 
{quote}
2020-08-20T09:54:39,533+0200 TRANSID=""f439eeaa-9df7-4d09-553a-5cbab15a5918"" SEVERITY=""ERROR"" ORIGIN=""SolrClientWrapperImpl"" MESSAGE=""
==== SolrQuery start ====
Solr collection : nvdb-roadobjects 
q = *:*
fq = exportId:5d12064e
fq = typeId:461
fq = +start_date:[0 TO 20200820] +(end_date:{20200820 TO *] (*:* -end_date:[* TO *]))
fq = ""5644=7935""
fq = docType:object
rows = 300
fl = end_date,route_id,contract_id,typeId,own_geometry,id,versjonsId,counties,last_modified,municipalities,start_date
cursorMark = *
sort = id asc,docId asc
shards.preference = replica.base:stable:hash:sessionId
sessionId = 85.164.136.234
_stateVer_ = nvdb-roadobjects:2619
==== SolrQuery stop ====
""
org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://svvpnvdbsolr08.vegvesen.no:8983/solr/nvdb-roadobjects: no field name specified in query and no default specified via 'df' param
{quote}",NVDB-6937,Les-API,
Gi klienter beskjed om at multigeometri ikke er tillatt,"Det er besluttet at Skriv ikke skal tillate multigeometri. Klienter vi kjenner mÃ¥ varses, og det mÃ¥ inn i API-dokumentasjon.",NVDB-6937,Datafangst,
Gjenopprett databasetilkobling ved connection timeout,"Vi har byttet fra Oracle connection pool til Hikari, siden indeksering gikk betydelig tregere med Oracle enn Hikari. 
Dersom den ene av databaseserverne blir borte kan Oracle-driveren i noen tilfeller havne i en tilstand der den tror alt er nede:

{quote}
2020-08-16 00:30:51 [ForkJoinPool.commonPool-worker-2] WARN  DBHealthChecker - NVDB database ping failure! null
java.lang.reflect.UndeclaredThrowableException: null
	at com.sun.proxy.$Proxy9.getConnection(Unknown Source)
	at no.vegvesen.nvdb.common.jdbc.dbix.Dbix.openSession(Dbix.java:57)
	at no.vegvesen.nvdb.common.jdbc.dbix.Dbix.openSession(Dbix.java:49)
	at no.vegvesen.nvdb.common.healthcheck.db.DBHealthChecker.test(DBHealthChecker.java:25)
	at no.vegvesen.nvdbind.oracle.OracleNvdbResource.lambda$getHealthChecker$0(OracleNvdbResource.java:46)
	at no.vegvesen.nvdb.common.healthcheck.HealthCheckReport.runTest(HealthCheckReport.java:76)
	at no.vegvesen.nvdb.common.healthcheck.HealthCheckReport.lambda$null$0(HealthCheckReport.java:53)
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604)
	at java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1596)
	at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
	at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)
	at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)
	at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157)
Caused by: java.lang.reflect.InvocationTargetException: null
	at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at no.vegvesen.common.hikaricp.HikariDatasourceProvider$CloseableDataSourceHandler.invoke(HikariDatasourceProvider.java:294)
	... 13 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: NVDB - Connection is not available, request timed out after 34361ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:697)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:196)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:161)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:100)
	... 17 common frames omitted
Caused by: com.zaxxer.hikari.pool.PoolBase$ConnectionSetupException: java.sql.SQLRecoverableException: IO Error: Operation interrupted, connect lapse 27882 ms., Authentication lapse 0 ms.
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:501)
	at com.zaxxer.hikari.pool.HikariPool.access$100(HikariPool.java:71)
	at com.zaxxer.hikari.pool.HikariPool$PoolEntryCreator.call(HikariPool.java:727)
	at com.zaxxer.hikari.pool.HikariPool$PoolEntryCreator.call(HikariPool.java:713)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLRecoverableException: IO Error: Operation interrupted, connect lapse 27882 ms., Authentication lapse 0 ms.
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:794)
	at oracle.jdbc.driver.PhysicalConnection.connect(PhysicalConnection.java:688)
	at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:39)
	at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:691)
	at oracle.jdbc.pool.OracleDataSource.getPhysicalConnection(OracleDataSource.java:384)
	at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:273)
	at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:198)
	at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:176)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:353)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:473)
	... 7 common frames omitted
Caused by: java.io.IOException: Operation interrupted, connect lapse 27882 ms., Authentication lapse 0 ms.
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:790)
	... 17 common frames omitted
Caused by: java.io.IOException: Operation interrupted, connect lapse 27882 ms.
	at oracle.net.ns.NSProtocolNIO.negotiateConnection(NSProtocolNIO.java:127)
	at oracle.net.ns.NSProtocol.connect(NSProtocol.java:317)
	at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1438)
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:518)
	... 17 common frames omitted
Caused by: java.io.InterruptedIOException: Operation interrupted
	at oracle.net.nt.TimeoutSocketChannel.handleInterrupt(TimeoutSocketChannel.java:311)
	at oracle.net.nt.TimeoutSocketChannel.write(TimeoutSocketChannel.java:221)
	at oracle.net.ns.NIOPacket.writeToSocketChannel(NIOPacket.java:211)
	at oracle.net.ns.NIOConnectPacket.writeToSocketChannel(NIOConnectPacket.java:232)
	at oracle.net.ns.NSProtocolNIO.negotiateConnection(NSProtocolNIO.java:108)
	... 20 common frames omitted
{quote}
{quote}
2020-08-13 07:53:57 [daemon] ERROR UpdatePoller - Escaped exception!
java.lang.reflect.UndeclaredThrowableException: null
	at com.sun.proxy.$Proxy9.getConnection(Unknown Source)
	at no.vegvesen.nvdb.common.jdbc.dbix.Dbix.openSession(Dbix.java:57)
	at no.vegvesen.nvdb.common.jdbc.dbix.Dbix.openSession(Dbix.java:49)
	at no.vegvesen.nvdb.jdbc.NvdbImpl.openSession(NvdbImpl.java:35)
	at no.vegvesen.nvdb.reader.datakat.DatakatalogUpdateChecker.updateInProgress(DatakatalogUpdateChecker.java:38)
	at no.vegvesen.nvdbind.daemon.UpdatePoller.doPoll(UpdatePoller.java:83)
	at no.vegvesen.nvdbind.daemon.UpdatePoller.run(UpdatePoller.java:58)
	at no.vegvesen.nvdbind.daemon.NvdbindDaemon.daemonThread(NvdbindDaemon.java:103)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.reflect.InvocationTargetException: null
	at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at no.vegvesen.common.hikaricp.HikariDatasourceProvider$CloseableDataSourceHandler.invoke(HikariDatasourceProvider.java:294)
	... 13 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: NVDB - Connection is not available, request timed out after 15000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:697)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:196)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:161)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:100)
	... 17 common frames omitted
{quote}

Siden vi har konkludert med at vi ikke skal bruke Oracle connection pool mÃ¥ vi lage en mekanisme som detekterer slikt og kobler til databasen pÃ¥ nytt.",NVDB-6937,NVDB-IND,
Sentry rapporterer ikke,"Sentry ble disablet pÃ¥ en tidligere release

usikker hvorfor, antakelig en glipp.

re-aktiver sentryÂ ",NVDB-6937,Datafangst,
Slett og opprett for samme kobling gir feil ved innsending,"En 400-mot-Skriv-feil pÃ¥ support viser seg Ã¥ vÃ¦re at samme sammenkobling stÃ¥r som bÃ¥de DELETE og WRITE. Fordi vi ikke viser slettede koblinger (se NVDB-5799) er det lett Ã¥ havne her, og dette problemet bÃ¸r hovedsaklig lÃ¸ses gjennom NVDB-5799. Men selv etter at det er fikset sÃ¥ mÃ¥ vi passe pÃ¥ at det ikke er mulig Ã¥ opprette en kobling der samme kobling stÃ¥r som slettet (men ikke innsendt). Dette gjelder bÃ¥de for kobling internt i kontrakten, og for kobling til mor eller datter i NVDB.",NVDB-6937,Datafangst,
Slettet sammenkobling vises ikke i brukergrensesnitt,"NÃ¥r bruker sletter en eksisterende sammenkobling mellom to vegobjekter som begge er i NVDB, sÃ¥ vises ikke denne i brukergrensesnittet etterpÃ¥.
Dette gjÃ¸r at brukene ikke kan se at dette er noe som sendes inn, og det gjÃ¸r at hen ikke kan angre sletting etterpÃ¥.

Eksisterende koblinger som er satt til sletting bÃ¸r fortsatt vises, men med markering (f.eks. gjennomstreking) som markerer de som slettet. Det bÃ¸r vÃ¦re mulig Ã¥ oppheve sletting ved Ã¥ trykke pÃ¥ et ikon i kobling.",NVDB-6937,Datafangst,
Ruteberegning: Segmenter med kun ett punkt,"Ved sÃ¸k etter rute dukker det opp noen segmenter som kun inneholder ett punkt. Finn ut om dette er ok oppfÃ¸rsel eller om noe gÃ¥r galt.

Eksempel 1:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?geometri=LINESTRING%20Z(277058.8%206651286.5%20172.075,%20277064.2%206651287.9%20172.075,%20277069.6%206651289.2%20171.975,%20277127.667%206651318.79%20171.975,%20277148.665%206651328.257%20171.875,%20277161.328%206651331.08%20171.875,%20277174.338%206651331.761%20171.775,%20277188.096%206651329.973%20171.775,%20277194.961%206651327.461%20171.675,%20277200.116%206651325.446%20171.675,%20277208.065%206651320.969%20171.675,%20277216.3%206651317.087%20171.592)&maks_avstand=10&konnekteringslenker=false&detaljerte_lenker=false&pretty=true&kortform=true]

Eksempel 2:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?start=0.0@625612&slutt=0.14364615@626970&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&kortform=true]

Eksempel 3 (Punkt fÃ¸rst og til slutt):

[https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute.json?start=0.0@1176591&slutt=0.65698432@1175844&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&kortform=true]

Eksempel 4:

Oppgi geometri gir fin rute:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute.json?geometri=LINESTRING%20Z(226327.432%206564594.167%209.226,%20226326.204%206564603.913%209.326,%20226325.03%206564611.74%209.376,%20226324.37%206564614.86%209.416,%20226322.59%206564620.63%209.436,%20226320.95%206564625.5%209.436,%20226318.69%206564631.57%209.496,%20226315.05%206564641%209.586,%20226312%206564648.92%209.646,%20226308.92%206564657.01%209.746,%20226304.83%206564667.79%209.846,%20226303.82%206564670.49%209.896,%20226299.94%206564680.86%2010.026,%20226296.12%206564691.05%2010.096,%20226293.02%206564699.27%2010.266,%20226289.87%206564707.61%2010.476,%20226287.74%206564713.17%2010.586,%20226283.3%206564724.76%2010.796,%20226279.56%206564734.5%2010.996,%20226276.63%206564742.17%2011.136,%20226275.59%206564744.94%2011.166,%20226272.47%206564753.24%2011.266,%20226271.5%206564755.91%2011.296,%20226267.58%206564766.66%2011.406,%20226265.69%206564772.07%2011.456,%20226262.02%206564782.93%2011.636,%20226259.44%206564790.73%2011.786,%20226256.4%206564800.5%2011.936,%20226253.2%206564811.46%2012.076,%20226251.67%206564816.92%2012.166,%20226248.64%206564827.88%2012.326,%20226244.72%206564842.55%2012.526,%20226240.95%206564856.4%2012.806,%20226238.24%206564866.36%2013.016,%20226235.54%206564876.21%2013.146,%20226232.38%206564887.72%2013.406,%20226231.05%206564892.51%2013.436,%20226229.02%206564899.69%2013.466,%20226228.22%206564902.4%2013.496,%20226225.85%206564910.46%2013.576,%20226224.12%206564916.17%2013.716,%20226223.22%206564919.01%2013.786,%20226221.4%206564924.67%2013.926,%20226219.57%206564930.28%2014.066,%20226218.62%206564932.95%2014.086,%20226216.71%206564938.32%2014.126,%20226214.84%206564943.09%2014.166,%20226212.776%206564947.972%2014.196,%20226212.24%206564949.31%2014.276,%20226209.63%206564954.88%2014.306,%20226207.21%206564959.329%2014.356,%20226203.163%206564966.408%2014.696,%20226200.16%206564967.25%2014.701,%20226197.548%206564968.563%2014.706,%20226194.566%206564970.973%2014.746,%20226193.676%206564972.194%2014.739,%20226192.053%206564974.424%2014.726,%20226190.929%206564977.325%2014.726,%20226190.632%206564978.092%2014.726,%20226190.16%206564981.834%2014.746,%20226190.377%206564983.72%2014.771,%20226190.589%206564985.574%2014.796,%20226191.863%206564989.047%2014.706,%20226192.894%206564990.783%2014.703,%20226194.698%206564993.041%2014.676)&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&kortform=true]

Rute med start og stopp basert pÃ¥ geometri over gir samme rute, *men* med et punkt fÃ¸rst og sist:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute.json?start=226327.432,6564594.167,9.226&slutt=226194.698,6564993.041,14.676&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&kortform=true]",NVDB-6937,Les-API,
Sortere kontraktgruppelista alfabetisk,Lista over kontraktgrupper begynner Ã¥ bli lang. Det ville vÃ¦rt kjekt om den var sortert. OgsÃ¥ kommet som Ã¸nske pÃ¥ support fra Jan Vidar StrÃ¸msvold. ,NVDB-6937,Datafangst,
"Legge inn telefonnummer til BSS pÃ¥ ""problemer med innlogging""-siden","Ref. at vi fÃ¥r mail fra kommune-brukere som sier ""dere er jo vegvesen"" nÃ¥r de spÃ¸r om hjelp til glemt passord, ettersom det stÃ¥r at de skal kontakte BSS/Statens vegvesen. 
BSS sier at vi kan henvise dem direkte til telefonnummeret: 240 58000",NVDB-6937,Datafangst,
Leveranseinformasjon NVDBIND 2020.12.1,"Innholder bÃ¥de https://jira.kantega.no/projects/NVDB/versions/34410, https://jira.kantega.no/browse/NVDB/fixforversion/34711 og https://jira.kantega.no/browse/NVDB/fixforversion/35110

Test i AT:
 * NVDB-4705: KjÃ¸r kontroll av FV409 og sjekk at det ikke er negative meter
 * NVDB-5674: GjÃ¸r en oppsummering av segmentene i ATM fÃ¸r og etter release a la den i beskrivelsen",NVDB-6937,NVDB-IND,
"Ruteberegning: Ved umulig rute, lever den lengste sammenhengende delruten","For situasjoner der det ikke er mulig Ã¥ levere en sammenhengende rute, skal den lengste sammenhengende ruten leveres sammen med en indikasjon pÃ¥ at dette ikke er en komplett rute.


Indikasjonen skal vÃ¦re i form av en status i et statusfelt, se egen sak NVDB-5791.",NVDB-6937,Les-API,
Ruteberegning: Statusfelt,"Det er nÃ¥ tydelig at det trengs et statusfelt i tillegg til vegsegmentene som leveres. Statusfeltet mÃ¥ kunne oppgi om en komplett rute er returnert, og i tillegg er det kjekt Ã¥ fÃ¥ enkel statistikk som f.eks hvor mange vegsegmenter som returneres. Se metadata-feltet for vegobjekter og vegnett for inspirasjon.",NVDB-6937,Les-API,
Ã… skru av vegnettet skal avbryte sÃ¸k,"Dersom man skrur pÃ¥ visning av vegnett over et stÃ¸rre omrÃ¥de, for sÃ¥ Ã¥ skru det av igjen, vil det fortsettes Ã¥ hente ned vegnett frem til det kan vises. Vegnettet vil ogsÃ¥ skru seg pÃ¥ igjen automatisk ved fullfÃ¸rt nedlasting av data.

Ã˜nsket oppfÃ¸rsel er at dersom vegnett skrus av, skal all nedlasting umiddelbart stoppe og vegnettet skal ikke forsÃ¸ke Ã¥ skru seg pÃ¥ av seg selv.",NVDB-6937,Vegkart,
Gi tilbakemelding pÃ¥ sensitive vegobjekttyper,"Ved Ã¥ sÃ¸ke etter sensitive vegobjekttyper (871, 890, 892, 894, 895, 901, 903, 905) fÃ¥r man evigvarende ""laster..."" og en feil i konsollen p.g.a. 403.

Det hadde vÃ¦rt bedre Ã¥ fange opp feilen og erstatte ""laster..."" med et varsel pÃ¥ at dataene er sensitive og ikke kan aksesseres.",NVDB-6937,Vegkart,
Ruteberegning: Definer og implementer korrekt respons pÃ¥ tidspunkt-intervaller,"*Grunnlag*

Det er usikkerhet rundt hvordan ulike konfigurasjoner av tidspunkt_start og tidspunkt_slutt burde gi respons pÃ¥ spÃ¸rringer til ruteberegneren.

Dette gjelder f.eks Ã¥pen sluttdato og oppdaterte segmenter mellom start og slutt. Detaljert liste over problemer lages.

Â 
{panel}
*NVDB-5458*
----
Det Ã¸nskes to parametere, fraDato og tilDato, som skal fÃ¸re til at ruten bare beregnes over veglenker som er gyldige pÃ¥ begge datoer. Den siste, tilDato, mÃ¥ kunne settes til ""null"" for Ã¥ angi at kun veglenker med Ã¥pen sluttdato er aktuelle.
{panel}
{panel}
*NVDB-5758*
----
Det er angitt tidspunkt_start = 2010-01-01 og ingen tidspunkt_slutt. Eneste gyldige stedfesting fra 2010-01-01 til ""evig tid"" er veglenkene 1 og 40, men siden ruten skal vÃ¦re sammenhengende forventes respons med rute 0.0-0.12832022@805705. FÃ¥r imidlertid en feilmelding.
{panel}
Â *SpÃ¸rsmÃ¥l Ã¥ ta stilling til:*
 * Dersom det forsÃ¸kes Ã¥ beregne en rute fra A til B med kun tidspunkt_start satt, men det ikke finnes nok Ã¥pne segmenter mellom A og B til Ã¥ beregne en rute, burde resultatet vÃ¦re tomt?
 * Dersom det forsÃ¸kes Ã¥ beregne en rute fra A til B med tidspunkt_start satt og tidspunkt_slutt satt, hvordan skal man behandle segmenter som har blitt oppdatert mellom disse punktene og tidspunktene?

Â ",NVDB-6937,Les-API,
Behandling avbrytes etter valideringsfeil pÃ¥ veglenkegeometri,"h2. Observasjon

Funnet under testing av NVDB-5636, fra Hans JÃ¸rgen:

Testet denne ved Ã¥ registrere en ny lenkekvens uten hÃ¸yde, og en ny lenkesekvens med for stor helning. Her blir det fÃ¸rst avvisning pga. helning og nÃ¥r den er rettet kommer avvisningen pga. manglende hÃ¸yde.

Skulle dette nÃ¥ ha kommet samlet?

https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/1bf2fc82-5516-4a5d-a94b-aabbe1902538

h2. Analyse

Den fÃ¸rste avvisningen skjer i constraint'en MaximumSlope, mens den andre skjer i constraint'en GeometryWithHeightCoords. Den fÃ¸rste hÃ¥ndheves *fÃ¸r* lÃ¥sing, mens den andre hÃ¥ndheves *etter*. NÃ¥r API Skriv ser at det er valideringsfeil vil den ikke utfÃ¸re lÃ¥sing og begynne validering pÃ¥ ""etter lÃ¥sing""-regler. NÃ¥r det er valideringsfeil vil heller ikke all beriking som skjer umiddelbart fÃ¸r lÃ¥sing gjennomfÃ¸res. Dette for Ã¥ unngÃ¥ lang behandlingstid pÃ¥ et endringssett som uansett avvises.

Hvorfor er GeometryWithHeightCoords hÃ¥ndhevet etter lÃ¥sing og ikke fÃ¸r som den andre? Validering pÃ¥ at veglenker har hÃ¸ydekoordinater skjer bare pÃ¥ veglenker for vegkategoriene E, R og F. For Ã¥ vite hvilken vegkategori en veglenke representerer mÃ¥ API Skriv lese inn Vegsystem (evt Vegreferanse)-vegobjekter som er stedfestet der. Denne berikingen skjer umiddelbart fÃ¸r lÃ¥sing, fordi de innleste vegobjektene mÃ¥ sekundÃ¦rlÃ¥ses.

I dette tilfellet er det helt nye veglenkesekvenser, med helt nytt Vegsystem-objekt som leveres i endringssettet. SÃ¥nn sett trenger man ikke beriking og lÃ¥sing for Ã¥ hÃ¥ndheve GeometryWithHeightCoords. Men koden som hÃ¥ndhever denne regelen er laget kompakt og generell og dekker bÃ¥de nye og oppdaterte veglenkesekvenser. Dette er forÃ¸vrig eneste geometrivalidering som gjÃ¸res etter lÃ¥sing.

Ã… bygge om dette systemet til Ã¥ validere nye veglenkesekvenser fÃ¸r lÃ¥sing og bare oppdaterte etter lÃ¥sing, er en relativt omfattende sak, er jeg redd. Kan det vÃ¦re en lÃ¸sning Ã¥ skille mellom registrering og oppdatering, ved at nye veglenkesekvenser alltid skal leveres med hÃ¸ydekoordinat +uansett vegkategori+ og kun validerere pÃ¥ ERF nÃ¥r det er oppdatering? Det vil i sÃ¥ fall vÃ¦re fort gjort Ã¥ realisere i koden.",NVDB-6937,Skriv-API,
Gi arkiveringsstatus for en kontrakt via API,"I dag vil ikke kall mot hverkenÂ /api/v1/contract ellerÂ /api/v1/contract/<contractId> gi noen informasjon om arkiveringsstatus. Dette er uheldig for bl.a. SINUS som oppdaget at man kan sende inn nye objekter pÃ¥ en arkivert kontrakt.

Vi bÃ¸r gi ut kontraktens arkiveringsstatus pÃ¥ ressursenÂ /api/v1/contract s.a. SINUS (og andre) kan filtrere bort arkiverte kontrakter - evt vise de pÃ¥ en annen mÃ¥te.

Intern-API benytter ""archivedState: OPEN/ARCHIVED"" for Ã¥ filtrere i UI pÃ¥ ressursenÂ /rest/contract/.",NVDB-6937,Datafangst,
Leveranseinformasjon,"*Testes i AT:*
 * NVDB-5775: Regististrer to nye kryssystem med hhv ugyldig og gyldig stedfesting. Sjekk at ugyldig stedfesting gir AVVIST og gyldig stedfesting gir UTFÃ˜RT med autogenerering av id-egenskapen.

NVDB-5679 trenger ingen spesifikk testing i ATM.",NVDB-6937,Skriv-API,
Sortering i kontraktslista,"h2. Observasjon

Ved sortering pÃ¥ navn i kontrktslista kommer Ã… etter tall, men fÃ¸r B.

Sortering pÃ¥ Ansvarlig fungerer ikke.",NVDB-6937,Datafangst,
Vegliste: Dubletter for noen kommunale veger,"Noen kommunale veger blir delt opp i mange smÃ¥ segmenter selv om BK-verdiene er identiske. For eksempel Kv4560 i HÃ¥ kommune, Rogaland. Ser ut til Ã¥ gjelde bÃ¥de publisering og arbeid med veglister.Â ",NVDB-6825,Rapportgenerator,
"Veglister:  Formattering ""tillatt vogntoglengde""","i word + excel: Kolonnen ""Tillatt vogntoglengde (m)"" skal vÃ¦re formattert med to desimaler og midtstilt, ikke tre desimaler og hÃ¸yrestilt. Dette gjelder bÃ¥de ""arbeid med veglister"" og publisering.Â 

Â Denne er litt spesiell, fordi egenkapverdien vi bruker (Maks vogntoglengde) er tekstfelt som enten inneholder teksten ""spesiell begrensning"" eller en tallverdi. Motoren returnerer tekst hvis verdien er ""spesiell begrensning"", ellers returneres Double.Â https://www.vegvesen.no/jira/browse/NVDBREF-629

Â ",NVDB-6825,Rapportgenerator,
Dokumentere ruteberegning,,NVDB-6937,Les-API,
ID-egenskap genereres ikke for Kryssystem,"h2. Observasjon

Endringssett https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/d1f39c75-f3f4-420d-854b-56c848da0729 behandles uten feil. Det inneholder registrering av ett Kryssystem-objekt med tempId -17. Dette skal fÃ¥ ID-egenskapen automatisk generert, men dette skjedde ikke.

h2. Analyse

Kryssystemet har stedfesting er 0.571446896631202@67570 og startdato 2020-08-11.

I Splunk finner vi:

{noformat}
Found no effective ref link part in job for location 0.571446896631202@67570 on date 2020-08-11
{noformat}

AutoGenIdAttributeEnricherFilter fant altsÃ¥ ingen gyldig veglenke for denne posisjonen pÃ¥ angitt startdato, og dropper derfor Ã¥ legge inn ID-egenskap.

Men hvorfor blir ikke Kryssystem-objektet avvist pga. ugyldig stedfesting?

Gyldigheten til stedfestinger valideres av LocationNetElementExistsValidator. Valideringen her tillater imidlertid et avvik pÃ¥ 1 mm i hver retning. Dette for Ã¥ unngÃ¥ at numeriske anomalier og unÃ¸yaktigheter i klienter (og API Skriv) skal pÃ¥virke valideringsresultatet. Java og det fleste andre programmeringssprÃ¥k klarer som kjent ikke Ã¥ representere alle reelle tall presist. Slingringsmonnet pÃ¥ 1 mm konfigureres i Kontrollpanelet. I dette tilfellet havner punktstedfestingen til Kryssystemet innenfor en avstand pÃ¥ 1 mm til nÃ¦rmeste gyldige stedfesting og blir dermed godtatt og endringssettet effektueres i NVDB.

h2. LÃ¸sning

AutoGenIdAttributeEnricherFilter trenger Ã¥ finne veglenken som Kryssystemet er stedfestet pÃ¥ for Ã¥ fÃ¥ tak i kommunenummeret pÃ¥ stedet. Dette brukes i anrop mot NVDB der reservasjon av Kryssystem-ID gjÃ¸res. Dette gjÃ¸res for alle stedfesting pÃ¥ KPS-veg. For ERF-veg er ikke dette noen problemstilling.

Koden som finner korrekt veglenke mÃ¥ endres til Ã¥ takle at en punktstedfesting ikke treffer nÃ¸yaktig pÃ¥ en gyldig veglenke og tillate et lite slingringsmonn, slik som i LocationNetElementExistsValidator.

Estimat: 1 - 2 timer

For det aktuelle Kryssystemet som gikk gjennom til NVDB uten ID-egenskap, mÃ¥ det kjÃ¸res et script som legger pÃ¥ denne. Korrekt ID genereres av lagret prosedyre RoadSystemUtils.reserveAttributeNumbers.
",NVDB-6937,Skriv-API,
Hvordan produsere og tilgjengeligjÃ¸re en endringslogg hvor vÃ¥re konsumenter kan lese om endringer ?,"Mail fra Triona:

Vi har registrert at det 4. juni ble innfÃ¸rt Ratelimiter pÃ¥ kall til NVDB-APIâ€™ene. Om vi har forstÃ¥tt det rett er det nÃ¥ en begrensning pÃ¥ 50 kall/sekund fra samme IP-adresse. Vi ser at dette er kommunisert i API-dokumentasjonen, men finnes det en annen offisiell infokanal der slike endringer blir lagt ut i forkant slik at vi som jobber med applikasjonsutvikling kan forberede oss pÃ¥ slike stÃ¸rre endringer fÃ¸r de kommer? Og er det mulig i dokumentasjonen Ã¥ ha litt info innledningsvis om hva som er endret i ny versjon? NÃ¥ mÃ¥ hele dokumentasjonen leses igjennom og sÃ¥ mÃ¥ vi selv finne/huske hvor det er gjort endringer.

Â 

Vi plukket opp informasjon angÃ¥ende ratelimiter via Gitter, men ogsÃ¥ i den sammenheng sÃ¥ Ã¸nsker vi oss en mer formalisert prosess rundt sporing av endringer (endringslogg) i API-et for oss som er eksterne. Gitter-kommunikasjonen er veldig Â«hoppendeÂ», sÃ¥ det er vanskelig Ã¥ vÃ¦re sikker pÃ¥ at vi fÃ¥r med oss alt derfra.

Â 

Â ",NVDB-6937,Les-API,
NPE ved bruk av tidspunkt pÃ¥ /rute,"h2. Observasjon

Dersom man oppgir en dato fÃ¸r generering av strekninger, har vegsystemreferansen kun vegsystem, og da fÃ¥r man en HTTP 500. Stacktrace:
{noformat}
Caused by: java.lang.NullPointerException at no.vegvesen.nvdb.roadsysref.RoadSysRef.getStartMeter(RoadSysRef.java:120) at no.vegvesen.nvdb.netelements.RoadNetSegment.getRoadSysRef(RoadNetSegment.java:266) at no.vegvesen.nvdb.netelements.RoadNetSegment.updateRelativePositionGeometryAndRoadRef(RoadNetSegment.java:258)
{noformat}
Eksempel-kall:Â [https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/beta/vegnett/rute?start=874760.8015977107,7849485.011404951&slutt=874968.4411868226,7849609.54906524&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&tidspunkt=2019-10-07&pretty=true&debug=true]

Brukeren burde her fÃ¥tt en eller annen beskjed om hva som gikk galt - evt en generell melding om at vegsystemref ikke er fullstendig pÃ¥ Ã¸nsket tidspunkt.",NVDB-6937,Les-API,
FÃ¥ tilbake vegsystem-teksten i sÃ¸k-oversikta,"NÃ¥r det vert lagt til vegsystem for begrense/spesifisere sÃ¸ket vert den berre vist med tomt felt med markÃ¸r og kryss i lista til hÃ¸gre.Â 

Her der det lagt til Europa-, Riks- og Fylkesveg som det kjem fra i adressefeltet, men i lista i kartet er det berre tre blanke felt.

SÃ¸ket fungerer som det skal og viser berre objekt pÃ¥ valgte vegsystem.

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@268102,7030868,8/hva:~(~(id~532))/hvor:~(kommune~(~5001)~vegsystemreferanse~(~'R~'E~'F))]",NVDB-6937,Vegkart,
Mismatch i stedfestiner mellom API LES og VVI,"h2. Observasjon

VVI og API LES gir stedfestinger som avviker litt, men nok til at de ikke er kompatible ved sammenkobling.
h2. Analyse

vi bruker 2 mÃ¥ter Ã¥ hente ut stedfestinger og geometri i datafangst.

For linjer bruker vi VVI sin ruteplanlegger og for punkter henter vi geometri direkte fra LES.

problemet er kommer antakelig fra smÃ¥ variasjoner i geometrisk kompleksitet i de to versjonene, der VVI antakelig har en litt forenklet geometri, som vi gi avvik i lengdenene som mÃ¥les i geometriene. Det gjÃ¸r at nÃ¥r vi trimmer stedfestinger (dÃ¸tre innenfor mor) eller skal koble sammen linjer og punkter, fÃ¥r stedfestinger som avviker mer enn vi tillater.
h2. LÃ¸sning

Vi antar at stedfestingene fra VVI er generelt sett riktig, men har smÃ¥ unÃ¸yaktigheter i lenkeposisjonen. for Ã¥ fÃ¥ riktig posisjon basert pÃ¥ geometriene i API LES, gjÃ¸r vi en re-projisering av endene i stedfestingen mot geometri fra API LES og henter ut riktig geometri der det er hensiksmessig.

For Punkt-stedfesting betyr det at vi VVI henter ut riktig reflink, og internt i datafangst iterere vi over alle delene i reflinken, finner den som er nÃ¦rmest, og projiserer posisjonen fra vegobjektet til reflinkpart-geometrien.

For multiline betyr det at VVI henter alle vegsegmentene, og vi internt reprojiserer endene av reflinkene for Ã¥ fÃ¥ riktig posisjon.

NÃ¥r bÃ¥de punkt-stedfestinger og linjestedfestinger har konsistent posisjon, skal de kunne sammenkobles riktig, og dÃ¸tre skal kunne flyttes riktig innenfor mor der det er minimale forskjeller i geometri.

Â 

Â ",NVDB-6937,Datafangst,
Import av vegobjekter uten stedfesting blokkerer type,"h2. Observasjon
Jeg importerte noen skredoverbygg for Ã¥ ha testdata. Det viste seg at to av disse (fra URL under) ikke har stedfesting. Import gÃ¥r uten feil, men Datafangst gir systemfeil nÃ¥r type skal leses ut i datafanen.
https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@172705,7027791,8/hva:~(~(id~66))

I databasen sÃ¥ ligger disse inne med en entry i stedfesting, men med posisjon ""-1"" og med null for ""projected_from_wtk"". Det er den sistnevnte som gir systemfeil nÃ¥r typen skal leses.

{code}
java.lang.NullPointerException: wkt can't be null or empty
        at java.util.Objects.requireNonNull(Objects.java:228)
        at no.svv.nvdb.datafangst.domainmodel.geometry.WktString.<init>(WktString.java:31)
        at no.svv.nvdb.datafangst.domainmodel.geometry.WktString.of(WktString.java:22)
        at no.svv.nvdb.datafangst.representation.LocationalOverviewJson.getLineExtentWkt(LocationalOverviewJson.java:176)
        at no.svv.nvdb.datafangst.representation.LocationalOverviewJson.fromDomain(LocationalOverviewJson.java:131)
        at no.svv.nvdb.datafangst.representation.viewmodel.Feature.fromDomain(Feature.java:92)
        at no.svv.nvdb.datafangst.representation.viewmodel.FeatureTypeView.lambda$getContractFeatures$15(FeatureTypeView.java:198)
        at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
        at java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:357)
        at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:483)
        at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
        at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
        at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
        at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)
        at no.svv.nvdb.datafangst.representation.viewmodel.FeatureTypeView.getContractFeatures(FeatureTypeView.java:199)
        at no.svv.nvdb.datafangst.representation.viewmodel.FeatureTypeView.lambda$getFeatures$4(FeatureTypeView.java:89)
        at java.util.Optional.map(Optional.java:215)
        at no.svv.nvdb.datafangst.representation.viewmodel.FeatureTypeView.getFeatures(FeatureTypeView.java:87)
        at no.svv.nvdb.datafangst.rest.ContractResource.doGetFeatures(ContractResource.java:464)
        at no.svv.nvdb.datafangst.rest.ContractResource.lambda$getFeatures$1(ContractResource.java:458)
        at no.svv.nvdb.datafangst.rest.ContractBaseResource.lambda$getResponseWithLastModified$2(ContractBaseResource.java:84)
        at java.util.Optional.map(Optional.java:215)
        at no.svv.nvdb.datafangst.rest.ContractBaseResource.getResponseWithLastModified(ContractBaseResource.java:74)
        at no.svv.nvdb.datafangst.rest.ContractResource.getFeatures(ContractResource.java:458)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
{code}",NVDB-6937,Datafangst,
Navnebytte generiske => egendefinerte rapporter,"Tilbakemelding og diskusjon pÃ¥ demo: ""Generiske rapporter"" [https://nvdb-vegnett-og-objektdata.utv.atlas.vegvesen.no/generisk]Â bÃ¸r hete ""Egendefinerte rapporter"".Â 

Men URL er grei, og trenger ikke endres.Â ",NVDB-6827,Rapportgenerator,
Kontraktsgruppe vises ikke,"h2. Observasjon

Dersom en bruker ikke har rettigheter innenfor en kontraktsgruppe, sÃ¥ vises det ikke hvilken kontraktsgruppe kontrakten er en del av pÃ¥ innstillingsfanen. Merk at man her mÃ¥ ha en global rolle for Ã¥ kunne se innstillingsfanen. SÃ¥ langt jeg kan se er det aktuelle scenarioet som i rapportert sak pÃ¥ support: Bruker har global forvalter rolle, men ingen rolle i kontraktsgruppen.

Det kan forÃ¸vrig bemerkes at vi bÃ¸r styre unna at brukere har globale roller - og heller flytte disse til kontraktsgrupperoller. _Det_ er nok den egentlig lÃ¸sningen.
h2. Analyse

Feilen oppstÃ¥r fordi brukeren i dette tilfellet ikke har rettigheter i gruppen som kontrakten tilhÃ¸rer.Â 

I listen over kontraktgrupper brukeren kan velge mellom vises bare kontraktgrupper brukeren har tilgang til. Feilen oppstÃ¥r fordi kontraktens kontraktgruppe ikke er en av disse kontraktene.Â 

Feilen oppstÃ¥r i de tilfeller der kontrakten ligger i en kontraktgruppe og brukeren har rettigheter til Ã¥ endre kontrakten, men ikke har rettigheter til kontraktgruppen kontrakten ligger i. Dette vil slÃ¥ ut for de med global forvalter-rolle (som bÃ¸r fjernes)
h2. LÃ¸sning

NÃ¥r vi henter ut kontraktens kontraktgruppe mÃ¥ vi legge denne til i listen over kontraktegrupper som skal vises i evt dropdown hvis den ikke finnes der fra fÃ¸r.

Hvis brukeren har rettigheter til Ã¥ endre kontrakten og rettigheter til Ã¥ endre fjerne kontrakten fra kontraktgruppen (som global forvalter har) sÃ¥ vil brukeren nÃ¥ kunne se og endre kontraktgrupper, inkludert den som kontrakten har. Global forvalter vil da kunne bytte kontraktgruppe til en av sine egne, men vil ikke kunne bytte tilbake ved en senere anledning.

Â 

Â ",NVDB-6937,Datafangst,
Skiltpunkt gir ikke statistikkpunkter ved for mange resultater,"Ã…pne Vegkart og behold standard zoom-nivÃ¥. SÃ¸k etter Skiltpunkt.

Applikasjonen prÃ¸ver nÃ¥ Ã¥ laste ned alle objekter i stedet for Ã¥ vise statistikkpunkter pÃ¥ kart, selv om antallet treff er langt over grensen pÃ¥ 30 000.",NVDB-6937,Vegkart,
Test hvor hÃ¸y sidestÃ¸rrelse vi kan ha,"Antallet objekter per side er nÃ¥ ganske lavt. 
 KjÃ¸r tester for Ã¥ finne ut hvor hÃ¸yt det kan settes. 
 Kanskje utvid med Ã¥ ha forskjellig grense pÃ¥ punkt og linjeobjekter i tillegg til det vi har nÃ¥.",NVDB-6937,Les-API,
Filtrering med negative verdier,"{panel:title=Vs: TrÃ¸bbel med filtrering i Vegkart}
{color:#000000}*Fra:*Â BÃ¸rnes Vilhelm <[vilhelm.bornes@vegvesen.no|mailto:vilhelm.bornes@vegvesen.no]>
 *Sendt:*Â onsdag 29. juli 2020 12:52
 *Til:*Â May Britt Hanstad <[may.hanstad@vegvesen.no|mailto:may.hanstad@vegvesen.no]>
 *Kopi:*Â Marvin Lillehaug <[Marvin.Lillehaug@kantega.no|mailto:Marvin.Lillehaug@kantega.no]>
 *Emne:*Â TrÃ¸bbel med filtrering i Vegkart{color}
 Â 
 Hei!

Jeg prÃ¸ver Ã¥ fÃ¥ til filtrering av alle stigninger (VT=825) brattere enn 15%, dvs stigning mÃ¥ vÃ¦re < -15 eller > 15. Versjon 2019 satte jeg opp dette slik:

Â 

[https://vegkart-2019.atlas.vegvesen.no/#kartlag:geodata/hva:(~(farge:'0_0,filter:(~(operator:'*3c*3d,type_id:9396,verdi:(~-15))),id:825),(farge:'1_1,filter:(~(operator:'*3e*3d,type_id:9396,verdi:(~15))),id:825))/@649482,7105251,3/vegobjekt:788691855:40a744:825]

I siste Vegkart versjon fungerer ikke dette. Det er 2 problem:
 # FÃ¥r ikke til Ã¥ legge inn negativt tall i filterfelt. Se figur under.
 # FÃ¥r ikke til Ã¥ angi samme vegobjekttype 2 ganger. Hvis jeg i stedet legger det til som to filter har jeg ikke mulighet til Ã¥ angi om begge kriterier mÃ¥ vÃ¦re oppfylt, eller at det er nok at ett av kriteriene er oppfylt. Ser ut til at standard er at begge krav mÃ¥ vÃ¦re oppfylt, dermed ikke mulig.{panel}
!image003.jpg|width=222,height=100,thumbnail!",NVDB-6937,Vegkart,
Kontraktsliste er ikke navigerbar med keyboard eller skjermleser,"h2. Observasjon

Sett i forbindelse med testing av NVDB-5755 (forbedringer for skjermleser).

Jeg fÃ¥r ikke brukt skjermleser for Ã¥ navigere til kontraktsnavn, hele kontraktslista er uresponsiv. Det samme gjelder for keyboardnavigasjon i form av tab fra lenke til lenke.
 Ã…rsak er nok at det er brukt <span> i stedet for <a> i lista.
h2. Analyse

Kontraktlista er en tabell med klikkbarhet lagt til via javascript. For at den skal kunne vÃ¦re tilgjengelig for skjermlesere med samtidig ha tabell-funksjonalitet, mÃ¥ kontrakene ogsÃ¥ ogsÃ¥ implementeres som semantiske lenker. Det gjÃ¸r at de kan aktiveres via en skjermleser, og at man kan navigere mellom kontrakter med TAB.

Actionknappene i kontraklista er ikke synlige for skjermlesere, siden det eneste innholdet i knappene er ikoner, og de er implementert som spans med javascript for klikkbarhet. Knappene mÃ¥ implementeres som button-elementer eller lenker, og ha beskrivende titler som er synlig for skjermlesere. knappene popper en modal, som ogsÃ¥ mÃ¥ fÃ¥ beskrivende felter via ARIA.Â 

Filter-rekken i toppen er tildels brukbare, men mangler LABEL-felter pÃ¥ noen av feltene. Label-feltene trenger bare Ã¥ vÃ¦re synlig for skjermlesere, da de er beskrivende nok i GUI. toggleknappene mÃ¥ fÃ¥ ARIA-PRESSED attributter, slik at en skjermleser forstÃ¥r om en knapp er aktiv eller ikke.
h2. Tiltak

Implementert som foreslÃ¥tt i Analysen.

Â 

Â ",NVDB-6937,Datafangst,
Systemfeil i AutoGenIdAttributeEnricherFilter,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/3e1caf01-4956-4b55-ba83-3598fd4cfc39 havarerer pga systemfeil under automatisk generering av id for et Kryssystem-objekt:

{code:java}
java.lang.IllegalStateException: Found no ref link part in job for location 0.124973095734052@760203 on date 2020-05-10
	at no.vegvesen.vt.nvdb.commons.core.functional.Suppliers.lambda$illegalStateException$1(Suppliers.java:16)
	at java.util.Optional.orElseThrow(Optional.java:290)
	at no.vegvesen.vt.nvdb.apiskriv.validation.feature.AutoGenIdAttributeEnricherFilter.createAutoGenIdAttribute(AutoGenIdAttributeEnricherFilter.java:109)
	at no.vegvesen.vt.nvdb.apiskriv.validation.feature.AutoGenIdAttributeEnricherFilter.lambda$doFilter$0(AutoGenIdAttributeEnricherFilter.java:73)
	at java.lang.Iterable.forEach(Iterable.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.feature.AutoGenIdAttributeEnricherFilter.doFilter(AutoGenIdAttributeEnricherFilter.java:64)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.JobFeatureFilters.doFilter(JobFeatureFilters.java:35)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateAfterLocking(DefaultValidationService.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateAfterLock(JobWorker.java:532)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:179)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
	at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1390)
	at org.apache.activemq.ActiveMQMessageConsumer.iterate(ActiveMQMessageConsumer.java:1552)
	at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:191)
	at org.apache.activemq.ActiveMQSessionExecutor.wakeup(ActiveMQSessionExecutor.java:111)
	at org.apache.activemq.ActiveMQMessageConsumer.start(ActiveMQMessageConsumer.java:1527)
	at org.apache.activemq.ActiveMQMessageConsumer$7.run(ActiveMQMessageConsumer.java:1308)
	at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)
	at java.util.TimerThread.mainLoop(Timer.java:555)
	at java.util.TimerThread.run(Timer.java:505)
{code}

h2. Analyse

Endringssettet inneholder oppdatering av veglenkesekvens 760203. Det registreres ogsÃ¥ et nytt Kryssystem med startdato 2020-05-10, tempId=""-58"" og punktstedfesting i 0.124973095734052@760203. Etter oppdatering av veglenkesekvens 760203 er eneste veglenke som dekker denne posisjonen ny veglenke med nr 11. Men denne har sluttdato 2020-05-10. Stedfestingen til Kryssystemet er derfor ugyldig. Dette er avdekket i en tidligere validering.

Systemfeil oppstÃ¥r senere i behandlingen der Kryssystem skal gis automatisk ID. I denne prosessen mÃ¥ API Skriv vite kommunenummeret fordi det aktuelle kryssystemet befinner seg pÃ¥ kommunal veg, privat veg eller skogsbilveg. ID skal jo da genereres unik innenfor kommunen. For Ã¥ finne kommunenr letes etter veglenken som dekker stedfestingen, men denne finnes ikke, som beskrevet over. Dermed kastes en exception fordi automatisk ID-generering ikke kan utfÃ¸res.

h2. LÃ¸sning

I stedet for Ã¥ kaste IllegalStateException nÃ¥r relevant veglenke ikke kan lokaliseres, returneres verdi som indikerer at ID-egenskap ikke skal genereres. Endringssett vil jo uansett avvises med valideringsfeil.",NVDB-6937,Skriv-API,
Mangelfull validering for deltakere i kontrakt,"Det er validering for brukernavn / e-post for Ã¥ legge til deltaker i kontrakt i dag, men den godtar verdier som f.eks. "" * havwig@kantega.no"", og gjÃ¸r ingenting etterpÃ¥ heller for Ã¥ fjerne ekstra tegn fra e-post.

Vi bÃ¸r fikse eksisterende validering sÃ¥nn at den virker, og med det samme rydde litt i databasen for de som Ã¥penbart er feil. KjÃ¸r ""select distinct username from user_role order by username limit 100;"" som spÃ¸rring for Ã¥ fÃ¥ ut kandidater.",NVDB-6937,Datafangst,
Ruteberegning: Fant ikke startpunkt,"Sender inn en lang sammenhengde geometri, satt sammen av geometrien til naboveglenkene 1, 39 og 40 som til sammen dekker posisjonene 0.0 - 0.22613915. Veglenkene som alle har startdato 1950-01-01 tilhÃ¸rer veglenkesekvens 805705. Den midterste veglenken (#39) er lukket med sluttdato 2011-03-25 og gjelder for intervallet 0.12832022 - 0.17491341.

Det er angitt tidspunkt_start = 2010-01-01 og ingen tidspunkt_slutt. Eneste gyldige stedfesting fra 2010-01-01 til ""evig tid"" er veglenkene 1 og 40, men siden ruten skal vÃ¦re sammenhengende forventes respons med rute 0.0-0.12832022@805705. FÃ¥r imidlertid en feilmelding:


{noformat}
9 > POST https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute
9 > Accept: application/json
9 > X-Client: NVDB API Skriv
9 > Content-Type: application/json
{""geometri"":""LINESTRING (13478.41 6696409.36, 13635.84 6696504.98, 14092.47 6696692.85, 14425.9 6696762.7, 14618.7 6696755.3, 14875.7 6696781.6, 14960.7 6696801.9, 15041.68 6696842.33)"",""maks_avstand"":""100"",""konnekteringslenker"":false,""detaljerte_lenker"":false,""vegsystemreferanse"":""K,E,R,F"",""trafikantgruppe"":null,""typeveg"":""kanalisertVeg,enkelBilveg,rampe,rundkjÃ¸ring"",""tidspunkt_start"":""2010-01-01"",""tidspunkt_slutt"":null,""pretty"":false,""kortform"":false}

2020-08-06T13:24:02.961 INFO  [qtp1971111020-69] [] n.v.v.nvdb.apiskriv.jersey.LoggingFilter 10 * LoggingFilter - Response received on thread qtp1971111020-69
10 < 422
10 < X-Robots-Tag: none
10 < Cache-Control: no-cache
10 < Access-Control-Allow-Origin: *
10 < Access-Control-Allow-Methods: GET, POST, OPTIONS
10 < Set-Cookie: 64e1275b536a3a9f08af7df4c4bb169c=98837086eace32e5157615edd2caa0ac; path=/; HttpOnly; Secure
10 < X-REQUEST-ID: 43bcd940-5126-db40-4411-f267d02ff1bc
10 < Content-Length: 150
10 < Access-Control-Max-Age: 1728000
10 < Date: Thu, 06 Aug 2020 11:24:02 GMT
10 < Access-Control-Allow-Headers: accept, x-client, x-client-session, origin, content-type
10 < Content-Type: application/json;charset=utf-8
[ {
    ""code"" : 4000,
    ""message"" : ""Fant ikke startpunkt :POINT (13478.41 6696409.36)"",
    ""help_url"" : ""https://nvdbapilesv3.docs.apiary.io""
} ]
{noformat}

Dersom tidspunkt_start-parameteren endres til 2020-01-01 fÃ¥r vi gyldig rute tilbake, men ikke sammenhengende. Det er et hull for intervallet til veglenke 39.
",NVDB-6937,Les-API,
UU: forvirrende markup og skrivefeil,"h2. Observasjon

Hans Ã…lien rapporterer:

Â 

Â 
{quote}NÃ¥ har jeg oppretta ei personlig testkontrakt, uten sÃ¦rlig besvÃ¦r. Underveis kom jeg inn pÃ¥ ei side med mye info.

Her fant jeg to ting som kanskje kan fikses:

Â«Legg til tilnyttet brukerÂ»

*** Skrivefeil i overskriften.

Â«Slett kontrakt

En slettet kontrakt kan ikke gjenopprettes!

î€ Â Slett

Arkiver kontrakt

Kontrakt lÃ¥ses og skjules i kontraktlista

Â 

Arkiver

Â»

*** Litt usikker pÃ¥ hvordan dette skal oppfattes. Er det to knapper her, som skjermleseren ikke oppfatter som knapper?
{quote}
Â 

Dette gjelder de to knappene nederst pÃ¥ innstillinger-fanen. De mÃ¥ endres til Ã¥ vÃ¦re HTML <button>.",NVDB-6937,Datafangst,
Hovedmeny stÃ¸tter ikke skjermleser,"h2. Observasjon
Mail fra Hans Anton:
""Jeg mÃ¥ innrÃ¸mme at jeg knapt har vÃ¦rt inne i Datafangst, men gikk inn nÃ¥. Da finner jeg ikke noen Â«NyttÂ»-knapp, der endringsloggen skulle kunne finnes. Jeg sÃ¸kte etter knapper og brukte tab m.m, men fant ingenting med Chrome og mitt skjermleserprogram.

Til slutt fant jeg ei liste med tre lenker: Kontrakter, samt to uten noen tekst/etikett. Ved Ã¥ velge disse to, kom jeg til henholdsvis Brukerveiledning og Endringslogg.

Kan jeg be om at det legges inn tekst pÃ¥ de to for meg tomme lenkene, pÃ¥ samme mÃ¥te som Â«KontrakterÂ», eller altText, tror jeg det heter, slik at skjermleseren kan formidle det. Samtiidig kan kanskje Â«NyttÂ»-knappen alltid presenteres med dynamisk tekst, f.eks. datoen for siste oppdatering, i tillegg til animering/fargenyanse.

 

Det jeg ogsÃ¥ fant, etter innlogging, var en knapp som framkommer for meg med teksten Â«Uten etikett 0Â». Like under stÃ¥r teksten Â«Logg utÂ» (ikke klikkbar). NÃ¥r jeg aktiverer Â«Uten etikett 0Â»-knappen, kommer jeg til pÃ¥liggingsdialogen, som kanskje betyr at jeg er logget ut.

Kan dette kombineres til en enkel Â«Logg utÂ»-knapp?""

h2. Analyse
Ser ut som problemer med manglende tekst pÃ¥ ""Nytt"" og de andre der bare er der nÃ¥r vinduet blir sÃ¥ smalt at teksten forsvinner og det bare vises ikoner. ""Logg ut"" ser konsekvent ut til Ã¥ mangle tekst.",NVDB-6937,Datafangst,
Fjerner unÃ¸dvendige permissions-oppslag,"gamle oppslag mot persmissions henger igjen fra en gammel refaktorisering, som fÃ¸rte til at permissionresolveren og alle permission-oppslag mot DB ble kjÃ¸rt 2 ganger ved kall til /session

Â 

Fjernet de skyldige kodelinjene",NVDB-6937,Datafangst,
Feilmelding for vÃ¦rutsatt veg,"{panel:title=Support-mail}
*Fra:*Â Erik Jensen <[erikjens@viken.no|mailto:erikjens@viken.no]>
*Sendt:*Â mandag 3. august 2020 11:13
*Til:*Â NVDB <[nvdb@vegvesen.no|mailto:nvdb@vegvesen.no]>
*Emne:*Â Feilmelding i Vegkart.no

Â Hei,

Jeg fÃ¥r en feilmelding nÃ¥r jeg skal hente ut data fraÂ [vegkart.no|http://vegkart.no/]. Det gjelder objekttype Â«+vÃ¦rutsatt veg+Â» som jeg forsÃ¸ker Ã¥ eksportere til CSV, da dukker det opp en feilmelding.Â 

Til nÃ¥ sÃ¥ har jeg ikke hatt dette problemet med andre kriterier jeg har lagt inn.
{panel}",NVDB-6937,Eksport,
Detaljerte lenker med meterverdi -1,"Sjekk om det er datafeil eller noe feil med beregning. Noen detaljerte lenker pÃ¥ E18 med -1 som gjÃ¸r at meterverdier blir feil.

""netelemid"":626896,
 ""startpos"":0.40588117,
 ""endpos"":0.41875179,

""netelem_superid"":625294,
 ""netelem_super_start"":0.36701772,
 ""netelem_super_end"":0.38071378

Â 

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@260479,6649122,17/hva:~(~(id~916))/hvor:~(vegsystemreferanse~(~'E18))/vegnett:~'geometri+~()/valgt:625751:19:18/vegsystemreferanse:260710.379:6649197.187]

og

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@260560,6649132,17/hva:~(~(id~916))/hvor:~(vegsystemreferanse~(~'E18))/vegnett:~'geometri+~()/valgt:625751:19:17/vegsystemreferanse:260710.379:6649197.187]

Â 

Â 

Funnet ved Ã¥ se etter segmenter som har -1 i prod:

[https://nvdbapiles-admin-v3.atlas.vegvesen.no/solr/nvdb-roadnet-segments/select?fq=!end_date%3A*&fq=!sysref_roadsystem_road_number%3A9999&fq=sysref_section_start_meter%3A%5C-1&q=*%3A*&rows=20]

Â ",NVDB-6937,NVDB-IND,
"API-import med ""Prosjektreferanse har verdi"" feiler","Jeg prÃ¸ver Ã¥ importere skiltpunkter som har filter ""Prosjektreferanse har verdi"". FÃ¥r systemfeil ved import.

URL i Vegkart: https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@273632,7042720,16/hva:~(~(filter~(~(operator~'*21*3d~type_id~11078~verdi~null))~id~95))

API-URL: https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/95?segmentering=true&egenskap=(11078!%3Dnull)&kartutsnitt=273314.005%2C7042558.314%2C273949.007%2C7042882.099&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter

Stacktrace:

{code}
java.lang.IllegalArgumentException: featureTypeIds can't be empty
        at no.svv.nvdb.datafangst.commons.Requires.require(Requires.java:35)
        at no.svv.nvdb.datafangst.commons.Requires.requireNonEmpty(Requires.java:23)
        at no.svv.nvdb.datafangst.api.FeatureCriteria.withFeatureTypeIds(FeatureCriteria.java:58)
        at no.svv.nvdb.datafangst.contract.ContractManagerImpl.importNvdbFeatures(ContractManagerImpl.java:1036)
        at no.svv.nvdb.datafangst.rest.ContractResource.addExistingFeatures(ContractResource.java:1807)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)
        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)
        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)
        at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$ResponseOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:160)
        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)
        at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)
        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)
        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)
        at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)
        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)
        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)
        at org.glassfish.jersey.internal.Errors.process(Errors.java:315)
        at org.glassfish.jersey.internal.Errors.process(Errors.java:297)
        at org.glassfish.jersey.internal.Errors.process(Errors.java:267)
        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)
        at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)
        at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)
        at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)
        at org.glassfish.jersey.servlet.ServletContainer.serviceImpl(ServletContainer.java:408)
        at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:583)
        at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:524)
        at no.svv.nvdb.datafangst.jersey.JerseyPlugin$1.doFilter(JerseyPlugin.java:81)
        at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:461)
{code}
",NVDB-6937,Datafangst,
Prosjektreferanse blir ikke lagret i database etter innsending,"h2. Observasjon

Ser litt nÃ¦rmere pÃ¥ prosjektreferanser i forbindelse med NVDB-5432. Vi sender inn prosjektreferanse til NVDB, men den blir aldri satt i databasen. Det vil si at etter at et vegobjekt med prosjektreferanse er lagret i NVDB sÃ¥ vil ikke lengre det som vises i Datafangst gjenspeile innholdet i NVDB.
h2. Analyse

Prosjektreferanser er litt spesielle siden de vanligvis settes i forbindelse med innsending, sÃ¥ Ã¥ lagre prosjektreferanse som attributt i database i forbindelse med innsending kan ogsÃ¥ bli feil, i tilfelle innsending blir avvist.
h2. Forslag til lÃ¸sning

Ta vare pÃ¥ prosjektreferanse som en del av data om innsending, og sett eller oppdater lokal prosjektreferanse etter vellykket innsending.

nytt felt i DB for prosjektreferanse pÃ¥ Nvdb_submission.

I ChangesetMonitors postprocessor endres eller oppdateres egenskapen for prosjektreferanse for vegobjektene som ligger i endringssettet.",NVDB-6937,Datafangst,
SQL-feil ved kopiering av objekt,"Jeg opplevde i en felles sesjon med TorbjÃ¸rn at vi fikk en feil da TorbjÃ¸rn skulle kopiere et vegobjekt til en annen type.
 Feilen kommer fra registrering av event, sÃ¥ typen i seg selv ble kopiert.

Feilen er at feltet som skal motta data er for lite, men jeg synes ogsÃ¥ det ser ut som vi prÃ¸ver Ã¥ putte ting i feil felt. Se stacktrace under, ""object"" kan ikke ta i mot sÃ¥ lange data, men synes det ser mer ut som noe som skulle vÃ¦rt i kolonne ""data"" i stedet.
{code:java}
java.lang.RuntimeException: Failed to execute update
	at no.svv.nvdb.datafangst.jdbc.Executors.executeUpdate(Executors.java:128)
	at no.svv.nvdb.datafangst.jdbc.Executors.executeUpdate(Executors.java:81)
	at no.svv.nvdb.datafangst.repository.EventLogDaoImpl.save(EventLogDaoImpl.java:90)
	at no.svv.nvdb.datafangst.security.EventLoggerImpl.lambda$saveEvent$0(EventLoggerImpl.java:69)
	at no.svv.nvdb.datafangst.jdbc.Jdbc.lambda$transactional$0(Jdbc.java:85)
	at no.svv.nvdb.datafangst.jdbc.Jdbc.transactional(Jdbc.java:107)
	at no.svv.nvdb.datafangst.jdbc.Jdbc.transactional(Jdbc.java:84)
	at no.svv.nvdb.datafangst.database.DatabaseImpl.transactional(DatabaseImpl.java:112)
	at no.svv.nvdb.datafangst.security.EventLoggerImpl.saveEvent(EventLoggerImpl.java:69)
	at no.svv.nvdb.datafangst.security.EventLoggerImpl.created(EventLoggerImpl.java:33)
	at no.svv.nvdb.datafangst.contract.ContractManagerImpl.copyGeometry(ContractManagerImpl.java:930)
	at no.svv.nvdb.datafangst.rest.ContractResource.copyFeatureGeometry(ContractResource.java:1706)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)
	at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)
	at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)
	at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$ResponseOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:160)
	at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)
	at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)
	at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)
	at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)
	at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)
	at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)
	at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:315)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:297)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:267)
	at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)
	at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)
	at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)
	at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)
	at org.glassfish.jersey.servlet.ServletContainer.serviceImpl(ServletContainer.java:408)
	at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:583)
	at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:524)
	at no.svv.nvdb.datafangst.jersey.JerseyPlugin$1.doFilter(JerseyPlugin.java:81)
	at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:461)
	at org.kantega.reststop.servlets.ReststopInitializer$PluginFilterChain.doFilter(ReststopInitializer.java:517)
	at no.svv.nvdb.datafangst.security.SessionTokenSecurityFilter.doFilter(SessionTokenSecurityFilter.java:60)
	at org.kantega.reststop.servlets.ReststopInitializer$PluginFilterChain.doFilter(ReststopInitializer.java:517)
	at no.svv.nvdb.datafangst.security.CORSFilter.doFilter(CORSFilter.java:42)
	at org.kantega.reststop.servlets.ReststopInitializer$PluginFilterChain.doFilter(ReststopInitializer.java:517)
	at no.svv.nvdb.datafangst.jersey.AccessLogFilter.doFilter(AccessLogFilter.java:44)
	at org.kantega.reststop.servlets.ReststopInitializer$PluginFilterChain.doFilter(ReststopInitializer.java:517)
	at org.kantega.reststop.servlets.ReststopInitializer$PluginDelegatingFilter.doFilter(ReststopInitializer.java:467)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:543)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:615)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:818)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1627)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLDataException: (conn=6916) Data too long for column 'object' at row 1
	at org.mariadb.jdbc.internal.util.exceptions.ExceptionMapper.get(ExceptionMapper.java:225)
	at org.mariadb.jdbc.internal.util.exceptions.ExceptionMapper.getException(ExceptionMapper.java:165)
	at org.mariadb.jdbc.MariaDbStatement.executeExceptionEpilogue(MariaDbStatement.java:238)
	at org.mariadb.jdbc.MariaDbPreparedStatementServer.executeInternal(MariaDbPreparedStatementServer.java:429)
	at org.mariadb.jdbc.MariaDbPreparedStatementServer.execute(MariaDbPreparedStatementServer.java:388)
	at org.mariadb.jdbc.MariaDbPreparedStatementServer.executeUpdate(MariaDbPreparedStatementServer.java:375)
	at com.zaxxer.hikari.proxy.PreparedStatementProxy.executeUpdate(PreparedStatementProxy.java:61)
	at com.zaxxer.hikari.proxy.PreparedStatementJavassistProxy.executeUpdate(PreparedStatementJavassistProxy.java)
	at no.svv.nvdb.datafangst.jdbc.Executors.executeUpdate(Executors.java:125)
	... 67 common frames omitted
Caused by: java.sql.SQLException: Data too long for column 'object' at row 1
Query is: INSERT INTO event (id, project_id, user_id, occured_instant, event_type, object_type, object, data) VALUES (?,?,?,?,?,?,?,?), parameters ['6af1ee5d-3e5e-43db-a62a-51aea74979a6','be683f88-7588-466f-98b4-540186ab4665','exttxm','2020-07-31 10:02:37.404','CREATE','Feature','Kopiert geometri til nytt objekt. Ny id: 8cc405ad-6242-4caf-95e9-2fa0d2d32d42. Kilde: DATAFANGST. Ny type: 24','']
java thread: http-nio-127.0.0.1-8080-exec-21
	at org.mariadb.jdbc.internal.util.LogQueryTool.exceptionWithQuery(LogQueryTool.java:163)
	at org.mariadb.jdbc.internal.protocol.AbstractQueryProtocol.executePreparedQuery(AbstractQueryProtocol.java:1041)
	at org.mariadb.jdbc.MariaDbPreparedStatementServer.executeInternal(MariaDbPreparedStatementServer.java:422)
	... 72 common frames omitted
{code}",NVDB-6937,Datafangst,
NullPointerException ved stedfesting med ankerpunkter,"h2. Observasjon

I forbindelse med testing av en annen sak ser jeg at jeg fÃ¥r NPE ved bruk av manuelle ankerpunkter.

Jeg fÃ¥r det i alle tilfeller jeg prÃ¸ver. Tipper at det har noe med endringer pÃ¥ input-parametere som ble gjort fÃ¸r sommeren.

Feilen rapporteres ogsÃ¥ som ""en feil i baksystem"", noe den ikke er. Har oppretta egen sak pÃ¥ dette, NVDB-5744.
{code:java}
java.lang.NullPointerException: null
	at no.svv.nvdb.datafangst.rest.RoadObjectResource.localizeWithAnchors(RoadObjectResource.java:185)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)
	at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)
	at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)
	at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$ResponseOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:160)
	at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)
	at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)
	at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)
	at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)
	at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)
	at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)
	at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:315)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:297)
	at org.glassfish.jersey.internal.Errors.process(Errors.java:267)
	at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)
	at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)
	at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)
	at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)
	at org.glassfish.jersey.servlet.ServletContainer.serviceImpl(ServletContainer.java:408)
	at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:583)
	at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:524)
	at no.svv.nvdb.datafangst.jersey.JerseyPlugin$1.doFilter(JerseyPlugin.java:81)
	at org.glassfish.jersey.servlet.ServletContainer.doFilter(ServletContainer.java:461)
{code}
h2. Analyse

Stedfesteren tÃ¥ler at vi sender objekter til stedfesting uten at veg er valgt, den mest sannsynlige kandidaten blir da valgt og stedfestingen fÃ¥r en pÃ¥litelighets-score.

Stedfesting med ankerpunkter tÃ¥ler ikke at veg ikke er valgt, fordi den bruker ruteplanleggeren for stedfesting, og den har et knippe begrensninger pÃ¥ hvilke veger som kan brukes, og vi mÃ¥ derfor angi hvilken veg vi vil ha.
h2. LÃ¸sning

Forhindre at brukeren kan trykke pÃ¥ knappen for stedfesting hvis stedfesting med ankerpunkter er valgt, og veg ikke er valgt.

Gi feilmelding med forklaring hvis det likevel skulle skje.

Â ",NVDB-6937,Datafangst,
StÃ¸tte for status KANSELLERT fra Skriv,"Skriv API har fÃ¥tt stÃ¸tte for at bruker selv kan kansellere endringsett som venter pÃ¥ lÃ¥s (NVDB-5467) , men Datafangst forstÃ¥r ennÃ¥ ikke denne statusen. Datafangst mÃ¥ utvides til Ã¥ stÃ¸tte denne, og fjerne status ""til eksport"" for berÃ¸rte vegobjekter.

Rapportert pÃ¥ support-mail av Marius Thorsen <marius.thorsen@vegvesen.no>.",NVDB-6937,Datafangst,
Optimalisering av UUID i database,"(!) *Ta backup av databasen fÃ¸r denne kjÃ¸rer i produksjon. Script kjÃ¸rer automatisk, men kan ta tre timer eller mer Ã¥ kjÃ¸re, og kan time ut.*

Etter NVDB-5499 (Unicode i database) ser vi at responstidene har gÃ¥tt opp, og database bruker mye CPU.

Det viser seg at MariaDB bruker mye ressurser pÃ¥ Ã¥ dekode UTF-8, selv om innholdet bare inneholder ASCII. I stedet for Ã¥ gÃ¥ tilbake til ISO-8859-1 for hele databasen kan vi sette kun UUID-kolonner til Ã¥ vÃ¦re ASCII. I tillegg sÃ¥ kan vi optimalisere litt ved at UUID-felter alltid er char i stedet for varchar.",NVDB-6937,Datafangst,
IllegalArgumentException ved restedfesting etter utskifting av vegnettsgeometri,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/d02da1e3-3967-4faa-a4d7-a0ed3467551a havner i SYSTEMFEIL under restedfesting i AdaptFeaturesToChangedRefLinkGeometryEnricherFilter:

{code:java}
java.lang.IllegalArgumentException: Expecting end less than or equal to 1.0, but is 1.0000000000000002
	at no.vegvesen.vt.nvdb.commons.core.contract.Requires.require(Requires.java:47)
	at no.vegvesen.vt.nvdb.apiskriv.domain.Extent.validateRange(Extent.java:115)
	at no.vegvesen.vt.nvdb.apiskriv.domain.Extent.of(Extent.java:78)
	at no.vegvesen.vt.nvdb.apiskriv.domain.Extent.between(Extent.java:98)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableLocational.relocalizeToPoint(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:1035)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableLocational.relocalize(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:1010)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableFeature.relocalize(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:832)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.addEnrichmentOrReportConflict(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:493)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.doFilter(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:160)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:406)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:165)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

Ved restedfesting etter utskiftning av vegnettsgeometri havarerer endringssettet fordi ny beregnet relativ posisjon for et punktobjekt er bittelitt stÃ¸rre enn 1.0 (som er max). Dette skyldes numeriske anomalier og unÃ¸yaktigheter knyttet til flyttallsrepresentasjon i Java.

h2. LÃ¸sning

Endrer resultatet fra LocationCalculator.calcRelativePosition slik at det aldri returneres verdier utenfor intervallet [0.0, 1.0].",NVDB-6937,Skriv-API,
Bruke inkluder_egenskaper-parameter i oppslag.,"BrukÂ 
{code:java}
?inkluder_egenskaper=alle|basis|geometri|assosiasjon|stedfestingÂ {code}
for Ã¥ fjerne uÃ¸nskede egenskaper i vegobjekt-sÃ¸k.",NVDB-6937,Vegkart,
Ikke lagre geometri for vegobjektsegmenter,"NÃ¥ lagrer vi hele eller deler av vegnettsgeometrien i objektenes segmenter. SÃ¥ vegnettsgeometrien for et objekt er lagret to ganger.

Objektsegmentets geometri blir kun brukt for visning, det sÃ¸kes aldri i. SÃ¥ det er mulig Ã¥ droppe Ã¥ indeksere den.

I stedet kan vi ved indeksering lagre hvilken del av objektets geometri pÃ¥ vegnettet segmentet representerer, og ved uthenting kan geometri lages ved Ã¥ klippe objektets fullstendige vegnettsgeometri.

Â 

GjenstÃ¥ende:

-HÃ¥ndtere retning pÃ¥ geometri, ok

-Utvide med noen flere tester i reader, ok

-Tester i apiet som verifiserer at segmenter fÃ¥r geometri, fÃ¥ med stedfestinger med forskjellige retninger, ok",NVDB-6937,NVDB-IND,
Mulig Ã¥ ekskludere assosiasjon- og stedfestingsegenskap,"?inkluder_egenskaper=alle|basis|geometri|assosiasjon|stedfesting

Â ",NVDB-6937,Les-API,
KjÃ¸re NVDBIND pÃ¥ Java 11,"Definer at rpm avhenger av java 11

Â 

Husk Ã¥ endre JAVA_HOME i STM, og Ã¥ definere steg i endringsdok for Ã¥ sette java 11 som default i ATM og Prod",NVDB-6937,NVDB-IND,
Dupliserte assosiasjoner gir 400-feil ved innsending til skriv,"Nytt tilfelle med dupliserte assosiasjoner, linker denne til [#NVDB-5410]
 Dette skulle vel egentlig vÃ¦rt lÃ¸st gjennom 5410, men nytt tilfelle 7. Juli.Â 

*Observasjon:*

Innsending endringssett: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.14/doc?id=c8uCeXEBxoPaAPabhBqO&_g=()]

Svar fra skriv: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.10-2020.07.07/doc/?id=2DC6J3MBycWn0Lra0-Z1]Â 

Det hÃ¸rer med at endringssettet ble forsÃ¸kt sendt inn 7. Juli 2020, men vegobjektene det gjelder ble importert/kopiert fra NVDB tilbake i februar/mars 2020. Kontrakten det gjelder er denne: [https://datafangst.kantega.no/#!/contract/87e792b7-5cff-4cad-adbd-79958e266dda/]Â 


_MÃ¥ reproduseres/undersÃ¸kes om slike tilfeller kan oppstÃ¥ ogsÃ¥ i fremtiden, og hva som skal til for Ã¥ forhindre det._",NVDB-6937,Datafangst,
TilgjengeliggjÃ¸re objekter fra SOSI i e-API,"Det kom en support henvendelse til Datafangst via SINUS support om Ã¥ kunne se og redigere objekter innlest via SOSI med vÃ¥rt eksterne API.

Alle objekter som er opplastet via SOSI bÃ¸r kunne leses og endres gjennom API pÃ¥ samme mÃ¥te som objekter som er opprettet via API.

Denne er relatert til to andre saker som omhandler Ã¥ se API-opprettede objektsamlinger i filfanen og kunne hente ut kart-importerte NVDB-objekter via API.

I bunn og grunn bÃ¸r man kunne aksessere objekter via API uansett hvordan de har kommet inn i kontrakten.",NVDB-6937,Datafangst,
Rampe pÃ¥ kjÃ¸refeltnivÃ¥ blir avvist av Skrive-API,"h2. Observasjon

Et endringssett (https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/b01f0262-e892-46d2-a11d-d577220e240f) inneholder en rampe med lenker pÃ¥ alle detaljnivÃ¥. KjÃ¸rebane- og KjÃ¸refelt-rampene er superstedfestet pÃ¥ Vegtrase-rampen. Feltegenskapen er angitt pÃ¥ alle detaljnivÃ¥. Likevel blir endringssettet avvist av skrive-API med denne meldingen:

*0: STEDFESTET_PÃ…_UGYLDIG_TYPEVEG_ELLER_DETALJNIVÃ… Veglenkens typeVeg/detaljnivÃ¥ er ikke kompatibel med tilsvarende verdier for veglenkesekvensen den er superstedfestet pÃ¥, ved veglenkens startdato: 1950.01.01*

*MarkÃ¸r navn: Lenke (Detaljert) (1)*

I hÃ¥ndbok V830 Nasjonalt vegreferansesystem avsnitt 5.4.1 er TypeVeg=Rampe tillat pÃ¥ alle detaljnivÃ¥. Kan det vÃ¦re en feil i valideringen i Skrive-API som gjÃ¸r at endringssettet blir avvist?

h2. Analyse

Endringssettet avvises med fÃ¸lgende feil:

|1951743|STEDFESTET PÃ… UGYLDIG TYPEVEG ELLER DETALJNIVÃ…|Veglenkens typeVeg/detaljnivÃ¥ er ikke kompatibel med tilsvarende verdier for veglenkesekvensen den er superstedfestet pÃ¥, ved veglenkens startdato: 1950-01-01|
|1951747|STEDFESTET PÃ… UGYLDIG TYPEVEG ELLER DETALJNIVÃ…|Veglenkens typeVeg/detaljnivÃ¥ er ikke kompatibel med tilsvarende verdier for veglenkesekvensen den er superstedfestet pÃ¥, ved veglenkens startdato: 1950-01-01|

h3. FÃ¸rste feilmelding

Oppdatert veglenke 1 pÃ¥ veglenkesekvens 1951743
- Gyldighet 1950-01-01 ->
- Konnekteringslenke
- DetaljnivÃ¥ KJÃ˜REFELT
- TypeVeg RAMPE
- Superstedfestet pÃ¥ 0.0-0.00992063 @ 521089 (port 1 - 6, altsÃ¥ veglenke 1):
-- Gyldighet 1950-01-01 ->
-- Konnekteringslenke
-- DetaljnivÃ¥ VEGTRASE
-- TypeVeg KANALISERT_VEG

En rampe pÃ¥ kjÃ¸refeltnivÃ¥ superstedfestes pÃ¥ kanalisert veg pÃ¥ vegtrasenivÃ¥. Dette er ikke tillatt i fÃ¸lge reglene vi har implementert i API Skriv.

h3. Andre feilmelding

Oppdatert veglenke 1 pÃ¥ veglenkesekvens 1951747
- Gyldighet 1950-01-01 ->
- Ikke konnekteringslenke
- DetaljnivÃ¥ KJÃ˜REFELT
- TypeVeg RAMPE
- Superstedfestet pÃ¥ 0.00992063 - 0.0621469906256782 @ 521089 (port 6 - 11 (ny), altsÃ¥ veglenke 2 (oppdatert)):
-- Gyldighet 1950-01-01 ->
-- Ikke konnekteringslenke
-- DetaljnivÃ¥ VEGTRASE
-- TypeVeg RAMPE

En rampe pÃ¥ kjÃ¸refeltnivÃ¥ superstedfestes pÃ¥ rampe pÃ¥ vegtrasenivÃ¥. Dette er heller ikke tillatt i fÃ¸lge reglene som hÃ¥ndheves nÃ¥. Kun ramper pÃ¥ kjÃ¸rebanenivÃ¥ tillates i dag superstedfestet pÃ¥ rampe pÃ¥ vegtrasenivÃ¥. [~linda.stoeng@vegvesen.no] og [~nikolaj.fyhn@vegvesen.no]: Ã˜nskes en endring pÃ¥ dette?

h2. LÃ¸sning

Oppdaterte SuperLocationRefLinkExistsValidator med de nye tillatte superstedfestingkombinasjonene.",NVDB-6937,Skriv-API,
FÃ¸lg opp endringssett som feiler pÃ¥ grunn av NVDB-5695,"https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/d0d60c24-7911-4930-8b65-c4ead07f4994 ser ut til Ã¥ feil pÃ¥ grunn av manglende sideposisjon, som er fikset i NVDB-5695.

",NVDB-6937,Skriv-API,
Filtrer pÃ¥ adskilte lÃ¸p gir feil i data (Prod),"h2. Observasjon

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/105?antall=5&adskiltelop=Mot]Â lister noen objekter, hvor ex [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/105/78718468/2]Â kun har adskilte lÃ¸p = Nei.

Samme medÂ [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/5?antall=5&adskiltelop=Mot]

*MERK*: Begge disse sÃ¸kene med filter gir samme objekter tilbake i UTV, STM og ATM - hvor alle objektene der har adskilte lÃ¸p = MOT. Datafeil et sted?",NVDB-6937,Les-API,
Visning med delingslenke crasher pÃ¥ rettigheter,"h2. Observasjon
Fra mÃ¸te med Ole JÃ¸rgen Skavhaug og Olav LÃ¸berg.

Visning med delingslenke fungerer ikke lengre etter endring av rettighetssjekk i 2020.1.11. FÃ¥r feinlelding pÃ¥ console om undefined.

Steg for Ã¥ reprodusere:
# GÃ¥ til status-fanen
# Klikk pÃ¥ (eller kopiÃ©r lenke) fra knapp med ""Delingslenke"" Ã¸verst til hÃ¸yre
# FÃ¥ opp innhold fra lenke
# Kart er tomt, og det er ikke noe informasjon i tabellen under kartet

h2. Analyse
FÃ¸r endring ble det brukt en rettighetssjekk som tok hÃ¸yde for at ingen bruker var satt, dette mÃ¥ gjÃ¸res pÃ¥ en tilsvarende mÃ¥te nÃ¥. Sjekk siste endring i contract-status-controllers.ts",NVDB-6937,Datafangst,
UtlÃ¸pt OpenAM-token gir systemfeil ved innsending til NVDB,"h2. Observasjon
I mÃ¸te med Ole JÃ¸rgen Skavhaug og Olav LÃ¸berg fra TrÃ¸ndelag FK for Ã¥ gÃ¥ gjennom feil.

Ett av de tilfellene der de fÃ¥r systemfeil med feilkode skyldes det at kall mot Skriv blir avvist fordi innlogging har utlÃ¸pt. SÃ¸k etter ""OafEgEhe"" for ett konkret tilfelle, eller ""HTTP 302 from NVDB API Skriv"" for Ã¥ finne alle.

h2. Analyse
Vi har automatisk fornying av token for servicebruker, men ikke for sluttbrukere. Vi har fÃ¥tt denne feilen fra starten av juni (med mindre den var maskert av annen feil fÃ¸r), mulig at det ble endra pÃ¥ levetid for OpenAM-token da.
Skriv skal over pÃ¥ Atlas og kommer da til Ã¥ ta i bruk JWT, og det samme gjelder Datafangst nÃ¥r (hvis) det blir innflytting.
Vi mÃ¥ vurdere hva vi skal gjÃ¸re her pÃ¥ kort sikt, og hva som skal vente pÃ¥ innlogging med OIDC og JWT.

h2. Forslag til lÃ¸sning
Den langsiktige lÃ¸sningen er JWT og at nettleser fornyer denne fÃ¸r den gÃ¥r ut. Det kommer pÃ¥ plass i forbindelse med innflytting. 

I mellomtida bÃ¸r bruker fÃ¥ en bedre feilmelding. Gi beskjed om at innlogging er utlÃ¸pt, og at bruker mÃ¥ logge inn i Datafangst igjen for Ã¥ sende inn til NVDB.",NVDB-6937,Datafangst,
Laster ikke vegobjekter ved kategorisering,"h2. Observasjon

NÃ¥r man legger til kategorisering sÃ¥ lastes ingen objekter. Observerer dette i UTV og TEST, men ikke i Prod - sÃ¥ det mÃ¥ ha kommet med siste versjon.

PrÃ¸v Ã¥ legge til Trondheim. Deretter tunnellÃ¸p. Resultater vises. Deretter kategoriser pÃ¥ noe. Ingen resultater vises, og ingen kall mot /vegobjekter sendes. Bruk evt lenkeÂ [https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@268102,7030868,9/hva:~(~(category~(type~'enum~id~8944)~id~67))/hvor:~(kommune~(~5001))]

Og sammenlign med Prod.",NVDB-6937,Vegkart,
Marker som feil pÃ¥ kommentar er utilgjengelig for kontrakteier,"Observasjon fra Eli Stenvik

PÃ¥ hvert enkelt vegobjekt kan man legge inn en kommentar og markere om denne skal gi en feil pÃ¥ vegobjektet. Denne er nÃ¥ ikke lengre tilgjengelig for gruppe-admin og -forvalter. Den er der for globaladmin og forvalter.",NVDB-6937,Datafangst,
Tillate endringssett med bÃ¥de lukke- og korrigeringsoperasjon pÃ¥ samme vegobjektversjon,"h2. Bakgrunn

* Bruker Ã¸nsker Ã¥ redigere stedfesting til et eksisterende vegobjekt, samtidig som objektet skal lukkes.
* Bruker Ã¸nsker Ã¥ redigere en egenskap, eks. sekvensnummer pÃ¥ FT916, samtidig som objektet skal lukkes.

Dette medfÃ¸rer at objektet bÃ¥de blir korrigert (delvisKorriger) og eksplisitt lukket (lukk) i endringssettet. Dette tilllates ikke av API Skriv i dag og innsjekk avvises.

Vegnettsbrukere mÃ¥ i slike tilfeller tilbakestille korreksjonen og nÃ¸ye seg med at objektet blir lukket.

Trimble v. Eivind og Richard, Tore E.A og Hans JÃ¸rgen/Kjetil hadde en prat om denne saken 25. juni.

h2. LÃ¸sning

Fjernet sperre i UniqueNvdbIdVersionValidator som hindrer korrigering og lukking av samme vegobjektversjon.
Oppdaterte PrepareForCorrectEnricherFilter til Ã¥ validere at sluttdato i korrigering og eventuell lukking er den samme, og setter sluttdato lik lukkedato dersom korrigering ikke setter sluttdato.
La til ny attributt ""operasjon"" i VegobjektResultat for Ã¥ kunne skille mellom ulike operasjoner pÃ¥ vegobjekter i <resultat>
",NVDB-6937,Skriv-API,
Visning av intervall pÃ¥ SD og KD,"h2. Observasjon

[https://vegkart.utv.atlas.vegvesen.no/#kartlag:geodata/@561395,7613925,9/hva:~(~(id~919)~(id~920))/hvor:~(vegsystemreferanse~(~'EV6S32D1M80SD1-2))]

Ser at jeg ikke fÃ¥r til Ã¥ skrive {{...SD1-2}} i sÃ¸kefeltet. Den hopper tilbake til {{...SD1}}, men blir riktig i sÃ¸k bakover. Det samme gjelder for KD.

Â 

BONUSOPPGAVE: Sett riktige meterverdier pÃ¥ strekning i vegsystemreferansen.

!Screenshot from 2020-09-10 10-45-02.png|thumbnail!",NVDB-6937,Vegkart,
Manglende oppdatering pÃ¥ relasjon til mor,"h2. Observasjon #1

Triona klager pÃ¥ at en mor-lÃ¸s datter ikke har fÃ¥tt mor etter en transaksjon i Skriv. EndringssettetÂ [https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/a8096224-636f-427b-b5cc-a710f05d7b2e?inkluderResultat=JA]

kobler to dÃ¸tre til en mor. Mor fÃ¥r begge dÃ¸trene ut:

[https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/487/837513801/3]

En datter har tilbakekobling til mor:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/25/871528419/1]

Men ikke den andre:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/25/489137099/1]

Skriv har lagret dette om mor:Â [https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/487/837513801/3]

Transaksjonen:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/transaksjoner?ider=4821867]
h2. Observasjon #2

Her har Triona fjernet en datter fra en mor og koblet datter til en annen mor:Â [https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/ccb48b7a-abad-4ebd-8f59-11b67dcb4520?inkluderResultat=JA]

Gammel mor ([https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/487/589434986/1]) og ny mor ([https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/487/589434991/1]) er oppdatert riktig i NVDB. Les gir ut riktig pÃ¥ begge mÃ¸drene, men datter har fortsatt gammel mor i relasjonene:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/25/589434987/1]

Transaksjon:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/transaksjoner?ider=4821864]

Â ",NVDB-6937,NVDB-IND,
"Vegobjekt har to vegsystemreferanser, skulle vÃ¦rt Ã©n?",https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/3/1006875798/1,NVDB-6937,NVDB-IND,
Stedfesting med Skriv som standard,"NÃ¥r utestÃ¥ende ting er fikset i Skriv og Les, og stedfesting med Skriv er testet nok, sÃ¥ kan vi gÃ¥ over til Ã¥ bruke denne som standard.

Det bÃ¸r vÃ¦re mulig for bruker Ã¥ bytte fram og tilbake mellom Skrivs og Datafangsts stedfesting fra GUI pÃ¥ stedfestingsfanen.
 * refaktoriser toggle-logikken fra Ã¥ referere til ""skrivlocationals"" til ""legacylocationals"" og snu om logikken slik at skriv er default og legacy styres med en toggle
 * Â fjern toggle knappen fra admin
 * legg inn en toggle-knapp synlig for alle for Ã¥ toggle ""bruk gammel metode for stedfesting""",NVDB-6937,Datafangst,
Negativ meterverdi for ankerpunkt hos vegnettsegmenter i rundkjÃ¸ring pÃ¥ FV409,"HÃ¥vard sin kontroll ""meterNegative"" viser etter siste reindeksering kun ett tilfelle (12 rader, men alt er samme rundkjÃ¸ring:

ERROR;MeterNegative;4203;21815;0;0,10147498;32965;2375019;0;;F;V;409;S1D1 M-1;K;1000;1;29;38;K;;;;4;1;;140071;6497253;19;140062;6497253;19

https://ftp.triona.no/NyttVegnett-2020/Logger/RoadNetwork-Norge-ERF-K-2020-06-29.log

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@140098,6497246,16/hvor:~(vegsystemreferanse~(~'FV409))/vegnett:~'geometri+~()/valgt:21815:10:6]

Lenkesekvensen til rundkjÃ¸ringen erÂ 21815.
 Lenkesekvensen til hovedlÃ¸pet hvor Kryssystem er stedfestet pÃ¥ erÂ 22196.

Jeg ser ingen feil i vegnettet, men har snappet nivÃ¥delt vegnett pÃ¥ nytt, snappet strekning- og vegsystem, stedfestet kryssdel og kryssystem pÃ¥ nytt uten at inkrementell oppdatering har lÃ¸st problemet.

Kryssystem-objektet har riktig vegsystemreferanse, metreringen til rundkjÃ¸ringen er ogsÃ¥ riktig, men det er altsÃ¥ ""ankerpunktet"" til segmentene i selve rundkjÃ¸ringen som har en negativ meter:Â FV409 K S1D1 M-1 KD1 M0-5

SpÃ¸rsmÃ¥let er om reindeksering av de to lenkesekvensene eller evt. full reindeksering av vegnett vil kunne lÃ¸se problemet etter mine ""restedfestinger"" i dag.",NVDB-6937,NVDB-IND,
Deltaker pÃ¥ kontrakt kan ikke importere fra NVDB,"h2. Observasjon
Med 2020-1.11.0 ble det innfÃ¸rt en feil som gjÃ¸r at ""Importer""-knappen pÃ¥ datafanen ikke lengre er aktiv for de som kun er lagt til pÃ¥ en kontrakt, og som ikke er i kontraktsgruppe eller er global admin.",NVDB-6937,Datafangst,
FÃ¥ lasten pÃ¥ svvpnvdbsolr13 til Ã¥ bli mer lik resten av solrnodene,"svvpnvdbsolr13 har i lengre tid hatt betydelig hÃ¸yere CPU-bruk enn de andre solrnodene i prod.

Vi kjenner ikke Ã¥rsaken til dette.

Drift har kikket pÃ¥ konfigurasjonen av noden og mener den er riktig satt opp. En reboot av noden hadde heller ingen effekt.

Kan det vÃ¦re en ide Ã¥ prÃ¸ve fÃ¸lgende for Ã¥ teste ut om det likevel er noe med solr13 som ikke er som de andre nodene:
 * bytte om shardene pÃ¥ solr13 og f.eks solr14. For Ã¥ sjekke ut om solr13 normaliserer seg og solr14 mÃ¥ ta hÃ¸yere last. Hvis ja er det sannsynlig at det er kombinasjonen last+type spÃ¸rringer som forÃ¥rsaker problemet, og at det ikke er noe galt med solr13. Hvis det ikke endrer situasjonen vil det vel bety at det er noe med selve solr13 som avviker fra andre?
 * Erstatte solr13 med en helt ny vm (som er lik de andre). Hvis det hjelper og gjÃ¸r at lasten pÃ¥ solr13 blir lik de andre, har vi pÃ¥vist at det var noe feil med selve solr13 noden.Â 

Er det andre grep som kan taes for Ã¥ fÃ¥ lastfordelingen til Ã¥ bli jevnere mellom nodene?

Â 

Â ",NVDB-6937,Les-API,
Kontraktlisten skalerer ikke for store grupper,"h2. Observasjon

PÃ¥ datafangst-test er det i gruppen TEST ca 550 kontrakter. NÃ¥r gruppeforvalter eller -admin skal fÃ¥ opp denne listen (uten at de har noen globale roller) sÃ¥ tar det veldig lang tid.

Brukere med globale rettigheter merker ikke dette da det er mange flere sjekker og databasekall involvert for gruppe-rollene.

Denne saken blir viktig fÃ¸r vi skal fÃ¥ alle kontrakter over i grupper.",NVDB-6937,Datafangst,
Validering pÃ¥ lengde for input ved ny kontrakt,"h2. Observasjon
Eli Stenvik (eli.stenvik@trondheim.kommune.no) fÃ¥r ""Feil fra baksystem"" under lagring av ny kontrakt. Sjekker logg og ser at det er SQL-feil siden hun sender flere tegn til ""contractor"" (dvs. entreprenÃ¸r) enn det tabelldefinisjonen tillater.

h2. Forslag til lÃ¸sning
Den trivielle mÃ¥ten Ã¥ lÃ¸se dette pÃ¥ er Ã¥ sette lengdebegrensning pÃ¥ feltene i HTML som samsvarer med hva som er definert i databasen.",NVDB-6937,Datafangst,
"""Skjul registrerte"" pÃ¥ datafane har ingen effekt","h2. Observasjon
Support-mail fra Ã˜ystein BjÃ¸ndal Lund (Oystein.bjondal.lund@vegvesen.no). Han fÃ¥r ingen effekt av Ã¥ trykke pÃ¥ toggle for ""Skjul registrerte"" i datafanen.

Har gjenskapt det samme pÃ¥ utv. Tekst endres pÃ¥ knapp, men vegobjekttyper med ikon for at alt er registrert (dvs, disk med hake) vises fortsatt i lista. ",NVDB-6937,Datafangst,
Snillere hÃ¥ndtering av sideposisjonsvarsel ved datafeil,"h2. Bakgrunn

Endringssett https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/f37e613a-2a41-46d4-ab03-d7f2818db4ed havnet i SYSTEMFEIL fordi et vegobjekt som skulle restedfestes (sideposisjonssammenligning) hadde ugyldig stedfesting i utgangspunktet. Dette er en datafeil og at dette fÃ¸rer til SYSTEMFEIL i forbindelse med sammenligning av ny og gammel sideposisjon er litt voldsomt. Sammenligningen skal jo bare brukes til Ã¥ generere et notabenevarsel. Vi bÃ¸r hÃ¥ndtere denne situasjonen litt snillere, f.eks. unnlate Ã¥ lage notabene nÃ¥r gammel sideposisjon ikke lar seg beregne e.l.

h2. Analyse

SYSTEMFEIL forÃ¥rsakes av at exception kastes fra SidePositionCalculator.lineSegmentFromPosition() nÃ¥r det ikke er mulig Ã¥ finne et linjesegment i veglenkegeometrien som passer til oppgitte veglenkesekvensposisjon.

h2. LÃ¸sning

Endrer SidePositionCalculator.lineSegmentFromPosition() til Ã¥ returnere Optional.empty() i stedet for Ã¥ kaste exception i den aktuelle situasjonen. I kaller (SidePositionCalculator.calculateSidePositionForPointLocational()) trigger det returverdi SidePosition.UNDEFINED.",NVDB-6937,Skriv-API,
Feil med automatisk bygging av cache i ATM/PROD,Bygging av cache feila. Gikk greit i UTV der det ble testa.,NVDB-6937,NVDB-IND,
Modulvogntog regelverkendring,"FÃ¸rst mÃ¥ det gjÃ¸res en datakatalogendring for de berÃ¸rte BK-variantene.Â 

Deretter ser det ut som om vi mÃ¥ ta med en ekstra egenskapverdi fra NVDB og inn i veglistene. Jeg har ikke klart Ã¥ finne noen annen logikk vi trenger understÃ¸tte (puh!). Gjengir epost fra Tone Wiig nedenfor
----
Â 

Hei

Â 

Veg- og trafikkjuridisk arbeider nÃ¥ med en mulighet for Ã¥ Ã¥pne for modulvogntog og vogntog med 24 m, totalvekt 60 tonn, i de deler av vegnettet som er Ã¥pnet for dette for tÃ¸mmervogntog. Man ser her at det kan bli en mulighet for noen Ã¥ reservere noen strekninger for ordningen, uten Ã¥ mÃ¥tte fjerne rettigheten for tÃ¸mmertransport.

Â 

I praksis betyr dette at det mÃ¥ innarbeides ei ny kolonne i vegliste for tÃ¸mmertransport. Prinsippet vil bli det samme som vi allerede har for modulvogntog, se vedlegg. AltsÃ¥ en kolonne Â«Gjelder ikke forÂ». SÃ¥ her mÃ¥ det en endring i datakatalogen, og en endring i rapportgeneratoren.

Â 

I skrivende stund, har vi ikke Ã¸konomi pÃ¥ plass. Dette blir derfor en undersÃ¸kelse om hva dere mener det vil bli av omfang pÃ¥ jobben, og om hvor mye det anslagsvis vil koste. Vi hÃ¥per Ã¥ ha dette i orden til oktober utgaven av veglista.

Â 

Vennlig hilsen
 Tone Wiig
 Mobil:Â +47Â 95726165",NVDB-6825,Rapportgenerator,
Release og deploy,"Release av:

back-end: 2.0.0

front-end: -v1.1.0-,Â -v1.1.1-,Â v1.1.2

Deploy til ATM og PROD

Fjerner deploy til dedikert Vegliste-versjon av nvdb-rapport-api, og flytter ressursene over pÃ¥ den vanlige/originale deployen.",,Rapportgenerator,
Systemdok: oppdatere med flernodedrift,"Oppdatere [systemdokumentasjonen|https://www.vegvesen.no/wiki/display/NVDBogGeodata/Systemdokumentasjon+NVDB+Rapporter] med info om flernodedrift og databaser (NVDBREF-488) som ikke blir med i release til PROD fÃ¸r sommerferien.

{color:#de350b}Frist: 2020-07-03{color}",,Rapportgenerator,
Forbedringer V1 vegnettsrapport,"Tilbakemelding fra Nikolaj Fyhn. Splittes opp i nye deloppgaver ved behov.Â 

Den fÃ¸rste feilen - _vegsystemreferanser utenfor k.omrÃ¥det_ - kjenner vi jo til: Vi har jo som kjent mangelfull filtrering og klipping pÃ¥ de bitene som er utafor k.omrÃ¥de - avgrensingen.Â 

---Â 

Hei,

Det er en flott jobb som gjÃ¸res med NVDB Rapporter ğŸ˜Š

Jeg har testet mere pÃ¥ V1 Vegnettsrapport og har noen tilbakemeldinger.

Â 

Â 

*StÃ¸rre feil:*
 * Feil lengde ved kontraktgrense. Jeg fant to vegsystemreferanser som er utenfor kontraktsomrÃ¥det. Disse er markert med gull farge i vedlagte vegnettsrapport. Kontrakten Â«9201 Lifjell riksveg 2020-2022Â» skal starte pÃ¥ RV36 S8D1 M5032, men i vegnettsrapporten er der vegsystemreferanser fÃ¸r dette punktet.
 * Sideanlegg 1029 pÃ¥ E134 har fÃ¥tt feil Â«TilmeterÂ» men Â«Lengde vegÂ» er riktig
 * Noen stedsnavn blir plassert feil i vegnettsrapporten.

For eksempel er stedsnavnet pÃ¥ fylkesgrensen Â«flyttetÂ» til feil ende av lenken.

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@186494,6620846,16/hva:~(~(id~343))/hvor:~(fylke~(~38))/vegnett:~'geometri+~()/valgt:106071196:343]

Stedsnavnet i kryss mellom E134 og fv. 3328 treffer ogsÃ¥ feil ende av lenken:

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@139488,6610545,17/hva:~(~(id~343))/vegnett:~'geometri+~()/valgt:106071048:343]

Â 

Â 

*Kosmetiske ting:*
 * Fjerne faner uten innhold. Driftkontraktene blir delt opp i egne fylkesveg-kontrakter og egne riksveg-kontrakter, da blir det ofte tomme faner.
 * Kolonnen Â«Lengde vegÂ» trenger ikke mere enn to desimaler. Centimeter-presisjon.
 * Kommunenummer for KPS-veger. KPS-vegene er bare unike innenfor kommunen og derfor mÃ¥ kommunenummeret vÃ¦re med.
 * Vertikal tekstretning pÃ¥ overskrifter kan gi bedre overblikk over rapporten og gjÃ¸r det enklere Ã¥ lese vegsystemreferansen:

Â 

Â 

Â 

Med hilsen
 Nikolaj Fyhn",NVDB-6827,Rapportgenerator,
Engine - ObjectListingReport bÃ¸r ikke bruke headere som nÃ¸kler,"Vi hadde et problem hvor headeren ""Lengde"" ble brukt bÃ¥de av NVDB objektet og av oss internt. For Ã¥ unngÃ¥ lignende konflikter i fremtiden bÃ¸r ObjectListingReport generere nÃ¸kler basert pÃ¥ attributtID for at vi skal kunne vÃ¦re sikre pÃ¥ at det ikke er noe overlapp.",NVDB-6871,Rapportgenerator,
Trenger sideposisjon i V4-rapporten,"Sammen med Ã¸vrig vegnettsinformasjon trenger vi Ã¥ viteÂ _sideposisjon_ i V4-rapporten. Mange objekter i NVDB mangler egengeometri, og da erÂ _sideposisjon_Â eneste mulighet til Ã¥ skille dem fra hverandre. I tillegg er det veldig kjekt for planlegging av vedlikehold.Â 

Â 

Tipper dette er slikt som mÃ¥ fikses i motoren. MÃ¥ excel-utskriften justeres ogsÃ¥?Â 

Â 

NB! Vi har en snublefelle ved at brukerne vÃ¥re forstÃ¥r sideposisjon relativt tilÂ +metreringsretning+, mens sideposisjon angitt i data fra leseApi alltid er slik data er lagret i NVDB: Relativt tilÂ +lenkeretning+. Hovedregelen er jo at metrering og lenkeretning gÃ¥r samme vei, men metrering blir relativt ofte snudd stikk motsatt av lenkeretning. Vi mÃ¥ finne ut hva i datagrunnlaget vÃ¥rt som sikrer at vi kan gi sideposisin relativt til metreringsretning. Mest sannsynlig mÃ¥ vi bruke data fra vegnettet, det vil si sjekke detaljene om hver enkelt lenkesegment.Â 

Â 

Jeg tror det er lurt om vi er overtydelige, for dette med at sideposisjon kan vÃ¦re bÃ¥de ihht metrering og lenkeretning er opphav til mye forvirring. Jeg vil at vi vurderer Ã¥ gi utÂ +to+ sideposisjonsverdier:Â 
 * sideposisjon_lenke <= det er denne vi fÃ¥r fra NVDB api V3
 * sideposisjon_metrering <= det er denne som etterspÃ¸rres, og som vi mÃ¥ regne ut.Â ",NVDB-6827,Rapportgenerator,
DevOps: UTV - tune minne og CPU,"Vegliste: Normaltransport, Viken fylke gÃ¥r ikke igjennom pÃ¥ UTV pga. ressursmangel.

Tune CPU og minne.

Evt. slÃ¥ sammen de to deploymentene for nvdb-rapport-api",NVDB-6825,Rapportgenerator,
Endringer i objektlista vil sette alle lagrede vegobjekter til DIRTY,"h2. Observasjon

Via Simon StÃ¸lan, support.
{quote}Hei,

Hva er Ã¥rsaken til at lagrede objekter noen ganger vises med lagretsymbol type Â«svart hake over svart strekÂ», mens de samme objektene ved neste innlogging (uten at det er gjort endringer) kan vises med Â«hvit hake pÃ¥ grÃ¸nn firkantÂ»?

Eks Vegbom og Singalanlegg iÂ [https://datafangst.kantega.no/#!/contract/16724ec7-a5a4-455a-9a2b-b1baf1b94d8a].

Dette er uoversiktlig for oss som jobber med lagring mot NVDB. Skal vel ikke vÃ¦re slik ? Er kanskje en bug som dere kan fikse pÃ¥?
{quote}
Â 

Endringer i objektlista ser ut til Ã¥ sette vegobjekter til DIRTY.
 Det har ikke noe Ã¥ si hvilke objekter man endrer i objektlista.
 En endring i objektlista setter DIRTY-flagget for vegobjekter i prosjektet, og det ser ut som, og DF behandler de som om de har endringer som skal lagres, men de har ingen reelle endringer, og vil bli avvist av Skriv med ""Empty changeset""-feilmelding.

Feilen kan gjenskapes ved Ã¥ laste opp en sosi, stedfeste objektene og lagre de i skriv. De er nÃ¥ markert som lagret. GÃ¥ deretter inn i settings for prosjektet, og hak av og pÃ¥ ett av objekttypene i objektlista. GÃ¥ tilbake til datafananen og observer at vegobjektene nÃ¥ er DIRTY.
h2. Analyse

NÃ¥r objektlistene oppdateres gjÃ¸res det en re-evaluering av validation issues, som fÃ¸rer til at alle vegobjekter blir oppdatert (touch) og fÃ¥r satt DIRTY flagg av dao.

Re-validering av vegobjekter bÃ¸r bare skje pÃ¥ objekter som er DIRTY, siden det ikke er noe poeng Ã¥ revalidere vegobjekter som er lagret.
h2. LÃ¸sning

La til DIRTY som kriterium i utvalget pÃ¥ oppdatering av validationÂ  issues.

Â ",NVDB-6937,Datafangst,
Automatisk rebuild av cache,"Rett feilen med automatisk rebuild av cache, slik at vi kan installere IND uten Ã¥ kjÃ¸re full indeksering med en gang.",NVDB-6937,NVDB-IND,
FÃ¥ med ferjekaier forkledd som bru,"BrukerÃ¸nske driftskontrakter V2/V3: De savner ferjeleier som er forkledd som bruer, dvs de bruene som har 1263 Brukategori = 7307 Ferjeleie

Saksgang: Avklare med Rune Henning SkÃ¥r om hva den nye oppramsingen bÃ¸r hete og slikt, samt hvordan det evt pÃ¥virker utlisting av Ã¸vrige bru-objekter. deretter er det kun for Magnus Ã¥ legge det til i rapportdefinisjonen.Â 

Bruer er som kjent et kodeord forÂ _konstruksjoner som vedlikeholdes i fagsystemet Brutus,_ det du trur at bru betyr = brukategoriÂ vegbru, som kunÂ er et subsett av objekttype 60 Bru i NVDB.Â ",NVDB-6827,Rapportgenerator,
Mer beskrivende filnavn som skiller mellom de ulike rapporttypene,"BrukerÃ¸nske driftskontrakter: Et filnavn som inneholder mere metadata om innholdet. For eksempel:Â 
 * rapporttype (V1, V2, ... )Â 
 * Nummer for driftskontrakt, for eksempel 9305 for DK ""9305 Sunnfjord""Â 
 * Dato rapport kjÃ¸rt (som i dag)Â Â ",NVDB-6827,Rapportgenerator,
Eksport: Vis bare uregistrerte viser bare registrerte,"h2. Observasjon

supportmail fraÂ oystein.bjondal.lund@vegvesen.no

Se kontraktÂ [https://datafangst.kantega.no/#!/contract/a959d5b8-ff3d-4cbd-947a-6f01260bc88f/export]

Ett vegobjekt er overfÃ¸rt NVDB.
 Merk av for Â«vis bare uregistrerteÂ»
 Det ser for meg ut som funksjonalitet er motsatt, at det bare er de registrerte som vises â€¦.",NVDB-6937,Datafangst,
URL-parameter for Ã¥ skru av splash-screen.,Ã˜nske fra brukerÂ Sindre Moldeklev (@sndrem pÃ¥ Gitter).,NVDB-6937,Vegkart,
Kansellere endringssett under behandling,"h2. Bakgrunn

Kontrollpanelet mÃ¥ tillate at et endringssett i status BEHANDLES settes til status KANSELLERT. Dette gjÃ¸r det bl.a. mulig Ã¥ stoppe endringssett som er altfor store og havarerer med OutOfMemoryError o.l. ActiveMQ vil i slike tilfeller gjÃ¸re redelivery av submit-meldingen og i prinsippet ikke gi seg fÃ¸r endringssettet er behandlet uten problemer.

h2. Analyse

JobWorker bÃ¸r undersÃ¸ke om et endringssett under behandling har fÃ¥tt ""kanselleringsordre"" pÃ¥ tre ulike tidpunkter:

1) Ved mottatt submit-melding => Rett fÃ¸r behandling starter.
2) Rett fÃ¸r (eller etter) lÃ¥sing => Halvveis i behandlingen.
3) Rett fÃ¸r endringssettet effektueres i NVDB => Rett fÃ¸r behandlingen avsluttes.

Kanselleringsordren bÃ¸r ikke angis ved at endringssettet settes i status KANSELLERT i jobbdatabasen. Under behandling skal det fortsatt ha status BEHANDLES og det er en del logikk i dag for Ã¥ sette i status VENTER f.eks. som det ikke er hensiktmessig Ã¥ rÃ¸re. At endringssettet skal kanselleres under behandling bÃ¸r heller angis med eget boolsk flagg pÃ¥ endringssettet i jobbdatabasen. JobWorker kan da inspisere dette flagget pÃ¥ de tre stedene angitt over og eventuelt avbryte behandlingen og sette status til KANSELLERT.

h2. LÃ¸sning

* (/) Nytt felt for kanselleringsflagg i JOB-tabellen. Tilsvarende property i Job-klassen. Mapping i Repository-klassen.
* (/) Service- og Repositorymetode for Ã¥ sette og lese kanselleringsflagg.
* (/) Kanselleringslogikk i JobWorker
* (/) Kanselleringsflagg i representasjonsmodell for Endringssett/Status.
* (/) Vis Kanseller-knapp i detaljvisning for endringssett med status BEHANDLES i Kontrollpanelet.
",NVDB-6937,Skriv-API,
UnÃ¸dvendig beriking av Gate-objekter,"StreetEnricherFilter beriker en jobb under behandling med alle eksisterende Gate-objekter med samme navn som et slikt objekt i endringssettet. Denne berikingen er ikke nÃ¸dvendig sÃ¥ lenge constrainten UniformStreetCodeForName er deaktivert.

h2. LÃ¸sning

Parametriserte beriking og aktiverte kun beriking basert pÃ¥ gatekode. La pÃ¥ ekstra logging for Ã¥ indikere nÃ¸yaktig hvilken type Gate-beriking som gjÃ¸res.",NVDB-6937,Skriv-API,
SQLSyntaxErrorException ved henting av Gate-objekter,"h2. Observasjon

Endringssett 8f37423d-3bbc-484e-9312-29470688fd5f m.fl. havarerer med SYSTEMFEIL under innlesing av Gate-objekter fra NVDB:

{code:java}
java.sql.SQLSyntaxErrorException: ORA-00907: missing right parenthesis
	at no.vegvesen.vt.nvdb.apiskriv.nvdbrepository.JdbcFeatureRepository.getFeatureVersions(JdbcFeatureRepository.java:283)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.JobFilter$Context.getFeaturesFromNvdb(JobFilter.java:215)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.StreetEnricherFilter.lambda$getExistingStreetsByName$3(StreetEnricherFilter.java:170)
	at java.lang.Iterable.forEach(Iterable.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.StreetEnricherFilter.getExistingStreetsByName(StreetEnricherFilter.java:157)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.StreetEnricherFilter.createStreetEnrichmentsByName(StreetEnricherFilter.java:106)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.StreetEnricherFilter.doFilter(StreetEnricherFilter.java:67)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:406)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:165)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.activemqclient.ActiveMqSubscription.onMessage(ActiveMqSubscription.java:188)
{code}

h2. Analyse

SQL som ikke er korrekt formatert er:

{code:sql}
with UNIQUE_FEATURE_VERSIONS as (
  select distinct
    f.feature.persistentid FID,
    fv.featureversion.versionid VID
  from
    nvdb.features_0538 f,
    table(f.featureversions) fv
  where
    fv.attr_4589.value = 'Harald Dreyer's vei'
    and fv.attr_202184.fid = 1002101811
    and fv.featureversion.versionid = (select max(fv2.featureversion.versionid) from table(f.featureversions) fv2)
)
select
  f.feature.persistentid FID,
  fv.featureversion.versionid VID,
  fv.featureversion.startdate SDATE,
  fv.featureversion.enddate EDATE,
  fv.attr_4588 ATTR_4588,
  fv.attr_4589 ATTR_4589,
  fv.attr_202184 ATTR_202184
from
  nvdb.features_0538 f,
  table(f.featureversions) fv,
  UNIQUE_FEATURE_VERSIONS ufv
where
  ufv.FID = f.feature.persistentid
  and ufv.VID = fv.featureversion.versionid
order by
  FID,
  VID
{code}

Ser ut som at enkelte gater bruker apostrof i navnet og dette skaper trÃ¸bbel i SQL der samme tegn brukes til Ã¥ angi streng.

h2. LÃ¸sning

WHERE-klausulen stammer fra StringAttributeHavingValue.asSql. InnfÃ¸rer literal quoting for Ã¥ unngÃ¥ problemet med strenger som inneholder apostrofer.",NVDB-6937,Skriv-API,
Ekstremt mange spÃ¸rringer etter Vegsystem-objekter,"h2. Observasjon

Ser i Splunk at mange endringssett (f.eks. 45106f4c-7c35-4056-ac24-664c0407fc68) under behandling genererer ekstremt mange spÃ¸rringer etter Vegsystem-vegobjekter i NVDB.

h2. Analyse

Beriking av jobb med Vegsystem-objekter gjÃ¸res i RoadSystemEnricherFilter. Dette er et NetElementFilter, men spÃ¸rs om det burde vÃ¦rt et JobFilter. Samme kan sies om RoadRefEnricherFilter.

h2. LÃ¸sning

Bygget om bÃ¥de RoadSystemEnricherFilter og RoadRefEnricherFilter til Ã¥ bli JobFilter og gjÃ¸r nÃ¥ kun ett oppslag i NVDB for Ã¥ hente hver av de to vegobjekttypene. Eller ett oppslag per 500 veglenkesekvensid, dersom det er mange av dem.",NVDB-6937,Skriv-API,
Droppe segmentering av historiske objekter for kontraktsomrÃ¥der og riksvegruter,"Vi segmenterer nÃ¥ med endel historikk for kontraktsomrÃ¥der og riksvegruter.

Marvin foreslÃ¥r at vi dropper Ã¥ ta med historiske objekter, og kun segmenterer med Ã¥pne, som nok tilsvarer det man har mulighet Ã¥ velge i Vegkart.Â 

---------------------------------------------------------------------------------------

I forbindelse med utvikling av nye rapporter fra NVDB sÃ¥ har de som fÃ¸lger opp entreprenÃ¸r gitt uttrykk for at det er viktig Ã¥ kunne gÃ¥ tilbake og se hvilke objekt som var tilknyttet et angitt kontraktsomrÃ¥de *pÃ¥ en gitt historisk dato*. Dvs ikke bare historiske objekt, men historiske objekt som overlapper med den historiske utstrekningen til kontraktsomrÃ¥det.

-------------------------------------------------------------------------------------------------------

Vi vet jo at det er under utvikling nytt ELrapp-system og det vil sannsynligvis komme Ã¸nsker og behov fra bÃ¥de divisjon D&V og Fylkeskommuner knyttet til driftskontrakter. Kan vi belyse hva et slikt Ã¸nske/behov vil innebÃ¦re?

Â 

*LÃ¸sning:*

Segmenterer vegnettet bare pÃ¥ aktive kontrakter og riksvegruter. BÃ¥de de som ikke har sluttdato og de som har sluttdato satt fram i tid. Segmentene fra vegnettet blir igjen brukt ved segmentering av vegobjekter, sÃ¥ det vil fÃ¥ effekt for antall segmenter pÃ¥ bÃ¥de vegnett og vegobjekter.

Det ser ut til Ã¥ ha en merkbar effekt. -For bÃ¥de vegnett og vegobjekt (type 105) utgjÃ¸r det ~1/3 fÃ¦rre dokumenter i solr.-Â NÃ¥r vi tar med de som har sluttdato satt fram i tid blir ikke resultatet like bra for vegnett, men fortsatt merkbart:

Etter siste endring viser test i UTV:

Antall vegnett-segmenter fÃ¸r:Â 10861319 etter:Â 8981518

Antall segmenter for vegobjekt av type 105 fÃ¸r:Â 3352620 etter:Â 2215249

Antall segmenter for vegobjekt av type 95 fÃ¸r: 7398499 etter: 2968546

Â 

Â 

Â ",NVDB-6937,NVDB-IND,
Ratelimiter - begrensning pÃ¥ 50 kall/sekund - bruk av klient-id som nÃ¸kkel i stedet for ip-adresse,"Mail fra Triona:

Â 

Â 

SINUS infra, SINUS entreprenÃ¸r og SINUS photo kjÃ¸res pÃ¥ Azure. Alle kall fra klientene (de ulike brukerne) gÃ¥r via applikasjonen pÃ¥ Azure. Og alle kallene videre til NVDB kommer fra samme IP-adresse. Her ser vi et potensielt problem nÃ¥r trafikken blir stor. Er det slik at dere, nÃ¥r det er kjent at en IP-adresse gjelder for en hel applikasjonsfamilie (f.eks. SINUS), kan skalere begrensningen pÃ¥ antall kall pr. sekund til en hÃ¸yere verdi? For vi antar at begrensningene er satt med tanke pr. bruker, ikke pr. applikasjon(sfamilie).",NVDB-6937,Les-API,
GUI: Feil URL til API i PROD,"Veglister feiler ved oppstart i PROD. Feil URL ved henting av omrÃ¥der.
Slik ser URL'en ut i de ulike miljÃ¸ene: * UTV:Â [https://nvdbrapportapi-veglister.utv.atlas.vegvesen.no/rapporter/omraader|https://slack-redir.net/link?url=https%3A%2F%2Fnvdbrapportapi-veglister.utv.atlas.vegvesen.no%2Frapporter%2Fomraader]
 * ATM:Â [https://nvdbrapportapi-veglister.test.atlas.vegvesen.no/rapporter/omraader|https://slack-redir.net/link?url=https%3A%2F%2Fnvdbrapportapi-veglister.test.atlas.vegvesen.no%2Frapporter%2Fomraader]
 * PROD:Â [https://nvdb-veglister.atlas.vegvesen.no/nvdbrapportapi-veglister.atlas.vegvesen.no/rapporter/omraader|https://slack-redir.net/link?url=https%3A%2F%2Fnvdb-veglister.atlas.vegvesen.no%2Fnvdbrapportapi-veglister.atlas.vegvesen.no%2Frapporter%2Fomraader]

Â 
PROD er feil",,Rapportgenerator,
GUI: Versjonere FronEnd-appene med package.json,"Versjon ""v1.1.0-RC1"" av front-end ble releaset med bruk av Git tag slik som det ble gjort fÃ¸r konsolidering av de tre applikasjonene i ett felles Git-repo.

Dette bÃ¸r endret slik at versjonen som stÃ¥r i de ulike appenes package.json er kriterie for versjonering.

Husk ogsÃ¥ Ã¥ oppdatere her: [https://www.vegvesen.no/wiki/display/NVDBogGeodata/Systemdokumentasjon+NVDB+Rapporter]Â nÃ¥r der endres.",,Rapportgenerator,
Kunne registrere nye dÃ¸tre til samme NVDB-mor pÃ¥ samme dag,"Simon StÃ¸lan Ã¸nsker Ã¥ kunne gjÃ¸re flere koblinger til samme mor pÃ¥ samme dag gjennom ulike registreringer. Dette gÃ¥r ikke i dag da det lages en ny versjon av mor nÃ¥r man legger til en datter og registrerer. Hvis NVDB-mor ikke er i kontrakten vil man ikke kunne legge til flere endringer med pÃ¥fÃ¸lgende endringer fÃ¸r det har gÃ¥tt en ekstra dag (kun en versjon kan opprettes pÃ¥ en og samme dag). Dette kan lÃ¸ses pÃ¥ ulike mÃ¥ter med f.ex Ã¥ ta inn NVDB-mor i kontrakten og behandle etterfÃ¸lgende registreringer som korrigeringer.

Fra Simon
{noformat}
Hei,Â 

Opplever at lÃ¸sningen er dÃ¥rlig tilpasset lagring ifbm ferdigstilling av tunneler.Â Det er da mye data som skal inn av ulike art, gjerne pÃ¥ samme dato. Og man har det travelt, fordi det nÃ¥ stilles strengere krav om oppdatert NVDB fÃ¸r sikkerhetsgodkjenning av tunnel.Â 

Det bÃ¸r pÃ¥ en eller annen mÃ¥te mulig Ã¥ lagre i flere operasjoner mot samme morobjekt pÃ¥ samme dato. Da slipper man omveien om NVDB123. En omveg som snart stenges... Objekttyper ferdigstilles fra entreprenÃ¸r og godkjennes av byggherre fortlÃ¸pende og i flere bolker per dag i sluttfasen fram mot sikkerhetsgodkjenning, slik at det ikke er naturlig Ã¥ lagre alle data i samme operasjon.Â 

SkjÃ¸nner at dette ikke lar seg lÃ¸se nÃ¥ i dag, men antar at det bÃ¸r vÃ¦re pÃ¥ plass en lÃ¸sning pÃ¥ dette fÃ¸r NVDB123 fases ut ? , i likhet med mye annet..
{noformat}
Mitt svar
{noformat}
Det er vel slik i dag at dersom du kobler objekter pÃ¥ en NVDB-mor (uten Ã¥ importere objektet inn i kontrakten) sÃ¥ vil denne NVDB-moren fÃ¥r en ny versjon. Og, som du egentlig sier, sÃ¥ fÃ¥r du ikke oppdatert versjon pÃ¥ et objekt flere ganger pÃ¥ samme dag. Men i ditt tilfelle her er det egentlig korrigeringer du gjÃ¸r pÃ¥ den nye versjonen du â€œhar startet pÃ¥â€. Korrigeringer kan gjÃ¸res mange ganger pÃ¥ samme objekt pÃ¥ samme dag. Vil det kunne hjelpe deg om du importerer NVDB-mor i kontrakten med operasjon â€œKorrigerâ€, for deretter Ã¥ jobbe videre med dette objektet? Da skal du kunne oppdatere objektet flere ganger, og mener at dette ogsÃ¥ gjelder nye assosiasjoner.

Men det â€œriktigeâ€ hadde da sikkert vÃ¦rt Ã¥ fÃ¥ laget en ny versjon av NVDB-mor som man etterpÃ¥ korrigerer med nye dÃ¸tre ettersom man jobber. Litt hazzle, men en kan tenke seg at man fÃ¸rst kobler en datter til NVDB-mor, registerer, deretter importerer denne NVDB-mor i kontrakten som â€œKorrigerâ€ og jobber videre. Dette er ikke en enkel arbeidsflyt.
{noformat}
Etter videre diskusjon pÃ¥ Mattermost oppsummerer HÃ¥vard en mulighet:Â Men det rimelige er vel Ã©n ny versjon, og sÃ¥ korrigering etterpÃ¥ for ett prosjekt. Den siste biten har vi ikke noen mÃ¥te Ã¥ oppdage i dag. Her ogsÃ¥ kunne det hjulpet Ã¥ importere mor ved kobling, da ville det ""gÃ¥ av seg selv"" med oppdater og korriger. Dessverre sÃ¥ er det en del jobb Ã¥ endre det.",NVDB-6937,Datafangst,
Vise hele vegsysmetreferanse for objekter,"Det kom inn en henvendelse pÃ¥ support fra Tina Vestersager
{noformat}
DriftsentreprenÃ¸rer og byggeledere trenger informasjon om strekning/delstrekning/meter pÃ¥ hvert vegobjekt. Dette gjelder bÃ¥de nye, redigerte og objekt som er importert for lukking.
{noformat}
Jeg svarte fÃ¸lgende
{noformat}
PÃ¥ det andre punktet sÃ¥ tenker du at vi i tillegg til Ã¥ vise vegkategori/fase/vegnummer ogsÃ¥ bÃ¸r vise strekning/delstrekning/meter i datafenen? 

Dette vil vi i sÃ¥fall klare for eksisterende NVDB-objekter som er importert (til endring/korreksjon/lukking), men det er litt verre for nye vegobjekter fÃ¸r de er indeksert i API Les - og for NVDB-objekter som fÃ¥r ny stedfesting. Datafangst vil ha et forhold til stadfestingen (posisjon@veglenkesekvens-id), men ikke hvilken vegsystemreferanse denne fÃ¥r etter indeksering. Med forbehold om at jeg ikke sier noe galt om hva som kan oppnÃ¥s gjennom API Skriv (i samarbeid med API Les), sÃ¥ mÃ¥ dette legges inn som et Ã¸nske om at denne tillegsinformasjonen legges til i respons fra API Skriv nÃ¥r vi gÃ¥r over til kun Ã¥ bruke stedfesting gjennom API Skriv.
{noformat}
Tina svarer da videre at det vil vÃ¦re en god begynnelse om man ser det for eksisterende objekt.

Â 

Jeg har hÃ¸rt med Tore om dette vil kunne vÃ¦re mulig gjennom stedfestingsfunksjonen til API Skriv. Tore mener at dette muligens kan lÃ¸ses gjennom informasjonen fra API Les. Tore sier videre
{noformat}
Skriv optimaliserer den segmenterte ruten fra Les, sÃ¥ om dette skal med i responsen fra Skriv, blir det som en separat liste per vegobjekt, ikke en vegsystemreferanse per stedfestingselement. Lag en sak, sÃ¥ kan jeg analysere og drodle litt.
{noformat}
Vi bÃ¸r fÃ¸rst ta en runde i Datafangst hvordan vi skal kunne lÃ¸se dette. Noen objekter vil jo ha en vegreferanse som bestÃ¥r av flere deler. F.exÂ [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/5/963759499/3]Â som har delene
{noformat}
EV6 S73D1 m3693-3788
EV6 S74D1 m0-1957
EV6 S74D1 m1957-2062
{noformat}
Og det finnes ""verre""",NVDB-6937,Datafangst,
Stedfesting med Skriv kan ikke brukes pÃ¥ anleggsveg,"Jeg prÃ¸ver Ã¥ stedfeste med Skriv med data fra NVDB-5664, den antenna som er mÃ¥lt inn som kurve. FÃ¥r feil om at ingen rute ble funnet, og grunnen er at vi ikke sender riktig fase til Skriv.

Vi sender fÃ¸lgende spÃ¸rring: https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/stedfest?maksimumAvstandTilVeg=300&vegnummer=6&vegkategori=E&typeVeg=ENKEL_BILVEG&fase=V

Siste query-parameter ""fase"" skulle vÃ¦rt ""A"" her i stedet. Fase er nÃ¥ hardkodet til ""V"", siden det var litt vanskelig Ã¥ navigere den miksen av vegstatuser som var i bruk, se linje ~249 i DefaultNvdbWriteApiGateway. Vi mÃ¥ se pÃ¥ en mÃ¥te Ã¥ fÃ¥ med fase pÃ¥ fra de dataene vi har.",NVDB-6937,Datafangst,
StÃ¸tte for punktstedfesting med stor geometri,"h2. Observasjon

Simon StÃ¸lan prÃ¸ver Ã¥ lagre Antenne. Da fÃ¥r han en NPE. Vedlagt er SOSI. Dette er reprodusert i df-test:Â [https://datafangst-test.kantega.no/#!/contract/f4d883fe-2992-4fee-925b-5ec93f2223db/export]

[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.10-2020.06.18/doc/?id=kx9kxnIBVuR5ZJBULewW]

Original kontrakt:Â [https://datafangst.kantega.no/#!/contract/16724ec7-a5a4-455a-9a2b-b1baf1b94d8a/export]
h2. Analyse

Problemet her er at Datakatalogen krever at Antenne stedfestes som punkt, men Antennen som skaper problemet har en lang linje-geometri.

Vi kommer bort i 2 problemer, som tilsammen har skapt problem-situasjonen som Simon har havnet i.

Det fÃ¸rste problemet opptrer som fÃ¸lger: NÃ¥r Antennen sendes til stedfesting, sjekker Localizeren med Datakatalogen hva slags stedfesting som kreves, finner at det er Punkt, og sender antennten videre til punktstedfesting. Punktstedfesteren sender et sÃ¸k til VVI, men siden antennen har en lang linjegeomtri blir sÃ¸keomrÃ¥det stÃ¸rre enn det VVI stÃ¸tter. Her sendes det tilbake en dÃ¥rlig ""Noe gikk galt""-feilmelding, istedet for Ã¥ forklare hva som er problemet. Her burde vi ha laget en bedre feilmelding, men det er relativt sjeldent at lange linje-geometrier skal ha punkt-stedfesting, sÃ¥ vi har ikke snappet opp den fÃ¸r. Riktig feilmelding fikses enkelt.

Det andre problemet er at Simon, som god forvalter, prÃ¸ver en annen metode for stedfesting nÃ¥r den fÃ¸rste feiler. Han stedfester med ankerpunkter. Og det gÃ¥r utmerket. Ankerpunkt-stedfesting bruker ruteplanleggeren til VVI istedet for sÃ¸k, og finner stedfestinger langs hele vegstrekket. Det burde den derimot ikke gjÃ¸re, for det er en kjent begrensning at ankerpunktstedfesting ikke skal stÃ¸tte punkt-stedfestinger. Ankerpunkt-stedfesteren skal avvise punkt-stedfestinger med en forklarende feilmelding, men den sjekker bare om geometrien til objektet er et punkt, ikke hva slags stedfesting datakatalogen krever. siden antennen er en strekning, blir ikke stedfestingen avvist, men gÃ¥r gjennom som om det var en linje-stedfesting. NÃ¥r Simon da prÃ¸ver Ã¥ lagre til Skriv, blir den avvist, fordi stedfesingen ikke er et punkt. Riktig feilmelding fra Ankerpunkt-stedfesteren fikses lett. SÃ¥ da koker det ned til hovedproblemet, som er at Datafangst ikke har god nok funksjonalitet for Ã¥ stedfeste strekningsobjekter som punkt.
h2. Â Implementasjon

stedfesting med ankerpunkter avvises nÃ¥ hvis Datakatalogen krever punkt-stedfesting

Punktstedfesteren har nÃ¥ en fallback som lager sÃ¸keomrÃ¥de for VVI, basert pÃ¥ objektets senterpunkt. Vi finner senter i objektet og lager et sÃ¸keomrÃ¥de basert pÃ¥ det. En utfordring med Ã¥ bruke senter som utgangspunkt er at senteret kan ligge langt unna veien, noe som er relativt sannsynlig nÃ¥r man har lange objekter med buet form langs en vei. For Ã¥ sÃ¸rge for at vi finner noe nÃ¥r senter ligger langt utenfor veie, utvider vi sÃ¸keomrÃ¥det til nÃ¦r maks av det VVI stÃ¸tter.

Projisering mellom stedfesting og locational er ogsÃ¥ skrevet om, siden senterposisjonen ikke ligger pÃ¥ objektet. Vi blir derfor nÃ¸dt til Ã¥ finne det punktet pÃ¥ objektet som lilgger nÃ¦rmest stedfestingen og lage en projisering mellom dem.

Â 

Â 

Â 

Â ",NVDB-6937,Datafangst,
Bruk fylke i SolrspÃ¸rring,"NÃ¥r det spÃ¸rres etter fylke=X blir dette til solrsÃ¸k municipality:(1 OR 2 ...), her kunne vi brukt county:X",NVDB-6937,Les-API,
Avvelge objekt etter godkjenning av stedfesting,"En bruker (Tina Vestersager) Ã¸nsker at objekter man godkjenner stedfestingen til skal automatisk ble deaktivert.
{noformat}
Etter stedfesting.. hvis man velger Â«godkjenn valgte stedfestingerÂ» tenker jeg at valgte objekt automatisk burde settes som ikke valgt. NÃ¥ man finne dem i lista og deaktivere eller klikke pÃ¥ dem i kartet.
{noformat}",NVDB-6937,Datafangst,
API-import fjerner mellomrom pÃ¥ slutten av attributtverdier,"h2. Observasjon
Supportmail fra Sigmund i Triona, de fÃ¥r problemer med Ã¥ importere skiltplater med enkelte typer. Det er 723.12 og U724.1r, og det disse har felles er at de i datakatalogen per i dag har et mellomrom pÃ¥ slutten av verdien. Mellomrommet blir fjernet ved import, noe som igjen  gjÃ¸r at Skriv ikke klarer Ã¥ matche dette til en gyldig attributtverdi.

h2. Analyse
Vi kjÃ¸rer en trim() pÃ¥ attributtverdier ved import, det er problematisk nÃ¥r vi er avhengig av at verdier matcher eksakt det som er i Datakatalogen.

h2. Forslag til lÃ¸sning
Fjern de to trim()-kallene i GeoJsonNvdbDocumentConverter.",NVDB-6937,Datafangst,
Driftskontrakt V4 feiler pga stÃ¸rrelse,"Driftskontrakt: 9305 Sunnfjord, V4 feiler pga stÃ¸rrelse.

74 tables, and a total of 36.645 lines (avg. 495 lines/table)

KjÃ¸ringen blir hengende pÃ¥ generering av Excel-fil.

Tabellen som det stopper opp pÃ¥ harÂ 3393 linjer!

Fra loggen:

2020-06-16 15:40:48,214 INFO [no.veg.nvd.fil.FileCreatorTemplate] (Thread-8) writeContent driftskontrakt with 74 tables, and a total of 36645 lines...
2020-06-16 15:40:48,214 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginFile
2020-06-16 15:40:48,375 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 0: '3 - Skjerm' (500 lines)
2020-06-16 15:40:48,650 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 1: 5 - Rekkverk
2020-06-16 15:40:55,282 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 2: 7 - Gjerde
2020-06-16 15:40:55,918 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 3: 9 - Kantstein
2020-06-16 15:40:56,849 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 4: 14 - Rekkverksende
2020-06-16 15:40:58,726 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 5: 15 - Grasdekker
2020-06-16 15:40:59,128 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 6: 20 - Kantstolper/Refleks
2020-06-16 15:40:59,344 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 7: 21 - BrÃ¸ytestikk
2020-06-16 15:40:59,459 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 8: 22 - Ferist
2020-06-16 15:40:59,579 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 9: 24 - Skiltportal
2020-06-16 15:40:59,841 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 10: 25 - Leskur
2020-06-16 15:41:00,221 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 11: 26 - Lekeapparat
2020-06-16 15:41:00,450 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 12: 27 - Renovasjon
2020-06-16 15:41:00,766 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 13: 28 - UtemÃ¸bler
2020-06-16 15:41:00,958 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 14: 29 - StrÃ¸sandkasse
2020-06-16 15:41:01,090 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 15: 37 - Vegkryss
2020-06-16 15:41:01,372 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 16: 39 - Rasteplass
2020-06-16 15:41:01,554 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 17: 40 - Snuplass
2020-06-16 15:41:01,734 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 18: 42 - Kollektivknutepunkt
2020-06-16 15:41:01,924 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 19: 43 - ParkeringsomrÃ¥de
2020-06-16 15:41:02,057 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 20: 44 - Kontroll-/veieplass
2020-06-16 15:41:02,185 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 21: 45 - Bomstasjon
2020-06-16 15:41:02,342 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 22: 47 - Trafikklomme
2020-06-16 15:41:04,325 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 23: 48 - Fortau
2020-06-16 15:41:04,520 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 24: 49 - TrafikkÃ¸y
2020-06-16 15:41:04,765 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 25: 60 - Bru
2020-06-16 15:41:05,448 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 26: 62 - StÃ¸ttekonstruksjon
2020-06-16 15:41:08,442 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 27: 64 - Ferjeleie
2020-06-16 15:41:09,618 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 28: 65 - Bygning
2020-06-16 15:41:09,763 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 29: 66 - Skredoverbygg
2020-06-16 15:41:09,892 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 30: 67 - TunnellÃ¸p
2020-06-16 15:41:11,071 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 31: 72 - Bergsikring
2020-06-16 15:41:12,723 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 32: 78 - Lukket rÃ¸rgrÃ¸ft
2020-06-16 15:41:15,249 INFO [no.veg.nvd.fil.DriftskontraktExcelFileCreator] (Thread-8) writeBeginTable 33: 79 - Stikkrenne/Kulvert (3393 lines!)",NVDB-6827,Rapportgenerator,
Release alle komponenter og deploye til ATM og PROD,"* nvdb-rapport-api
To deployments (vanlig + egen dedikert for Veglister)
 * nvdb-rapport-gui
*Hvordan release nÃ¥ som alle tre front-end applikasjonene er i felles kodebase?*
Separate deployments for Veglister, Driftskontrakter og Kostra",,Rapportgenerator,
Automatisk zoom aktiveres etter geometriredigering,"h2. Observasjon

Deaktiver automatisk zoom i datafanen. Rediger geometri for et objekt (bruker spesifiserer at dette gjelder linje geometri, men gjelder generelt geometriendring). Da blir automatisk zoom aktivert igjen.

Bruker Ã¸nsker at valgene som er satt skal gjelde ogsÃ¥ etter geometriredigering, dvs at automatisk zoom som er dekativert bÃ¸r vÃ¦re deaktivert ogsÃ¥ etter geometriredigeringen.
h2. Analyse

mekanismen som resetter rediger-geometri-state resetter ogsÃ¥ feilaktig autozoom
h2. LÃ¸sning

Fjerner den biten av resetEditGeometryState som resetter autozoom.",NVDB-6937,Datafangst,
"Meterberegning, FV123","PÃ¥ FV123 er det et gap i meterverdier pÃ¥ lenkesekvens 971557 i punktetÂ 0.85531374

Â 

> INFO ;Road=FV123, StretchType=S, TopologyLevel=0, TrafficTypes=K
 > WARN ;Segment1.MeterGap;3014;971557;0,85309189;0,85531374;998217;998220;0;;F;V;123;;S;1;1;6838;6858;K;;;;2;1#2;;297391;6614011;130;297411;6614020;130;Gap=313,000m
 > WARN ;Segment2.MeterGap;3014;971557;0,85531374;0,85697188;998220;3088194;0;;F;V;123;;S;1;1;7171;7186;K;;;;2;1#2;;297411;6614020;130;297424;6614027;130;Gap=313,000m

Â 

*Analyse:*

De ekstra meterene kommer fraÂ [https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegobjekter/916/1003465802/1Â |https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegobjekter/916/1003465802/1]Â pÃ¥ grunn av dette lukkede vegsystemet:Â [https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegobjekter/915/1002103808/1]

Â 

*LÃ¸sning:*

Tar med start- og sluttdato for vegsystemet helt ut til sammenslÃ¥ingen, slik at det kan filtreres pÃ¥ dette for Ã¥ fÃ¥ riktige strekninger.",NVDB-6937,NVDB-IND,
Endringssett skriver ufullstendig turnextent til NVDB,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/1fe459af-fd6c-47cb-97e4-0594dbfee402 skriver inn en svingerestriksjon som mangler lenkesekvensid for til-punkt i NVDB:

NF_FV_0573_OF(NF_FEATUREVERSION_OT(1, '12-JUN-20', NULL, NULL, NULL), NN_TURNEXT
ENT_OT(100573, 92515, 50001, NN_REFLINKEXTENT_OT(100573, 72370, 50002, 0, 0, 0,
NULL, NN_REFLINKLOC_OT(.32645205), NULL), NN_REFLINKEXTENT_OT(100573, *NULL*, 5000
2, 0, 0, 0, NULL, NN_REFLINKLOC_OT(.44680832), NULL)), NULL, NULL)

h2. Analyse

I endringssettet registreres et vegobjekt av type Svingerestriksjon, der til-punktet i svingstedfestingen refererer til tempId for en veglenkesekvens som registreres i samme endringssett. Det ser ikke ut til at tempId erstattes med nvdbId fÃ¸r skriving til NVDB. Ved nÃ¦rmere analyse ser det ut til at Feature.populateNvdbIds er synderen. Her oppdateres ikke nvdbId for fra- og tilpunktene med mindre noden ogsÃ¥ er tempId.

h2. LÃ¸sning

Flytt hÃ¥ndteringen av tempId for fra- og tilpunkt til utenfor hÃ¥ndteringen av noden i Feature.populateNvdbIds",NVDB-6937,Skriv-API,
Integrasjonstester mot SVV NVDB,"Endre integrasjonstestene til Ã¥ kjÃ¸re mot SVV NVDB, i stedet for Triona NVDB",NVDB-6937,NVDB-IND,
Begrens antallet samtidige spÃ¸rringer til Solr,"I tillegg til ratelimit burde vi kanskje sette opp begrensning pÃ¥ hvor mange samtidige kall som skal tillates til Solr.
https://resilience4j.readme.io/docs/bulkhead kan brukes, eller et vanlig threadpool.",NVDB-6937,Les-API,
FÃ¸lgeoppdateringskonflikt ved sletting av datter i assosiasjon,"h2. Observasjon

Endringssettet https://www.test.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/0c5bc7de-99c2-4f38-b716-577114a0d632 avvises med valideringsfeil:


{code:xml}
<vegobjekt nvdbId=""1007893658"" versjon=""1"">
  <feil>
    <feil kode=""KONFLIKT_MELLOM_VEGOBJEKTER"">
      <melding>
        Kunne ikke fullfÃ¸re fÃ¸lgeoppdatering i forbindelse med lukking av morlÃ¸se vegobjekter: Oppdatering av vegobjektversjon 1007893658:1 av type 95 med startdato 2020-05-05 fÃ¸rer til ugyldig lukking av vegobjektversjon 1007893718:1 av type 96 som har startdato (2020-05-12) etter/lik fÃ¸rstnevntes startdato.
      </melding>
    </feil>
  </feil>
</vegobjekt>
{code}

h2. Analyse

APIet protesterer fordi slettingen av datterobjektkoblingen i det skiltpunktet som oppdateres (overskrives), skaper en fÃ¸lgeoppdatering under behandling. FÃ¸lgeoppdatering bestÃ¥r i Ã¥ lukke datterobjektet (kan ikke eksistere uten morobjekt), men siden startdato for datterobjektet er etter startdato for morobjekt, skulle datterobjektet egentlig vÃ¦rt fjernet. En svakhet i API Skriv, altsÃ¥. 

h2. LÃ¸sning

Ingen kodeendringer i for denne saken. Dette fikses ved Ã¥ realisere et gammelt endringsÃ¸nske: NVDB-4058.",NVDB-6937,Skriv-API,
Opprydding i permissions,"NB! Database-script: Ny rettighet
 * egen permission for Ã¥ se kontraktgruppeadmin
 * Erstatte wildcard med egnet, navngitt metode
 * Fjerne metode som lÃ¸fter enkelte permissions ut av scope
 * refaktorer permissions
 * I contract settings blir CONTRACTGROUP:REMOVE ikke gitt riktig fordi UserSession ikke er lastet nÃ¥r permission sjekkes
 * Permissions-endepunktet lister unÃ¸dig ut duplikate permissions
 * Bare brukere med global comment-rettigheter fÃ¥r lage nye kommentarer
 * hasPermission() er implementert 3 ganger, i 2 forskjellige permissionResolvere og i securityService. Fjerner og refaktoriserer slik at bare UserSession.hasPermission finnes
 * Flere enhetstester for permissions",NVDB-6937,Datafangst,
/veg med vegsysref kan gi detaljerte lenker,"Her blir av og til detaljerte lenker returnert:

[https://www.vegvesen.no/nvdb/api/v3/veg?vegsystemreferanse=EV18S50D1m1100]

Â 

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@247592,6645337,17/vegnett:~'metrering+~()/vegsystemreferanse:247572.285:6645318.651]",NVDB-6937,Les-API,
Vegkart: Liten og stor bokstav for meter,"I vegnettshÃ¥ndboka og i lese-apiet, sÃ¥ skrives fullstendig vegsystemreferanse sin ""m"" for meter med liten bokstav slik: *EV16 S1D1 m942*. Dette gjÃ¸res ogsÃ¥ nÃ¥r du peker pÃ¥ et punkt i Vegkart. NÃ¥r du lister opp objekter i Vegkart, sÃ¥ har ""m"" blitt til ""M"". Ingen stor sak, men dette skal helst vÃ¦re likt. (Vi har faktisk fÃ¥tt spÃ¸rsmÃ¥l om dette.)",NVDB-6937,Vegkart,
NVDBREF-688 : Feil visning av sÃ¸keutvalg,"Jeg Ã¸nsker Ã¥ se trafikklommer pÃ¥ RV83S1-2, og sÃ¸ker opp dette.
 Etter Ã¥ ha trykket pÃ¥ ""enter"" kommer stedsanvisning: RV83 S1 opp. Det kommer altsÃ¥ ikke fram i sÃ¸kefeltet at jeg har data for S2 ogsÃ¥.

Jeg fÃ¥r altsÃ¥ opp trafikklommene for bÃ¥de S1 og S2, men S2 mangler i stedsangivelsen. Se vedlagt bilde.

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@565032,7622045,9/hva:~(~(id~47))/hvor:~(vegsystemreferanse~(~'RV83S1-2]))",NVDB-6937,Vegkart,
NVDBREF-694: PrÃ¸veinnsjekk skal kjÃ¸re alle kontroller uten Ã¥ stoppe,"h2. Bakgrunn

Innspill fra Linda:

Ved prÃ¸veinnsjekk av et vegnettsprosjekt stoppes dette nÃ¥r valideringen finner fÃ¸rste feil. Dette betyr at brukeren mÃ¥ starte prÃ¸veinnsjekket mange ganger for til slutt Ã¥ ha avdekket alle feil og mangler. Det er derfor Ã¸nskelig at nÃ¥r prÃ¸veinnsjekket finner en feil, sÃ¥ logges denne, og sÃ¥ gÃ¥r prÃ¸veinnsjekket videre til alle valideringer er kjÃ¸rt.

Vi kan jo komme i situasjoner der en feil gir fÃ¸lgefeil pÃ¥ ""noe annet"" uten at ""dette andre"" egentlig er feil. F.eks. kan feil i nettverket gjÃ¸re at det ogsÃ¥ vil meldes feil i objekter - som altsÃ¥ ikke vil vÃ¦re feil nÃ¥r nettverket blir fikset. For Ã¥ unngÃ¥ at brukeren fÃ¥r mange meldinger pÃ¥ feil som egentlig ikke er feil, kan det vÃ¦re en lÃ¸sning at alle nettverksvalideringer (inkludert geometrivalideringer) kjÃ¸res ferdig, og dersom det er feil i nettverket, sÃ¥ samles disse opp og prÃ¸veinnsjekket stoppes. SÃ¥ kan brukeren rette feilen(e), og starte prÃ¸veinnsjekk pÃ¥ nytt. NÃ¥r det ikke er feil pÃ¥ nettverket, sÃ¥ valideres objektene, og alle feil pÃ¥ disse logges. Om vi ogsÃ¥ her kan komme i situasjoner der en feil gir fÃ¸lgefeil pÃ¥ noe annet som ikke er feil klarer jeg ikke helt Ã¥ se for meg. Det bÃ¸r vi tenkte nÃ¸ye igjennom.

SÃ¥ er jo spÃ¸rsmÃ¥let om dette programmessig lar seg gjennomfÃ¸re? Det mÃ¥ vel Tore EA svare pÃ¥.Â 

h2. Analyse

Dette er beslektet med NVDB-5271 (rullet ut i slutten av april), der pipelinen for valideringsendepunktet, DataQualityOnlyPipeline, ble justert til Ã¥ fullfÃ¸re flere valideringer, selv om det ble avdekket feil. Det ble realisert ved at JobFeatureFilters ikke avbryter kjÃ¸ring av feature filtere fÃ¸r alle filtere er kjÃ¸rt pÃ¥ alle features. FÃ¸r ble valideringen avbrutt etter fÃ¸rste FeatureFilter-instans som fant feil. I tillegg ble det parametrisert hvorvidt pipelinen skulle avbrytes ved feil etter hver instans av JobFeatureFilters. Justeringen internt i JobFeatureFilters kom oss ogsÃ¥ tilgode i BeforeLockingPipeline som brukes ved vanlig behandling av endringssett. Siden april har derfor prÃ¸veinnsjekk funnet flere feil fÃ¸r valideringen ble avbrutt.

Det er 100% umulig Ã¥ fÃ¥ til et prÃ¸veinnsjekk som avdekker alle feil. Det er mange valideringsfiltere som kontrollerer grunnleggende ting som at typeId pÃ¥ vegobjekter og egenskaper finnes i datakatalogen, historikken til vegobjekter er sammenhengende og uten hull, og at vegnett henger sammen topologisk via portkoblingene og at portnummere og veglenkenummere er unike. Dersom disse grunnleggende valideringene finner feil er det helt meningslÃ¸st Ã¥ fortsette med annen validering fordi vi vil fÃ¥ potensielt mange misvisende eller pussige feil (i verste fall systemfeil, fordi etterfÃ¸lgende validatorer forutsetter at grunnstrukturer er korrekte) som bare vil forvirre brukeren.

Foranledningen for saken var at en bruker opplevde at valideringen av gatenavn og -kode bare leverte delvis oversikt over feil. Det stemmer ikke. Denne valideringen gÃ¥r gjennom samtlige Gate-objekter, fÃ¸r pipelinen evt. avgjÃ¸r om videre validering skal avbrytes.

h2. LÃ¸sning

Bygget om mekanismene for avbrudd. Feil fÃ¸rer ikke lenger til automatisk avbrudd uansett hvor de oppstÃ¥r. Det er de ulike filtrene sitt ansvar Ã¥ kalle ValidationResult.abortProcessing() dersom en feil anses Ã¥ vÃ¦re sÃ¥ grunnleggende at videre validering er meningslÃ¸s. Dette anropet ble fjernet fra en del filtere som ikke tilfredstilte dette kriteriet. Gjorde en del endringer i ulike iteratorfiltere (f.eks. JobFeatureFilters og FeatureAttributeFilters)for Ã¥ gjennomfÃ¸re avbrudd basert pÃ¥ ValidationResult.isProcessingAborted() i stedet for Ã¥ se om det har oppstÃ¥tt feil.
",NVDB-6937,Skriv-API,
Synkronisere standard FKB objektliste i Datafangst med seneste Excel-objektliste,"h2. Observasjon

Sak er utledet fra en support-dialog med Tanja Molland Caliskaner (Tanja.Jeanette.Molland.Caliskaner@vlfk.no).

Objektlista i et nytt prosjekt er ikke den samme som seneste versjon av objektliste fra Excel for FKB-objekter. Objektliste fra Excel oppdateres (potensielt) hver gang det kommer en ny datakatalog. Det er mulig for bruker Ã¥ importere objektliste fra Excel, og mange prosjekter gjÃ¸r ogsÃ¥ tilpassinger i sin objektliste fÃ¸r de laster opp.

Utvides til Ã¥ ogsÃ¥ omfatte problemer etter support-dialog med Anne Kirsti Tryggestad. Hun opplever at avkrysninger i excel-dokumentet ikke gir samsvar med det som vises i datafangst etter opplasting av excel, for FKB-objekter. Legger ved skjermbilder som viser excel-filen og datafangst etter import.
{quote}*Espen:*
 Ok. tolker jeg det riktig som at det ikke er samsvar med det som er haket av i excel-fila og det som blir haket av i datafangst?

og mer spesifikt at det er FKB-objekter det gjelder?
 eksempelvis sÃ¥ burde ikke FKB-objektene KjÃ¸rebanekant og Vegskulderkant vÃ¦re haket av i Datafangst siden de ikke er det i excel-lista?

*Anne:*
 Korrekt
{quote}
!image003.jpg|thumbnail!
h2. Analyse

Det er mulig at vi gir bruker et standardvalg (utdatert avkrysset objektliste) som ikke gir sÃ¥ mye mening for FKB. For NVDB-objekter leser vi oppdatert liste fra Datakatalogen, sÃ¥ disse trenger ikke noen synkronisering.
h2. Forslag til lÃ¸sning

En mulighet er Ã¥ prÃ¸ve Ã¥ vÃ¦re i sync med siste FKB objektliste pÃ¥ Excel, da mÃ¥ vi ha en rutine pÃ¥ Ã¥ sjekke den hver gang det kommer ny versjon av datakatalogen.

En annen mulighet er Ã¥ ikke ha valgt noe som default, sÃ¥nn at bruker alltid mÃ¥ inn og laste opp riktig objektliste. Dette vil i sÃ¥ fall (tror jeg) bare vÃ¦re relevant for visse kontraktstyper.

Valg av lÃ¸sning her bÃ¸r gjÃ¸res i samrÃ¥d med brukerne.",NVDB-6937,Datafangst,
FKB vegobjekttyper vises i feil rekkefÃ¸lge i objektliste,"h2. Observasjon
Supportsak fra Tanja Molland Caliskaner (Tanja.Jeanette.Molland.Caliskaner@vlfk.no). Saken starter med at hun ikke fant igjen noen FKB-typer etter Ã¥ ha importert objektliste fra Excel. Etter litt dialog viser det seg at de etterlyste typene er der, men de beholder ikke rekkefÃ¸lge som er i Excel-dokumentet. Vi bevarer rekkefÃ¸lge for alle NVDB-typer, men bare noen FKB-typer. Eksempel pÃ¥ FKB-typer som ikke kommer pÃ¥ riktig sted er kjÃ¸refelt, kjÃ¸rebane og sykkelvegsenterlinje.

h2. Analyse
Vi har ikke noen kobling til en FKB-datakatalog, men vi har kjente typer i database. Der har vi ogsÃ¥ et sorteringsnummer, sÃ¥ jeg antar at det kun er snakk om Ã¥ legge til nye kjente typer, og sette sorteringsnummer riktig.",NVDB-6937,Datafangst,
Endringssett avvises pga datter utenfor mor,"h2. Observasjon

Triona hevder at endringssettet https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/6e8d39a8-809e-45e0-8a69-0c1579024ec4 skal gÃ¥ gjennom uten valideringsfeil. Det avvises imidlertid pga fire tilfeller av STEDFESTING_UTENFOR_MOROBJEKT.

h2. Analyse

Endringssettet inneholder delvis korrigering av et skiltpunkt (id 203117542 versjon 8) og tilhÃ¸rende datterobjekter av type skiltplate og systemobjekt. Det avvises med feilkode STEDFESTING_UTENFOR_MOROBJEKT pÃ¥ datterobjektene.

Hvis vi ser nÃ¦rmere pÃ¥ systemobjektet som korrigeres, sÃ¥ har dette id 487519680, versjon 1 og gyldighetsperiode 2014-02-25 ->

Morobjektet er skiltpunkt med id 203117542. I endringssettet korrigeres kun versjon 8 med gyldighetsperiode 2018-12-03 ->. Feilmeldingen er imidlertid knyttet til versjon 6 av skiltpunktet som har gyldighetsperiode 2014-02-25 - 2015-01-22. Denne versjonen har ogsÃ¥ assosiasjon til systemobjektet, men har ikke matchende stedfesting. Selv om det ikke meldes i status for endringssettet har vi samme situasjon for versjon 7.

Jeg mener det er korrekt Ã¥ avvise endringssettet da det er versjoner av morobjektet som har overlappende gyldighetsperiode med datterobjektet men avvikende stedfesting. For Ã¥ fÃ¥ dette endringssettet gjennom mÃ¥ det utvides med korrigering av stedfestingen til versjon 6 og 7 av skiltpunktet i tillegg.
",NVDB-6937,Skriv-API,
RuntimeException ved beregning av sideposisjon,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/b6f8a6ad-2b0d-44e1-8ac4-23771c211d08 avbrytes med SySTEMERROR under beregning av original sideposisjon ved restedfesting etter oppdatert vegnettsgeometri:

{code:java}
java.lang.RuntimeException: Failed to get line segmenet from locational. Locational part size: 0
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.lineSegmentFromPosition(SidePositionCalculator.java:153)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.calculateSidePositionForPointLocational(SidePositionCalculator.java:111)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.calculateSidePosition(SidePositionCalculator.java:99)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.compareSidePositions(SidePositionCalculator.java:85)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.compareUpdatedSidePositionToOld(SidePositionCalculator.java:55)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.compareUpdatedSidePositionToOld(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:609)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.postProcessApprovedRelocalization(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:566)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.lambda$addEnrichmentOrReportConflict$15(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:511)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.enrichment.EnrichmentEvaluator.evaluate(EnrichmentEvaluator.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.addEnrichmentOrReportConflict(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:548)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.doFilter(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:160)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:132)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:392)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:162)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:136)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

RunbtimeException kastes fordi det ikke lykkes Ã¥ finne en original refLinkPart for posisjon 0.84231232 (refLink 443409) som er gyldig pÃ¥ vegobjektets (87/628784632/1) sluttdato, 2016-12-14.

h2. LÃ¸sning

I stedet for Ã¥ bruke sluttdato, som er ikke-inklusiv, brukes sluttdato - 1 dag i SidePositionCalculator.compareUpdatedSidePositionToOld. Dette sikrer at de korrekt refLinkParts finnes igjen.",NVDB-6937,Skriv-API,
Universell utforming smÃ¥ting ,"*Tips universell utforming:*Â 
 * Kunne bruke mellomrom til Ã¥ velge fra liste
 * Kalenderikon bÃ¸r ha alt-tekst ""Kalender: Velg gyldighetsdato for uttak fra NVDB""
 * I dag tabber man forbi ""velg rapport""-knappen nÃ¥r den er inaktiv. Kanskje den burde vÃ¦re med i tab-rekkefÃ¸lgen, men inaktiv. GjÃ¸r det mer intuitivt at man mÃ¥ utfÃ¸re flere handlinger fÃ¸r denne knappen blir aktiv.Â 
 * Det var litt lite intuitivt hva vegfilter - tekstboks skulle brukes til. Ingen gode lÃ¸sningsforslag.Â 

Â 

Â ",NVDB-6827,Rapportgenerator,
nvdb-read-api-v3-client: DatakatalogClient.getFeatureType(s) feiler,"DatakatalogClient's metoder getFeatureTypes ogÂ getFeatureType feiler med:

Error setting etag for /vegobjekttypernull: java.nio.file.NoSuchFileException: ?/.nvdb-api-read-v3/_vegobjekttypernull.etag

Versjon 1.8.4

Se log",,Rapportgenerator,
Alfabetisk sortering i admingrensesnitt for kontraktsgrupper,"Noen kontraktgrupper har veldig mange kontrakter. Det hadde vÃ¦rt kjekt Ã¥ fÃ¥ sortert disse alfabetisk. 

Andre lister i admin-grensesnittet for brukere og kontraktsgrupper bÃ¸r ogsÃ¥ sorteres alfabetisk for Ã¥ vÃ¦re navigerbare.",NVDB-6937,Datafangst,
Sosikontroll av FKB-data,"Mail til datafangst-support
bq. Den 10.06.2020 10:03, skrev Espen Refsdal Thiem:
bq. Hei. 
bq. 
bq. Hvorfor har dere ikke integrert en sosikontroll av FKB-data pÃ¥ samme mÃ¥te som for NVDB?
bq.  
bq. Mvh
bq. Espen Refsdal Thiem
bq. 
bq. Vestland Fylkeskommune, Infrastruktur og veg, Geodata
bq. Mobil: +47 41844169 
bq. Epost: espen.refsdal.thiem@vlfk.no
",NVDB-6937,Datafangst,
Tydeligere feilmelding ved multiple operasjoner pÃ¥ samme nvdbId-versjon,"h2. Bakgrunn

Et endringssett fra NovaPoint inneholdt bÃ¥de lukking og delvis korrigering av samme vegobjekt (identisk nvdbId og versjon). Dette ble avvist ved mottak via 400 BAD REQUEST og fault message ""MÃ¥ vÃ¦re unik: nvdbId+versjon"". Dette er litt for knapt til at brukeren forstÃ¥r hva som er problemet. Som et minimum mÃ¥ den konkrete nvdbId- og versjonsverdien angis.

h2. Analyse

Feilmeldingen stammer fra UniqueNvdbIdVersionValidator.

h2. LÃ¸sning

Introduserer skreddersydde feilmelding via expression properties i Hibernate Validation. Expression properties inneholder liste med id'er med duplikater. SkreddersÃ¸mmen hÃ¥ndteres av ny klasse ConstraintViolationReporter.",NVDB-6937,Skriv-API,
Noen store meteravvik,"Sammenlignet med prod er det kommet noen store meteravvik vi mÃ¥ undersÃ¸ke:

Â 

Segment nummer 15, fra lenke nummer 17 (""startposisjon"":Â 0.26205316,""sluttposisjon"":Â 0.26306464) har rar meterverdi, starter pÃ¥ 0 igjen.

[https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/1125774]

[https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:topo4/@707204,7712581,18/vegnett:~'geometri+~()/valgt:1125774:17:15/vegsystemreferanse:707198.993:7712573.409]

Strekning:Â [https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/vegobjekter/916/1004695694/1]

Â 

Andre eksempler pÃ¥ andre som kanskje er relatert:

WARN ;Segment1.MeterGap;5426;1126292;0,98023146;1;2834165;1259957;0;;E;V;6;;S;186;1;2333;2545;K;;;;2;1#2;;722173;7721645;18;722345;7721768;10;Gap=5627,865m
 WARN ;Segment2.MeterGap;5426;1126293;0;0,00958931;1259957;2834184;0;;E;V;6;;S;186;1;8173;8257;K;;;;2;1#2;;722345;7721768;10;722421;7721803;10;Gap=5627,865m

WARN ;Segment1.MeterGap;5426;1126293;0,47903275;0,48620153;2834173;2314049;0;;E;V;6;;S;186;1;6148;6212;K;;;;2;1#2;;726125;7720491;4;726185;7720472;4;Gap=6227,293m
 WARN ;Segment2.MeterGap;5426;1126293;0,48620153;0,59880558;2314049;2834174;0;;E;V;6;;S;186;1;12439;13427;K;;;;2;1#2;;726185;7720472;4;727030;7719967;6;Gap=6227,293m

WARN ;Segment1.MeterGap;4621;805598;0,31058791;0,31695888;2787308;2398686;0;;E;V;16;;S;10;60;2017;2071;K;A;;;2;1#2;;30543;6752137;50;30491;6752124;51;Gap=519,664m
 WARN ;Segment2.MeterGap;4621;2398663;0;0,50987059;2398686;2398682;0;;E;V;16;;S;10;60;2591;2670;K;A;;;2;1#2;;30491;6752124;51;30437;6752069;51;Gap=519,664m

Â 

*LÃ¸sning:*

Perioden til det aktuelle vegsystemet for segment blir brukt for Ã¥ hente strekninger fra cache. HÃ¥ndterer strekninger som overlapper med flere vegsystemobjekter i tid, slik at strekningsmeteren bare blir tatt med en gang. Verifisert med integrasjonstester for noen av de tilfellene som ble rapportert.

Â ",NVDB-6937,NVDB-IND,
"teksten ved feltet ""legg til bruker"" burde vises hele tiden","PÃ¥ Instillinger, under Tilknyttede brukere, nÃ¥r du skal legge til en ny bruker kommer ikke teksten ""SVV-brukernavn eller e-postadresse mÃ¥ oppgis"" opp fÃ¸r du har gjort noe feil.

Legg gjerne til at det ikke er noen evaluering av epostadresse eller sjekk av at brukeren finnes, sÃ¥ folk mÃ¥ sjekke at de har skrevet brukernavn og/eller epost riktig",NVDB-6937,Datafangst,
"""Kopier til alle"" virker ikke nÃ¥r kvalitetsparametre er slÃ¥tt pÃ¥.","h2. Observasjon

aktiver ""vis kvalitets parametre"".

NÃ¥ er det ikke lenger mulig Ã¥ benytte funksjonene ""Kopier til alle"" med venner, i verktÃ¸ymenyen.
h2. Analyse

FocusedAttribute-selectoren tar ikke hÃ¸yde for kvalitetsparametre
h2. LÃ¸sning

focusedattribute-selectoren tar hÃ¸yde for kvalitetsparametre

Lagde et knippe enhetstester som tester focusedFeature og FocusedAttribute

Â 

Â ",NVDB-6937,Datafangst,
Tilpasse og rulle ut i Atlas (UTV),"* (/) Bytte kÃ¸type fra ""mirror"" til ""quorum"" i RabbitMQClient for bedre avbruddsikkerhet.
* (/) Etablere RabbitMQ-tjeneste i applikasjonsmiljÃ¸ ""utvikling"".
* (/) Etablere logging og loggaggregering i trÃ¥d med Atlas-standarder.
* (/) Etablerer datasources programmatisk i API Skriv om de ikke finnes ved JNDI-oppslag
* (/) Tilpasse API Skrivs web-konfig til alle scenarier: Jetty, Tomcat, Integrasjonstester, Live integrasjonstester osv
* (/) Etablere velv med brukernavn og passord for jobdb og nvdb.
* (/) Etablere datasource og miljÃ¸variable for de to databasene i deploymentbeskrivelse. 
* (/) Etablere velv med brukernavn og passord for soabasis.
* (/) Oppsett av pluginConfigDir, kontekststi m.m for Tomcat
* (/) Oppsett av Route, Probes og Resources
* (/) StÃ¸tte og konfigurere OpenIdConnect
* (/) Test",NVDB-6937,Skriv-API,
Fjern mulighet til Ã¥ kategorisere/filtrere pÃ¥ egenskaper med skjermede data,"NÃ¥r man prÃ¸ver Ã¥ filtrere pÃ¥ egenskaper med skjermede data, vil laster-indikatoren henge seg opp pÃ¥ grunn av 403-respons fra API-et.

 !Screenshot from 2020-06-03 08-51-38.png|thumbnail! 

Sjekk om det er mulig Ã¥ grÃ¥e ut eller fjerne de egenskapene som er merket som sensitive.",NVDB-6937,Vegkart,
Legg til meter for strekningsobjekter i kategoriresultater,"{panel:title=Fra mail:}

Hei

I versjon 2 fikk vi opp antall meter nÃ¥r vi kategorisert objekten. F.eks Vegreferanse sÃ¥ fikk hvor mange meter det var av hver kategori.

 !Picture (Device Independent Bitmap) 1.jpg|thumbnail! 

Har dette forsvunnet eller er det jeg som velger noe feil i den nye versjonen ?

 !Picture (Device Independent Bitmap) 2.jpg|thumbnail! 

Vennlig hilsen

Arne Henry Grottvik
Fagansvarlig Veg â€“ Idrett og Park
TysvÃ¦r kommune
Tlf 52 75 71 75 Mob. 901 46 683
E-post: arne.henry.grottvik@tysver.kommune.no


{panel}
",NVDB-6937,Vegkart,
Filopplasting feiler med exception fra SQL,"{quote}Tanja Jeanette Molland CaliskanerÂ <Tanja.Jeanette.Molland.Caliskaner@vlfk.no>
{color:#172b4d}Tue 2020-06-02 11:33Â {color}

{color:#172b4d}Hei!
{color}{color:#172b4d}Ser nÃ¥ at en del sosi-filer blir forkastet med flammetegn eller innkjÃ¸ring forbudt tegn etter opplastning, og det er bra! Men nÃ¥r det er flammer sÃ¥ er det ingen beskjed om hva som er feil. Har ingen eksempel Ã¥ vise til akkurat nÃ¥ da entreprenÃ¸r fikset det uten Ã¥ egentlig vite helt hvorfor filen ble akseptert til slutt. Da vi sÃ¥ pÃ¥ filoppbyggingen sÃ¥ sÃ¥ alt bra ut, men en kommentar om feil hadde vÃ¦rt topp.
{color}{color:#172b4d}Med vennleg hilsen
{color}{color:#172b4d}Tanja Molland Caliskaner{color}
{quote}
Â 

Last opp vedlagt fil,

Den feiler, og ""kontroll""-fanen sier at det er ""intern feil under behandling""

Loggen sier exception
{quote}at no.svv.nvdb.datafangst.database.DatabaseImpl.transactional(DatabaseImpl.java:111)at no.svv.nvdb.datafangst.database.DatabaseImpl.transactional(DatabaseImpl.java:111) at no.svv.nvdb.datafangst.orm.FeatureStorageImpl.saveFeatureValidationIssues(FeatureStorageImpl.java:413) at no.svv.nvdb.datafangst.submission.handler.GenericSubmissionHandler.saveFeatureValidationIssues(GenericSubmissionHandler.java:333) at no.svv.nvdb.datafangst.submission.handler.GenericSubmissionHandler.process(GenericSubmissionHandler.java:139) at no.svv.nvdb.datafangst.submission.SubmissionServiceImpl.lambda$createFeatureCollectionAsync$1(SubmissionServiceImpl.java:119) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Cannot add or update a child row: a foreign key constraint fails (`datafangst`.`validation_issue2`, CONSTRAINT `fk_vi2_feature_id` FOREIGN KEY (`feature_id`) REFERENCES `feature2` (`id`) ON DELETE CASCADE) at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
{quote}

h2. Analyse
Vegobjekter blir avvist (og dermed ikke lagret) etter validering mot Skriv, men fÃ¸r dette skjer sÃ¥ er det allerede lagret en advarsel fra SOSI-parsing som har en referanse til featureId. NÃ¥r den fÃ¸rste feilen skal lagres i databasen fÃ¥r vi da en referansefeil fordi feature ikke finnes.",NVDB-6937,Datafangst,
Vegkart krasjer konsekvent ved opplistning/visning av fagdata pÃ¥ enkelte rundkjÃ¸ringer,"Jeg har oppdaget et problem med Ã¥ hente data ved flere tilfeller. Dette ender ofte med et fullstendig krasj av vegkart og vi fÃ¥r et fint varselbilde om at vegkart har havnet i en ulykke. Under nÃ¦rmere undersÃ¸kelse sÃ¥ har jeg funnet ut at dette krasjer er forÃ¥rsaket av rundkjÃ¸ringer i vegnettet som har problemer med Ã¥ lese vegsystemreferansen.Â 

Her har dere link til hovedeksemplet mitt:

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-30953,6577346,16/hva:~(~(id~532)~(id~105)~(id~519))/hvor:~(vegsystemreferanse~(~'R13))]

[https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@-30953,6577346,16/hva:~(~(id~519)~(id~532)~(id~917))/hvor:~(vegsystemreferanse~(~'R13))]

Det virker som at det skjer et eller annet med tydingen av kryssdelen nÃ¥r rundkjÃ¸ringen er koblet med lenker som har adskilte lÃ¸p. Jeg har funnet to eksempler pÃ¥ forskjellige ""koblinger"" hvor dette er gjeldene.Â 

Hordaland:

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-38337,6732992,16/hva:~(~(id~532)~(id~105)~(id~519))/hvor:~(vegsystemreferanse~(~'F562))]

[https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@-38366,6732984,16/hva:~(~(id~917)~(id~519)~(id~532))/hvor:~(vegsystemreferanse~(~'F562))/valgt:1007884111:916]

Det som er interessant med hele denne saken, er at jeg har klart Ã¥ lÃ¸se problemet pÃ¥ et omrÃ¥de. I stavanger sÃ¥ har vi i vegnettet definert enkelte kryss i gang- og sykkelvegnettet som rundkjÃ¸ring. PÃ¥ et omrÃ¥de sÃ¥ lÃ¥ koblingspunktet til kryssystemet noen meter unna rundkjÃ¸ringen. Veglenka lÃ¥ heller ikke inne som rundkjÃ¸ring i NVDB. I NVDB vegnett sÃ¥ gikk jeg inn og flyttet pÃ¥ kryssystemet til rett lenke knutepunkt og rettet opp lenka fra GSvegsenterlinje til rundkjÃ¸ring. Plutselig kunne jeg nÃ¥ i PROD hente og liste opp data uten krasj. SÃ¥ det er mulig Ã¥ rette opp i det. Men hadde vÃ¦rt fint Ã¥ vite hva som egentlig fÃ¸rer til at dette er et problem:

GSrundkjÃ¸ring FÃ˜R retting(test):

[https://vegkart.test.atlas.vegvesen.no/#kartlag:topo4/@-31902,6573213,18/hva:~(~(id~532)~(id~917))/hvor:~(vegsystemreferanse~(~'F441))/vegnett:~'geometri+~()/valgt:805722:3:7]

GSrundkjÃ¸ring ETTER retting(prod):

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@-31906,6573215,18/hva:~(~(id~532)~(id~917))/hvor:~(vegsystemreferanse~(~'F441))]",NVDB-6937,Vegkart,
Bruke geometristruktur i konverteringsendepunktet,"h2. Bakgrunn

NÃ¸dvendige forbedringer av konverteringsendepunktene for SOSI og SosiGeoJson:

- Bruker nÃ¥ gammel (streng-basert) egenskapsverdi (<verdi>) for geometri. Skal bruke (strukturert) <geometri>.
- MÃ¥ kontrollere at VERT-DATUM bruker NN2000, siden det er det NVDB vil ha.

h2. Analyse & lÃ¸sning

Konverteringen foregÃ¥r i hhv klassene SosiConverter og SosiGeoJsonConverter. Oppdaterer geometrigenereringen der.",NVDB-6937,Skriv-API,
NPE ved utlisting av endringssett uten sorteringsnÃ¸kkel,"h2. Observasjon

Ved anrop til /nvdb/apiskriv/rest/v3/endringssett uten Ã¥ angi parameter sorterPÃ¥ gir NullPointerException.

h2. Analyse

NÃ¥r ChangesetResource.getList anropes uten query-parameter vil JobSearch-instansen fÃ¥ null som verdi for sortField. Denne transporteres hele vegen inn til JdbcJobRepository.getAll som anroper SelectStatement.orderBy med null-verdien. Men den metoden kaster NPE dersom det orders er null.

h2. LÃ¸sning

Endret JobSearch.sortBy til Ã¥ bare oppdatere sortField om parameteren er ulik null. JobSearch har allerede TIME som default sortField.",NVDB-6937,Skriv-API,
Vise mer info i eventlog nÃ¥r berikede vegobjekter er endret,"h2. Bakgrunn

Endringssett https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/b2d2498e-52ea-4f99-8d27-916f0f5c1783?inkluderResultat=NEI restartes automatisk fordi ""en annen prosess har endret enkelte objekter etter at denne prosessen leste dem fra NVDB"". Her Ã¸nskes informasjon om vegobjekttype, vegobjektid og bruker.

h2. Analyse

Meldingen har opphav i StaleFeatureVersionChecker. I dagens kode svarer denne bare med true eller false, og dersom true legges inn meldingen over i eventloggen.

h2. LÃ¸sning

StaleFeatureVersionChecker utvides til Ã¥ returnere liste med beskrivelse av hva som er galt og hvilke vegobjektversjoner det gjelder. Listen puttes inn som event-data i JobWorker.hasStaleJobExtensions.",NVDB-6937,Skriv-API,
Sjekke om vi kan fÃ¥ fÃ¦rre segmenter for objekter,"Sjekk om det er mulig Ã¥ slÃ¥ sammen vegobjektsegmenter der segmentene er like, men har forskjellig dato.
 Kan muligens ses i sammenheng med NVDB-5592.

Â 

LÃ¸sning:

Lagt til et steg som slÃ¥r sammen vegobjekt-segmenter som er like og henger sammen i tid. Funksjonaliteten kan skrues av ved Ã¥ sette config:Â nvdbind.objectreader.segmenting.mergeintime=false.

Det ser ikke ut til Ã¥ ha en veldig stor effekt. PÃ¥ typeId:105 utgjÃ¸r det ~2000 dokumenter av 3,3millioner.",NVDB-6937,Les-API,
StÃ¸tte for ny versjon av excel-objektliste,"Fra bruker Tanja Molland Caliskaner

_Hei!_Â  

_I objektlisten i datafangst sÃ¥ ligger objektet FKB Â«fortauskant ytreÂ». Dette er et utgÃ¥tt objekt, og har vÃ¦rt utgÃ¥tt en god stund. Det er erstattet av AnnetVegarealAvgrensning som er i listen. Objektet er fjernet fra siste oppdaterte excel objektliste som vegvesenet opererer med her: [https://www.vegvesen.no/fag/teknologi/nasjonal+vegdatabank/objektliste]Â sÃ¥ datafangst burde fÃ¥ oppdatert sin objektliste iht siste versjon av excel objektlisten. Det gjelder nok flere objekt enn fortauskant ytre, og jeg mener (uten Ã¥ huske hvilke) det er noen objekt som er lagt til som ikke ligger i datafangst sin liste. Dette mÃ¥ dere sikkert diskutere internt, men det hadde vÃ¦rt fint at disse to objektlistene er like. Vi laster opp excel i datafangst og da kommer ikke alle objekt med, noe som er uheldig nÃ¥r prosjekt har tilpasset listen og entreprenÃ¸r ikke finner objektene i datafangst._

Vi mÃ¥ se pÃ¥ hvilke endringer som er gjort, og passe pÃ¥ at vi nÃ¥ stÃ¸tter SVV 5.0 og Nye Veger 1.08.",NVDB-6937,Datafangst,
Automatisk test for sammenhengende meter,"Feil med metrering pÃ¥ vegnett blir oppdaget sent og gjerne av andre.

Vi skulle hatt en automatisk/halvautomatisk test som kan traversere deler av vegnettet og avdekker eventuelle usammenhengende meterverdier eller overlapp.

Vi kunne kjÃ¸rt denne testen hver gang det er endringer i IND som kan pÃ¥virke metrering pÃ¥ vegnettet.

Â 

---

Sjekk med HÃ¥vard Lerstad om vi kan fÃ¥ testen han kjÃ¸rer sÃ¥ vi kan bruke den.",NVDB-6937,NVDB-IND,
Hente status pÃ¥ vilkÃ¥rlig endringssett med tjenestebruker,"h2. Bakgrunn

Datafangst og muligens andre klienter som bruker tjenestebruker har behov for Ã¥ kunne hente status for endringssett som har annen eier enn denne tjenestebrukeren. Anropende bruker av type tjenestebruker skal da fÃ¥r svar pÃ¥ fÃ¸lgende requester, uansett verdi pÃ¥ <id>:

{noformat}
GET /nvdb/apiskriv/rest/v3/endringssett/<id>/fremdrift
GET /nvdb/apiskriv/rest/v3/endringssett/<id>/fremdriftOgÃ…rsak
GET /nvdb/apiskriv/rest/v3/endringssett/<id>/status
{noformat}

h2. Analyse

Endepunktene /fremdrift og /fremdriftOgÃ…rsak er allerede tilgjengelig for alle brukere, uavhengig av eierskap. Endepunktet for /status, derimot krever i dag at anropende bruker enten eier endringssettet eller har Permission.GET_ANY_CHANGESET. Denne tilgangen er bare gitt til bruker med system-admin-rollen.

h2. LÃ¸sning

Etablerte nye Permissions: GET_OWN_CHANGESET_STATUS og GET_ANY_CHANGESET_STATUS. Sistnevnte ble koblet til tjenestebrukere i DefaultPermissionManager. Endret ChangesetResource.getStatus sin PermissionsAllowed-annotasjon til Ã¥ akseptere GET_OWN_CHANGESET_STATUS og GET_ANY_CHANGESET_STATUS. Internt i metoden kontrolleres at anropende bruker har GET_ANY_CHANGESET_STATUS-permission hvis han/hun ikker eier endringssettet.",NVDB-6937,Skriv-API,
SmÃ¥ meteravvik pÃ¥ detaljerte lenker,"Â 

Eksempel 1:

Her har den detaljerte lenka som krysser fÃ¥tt feil startmeter og kanskje sluttmeter. Den starter pÃ¥ meter 1009, men har meter 1013 (denne er lik i prod):

[https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:topo4/@289096,6746856,18/vegnett:~'geometri+~()/valgt:706451:1:20/vegsystemreferanse:289008.498:6746838.856]

Â 

Eksempel 2:Â 

-Her er det flere eksempel pÃ¥ avvik med bÃ¥de start/slutt-meter pÃ¥ detaljerte konnekteringslenker (denne er bedre i prod):-

-[https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:topo4/@289506,6746849,18/vegnett:~'geometri+~()/valgt:1997271:1:14/vegsystemreferanse:289008.498:6746838.856]-

Superstedfesting pÃ¥ detaljert lenkeÂ 1997271Â er korrigert i prod, sÃ¥ derfor er det sannsynligvis datafeil vi ser i STM.

Â 

Eksempel 3:

< WARN ;Segment2.MeterGap;3421;705473;0,81553627;0,94109061;2254145;752481;1;;R;V;25;;S;11;1;10743;10767;K;;;;1;1;;355152;6795985;358;355169;6796011;357;Gap=6,482m

[https://vegkart.atlas.vegvesen.no/#kartlag:topo4/@355166,6796000,18/vegnett:~'geometri+~()/valgt:705473:5:7/vegsystemreferanse:293232.608:6740608.765]

Denne er lik i STM og PROD. Ser ut til Ã¥ skyldes datafeil. To detaljerteÂ lenker (706479 ogÂ 705473) slutter i samme punkt i geometri, men har forskjellig sluttpunkt i superstedfesting som gir forskjellige meterverdier pÃ¥ samme punket.

Â 

Eksempel 4:

WARN ;Segment1.MeterGap;5425;2491861;0;0,46369639;2491842;2491835;0;;E;V;6;;S;182;1;12320;12424;K;;;;1;1;;707495;7704877;37;707577;7704942;37;Gap=3,742m

WARN ;Segment2.MeterGap;5425;2491847;0;0,16867876;2491835;2836606;0;C;E;V;6;;S;182;1;12428;12436;K;;;;1;;;707577;7704942;37;707582;7704953;37;Gap=3,742m

[https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:topo4/@707589,7704959,18/vegnett:~'geometri+~()/valgt:2491847:1:8]

Kun i den siste kjÃ¸ringen. Skyldes stedfesting og geometri som ikke henger sammen. Likt i prod.

Â Â 

Flere eksempler pÃ¥ tilsvarende iÂ [https://ftp.triona.no/NyttVegNett-2020-Test/Logger-2020-05-27/Diff-STM1-STM2.log]

Â 

Â ",NVDB-6937,NVDB-IND,
Enkel oppstartsskjerm for Vegkart,"NÃ¥r Vegkart fÃ¸rst laster sÃ¥ er det som regel et par sekunder fÃ¸rst der skjermen er helt hvit. Hvis man har en treig nettleser eller treig internettforbindelse sÃ¥ kan denne perioden vÃ¦re lengre. (Tor sier at det har kommet rapporter om dette internt i SVV for de som bruker Edge.)

Det er lett Ã¥ tro at det er noe feil med applikasjonen nÃ¥r man fÃ¥r opp en helt hvit skjerm, siden det ofte er sÃ¥nn  tekniske feil arter seg ellers.

Vi kan legge pÃ¥ en enkel tekst og eventuelt en spinner som vises mens javaScript laster, sÃ¥nn at bruker fÃ¥r opp noe pÃ¥ skjermen umiddelbart nÃ¥r den Ã¥pner vegkart.",NVDB-6937,Vegkart,
Valgt vegobjekt henger igjen pÃ¥ kartet,"GÃ¥ til:

https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@154239,6513881,12/hva:~(~(id~105)~(id~540))/hvor:~(fylke~(~42)~vegsystemreferanse~(~'FV411S3D1))/valgt:84193056:540

# Zoom til valgt objekt
# Kryss ut valgt vegobjekt.
# Se at den hvite linjen for valgt vegobjekt henger igjen i kartet.
# Det er ikke mulig Ã¥ klikke pÃ¥ at annet vegobjekt pÃ¥ samme sted som den hvite linjen dekker.

 !Screenshot from 2020-05-26 13-47-15.png|thumbnail! 

Kan ta et par forsÃ¸k med klikk og utkryssing fÃ¸r feilen reproduseres.",NVDB-6937,Vegkart,
API-import: Egen feilmelding ved timeout eller feil mot Les,"Virker som Sinus EntreprenÃ¸r og de som bruker den ute pÃ¥ veien sliter en del med timeout mot Les for tida. Vi kunne gjort det bedre for disse ved Ã¥ kunne gi en spesifik feilmelding og kode for timeout eller andre midlertidige problemer mot Les.

Da kunne ogsÃ¥ Sinus forklare sine brukere at problemet var midlertidig, og vi hadde sluppet en del support for begge parter.",NVDB-6937,Datafangst,
SYSTEMFEIL ved beregning av sideposisjon,"h2. Observasjon

Endringssett https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/868e1f7d-9aaf-4e58-aad6-8a888b3d7e30 (og 7 andre fra oddlskil) havner i SYSTEMFEIL ved beregning av sideposisjon nÃ¥r et vegobjekt skal restedfestes i forbindelse med geometriutskiftning pÃ¥ vegnett:

{code:java}
java.lang.RuntimeException: No line segment found for refLinkPosition 1.0
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.lambda$lineSegmentFromPosition$2(SidePositionCalculator.java:151)
	at java.util.Optional.orElseThrow(Optional.java:290)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.lineSegmentFromPosition(SidePositionCalculator.java:151)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.calculateSidePositionForPointLocational(SidePositionCalculator.java:111)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.calculateSidePosition(SidePositionCalculator.java:99)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.compareSidePositions(SidePositionCalculator.java:85)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.compareUpdatedSidePositionToOld(SidePositionCalculator.java:55)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.compareUpdatedSidePositionToOld(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:607)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.postProcessApprovedRelocalization(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:564)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.lambda$addEnrichmentOrReportConflict$15(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:509)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.enrichment.EnrichmentEvaluator.evaluate(EnrichmentEvaluator.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.addEnrichmentOrReportConflict(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:546)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.doFilter(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:159)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:116)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:129)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:391)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:161)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:135)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

Exception kastes fordi RefLinkPart.getLineSegmentAtPosition() ikke finner linjesegmentet av geometrien som dekker posisjon 1.0. Den aktuelle lenken dekker imidlertid intervallet [0.436352d, 1.0d]. Beregningen av linjesegment baserer seg pÃ¥ angitt geometrisk (3D) lengde for lenken, men denne ser ut til Ã¥ avvike med ca 0,5 mm fra den virkelige lengden i dette tilfellet. Dette er nok til at algoritmen faller utenfor det siste linjesegmentet i geometrien og returnerer ingen funn.

h2. LÃ¸sning

Ny metode calcGeometricLength i RefLinkPart som regner ut eksakt geometrisk lengde. Denne metoden brukes alle andre steder i RefLinkPart der beregninger basert pÃ¥ geometrilengde utfÃ¸res.",NVDB-6937,Skriv-API,
Vegobjekt med kun endring av mor i NVDB blir ikke etterbehandlet,"h2. Observasjon
Ser i forbindelse med testing av NVDB-5367 at et vegobjekt som kun har endret mor i NVDB ikke har fÃ¥tt status for assosiasjoner oppdatert etter at endringssett er ferdig behandlet.
Videre graving der viser at aktuelt vegobjekt ikke har {{nvdb_submission_id}} satt, slik at det ikke blir plukket opp som et vegobjekt som skal oppdateres nÃ¥r endringssettet etterbehandles.

Ã… sende inn endringer for dette vegobjektet pÃ¥ nytt vil gi feil, siden endringer i koblinger allerede er behandlet.

h2. Analyse
Vegobjektet var et eksisterende NVDB-objekt som ikke hadde andre endringer enn endring i mor, dette er antakeligvis en forutsetning. NÃ¥r endringssettet settes sammen, sÃ¥ behandles kobling til NVDB-mor spesielt (se potensiell forbedring i NVDB-4510), sÃ¥ disse vegobjektene blir da tydeligvis ikke merket som at de er med i  endringssettet.

h2. Forslag til lÃ¸sning
Vi kan merke de aktuelle vegobjektene ogsÃ¥ med {{nvdb_submission_id}}, sÃ¥nn at de fÃ¸lger samme lÃ¸ypa i etterbehandling. I sÃ¥ fall viktig Ã¥ teste grundig, jeg har ikke oversikt over om det vil ha noen konsekvenser ut over dette.

Alternativet er Ã¥ se behandle innholdet i resultatet vi fÃ¥r fra Skriv, i stedet for Ã¥ bruke {{nvdb_submission_id}}. Dette er en ganske omfattende endring, og vil nok kreve en del jobb Ã¥ fÃ¥ riktig.",NVDB-6937,Datafangst,
Avviser detaljert lenke pga ugyldig felt pÃ¥ sluttdato,"h2. Observasjon

Epost fra Hans JÃ¸rgen:

En bruker i Agder fÃ¥r dette endringssettet avvist med mange meldinger om ugyldig felt:
 
https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/b9c40b03-4fb6-42a2-a5bc-96af9f865d8c
 
Han har lagt inn konnekteringslenker inn og ut av rundkjÃ¸ringen. Dette er gjort ved Ã¥ opprette nye lenker pÃ¥ eksisterendelenkesekvenser, slik at det blir historikk pÃ¥ alle nivÃ¥er. Ingen nye lenkesekvenser i bildet her.
 
NVDB Vegnett melder ikke om noe feil og jeg klarer heller ikke Ã¥ finne noen. Det er selvsagt en viss sjanse for at det er noe jeg ikke klarer Ã¥ se her, men tror vi trenger litt hjelp til Ã¥ forstÃ¥.

h2. Analyse

Endringssettet avvises med en rekke feilmeldinger. De fleste avdekkes i SuperLocationLaneExistsValidator som har som oppgave Ã¥ validere at et felt brukt i en superstedfesting faktisk finnes i hovedveglenkesekvensen i levetiden til den detaljerte veglenken.

I endringssettet oppdateres hovedveglenkesekvens 2432560 med endret veglenke nr 1 og tre nye veglenker. Etter oppdateringen har veglenkesekvensen fÃ¸lgende veglenker:

* Nr 1 - gyldig: 2012-07-05 - 2020-05-20, dekker: 0.0 - 0.848741, felt: 1#2
* Nr 4 - gyldig: 2020-05-20 - >, dekker: 0.0 - 0.848741, felt: 1#2
* Nr 2 - gyldig: 2012-07-05 - 2020-05-20, dekker: 0.848741 - 1.0, felt: 1#2
* Nr 3 - gyldig: 2020-05-20 - >, dekker: 0.848741 - 1.0, felt: (ingen), konnekteringsveglenke

I samme endringssett oppdateres detaljert veglenkesekvens 2432559, og veglenke nr 2 ser slik ut etter oppdatering:

* Nr 2 - gyldig: 2012-07-05 - 2020-05-20, superstedfesting: 0.848741 - 1.0, felt 1

I SuperLocationLaneExistsValidator valideres at felt 1 finnes for 0.848741 - 1.0 pÃ¥ hovedveglenkesekvensen, bÃ¥de pÃ¥ startdato og sluttdato for den detaljerte veglenken. For startdato gÃ¥r dette bra, siden felt 1 finnes for hele veglenkesekvensen pÃ¥ den datoen. For sluttdato finnes imidlertid bare hovedveglenke nr 3, som ikke har felt siden det er en konnekteringslenke. Validatoren varsler derdor dette som feil.

Dette er en bug i API Skriv, fordi sluttdato alltid er ikke-inklusiv. NÃ¥r det skal valideres pÃ¥ gyldighet for sluttdato, mÃ¥ vi bruke *dagen fÃ¸r*, som er siste inklusive gyldighetsdato.

h2. LÃ¸sning

La inn ny metode getValidToInclusive() i Feature, Node og RefLinkPart som leverer siste gyldige dato i objektets levetid. Bruker denne i stedet for getValidTo() i SuperLocationLaneExistsValidator og andre lignende scenarier.",NVDB-6937,Skriv-API,
Finner ikke meter pÃ¥ grunn av avvik i siste desimal eller treffer feil strekning,"Det finnes endel tilfeller der meterberegning ikke finner start eller sluttmeter pÃ¥ grunn av relativ posisjon pÃ¥ beregnet/segmentert superstedfesting avviker 0.00000001 fra start/sluttpos for strekning.
Eksempel:
https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/444364.json
https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/444364.json

Her har veglenke 11 et segment 0.12170972-0.1239413@444364, super: 0.36141955-0.36808559@443149

Strekningen som er beregnet for dette segmentet er
https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/916/1003623307/1.json 
som er stedfestet pÃ¥ 0.36141956-0.44850952@443149

Vi legger til at avvik pÃ¥ 0.00000001 Â«snapperÂ» til den tidligere beregnede strekningen.",NVDB-6937,NVDB-IND,
Direktelenking av filtre med tekst,"GÃ¥ til 

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-51388,6620725,16/hva:~(~(filter~(~(operator~'*3d~type_id~11404~verdi~(~'*2a307946*2a)))~id~301)~(filter~(~(operator~'*3d~type_id~11109~verdi~(~'*2a307946*2a)))~id~234))/vegnett:~'geometri+~()|https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-51388,6620725,16/hva:~(~(filter~(~(operator~'*3d~type_id~11404~verdi~(~'*2a307946*2a)))~id~301)~(filter~(~(operator~'*3d~type_id~11109~verdi~(~'*2a307946*2a)))~id~234))/vegnett:~'geometri+~() ] 

og se at tekststrengene i filteret ikke blir parset riktig.

Start med Ã¥ se pÃ¥ HashToState.hvaState() om filteret blir parset riktig der. Dersom ja, gÃ¥ videre til komponenten Egenskapsfilter og se om komponenten leser state riktig.",NVDB-6937,Vegkart,
Ta med ID til morobjektet,Hvis man ber NVDB api om Ã¥ inkludere relasjoner sÃ¥ fÃ¥r man ID og type til mor eller mÃ¸dre i relasjonstreet.Â ,NVDB-6827,Rapportgenerator,
Utvidet og konfigurerbar timeout mot Skriv,"h2. Observasjon

Phillip Longva Karlsen (Phillip.Longva.Karlsen@sandefjord.kommune.no) fÃ¥r problemer med Ã¥ sende inn til NVDB fra sitt prosjekt fordi han sender inn ~11000 objekter i en innsending, og vi treffer vÃ¥r hardkodede timeout mot Skriv pÃ¥ 25 sekunder.
h2. Analyse

25 sekunder er kanskje litt i vel korteste laget her. Dette er timeout for Ã¥ lese svar, vi har en separat (og kortere) timeout for Ã¥ koble opp.
h2. Forslag til lÃ¸sning

Vi burde bÃ¥de gjÃ¸re denne timeout'en konfigurerbar (med default-verdier), og sette den hÃ¸yere som default.
h2. LÃ¸sning

La til configbare verdier i datafangst.config
{quote}{{Write APi Client timeout in milliseconds}}
{{writeApiConnectionTimeout=5000}}
{{writeApiReadTimeout=60000}}
{quote}
{{Disse har ogsÃ¥ defaultverdier satt til det samme i Integration plugin.}}

Disse verdiene settes nÃ¥ direkte pÃ¥ client-objektet, og ikke lenger som overrides inne pÃ¥ NvdbWriteApiGateway

Â ",NVDB-6937,Datafangst,
AppkrÃ¦sj ved meterverdi = 0 i vegsystemreferanse,"https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@264898,7030140,16/hva:~(~(id~915))/valgt:1002201965:915


{code:java}
TypeError: Cannot read property 'toFixed' of null
    at e.toString (Vegsystemreferanse.ts:72)
    at t.toVegkartKortform (Vegsystemreferanse.ts:18)
    at VegobjektComponent.tsx:192
    at t.VegobjektComponent (VegobjektComponent.tsx:78)
    at Ho (react-dom.production.min.js:153)
    at vs (react-dom.production.min.js:261)
    at cu (react-dom.production.min.js:246)
    at su (react-dom.production.min.js:246)
    at Qs (react-dom.production.min.js:239)
    at react-dom.production.min.js:123
    at e.unstable_runWithPriority (scheduler.production.min.js:19)
    at Bi (react-dom.production.min.js:122)
    at Vi (react-dom.production.min.js:123)
    at Wi (react-dom.production.min.js:122)
    at tu (react-dom.production.min.js:240)
    at Object.notify (Subscription.js:19)
    at t.e.notifyNestedSubs (Subscription.js:92)
    at t.e.handleChangeWrapper (Subscription.js:97)
    at v (redux.js:221)
    at middleware.ts:34
    at middleware.ts:21
    at index.js:11
    at dispatch (redux.js:638)
    at fetchVegobjekter.ts:65
{code}
",NVDB-6937,Vegkart,
"Endring av kontraktsgruppe feiler, sletter ikke gammel kobling","h2. Observasjon

Jeg slet med endring av kontraktsgruppe pÃ¥ en kontrakt i prod som allerede hadde en gruppe. Endra gruppe uten feilmeldinger, men gammel gruppe var fortsatt pÃ¥ plass etter reload av kontrakt.

SÃ¥ etter hvert at kontrakten fikk _to_ kontraktsgrupper i databasen etter endring, bÃ¥de den eksisterende og den som jeg endra til.
h2. Analyse

En bug har fÃ¸rt til at gamlel kontraktgrupper ikke ble fjernet som tenkt. I tillegg slettes bare en av da gamle kontraktene ved flytting, sÃ¥ hvis en kontrakt hadde fÃ¥tt flere grupper, kunne det ikke lÃ¸ses uten Ã¥ kjÃ¸re SQL manuelt. Det betyr at det antakelig finnes flere kontrakter med flere grupper.

Fant ogsÃ¥ en bug der vi bare ser pÃ¥ roller for Ã¥ avgjÃ¸re om en bruker har rettigheter til Ã¥ flytte kontrakter, istedet for Ã¥ bruke PermissionResolver, som gjorde at global admin ikke kunne flytte kontrakter uten Ã¥ ogsÃ¥ vÃ¦re administrator for gruppene
h2. LÃ¸sning

Vi sjekker nÃ¥ rettigheter ved Ã¥ bruke PermissionResolver.

Ved tilegning av ny kontraktgruppe fjernes nÃ¥ alle gamle kontraktgrupper.",NVDB-6937,Datafangst,
Global admin kan ikke endre kontraktsgruppe,"h2. Observasjon
Som global admin kan jeg sette kontraktsgruppe for en kontrakt selv om jeg ikke er medlem av kontraktsgruppa. NÃ¥r jeg etterpÃ¥ prÃ¸ver Ã¥ endre til en annen kontraktsgruppe sÃ¥ fÃ¥r jeg ikke lov til dette, med melding om at jeg ikke har rettigheter til Ã¥ fjerne kontrakten fra den eksisterende gruppa.",NVDB-6937,Datafangst,
Metrering pÃ¥ fylkesveger som krysser fylkesgrense,"Fylkesveger som krysser fylkesgrenser fÃ¥r ikke sammenhengende metrering.

Endres slik at fylkesveger behandles likt Riks og Europaveier.

Â 

Eksempel:

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-43292,6632597,12/hva:~(~(id~916))/hvor:~(vegsystemreferanse~(~'FV4942))/vegnett:~'metrering+~()/valgt:1003459772:916]

Â 

*LÃ¸sning:*

Endret hÃ¥ndtering av fylkesveger slik at det blir likt som for riks- og europaveger. Denne saken krever full indeksering.",NVDB-6937,NVDB-IND,
userDao.hasRole() funker ikke hvis rollen forekommer flere ganger,"h2. Observasjon

En sÃ¦regenhet i userDao.hasRole() gjÃ¸r at en rolle ikke blir resolvet hvis den er satt flere ganger.

den returnerer true hvis oppgitt rolle opptrer kun en gang (count = 1). Av en eller annen grunn har jeg ADMIN-rollen satt 2 ganger.

metoden brukes i dag bare for Ã¥ sjekke om en bruker har ADMIN-rollen, hvor den fungerer greit for alle andre enn meg, men man kan se for seg at den kan brukes for Ã¥ avgjÃ¸re om en bruker har gruppeadmin-rollen for en eller flere grupper, og da vil den ikke fungere.
h2. Tiltak

endre til count > 0",NVDB-6937,Datafangst,
Noder slettes ikke,Ved transaksjoner som sletter noder slettes ikke noden fra Solr.,NVDB-6937,NVDB-IND,
Vegobjekter importert fra kart ikke tilgjengelig for ekstern API,"h2. Observasjon
Vegobjekter som importeres fra kartet i datafanen legges i ikke i noen ""fil"" / FeatureCollection. Dette gjÃ¸r at de ikke er tilgjengelige for ekstern API, men de finnes fortsatt i kontrakten. Dette gjÃ¸r at f.eks. Sinus EntreprenÃ¸r ikke kan fÃ¥ ut alle vegobjekter i en kontrakt, og ikke pÃ¥ forhÃ¥nd kan oppdage duplikater i kontrakt.

h2. Analyse
Vi kan legge importerte vegobjekter i en felles samling for ""importerte vegobjekter"", eller vi kan opprette en ny samling per import. Vi bÃ¸r tenke litt framover mot en opprydding av fil-fanen, men dette bÃ¸r kunne implementeres fÃ¸r vi endrer pÃ¥ filfanen.",NVDB-6937,Datafangst,
mÃ¥l bruk av stedfesting 1,"h2. Observasjon

vi mÃ¥ mÃ¥le bruk av stedfesting 1 slik at vi vet nÃ¥r vi kan slÃ¥ det av.
h2. TiltakÂ 

Lasting av siden logger nÃ¥ meldingen ""User has requested Locational1""",NVDB-6937,Datafangst,
Ruteberegning: Kneler ved for store geometrier,"h2. Observasjon

Datafangst forsÃ¸kte Ã¥ stedfeste en laaang LINESTRING via API Skriv. Request-URL til ruteberegner var:


{noformat}
https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute?geometri=LINESTRING+%28-39394.61+6562838.58%2C+-39396.05+6562838.13%2C+-39397.48+6562837.7%2C+-39397.74+6562838.55%2C+-39398.03+6562839.52%2C+-39398.58+6562841.47%2C+-39399.11+6562843.44%2C+-39399.54+6562845.13%2C+-39399.61+6562845.39%2C+-39399.84+6562846.38%2C+-39400.08+6562847.36%2C+-39400.31+6562848.35%2C+-39400.52+6562849.34%2C+-39400.67+6562849.98%2C+-39400.8+6562850.63%2C+-39400.95+6562851.33%2C+-39401.23+6562852.74%2C+-39401.34+6562853.38%2C+-39401.41+6562853.94%2C+-39401.46+6562854.49%2C+-39401.48+6562855.06%2C+-39401.49+6562855.62%2C+-39401.46+6562856.19%2C+-39401.42+6562856.76%2C+-39401.35+6562857.31%2C+-39401.24+6562857.87%2C+-39401.22+6562858.04%2C+-39401.11+6562858.5%2C+-39400.99+6562858.96%2C+-39400.83+6562859.5%2C+-39400.65+6562860.04%2C+-39400.44+6562860.57%2C+-39400.21+6562861.08%2C+-39399.96+6562861.59%2C+-39399.69+6562862.08%2C+-39399.4+6562862.57%2C+-39399.09+6562863.03%2C+-39398.75+6562863.5%2C+-39398.41+6562863.94%2C+-39398.04+6562864.37%2C+-39397.66+6562864.78%2C+-39397.33+6562865.1%2C+-39397+6562865.41%2C+-39396.83+6562865.56%2C+-39396.47+6562865.86%2C+-39396.1+6562866.16%2C+-39395.96+6562866.26%2C+-39395.49+6562866.59%2C+-39395.02+6562866.89%2C+-39394.86+6562866.98%2C+-39394.12+6562867.42%2C+-39393.22+6562867.92%2C+-39392.3+6562868.41%2C+-39391.38+6562868.87%2C+-39390.45+6562869.32%2C+-39389.51+6562869.75%2C+-39388.56+6562870.17%2C+-39388.07+6562870.38%2C+-39387.62+6562870.56%2C+-39380.2+6562873.61%2C+-39379.26+6562873.99%2C+-39370.92+6562877.41%2C+-39369.63+6562877.94%2C+-39369.07+6562878.18%2C+-39368+6562878.61%2C+-39367.21+6562878.94%2C+-39366.74+6562879.13%2C+-39366.28+6562879.33%2C+-39365.48+6562879.66%2C+-39365.35+6562879.71%2C+-39364.89+6562879.9%2C+-39364.42+6562880.09%2C+-39363.96+6562880.28%2C+-39363.5+6562880.47%2C+-39363.42+6562880.5%2C+-39363.34+6562880.54%2C+-39361.64+6562881.23%2C+-39359.79+6562882%2C+-39358.2+6562882.64%2C+-39357.93+6562882.76%2C+-39356.65+6562883.28%2C+-39356.08+6562883.52%2C+-39355.77+6562883.64%2C+-39355.31+6562883.83%2C+-39354.21+6562884.28%2C+-39352.36+6562885.04%2C+-39351.76+6562885.29%2C+-39350.75+6562885.71%2C+-39350.5+6562885.8%2C+-39348.65+6562886.56%2C+-39348.42+6562886.66%2C+-39348.01+6562886.83%2C+-39346.8+6562887.32%2C+-39346.19+6562887.57%2C+-39345.28+6562887.95%2C+-39344.94+6562888.09%2C+-39343.09+6562888.85%2C+-39343+6562888.88%2C+-39342.54+6562889.07%2C+-39341.63+6562889.45%2C+-39341.22+6562889.61%2C+-39340.98+6562889.71%2C+-39340.48+6562889.92%2C+-39339.37+6562890.37%2C+-39338.89+6562890.57%2C+-39337.51+6562891.14%2C+-39337.07+6562891.32%2C+-39336.89+6562891.38%2C+-39335.66+6562891.9%2C+-39335.25+6562892.06%2C+-39333.8+6562892.66%2C+-39332.51+6562893.19%2C+-39331.95+6562893.42%2C+-39331.6+6562893.56%2C+-39330.09+6562894.19%2C+-39330+6562894.22%2C+-39328.23+6562894.94%2C+-39327.96+6562895.05%2C+-39326.38+6562895.7%2C+-39326.35+6562895.71%2C+-39326.14+6562895.8%2C+-39324.52+6562896.46%2C+-39324.32+6562896.55%2C+-39323.74+6562896.79%2C+-39323.41+6562896.92%2C+-39322.67+6562897.23%2C+-39320.81+6562897.99%2C+-39320.68+6562898.04%2C+-39318.96+6562898.75%2C+-39318.93+6562898.76%2C+-39318.86+6562898.79%2C+-39318.78+6562898.83%2C+-39318.69+6562898.86%2C+-39318.53+6562898.92%2C+-39318.41+6562898.97%2C+-39317.96+6562899.15%2C+-39317.22+6562899.46%2C+-39317.1+6562899.51%2C+-39317.05+6562899.54%2C+-39316.32+6562899.83%2C+-39316.14+6562899.91%2C+-39315.24+6562900.28%2C+-39314.53+6562900.57%2C+-39314.33+6562900.65%2C+-39313.64+6562900.93%2C+-39313.42+6562901.02%2C+-39313.38+6562901.04%2C+-39312.97+6562901.2%2C+-39312.52+6562901.39%2C+-39311.88+6562901.66%2C+-39311.61+6562901.76%2C+-39311.53+6562901.8%2C+-39310.71+6562902.14%2C+-39310.47+6562902.24%2C+-39310.37+6562902.28%2C+-39310.06+6562902.41%2C+-39309.81+6562902.51%2C+-39309.68+6562902.56%2C+-39309.14+6562902.78%2C+-39308.9+6562902.88%2C+-39308.64+6562902.99%2C+-39308.22+6562903.16%2C+-39308+6562903.25%2C+-39307.82+6562903.33%2C+-39307.3+6562903.54%2C+-39307.17+6562903.59%2C+-39307.09+6562903.62%2C+-39306.38+6562903.91%2C+-39306.19+6562903.99%2C+-39305.97+6562904.09%2C+-39305.46+6562904.29%2C+-39305.28+6562904.37%2C+-39304.38+6562904.74%2C+-39304.11+6562904.84%2C+-39303.47+6562905.11%2C+-39302.57+6562905.48%2C+-39302.25+6562905.6%2C+-39301.67+6562905.85%2C+-39300.76+6562906.21%2C+-39300.39+6562906.37%2C+-39299.86+6562906.59%2C+-39298.96+6562906.96%2C+-39298.54+6562907.13%2C+-39298.05+6562907.33%2C+-39297.15+6562907.7%2C+-39296.68+6562907.89%2C+-39296.25+6562908.07%2C+-39295.35+6562908.45%2C+-39295.17+6562908.51%2C+-39294.83+6562908.65%2C+-39294.65+6562908.73%2C+-39294.44+6562908.81%2C+-39293.54+6562909.18%2C+-39293.06+6562909.39%2C+-39292.97+6562909.42%2C+-39292.77+6562909.5%2C+-39292.64+6562909.55%2C+-39292.62+6562909.56%2C+-39292.46+6562909.63%2C+-39292.31+6562909.69%2C+-39292.16+6562909.75%2C+-39292.05+6562909.8%2C+-39292+6562909.82%2C+-39291.86+6562909.87%2C+-39291.73+6562909.92%2C+-39291.71+6562909.93%2C+-39291.56+6562910%2C+-39291.42+6562910.06%2C+-39291.33+6562910.09%2C+-39291.27+6562910.11%2C+-39291.18+6562910.15%2C+-39291.12+6562910.18%2C+-39291.06+6562910.19%2C+-39290.91+6562910.26%2C+-39290.85+6562910.3%2C+-39290.83+6562910.3%2C+-39286.61+6562912.02%2C+-39286.57+6562912.03%2C+-39286.47+6562912.08%2C+-39286.38+6562912.11%2C+-39286.28+6562912.15%2C+-39286.19+6562912.19%2C+-39286.1+6562912.22%2C+-39286.01+6562912.27%2C+-39285.92+6562912.3%2C+-39285.82+6562912.34%2C+-39285.73+6562912.38%2C+-39285.64+6562912.41%2C+-39285.54+6562912.46%2C+-39285.45+6562912.5%2C+-39285.35+6562912.53%2C+-39285.27+6562912.57%2C+-39285.18+6562912.6%2C+-39285.08+6562912.65%2C+-39285.06+6562912.65%2C+-39284.99+6562912.69%2C+-39284.89+6562912.72%2C+-39284.8+6562912.76%2C+-39284.71+6562912.79%2C+-39284.62+6562912.84%2C+-39284.53+6562912.88%2C+-39284.43+6562912.91%2C+-39284.34+6562912.95%2C+-39284.25+6562912.98%2C+-39284.15+6562913.03%2C+-39284.06+6562913.07%2C+-39283.96+6562913.1%2C+-39283.88+6562913.14%2C+-39283.78+6562913.18%2C+-39283.69+6562913.22%2C+-39283.6+6562913.26%2C+-39283.5+6562913.29%2C+-39283.41+6562913.33%2C+-39283.31+6562913.37%2C+-39283.22+6562913.4%2C+-39283.14+6562913.45%2C+-39283.04+6562913.48%2C+-39282.95+6562913.52%2C+-39282.85+6562913.56%2C+-39282.76+6562913.6%2C+-39282.67+6562913.64%2C+-39282.57+6562913.68%2C+-39282.48+6562913.71%2C+-39282.39+6562913.75%2C+-39282.3+6562913.79%2C+-39282.21+6562913.83%2C+-39282.11+6562913.87%2C+-39282.02+6562913.9%2C+-39281.92+6562913.94%2C+-39281.83+6562913.97%2C+-39281.73+6562914.02%2C+-39281.65+6562914.06%2C+-39281.56+6562914.09%2C+-39281.46+6562914.13%2C+-39281.37+6562914.16%2C+-39281.27+6562914.21%2C+-39281.18+6562914.25%2C+-39281.09+6562914.28%2C+-39280.99+6562914.32%2C+-39280.91+6562914.36%2C+-39280.81+6562914.4%2C+-39280.72+6562914.44%2C+-39280.63+6562914.47%2C+-39280.53+6562914.51%2C+-39280.44+6562914.55%2C+-39280.34+6562914.59%2C+-39280.25+6562914.63%2C+-39280.17+6562914.66%2C+-39280.07+6562914.7%2C+-39279.98+6562914.74%2C+-39279.88+6562914.78%2C+-39279.79+6562914.82%2C+-39279.69+6562914.86%2C+-39279.6+6562914.89%2C+-39279.52+6562914.93%2C+-39279.42+6562914.97%2C+-39279.33+6562915.01%2C+-39279.23+6562915.05%2C+-39279.14+6562915.08%2C+-39279.12+6562915.09%2C+-39274.41+6562917.03%2C+-39273.92+6562917.24%2C+-39273.67+6562917.34%2C+-39273.48+6562917.41%2C+-39273.26+6562917.5%2C+-39272.76+6562917.71%2C+-39272.55+6562917.8%2C+-39271.86+6562918.08%2C+-39270.7+6562918.56%2C+-39270.05+6562918.82%2C+-39269.16+6562919.19%2C+-39269.14+6562919.2%2C+-39268.85+6562919.32%2C+-39267.34+6562919.94%2C+-39266.99+6562920.08%2C+-39265.13+6562920.85%2C+-39264.62+6562921.05%2C+-39263.27+6562921.61%2C+-39261.91+6562922.16%2C+-39261.42+6562922.37%2C+-39260.1+6562922.9%2C+-39259.56+6562923.13%2C+-39259.21+6562923.27%2C+-39258.31+6562923.65%2C+-39257.71+6562923.9%2C+-39256.5+6562924.39%2C+-39255.85+6562924.65%2C+-39255.6+6562924.76%2C+-39254.09+6562925.37%2C+-39254+6562925.41%2C+-39253.84+6562925.48%2C+-39253.79+6562925.5%2C+-39252.15+6562926.17%2C+-39251.16+6562926.58%2C+-39251.09+6562926.61%2C+-39250.28+6562926.94%2C+-39248.43+6562927.7%2C+-39248.38+6562927.72%2C+-39246.75+6562928.39%2C+-39246.58+6562928.46%2C+-39246.31+6562928.57%2C+-39245.68+6562928.82%2C+-39244.72+6562929.22%2C+-39242.97+6562929.94%2C+-39242.86+6562929.99%2C+-39242.32+6562930.2%2C+-39242.02+6562930.33%2C+-39241.01+6562930.75%2C+-39240.22+6562931.07%2C+-39239.15+6562931.51%2C+-39237.52+6562932.18%2C+-39237.29+6562932.27%2C+-39236.83+6562932.46%2C+-39235.43+6562933.04%2C+-39235.2+6562933.13%2C+-39234.82+6562933.28%2C+-39233.86+6562933.68%2C+-39233.58+6562933.79%2C+-39232.85+6562934.09%2C+-39232.12+6562934.4%2C+-39231.73+6562934.55%2C+-39231.26+6562934.74%2C+-39230.8+6562934.93%2C+-39230.32+6562935.13%2C+-39230.19+6562935.18%2C+-39229.95+6562935.28%2C+-39229.87+6562935.31%2C+-39229.83+6562935.33%2C+-39229.51+6562935.46%2C+-39229.42+6562935.49%2C+-39229.18+6562935.59%2C+-39229.04+6562935.65%2C+-39228.94+6562935.69%2C+-39228.81+6562935.74%2C+-39228.52+6562935.87%2C+-39228.01+6562936.07%2C+-39227.62+6562936.23%2C+-39227.39+6562936.33%2C+-39227.34+6562936.34%2C+-39227.08+6562936.45%2C+-39226.72+6562936.6%2C+-39226.62+6562936.64%2C+-39226.51+6562936.68%2C+-39226.16+6562936.83%2C+-39225.99+6562936.9%2C+-39225.82+6562936.96%2C+-39225.23+6562937.21%2C+-39224.92+6562937.33%2C+-39224.48+6562937.52%2C+-39224.3+6562937.59%2C+-39223.37+6562937.97%2C+-39222.47+6562938.33%2C+-39222.43+6562938.34%2C+-39222.18+6562938.41%2C+-39221.92+6562938.47%2C+-39221.77+6562938.5%2C+-39221.45+6562938.57%2C+-39221.22+6562938.62%2C+-39220.93+6562938.69%2C+-39220.45+6562938.79%2C+-39220.26+6562938.84%2C+-39219.45+6562939.01%2C+-39219.3+6562939.04%2C+-39218.47+6562939.23%2C+-39218.34+6562939.26%2C+-39217.47+6562939.44%2C+-39217.39+6562939.46%2C+-39216.81+6562939.58%2C+-39216.47+6562939.65%2C+-39216.42+6562939.66%2C+-39215.48+6562939.88%2C+-39214.89+6562940%2C+-39214.51+6562940.08%2C+-39214.48+6562940.09%2C+-39213.99+6562940.2%2C+-39213.52+6562940.39%2C+-39212.59+6562940.77%2C+-39211.67+6562941.15%2C+-39210.73+6562941.53%2C+-39209.8+6562941.91%2C+-39208.88+6562942.29%2C+-39207.95+6562942.67%2C+-39206.08+6562943.44%2C+-39205.5+6562942.05%2C+-39207.38+6562941.28%2C+-39208.3+6562940.9%2C+-39209.23+6562940.52%2C+-39210.17+6562940.14%2C+-39211.09+6562939.76%2C+-39212.02+6562939.38%2C+-39212.95+6562938.99%2C+-39213.41+6562938.8%2C+-39213.88+6562938.61%2C+-39213.9+6562938.61%2C+-39214.27+6562938.46%2C+-39214.8+6562938.23%2C+-39215.69+6562937.87%2C+-39215.73+6562937.86%2C+-39216.04+6562937.72%2C+-39216.59+6562937.51%2C+-39216.66+6562937.48%2C+-39217.48+6562937.14%2C+-39217.59+6562937.1%2C+-39218.37+6562936.77%2C+-39218.51+6562936.72%2C+-39219.26+6562936.41%2C+-39219.44+6562936.34%2C+-39219.89+6562936.15%2C+-39220.15+6562936.04%2C+-39220.37+6562935.95%2C+-39220.68+6562935.82%2C+-39220.81+6562935.78%2C+-39221.05+6562935.68%2C+-39221.29+6562935.58%2C+-39221.3+6562935.56%2C+-39221.33+6562935.55%2C+-39222.23+6562935.18%2C+-39223.15+6562934.8%2C+-39223.33+6562934.72%2C+-39223.78+6562934.54%2C+-39224.08+6562934.42%2C+-39224.67+6562934.17%2C+-39224.85+6562934.11%2C+-39225.01+6562934.04%2C+-39225.36+6562933.89%2C+-39225.47+6562933.85%2C+-39225.57+6562933.81%2C+-39225.94+6562933.66%2C+-39226.19+6562933.55%2C+-39226.24+6562933.54%2C+-39226.47+6562933.44%2C+-39226.86+6562933.28%2C+-39227.37+6562933.06%2C+-39227.66+6562932.95%2C+-39227.79+6562932.9%2C+-39227.89+6562932.85%2C+-39228.03+6562932.79%2C+-39228.27+6562932.7%2C+-39228.36+6562932.66%2C+-39228.68+6562932.53%2C+-39228.72+6562932.51%2C+-39228.8+6562932.48%2C+-39229.05+6562932.38%2C+-39229.17+6562932.33%2C+-39229.65+6562932.13%2C+-39230.11+6562931.94%2C+-39230.57+6562931.75%2C+-39230.97+6562931.6%2C+-39231.7+6562931.29%2C+-39232.43+6562930.99%2C+-39232.72+6562930.88%2C+-39233.67+6562930.48%2C+-39234.05+6562930.32%2C+-39234.28+6562930.23%2C+-39235.68+6562929.65%2C+-39236.15+6562929.46%2C+-39236.37+6562929.37%2C+-39238+6562928.7%2C+-39239.07+6562928.27%2C+-39239.85+6562927.94%2C+-39240.87+6562927.52%2C+-39241.18+6562927.4%2C+-39241.71+6562927.19%2C+-39241.83+6562927.14%2C+-39243.56+6562926.42%2C+-39244.52+6562926.03%2C+-39245.15+6562925.76%2C+-39245.42+6562925.66%2C+-39245.6+6562925.58%2C+-39247.23+6562924.91%2C+-39247.27+6562924.9%2C+-39249.14+6562924.14%2C+-39249.93+6562923.81%2C+-39250.01+6562923.78%2C+-39250.99+6562923.37%2C+-39252.64+6562922.69%2C+-39252.69+6562922.68%2C+-39252.85+6562922.61%2C+-39252.94+6562922.57%2C+-39254.45+6562921.96%2C+-39254.7+6562921.85%2C+-39255.35+6562921.59%2C+-39256.56+6562921.09%2C+-39257.15+6562920.84%2C+-39258.06+6562920.47%2C+-39258.41+6562920.32%2C+-39258.96+6562920.1%2C+-39260.27+6562919.56%2C+-39260.77+6562919.36%2C+-39262.13+6562918.8%2C+-39263.48+6562918.25%2C+-39263.98+6562918.04%2C+-39265.84+6562917.28%2C+-39266.18+6562917.14%2C+-39267.69+6562916.52%2C+-39267.99+6562916.39%2C+-39268.9+6562916.02%2C+-39269.55+6562915.76%2C+-39270.7+6562915.28%2C+-39271.4+6562915%2C+-39271.61+6562914.91%2C+-39272.12+6562914.7%2C+-39272.33+6562914.61%2C+-39272.51+6562914.53%2C+-39272.76+6562914.44%2C+-39273.27+6562914.23%2C+-39273.41+6562914.17%2C+-39273.46+6562914.15%2C+-39273.88+6562913.97%2C+-39274.14+6562913.87%2C+-39274.19+6562913.85%2C+-39274.31+6562913.8%2C+-39274.91+6562913.55%2C+-39275.12+6562913.47%2C+-39275.22+6562913.43%2C+-39275.76+6562913.21%2C+-39276.12+6562913.06%2C+-39276.36+6562912.96%2C+-39276.5+6562912.91%2C+-39277.03+6562912.69%2C+-39277.06+6562912.67%2C+-39277.12+6562912.64%2C+-39277.16+6562912.64%2C+-39277.25+6562912.59%2C+-39277.34+6562912.55%2C+-39277.44+6562912.52%2C+-39277.5+6562912.5%2C+-39277.53+6562912.48%2C+-39277.63+6562912.44%2C+-39277.72+6562912.41%2C+-39277.8+6562912.36%2C+-39277.9+6562912.33%2C+-39277.97+6562912.3%2C+-39277.99+6562912.29%2C+-39278.09+6562912.25%2C+-39278.18+6562912.22%2C+-39278.28+6562912.17%2C+-39278.37+6562912.14%2C+-39278.45+6562912.1%2C+-39278.55+6562912.06%2C+-39278.64+6562912.03%2C+-39278.74+6562911.98%2C+-39278.83+6562911.95%2C+-39278.92+6562911.91%2C+-39279.02+6562911.87%2C+-39279.11+6562911.84%2C+-39279.2+6562911.79%2C+-39279.29+6562911.75%2C+-39279.38+6562911.72%2C+-39279.48+6562911.68%2C+-39279.57+6562911.65%2C+-39279.67+6562911.6%2C+-39279.75+6562911.57%2C+-39279.85+6562911.53%2C+-39279.94+6562911.49%2C+-39280.03+6562911.46%2C+-39280.13+6562911.41%2C+-39280.22+6562911.37%2C+-39280.31+6562911.34%2C+-39280.41+6562911.3%2C+-39280.5+6562911.27%2C+-39280.6+6562911.22%2C+-39280.68+6562911.18%2C+-39280.77+6562911.15%2C+-39280.87+6562911.11%2C+-39280.96+6562911.07%2C+-39281.06+6562911.03%2C+-39281.15+6562910.99%2C+-39281.24+6562910.96%2C+-39281.34+6562910.92%2C+-39281.42+6562910.88%2C+-39281.52+6562910.84%2C+-39281.61+6562910.8%2C+-39281.71+6562910.77%2C+-39281.8+6562910.73%2C+-39281.89+6562910.69%2C+-39281.99+6562910.66%2C+-39282.08+6562910.61%2C+-39282.17+6562910.57%2C+-39282.26+6562910.54%2C+-39282.35+6562910.5%2C+-39282.45+6562910.46%2C+-39282.54+6562910.42%2C+-39282.64+6562910.38%2C+-39282.73+6562910.35%2C+-39282.82+6562910.31%2C+-39282.91+6562910.27%2C+-39283+6562910.23%2C+-39283.1+6562910.19%2C+-39283.19+6562910.16%2C+-39283.29+6562910.12%2C+-39283.38+6562910.09%2C+-39283.47+6562910.04%2C+-39283.56+6562910%2C+-39283.65+6562909.97%2C+-39283.75+6562909.93%2C+-39283.84+6562909.89%2C+-39283.91+6562909.86%2C+-39283.93+6562909.85%2C+-39284.03+6562909.81%2C+-39284.12+6562909.78%2C+-39284.22+6562909.74%2C+-39284.3+6562909.7%2C+-39284.39+6562909.66%2C+-39284.49+6562909.62%2C+-39284.58+6562909.59%2C+-39284.68+6562909.55%2C+-39284.77+6562909.51%2C+-39284.86+6562909.47%2C+-39284.96+6562909.43%2C+-39285.04+6562909.39%2C+-39285.14+6562909.36%2C+-39285.23+6562909.32%2C+-39285.32+6562909.28%2C+-39285.42+6562909.24%2C+-39285.45+6562909.22%2C+-39285.51+6562909.2%2C+-39285.59+6562909.18%2C+-39285.61+6562909.17%2C+-39285.65+6562909.14%2C+-39285.7+6562909.13%2C+-39285.77+6562909.1%2C+-39285.88+6562909.05%2C+-39285.9+6562909.04%2C+-39285.97+6562909.01%2C+-39286.03+6562908.99%2C+-39286.07+6562908.98%2C+-39286.15+6562908.94%2C+-39286.25+6562908.9%2C+-39286.29+6562908.89%2C+-39286.42+6562908.83%2C+-39286.56+6562908.77%2C+-39286.71+6562908.71%2C+-39286.83+6562908.66%2C+-39286.98+6562908.61%2C+-39287.12+6562908.54%2C+-39287.28+6562908.48%2C+-39287.43+6562908.42%2C+-39287.58+6562908.35%2C+-39287.74+6562908.29%2C+-39287.85+6562908.24%2C+-39287.9+6562908.23%2C+-39288.05+6562908.16%2C+-39288.11+6562908.14%2C+-39288.22+6562908.1%2C+-39288.54+6562907.96%2C+-39288.68+6562907.9%2C+-39288.78+6562907.86%2C+-39288.83+6562907.85%2C+-39288.97+6562907.78%2C+-39289.13+6562907.71%2C+-39289.29+6562907.66%2C+-39289.45+6562907.59%2C+-39289.6+6562907.52%2C+-39289.69+6562907.49%2C+-39289.76+6562907.46%2C+-39289.92+6562907.39%2C+-39289.97+6562907.38%2C+-39290.02+6562907.35%2C+-39290.13+6562907.31%2C+-39290.18+6562907.28%2C+-39290.27+6562907.25%2C+-39290.41+6562907.19%2C+-39290.56+6562907.13%2C+-39290.59+6562907.12%2C+-39290.71+6562907.07%2C+-39290.86+6562907.01%2C+-39290.89+6562907%2C+-39291+6562906.95%2C+-39291.16+6562906.89%2C+-39291.32+6562906.82%2C+-39291.46+6562906.76%2C+-39291.49+6562906.75%2C+-39291.62+6562906.7%2C+-39291.82+6562906.62%2C+-39291.9+6562906.58%2C+-39292.39+6562906.38%2C+-39293.29+6562906.01%2C+-39293.5+6562905.92%2C+-39293.68+6562905.85%2C+-39294.03+6562905.71%2C+-39294.19+6562905.64%2C+-39295.09+6562905.27%2C+-39295.53+6562905.09%2C+-39296+6562904.9%2C+-39296.9+6562904.53%2C+-39297.39+6562904.33%2C+-39297.8+6562904.16%2C+-39298.71+6562903.78%2C+-39299.25+6562903.57%2C+-39299.61+6562903.42%2C+-39300.51+6562903.05%2C+-39301.1+6562902.8%2C+-39301.42+6562902.68%2C+-39302.32+6562902.31%2C+-39302.96+6562902.04%2C+-39303.23+6562901.94%2C+-39304.13+6562901.56%2C+-39304.32+6562901.49%2C+-39304.81+6562901.28%2C+-39305.03+6562901.19%2C+-39305.23+6562901.11%2C+-39305.94+6562900.82%2C+-39306.02+6562900.79%2C+-39306.15+6562900.74%2C+-39306.67+6562900.52%2C+-39306.84+6562900.45%2C+-39307.07+6562900.36%2C+-39307.49+6562900.18%2C+-39307.75+6562900.08%2C+-39307.98+6562899.98%2C+-39308.52+6562899.75%2C+-39308.65+6562899.7%2C+-39308.9+6562899.61%2C+-39309.21+6562899.47%2C+-39309.33+6562899.43%2C+-39309.56+6562899.33%2C+-39310.38+6562899%2C+-39310.47+6562898.96%2C+-39310.73+6562898.85%2C+-39311.37+6562898.59%2C+-39311.83+6562898.41%2C+-39312.24+6562898.24%2C+-39312.28+6562898.22%2C+-39312.5+6562898.13%2C+-39313.19+6562897.85%2C+-39313.39+6562897.77%2C+-39314.09+6562897.48%2C+-39315+6562897.1%2C+-39315.17+6562897.03%2C+-39315.91+6562896.73%2C+-39315.95+6562896.71%2C+-39316.07+6562896.66%2C+-39316.82+6562896.35%2C+-39317.27+6562896.17%2C+-39317.37+6562896.13%2C+-39317.54+6562896.05%2C+-39317.63+6562896.02%2C+-39317.72+6562895.99%2C+-39317.78+6562895.96%2C+-39317.8+6562895.95%2C+-39319.54+6562895.24%2C+-39319.66+6562895.19%2C+-39321.51+6562894.43%2C+-39322.27+6562894.12%2C+-39322.59+6562893.98%2C+-39323.18+6562893.74%2C+-39323.37+6562893.66%2C+-39325+6562893%2C+-39325.2+6562892.91%2C+-39325.23+6562892.9%2C+-39326.82+6562892.25%2C+-39327.09+6562892.14%2C+-39328.85+6562891.42%2C+-39328.94+6562891.38%2C+-39330.46+6562890.75%2C+-39330.8+6562890.61%2C+-39331.36+6562890.38%2C+-39332.65+6562889.85%2C+-39334.1+6562889.26%2C+-39334.51+6562889.1%2C+-39335.75+6562888.58%2C+-39335.92+6562888.52%2C+-39336.36+6562888.34%2C+-39337.74+6562887.77%2C+-39338.22+6562887.57%2C+-39339.32+6562887.11%2C+-39339.84+6562886.91%2C+-39340.08+6562886.81%2C+-39340.48+6562886.64%2C+-39341.39+6562886.27%2C+-39341.84+6562886.08%2C+-39341.93+6562886.05%2C+-39343.79+6562885.29%2C+-39344.12+6562885.15%2C+-39345.05+6562884.77%2C+-39345.64+6562884.52%2C+-39346.86+6562884.03%2C+-39347.27+6562883.86%2C+-39347.5+6562883.76%2C+-39349.35+6562883%2C+-39349.6+6562882.9%2C+-39350.6+6562882.49%2C+-39351.22+6562882.24%2C+-39353.07+6562881.47%2C+-39354.16+6562881.03%2C+-39354.62+6562880.84%2C+-39354.93+6562880.71%2C+-39355.5+6562880.47%2C+-39356.78+6562879.95%2C+-39357.04+6562879.85%2C+-39358.63+6562879.19%2C+-39360.49+6562878.43%2C+-39362.2+6562877.73%2C+-39362.27+6562877.7%2C+-39362.34+6562877.67%2C+-39362.81+6562877.48%2C+-39363.28+6562877.29%2C+-39363.74+6562877.1%2C+-39364.21+6562876.91%2C+-39364.33+6562876.86%2C+-39365.13+6562876.53%2C+-39365.6+6562876.34%2C+-39366.06+6562876.15%2C+-39366.85+6562875.82%2C+-39367.92+6562875.38%2C+-39368.47+6562875.16%2C+-39369.77+6562874.62%2C+-39378.13+6562871.19%2C+-39379.04+6562870.81%2C+-39386.48+6562867.78%2C+-39386.92+6562867.59%2C+-39387.39+6562867.4%2C+-39388.28+6562867.01%2C+-39389.17+6562866.6%2C+-39390.04+6562866.17%2C+-39390.92+6562865.74%2C+-39391.77+6562865.28%2C+-39392.62+6562864.81%2C+-39393.32+6562864.4%2C+-39393.45+6562864.33%2C+-39393.81+6562864.09%2C+-39394.17+6562863.83%2C+-39394.28+6562863.76%2C+-39394.57+6562863.52%2C+-39394.86+6562863.29%2C+-39394.99+6562863.17%2C+-39395.25+6562862.93%2C+-39395.49+6562862.68%2C+-39395.79+6562862.36%2C+-39396.09+6562862.03%2C+-39396.36+6562861.68%2C+-39396.61+6562861.33%2C+-39396.86+6562860.96%2C+-39397.08+6562860.59%2C+-39397.29+6562860.2%2C+-39397.48+6562859.81%2C+-39397.66+6562859.41%2C+-39397.82+6562859%2C+-39397.97+6562858.58%2C+-39398.1+6562858.16%2C+-39398.19+6562857.8%2C+-39398.26+6562857.44%2C+-39398.29+6562857.31%2C+-39398.36+6562856.87%2C+-39398.42+6562856.44%2C+-39398.45+6562856.01%2C+-39398.47+6562855.56%2C+-39398.47+6562855.12%2C+-39398.46+6562854.69%2C+-39398.42+6562854.25%2C+-39398.37+6562853.81%2C+-39398.28+6562853.32%2C+-39398+6562851.93%2C+-39397.86+6562851.24%2C+-39397.72+6562850.61%2C+-39397.58+6562849.99%2C+-39397.37+6562849.02%2C+-39397.15+6562848.05%2C+-39396.92+6562847.08%2C+-39396.68+6562846.12%2C+-39396.62+6562845.85%2C+-39396.19+6562844.19%2C+-39395.68+6562842.27%2C+-39395.14+6562840.37%2C+-39394.86+6562839.41%2C+-39394.61+6562838.58%29&maks_avstand=300&detaljerte_lenker=false&pretty=false&kortform=false&vegsystemreferanse=E%2CK%2CF%2CR
{noformat}

Dette blir for mange tegn i URL'en og Tomcat kneler med fÃ¸lgende respons:

{noformat}
6 < 400
6 < Set-Cookie: 220dc34f3d07f10f55591555f8bb93c2=1acac74f84a313d516ef56b635313768; path=/; HttpOnly; Secure
6 < Content-Length: 1866
6 < Date: Sat, 16 May 2020 15:48:32 GMT
6 < Content-Language: en
6 < Content-Type: text/html;charset=utf-8
<!doctype html><html lang=""en""><head><title>HTTP Status 400 â€“ Bad Request</title><style type=""text/css"">body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}</style></head><body><h1>HTTP Status 400 â€“ Bad Request</h1><hr class=""line"" /><p><b>Type</b> Exception Report</p><p><b>Message</b> Request header is too large</p><p><b>Description</b> The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing).</p><p><b>Exception</b></p><pre>java.lang.IllegalArgumentException: Request header is too large
	org.apache.coyote.http11.Http11InputBuffer.fill(Http11InputBuffer.java:726)
	org.apache.coyote.http11.Http11InputBuffer.parseRequestLine(Http11InputBuffer.java:464)
	org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:502)
	org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
	org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:810)
	org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1506)
	org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	java.lang.Thread.run(Thread.java:748)
</pre><p><b>Note</b> The full stack trace of the root cause is available in the server logs.</p><hr class=""line"" /><h3>Apache Tomcat/8.5.49</h3></body></html>
{noformat}

Til tross for at API Skriv kjÃ¸rer Douglas-Peucker og stripper bort unÃ¸dvendige desimaler i koordinatene ble det altsÃ¥ for langt.

Ruteberegneren i API Les bÃ¸r skrives om til Ã¥ ta i mot geometriene som request-payload via POST.",NVDB-6937,Les-API,
Forbedre tekst / endre flyt pÃ¥ glemt passord,"h2. Observasjon
Et tilbakevendende problem pÃ¥ datafangst-support er brukere i SVV og fylkeskommune som sier at de har brukt ""glemt passord"" og ikke fÃ¥tt noen mail.

De fÃ¥r ikke noen mail fordi de ikke er registrert som e-postbruker i Datafangst (noe vi uansett ikke vil), og de fÃ¥r heller ikke beskjed om at mail ikke er sendt. Hvis de hadde fÃ¥tt beskjed hadde sida kunne brukes til Ã¥ gjette registrerte brukere i Datafangst, noe som er dÃ¥rlig sikkerhetspraksis.

h2. Analyse
Problemet oppstÃ¥r fordi denne lÃ¸sningen ikke er ment for dem, og det er lite der som kan hjelpe dem Ã¥ skjÃ¸nne at de ikke kan bruke denne funksjonen nÃ¥r de ikke kommer inn i datafangst.

h2. Forslag til lÃ¸sning
Det bÃ¸r vÃ¦re en tekst der som tydelig formidler hvem som kan bruke ""glemt passord"", og hva som er alternativene for andre brukere.
Siden vi vet at folk ikke leser tekst og heller gÃ¥r rett pÃ¥ input, kan vi vurdere om folk fÃ¸rst mÃ¥ velge sin kategori fÃ¸r de fÃ¥r fram tekst eller skjema som er relevante for dem.",NVDB-6937,Datafangst,
Sjekk for overlapp internt i kontrakt og vis feilmelding,"h2. Observasjon
Et problem som dukker opp relativt ofte er at bruker fÃ¥r feil ved overlapp internt i kontrakten ved innsending til NVDB. En del vegobjekttyper tillater ikke overlapp med andre av samme type, som gjÃ¸r at Skriv API avvise disse nÃ¥r det er overlapp i stedfesting.

Ett konkret eksempel er to vegobjekter av type veidekke med lik geometri, men forskjellige attributter for lagtype. Et annet eksempel kan vÃ¦re en unÃ¸yaktig mÃ¥ling som gjÃ¸r at det er litt overlapp mellom objekter.

h2. Analyse
Ved import av vegobjekter burde vi kunne gÃ¥ over alle typer som ikke kan ha overlapp, og sjekke om det er overlappende geometri. Bittelitt overlapp pÃ¥ geometri mÃ¥ kunne tolereres, siden vi kan lirke til dette med stedfesting. Hvis det er vesentlig overlapp bÃ¸r det vises som en feil pÃ¥ alle vegobjekter involvert i overlapp.",NVDB-6937,Datafangst,
Statistikkpunkter vises for omrÃ¥der utenfor sÃ¸k,"GÃ¥ til:

https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@205513,6656638,5/hva:~(~(id~532))/hvor:~(fylke~(~30)~vegsystemreferanse~(~'FV))

 !Screenshot from 2020-05-15 12-10-57.png|thumbnail! 

Selv om resultatlisten er korrekt, vises statistikkpunkter for fylker utenfor filtrert omrÃ¥de.

Dette skjer fordi fetchVegobjekter.fetchVegobjekterStatisticsByFylke() og fetchVegnett.fetchVegnettStatisticsByFylke() ikke tar hensyn til omrÃ¥der i sÃ¸ket nÃ¥r det er for mange objekter Ã¥ hente, og man skal opprette omrÃ¥destatistikk i stedet.

Feil introdusert i refaktorering av area-bruk i egenskapsfilter til kun omrÃ¥defilter (NVDB-5379).",NVDB-6937,Vegkart,
Ved feil med stedfesting med Skriv henger spinner,"h2. Observasjon
Ved stedfesting med Skriv, og nÃ¥r vi fÃ¥r feil i NVDB-5535, sÃ¥ fortsetter spinner Ã¥ gÃ¥ etter at stedfesting er avbrutt.

h2. Analyse
Vi fanger feilen og sender den videre pÃ¥ riktig mÃ¥te, men mottaker til kjÃ¸ring har ikke hÃ¥ndtert at exception er wrappet.",NVDB-6937,Datafangst,
Ruteberegning: Punkter i rute for polygon,"h2. Observasjon

Request til ruteberegner:

{noformat}
GET https://nvdbapiles-v3.test.atlas.vegvesen.no/beta/vegnett/rute?geometri=LINESTRING+%28270203.15+7041918.45%2C+270203.12+7041921.1%2C+270202.94+7041928.89%2C+270202.66+7041928.89%2C+270202.44+7041933.08%2C+270202.25+7041935.64%2C+270200.05+7041935.65%2C+270200.05+7041935.8%2C+270199.01+7041935.78%2C+270198.99+7041934.8%2C+270199.16+7041934.81%2C+270199.19+7041934.7%2C+270199.11+7041932.03%2C+270198.99+7041930.45%2C+270200.05+7041930.55%2C+270200.14+7041925.46%2C+270200.14+7041924.67%2C+270200.24+7041918.54%2C+270200.28+7041916.14%2C+270200.43+7041908.83%2C+270200.49+7041906.44%2C+270200.64+7041899.43%2C+270200.81+7041891.73%2C+270201.33+7041866.85%2C+270201.38+7041864.6%2C+270201.65+7041854.5%2C+270199.18+7041854.59%2C+270199.27+7041851%2C+270199.31+7041850.23%2C+270199.41+7041849.44%2C+270199.55+7041848.68%2C+270199.98+7041847.36%2C+270200.4+7041846.4%2C+270200.64+7041845.98%2C+270201.12+7041845.19%2C+270201.97+7041844.02%2C+270202.49+7041843.43%2C+270203.15+7041842.75%2C+270204.44+7041841.7%2C+270205.79+7041840.88%2C+270206.53+7041840.52%2C+270208.16+7041839.97%2C+270209.05+7041839.76%2C+270213.19+7041839.19%2C+270213.46+7041839.15%2C+270218.3+7041843.78%2C+270215.37+7041844.24%2C+270215.4+7041844.64%2C+270214.77+7041844.75%2C+270215.12+7041848.74%2C+270214.22+7041851.31%2C+270213.63+7041851.39%2C+270205.68+7041852.3%2C+270205.4+7041852.44%2C+270205.14+7041852.67%2C+270204.91+7041852.92%2C+270204.69+7041853.33%2C+270204.64+7041853.47%2C+270204.22+7041854.08%2C+270204.21+7041855.44%2C+270204.16+7041857.09%2C+270203.69+7041857.07%2C+270203.68+7041858.67%2C+270204.31+7041858.68%2C+270204.32+7041858.79%2C+270204.38+7041858.78%2C+270204.38+7041859.94%2C+270204.44+7041859.93%2C+270204.44+7041859.95%2C+270204.43+7041860.7%2C+270204.37+7041860.7%2C+270204.25+7041866.91%2C+270204.16+7041870.76%2C+270203.94+7041881.99%2C+270203.56+7041881.99%2C+270203.51+7041883.67%2C+270203.9+7041883.67%2C+270203.72+7041891.79%2C+270203.45+7041903.53%2C+270203.41+7041905.85%2C+270203.17+7041917.19%2C+270203.15+7041918.45%29&maks_avstand=300&detaljerte_lenker=false&pretty=false&kortform=false&vegsystemreferanse=FV6690&typeveg=enkelBilveg
1 > Accept: application/json
1 > X-Client: NVDB API Skriv
{noformat}

Respons:

{noformat}
2 < 200
2 < Access-Control-Allow-Origin: *
2 < Access-Control-Allow-Methods: GET, POST, OPTIONS
2 < X-REQUEST-ID: 9c43bfc9-7e4e-9805-dc1d-b02327f86c89
2 < Date: Thu, 14 May 2020 17:24:15 GMT
2 < Access-Control-Allow-Headers: accept, x-client, x-client-session, origin
2 < X-Robots-Tag: none
2 < Cache-Control: no-cache
2 < X-Datakatalog-Versjon: 2.20
2 < Set-Cookie: 220dc34f3d07f10f55591555f8bb93c2=1acac74f84a313d516ef56b635313768; path=/; HttpOnly; Secure
2 < Content-Length: 4647
2 < Access-Control-Max-Age: 1728000
2 < Content-Type: application/json;charset=utf-8
[{""href"":""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/72812"",""metadata"":{""startdato"":""2020-03-04""},""veglenkesekvensid"":72812,""startposisjon"":0.78970927,""sluttposisjon"":0.78970927,""kortform"":""0.78970927@72812"",""veglenkenummer"":27,""startnode"":""1869851"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2"",""3K"",""4""],""geometri"":{""wkt"":""POINT Z(270191.86 7041929.32 9.233)"",""srid"":5973},""lengde"":0.0,""fylke"":50,""kommune"":5001,""vegsystemreferanse"":{""vegsystem"":{""id"":1002159798,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":6690},""strekning"":{""id"":1003469232,""versjon"":1,""strekning"":2,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""meter"":1016.314,""retning"":""MOT""},""kortform"":""FV6690 S2D1 m1016""},""kontraktsomrÃ¥der"":[{""id"":376447712,""navn"":""1610 Trondheim Indre 2015-2020""},{""id"":920262210,""navn"":""5006 Trondheim 2020-2028""},{""id"":218658146,""navn"":""1609 TrondheimBydrift 2011-2015""}],""riksvegruter"":[{""id"":137054102,""nummer"":""6A"",""navn"":""RUTE6A"",""periode"":""2010-2019""}]},{""href"":""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/72812"",""metadata"":{""startdato"":""2020-03-04""},""veglenkesekvensid"":72812,""startposisjon"":0.78970927,""sluttposisjon"":0.79084754,""kortform"":""0.78970927-0.79084754@72812"",""veglenkenummer"":27,""startnode"":""1869851"",""sluttnode"":""2860952"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2"",""3K"",""4""],""geometri"":{""wkt"":""LINESTRING Z(270191.86 7041929.32 9.233, 270192.65 7041934.83 9.183)"",""srid"":5973},""lengde"":5.567000000000007,""fylke"":50,""kommune"":5001,""vegsystemreferanse"":{""vegsystem"":{""id"":1002159798,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":6690},""strekning"":{""id"":1003469232,""versjon"":1,""strekning"":2,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":1016.314,""til_meter"":1021.881,""retning"":""MOT""},""kortform"":""FV6690 S2D1 m1016-1022""},""kontraktsomrÃ¥der"":[{""id"":376447712,""navn"":""1610 Trondheim Indre 2015-2020""},{""id"":920262210,""navn"":""5006 Trondheim 2020-2028""},{""id"":218658146,""navn"":""1609 TrondheimBydrift 2011-2015""}],""riksvegruter"":[{""id"":137054102,""nummer"":""6A"",""navn"":""RUTE6A"",""periode"":""2010-2019""}]},{""href"":""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/2510770"",""metadata"":{""startdato"":""2020-03-04""},""veglenkesekvensid"":2510770,""startposisjon"":0.6140563,""sluttposisjon"":1.0,""kortform"":""0.6140563-1.0@2510770"",""veglenkenummer"":2,""startnode"":""1869850"",""sluttnode"":""2510767"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2"",""3K"",""4K""],""geometri"":{""wkt"":""LINESTRING Z(270193.69 7041838.28 10.034, 270193.4 7041839.38 10.034, 270192.565 7041842.816 10.034, 270192.045 7041846.112 10.034)"",""srid"":5973},""lengde"":8.009999999999998,""fylke"":50,""kommune"":5001,""vegsystemreferanse"":{""vegsystem"":{""id"":1002159797,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":6690},""strekning"":{""id"":1003469234,""versjon"":1,""strekning"":3,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""fra_meter"":0.0,""til_meter"":8.01,""retning"":""MOT""},""kortform"":""FV6690 S3D1 m0-8""},""kontraktsomrÃ¥der"":[{""id"":376447712,""navn"":""1610 Trondheim Indre 2015-2020""},{""id"":920262210,""navn"":""5006 Trondheim 2020-2028""},{""id"":218658146,""navn"":""1609 TrondheimBydrift 2011-2015""}],""riksvegruter"":[]},{""href"":""https://nvdbapiles-v3.test.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert/72812"",""metadata"":{""startdato"":""2020-03-04""},""veglenkesekvensid"":72812,""startposisjon"":0.78970927,""sluttposisjon"":0.78970927,""kortform"":""0.78970927@72812"",""veglenkenummer"":27,""startnode"":""1869851"",""type"":""HOVED"",""detaljnivÃ¥"":""Vegtrase og kjÃ¸rebane"",""typeVeg"":""Enkel bilveg"",""typeVeg_sosi"":""enkelBilveg"",""feltoversikt"":[""1"",""2"",""3K"",""4""],""geometri"":{""wkt"":""POINT Z(270191.86 7041929.32 9.233)"",""srid"":5973},""lengde"":0.0,""fylke"":50,""kommune"":5001,""vegsystemreferanse"":{""vegsystem"":{""id"":1002159798,""versjon"":1,""vegkategori"":""F"",""fase"":""V"",""nummer"":6690},""strekning"":{""id"":1003469232,""versjon"":1,""strekning"":2,""delstrekning"":1,""arm"":false,""adskilte_lÃ¸p"":""Nei"",""trafikantgruppe"":""K"",""meter"":1016.314,""retning"":""MOT""},""kortform"":""FV6690 S2D1 m1016""},""kontraktsomrÃ¥der"":[{""id"":376447712,""navn"":""1610 Trondheim Indre 2015-2020""},{""id"":920262210,""navn"":""5006 Trondheim 2020-2028""},{""id"":218658146,""navn"":""1609 TrondheimBydrift 2011-2015""}],""riksvegruter"":[{""id"":137054102,""nummer"":""6A"",""navn"":""RUTE6A"",""periode"":""2010-2019""}]}]
{noformat}

InngÃ¥ende geometri er et polygon. Returnert rute starter med et punkt, fortsetter med to linjer og avsluttes med et punkt som er identisk med det fÃ¸rste. Det gir ingen mening Ã¥ levere med disse punktene. En rute mÃ¥ bestÃ¥ av utstrekning.",,Les-API,
Ulovlig versjonering i fÃ¸lgeoppdatering ved lukking av vegnett,"Ad akseptansetesting av NVDB-5375.

h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/3a65998f-463f-4c48-9658-0bd295bb0316 avvises pÃ¥ grunn av ulovlig versjonering i en fÃ¸lgeoppdatering.

h2. Analyse

Endringssettet er litt annerledes her enn det i NVDB-5375. I sistnevnte lukkes alle vegobjektene som blir delvis berÃ¸rt av vegnettslukking pÃ¥ lukkedato for vegnettet. I denne saken sitt endringssett er det to berÃ¸rte vegobjekter som ikke lukkes:

VEGOBJEKTTYPE=GSV langs annen vegkategori (949); ID=1006516746; VERSJON=2; STARTDATO=2020-05-08; SLUTTDATO=null
VEGOBJEKTTYPE=GSV langs annen vegkategori (949); ID=1006516614; VERSJON=2; STARTDATO=2020-05-08; SLUTTDATO=null

Dersom disse to ogsÃ¥ hadde blitt lukket i endringssettet ville det gÃ¥tt gjennom uten feil.

Dette er et litt annerledes case, men likefullt noe som bÃ¸r hÃ¥ndteres bedre av API Skriv. De to vegobjektene er delvis berÃ¸rt av vegnettslukking og forsÃ¸kes derfor versjonert med redusert stedfesting i v2. Men - de kan ikke versjoneres. Hvordan skal dette hÃ¥ndteres?

1) Vegobjektene lukkes pÃ¥ lukkedato for vegnettet?
2) Som over + nyregistrering av kopi av disse vegobjektene med redusert stedfesting?

I samrÃ¥d med Arne SonflÃ¥ og Hans JÃ¸rgen Ekker gÃ¥r vi for alternativ 2.

h2. LÃ¸sning

Oppdaterte AdaptFeaturesToClosedNetworkEnricherFilter.createEnrichmentsForFeature() med forgreining som trigger splitting av ikke-versjonerbar vegobjekttype. Splitting fÃ¸rer til to berikinger i jobben; DISCONTINUE pÃ¥ originalen og CREATE med lokasjonsredusert kopi av originalen. Operasjon CREATE som beriking i jobben er nytt og krevde noen tilpasninger i JobResultWriter, JobEnricher and JobWorker. ",NVDB-6937,Skriv-API,
Nytt gatenavn pÃ¥ eksisterende gatekode i samme kommune avvises ikke,"Ad akseptansetesting av NVDB-5464.

h2. Observasjon

Bruker ragntunh fikk utfÃ¸rt fÃ¸lgende endringssett i ATM: https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/e9900805-05c5-4292-a1d1-a111d5a3ba98

Beskrivelse fra bruker:

Jeg testet dette nÃ¥ og jeg fikk sjekket inn 3 gateobjekt med feil gatenavn i forhold til gatekoden i Indre Ã˜stfold. Legger ved informasjon om endringssettet mitt, slik at dere kan se pÃ¥ det. Jeg la pÃ¥ nye gateobjekt og brukte gatekoder som er brukt andre steder i kommunen, men la inn et annet gatenavn enn det navnet gaten har pÃ¥ de andre stedene i kommunen. Det gjelder gatekode 1002 som fikk navnet ""Arnolds veg"", men som heter ""Arnoldts vei"" andre steder i kommunen. Gatekode 10053 som fikk navnet ""BÃ¥sstadveien"", som heter ""BÃ¥stadveien"" andre steder i kommunen. Og gatekode 22500 som fikk navnet ""Fredheimvegen"", som skal ha navnet ""Fredheimsveien"".

h2. Analyse

I endringssettet registreres tre nye Gate-objekter i kommune ""Indre Ã˜stfold"" som har kommunenr 3014:

*1) Gate tempId ""-1"" med gatekode ""1002"" og gatenavn ""Arnolds veg""*

I NVDB-ATM finner jeg ingen andre Gate-objekter i denne kommunen med gatekode ""1002"": https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/538?egenskap=%22egenskap(4588)=1002%20AND%20relasjon(946,egenskap(11769)=3014)%22
Jeg finner heller ingen andre Gate-objekter i denne kommunen med gatenavn ""Arnolds veg"": https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/538?egenskap=%22egenskap(4589)=%27Arnolds%20veg%27%20AND%20relasjon(946,egenskap(11769)=3014)%22

*2) Gate tempId ""-2"" med gatekode ""10053"" og gatenavn ""BÃ¥sstadveien""*

I NVDB-ATM finner jeg ingen andre Gate-objekter i denne kommunen med gatekode ""10053"": https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/538?egenskap=%22egenskap(4588)=10053%20AND%20relasjon(946,egenskap(11769)=3014)%22
Jeg finner heller ingen andre Gate-objekter i denne kommunen med gatenavn ""BÃ¥sstadveien"": https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/538?egenskap=%22egenskap(4589)=%27BÃ¥sstadveien%27%20AND%20relasjon(946,egenskap(11769)=3014)%22

*3) Gate tempId ""-3"" med gatekode 22500 og gatenavn ""Fredheimvegen""*

I NVDB-ATM finner jeg ingen andre Gate-objekter i denne kommunen med gatekode ""22500"": https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/538?egenskap=%22egenskap(4588)=22500%20AND%20relasjon(946,egenskap(11769)=3014)%22
Jeg finner heller ingen andre Gate-objekter i denne kommunen med gatenavn ""Fredheimvegen"": https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/538?egenskap=%22egenskap(4589)=%27Fredheimvegen%27%20AND%20relasjon(946,egenskap(11769)=3014)%22

Basert pÃ¥ funnene over er det altsÃ¥ korrekt oppfÃ¸rsel av API Skriv og utfÃ¸re endringssettet uten innsigelser.",NVDB-6937,Skriv-API,
Tillate endring av FeatureCollection med ERROR eller REJECT,"h2. Observasjon
Dersom det oppstÃ¥r en feil (usikkert hva) sÃ¥ lÃ¥ses en featurecollection. Tilstand settes i ERROR og nye forsÃ¸k pÃ¥ Ã¥ sende inn blir avviste med melding om at feil i collection mÃ¥ rettes fÃ¸r noe annet kan bli registrert.

Vi bÃ¸r finne ut hvorfor en featurecollection er designet til Ã¥ hindre nye innsendinger hvis en tidligere innsending har en feil. Vi bÃ¸r se pÃ¥ om dette berÃ¸rer feil som sendes inn mot

POST /featurecollection

PUT /featurecollection/<id>

POST /featurecollection/<id>/feature

PUT /featurecollection/<id>/feature/<id>

og evt andre som jeg ikke kommer pÃ¥ i farten.

Denne er relatert til NVDB-5541 og kanskje NVDB-5511.Â 

(Se gjerne ogsÃ¥ gjennom support-henvendelser fra SINUS og Andre LÃ¸set)

h2. Analyse
Har sjekka medÂ Tore (som skrev opprinnelig kode), han kommer ikke pÃ¥ noen spesiell grunn til at det ble lagt inn.

h2. LÃ¸sning
Fjerne kode som blokkerer endring for FeatureCollection med ERROR eller REJECT.",NVDB-6937,Datafangst,
Featurecollection havner i ERROR-tilstand,"SINUS opplever til stadig at en featurecollection havner i tilstand ERROR som gjÃ¸r at de ikke fÃ¥r sendt inn noen flere objekter fÃ¸r feil pÃ¥ collection er rettet.

Vi mÃ¥ se pÃ¥ hvorfor en collection havner i tilstand ERROR. Hva er det som gjÃ¸r dette?

*Her er forelÃ¸pige observasjoner jeg har (gjengitt fra Mattermost)*

Begynte pÃ¥ det nÃ¥, og for meg ser det ut til at det skjer noe ved import av objekt [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/83/114825508]

Men det ser ogsÃ¥ ut til at bruker har noen endringer siden DF etterpÃ¥ sender valideringsmld til Skriv med <delvisOppdater>.

Jeg er pÃ¥ datafangst-server og kjÃ¸rer grep etter e1afa5a3-b85b-4cbd-8711-1de0a80c484d pÃ¥ fil zless datafangst.kantega.no_trace.2020-05-13_12.log.gz. Utdrag fra denne er vedlagt.

Rett etter dette ser det ut som om det er en ERROR-tilstand som kommer, og neste innsending gÃ¥r ikke gjennom.

Ting starter ved tid 2020-05-13T12:27:44.692

Min fÃ¸rste tanke var Ã¥ sette opp en kontrakt og sende inn import av dette objektet med de endringene som ligger i valideringsmld mot Skriv

ForsÃ¸kte sÃ¥ Ã¥ mappe inn de endringene det ser ut til at han har gjort, og ""uheldigvis"" gÃ¥r alt fint inn: ACCEPTED. Brukte vedlagte geojson for dette.

Â 

Denne er relatert til NVDB-5542 og kanskje NVDB-X.

(Se gjerne ogsÃ¥ gjennom support-henvendelser fra SINUS og Andre LÃ¸set)

h2. Analyse
Feil fra Skriv (f.eks. timeout) gjÃ¸r at vi havner i exception handler, og denne setter alltid status for fila til ERROR.

h2. LÃ¸sning
Ikke sett fil-status nÃ¥r vi legger til en fil. Ã… legge til hÃ¥ndteres ogsÃ¥ annerledes ellers i koden (sjekk enum ProcessingMode).",NVDB-6937,Datafangst,
Manuell stedfesting bruker aldri Skriv,"h2. Observasjon

Fiks i NVDB-5534 (for alltid Skriv) ha avslÃ¸rt en annen feil, som gjÃ¸r at flagg fra sesjonen ikke blir brukt.
h2. Analyse

Gyldig bruker blir ikke satt i state. Det finnes en action for dette, men den blir ikke kalt. I stedet kalles ensureCurrentUser direkte i komponent, disse bÃ¸r samkjÃ¸res.
h2. LÃ¸sning

kaller initLocational som setter usersession i state nÃ¥r locational-komponenten mountes",NVDB-6937,Datafangst,
Automatisk bygg og deploy til Atlas,Jenkinsfile og atlas-config,NVDB-6826,Rapportgenerator,
Noen GUI-justeringer,"fikse noen smÃ¥issues som har oppstÃ¥tt pÃ¥ GUI
 * progress overlay overlayer ikke hele skjermen
 * progress overlay viser numerisk progress i hjÃ¸rnet
 * automatisk stedfestings-modalen bÃ¸r lukkes fÃ¸r progress overlay vises
 * automatisert stedfesting sier at objektlisten er oppdatert, men det er misvisende, siden objektliste er spesifikt begrep brukt om noe annet.
 * changelog alert gir feilmeldinger i console fÃ¸r usesession er lastet
 * Fjernet bootstrap-alert, siden det genererte feilmeldinger i console, og siden vi har lyst til Ã¥ fase ut bootstrap pÃ¥ sikt.",NVDB-6937,Datafangst,
Avrunding av posisjon for Locational gjÃ¸r stedfesting umulig i grensetilfeller,"*Bug som hindrer bruker og ikke kan omgÃ¥s.*

*Grunnlag*
 Fikk inn en supportsak om uvanlig feil pÃ¥ trÃ¦r som ble forsÃ¸kt stedfestet. (12.5.2020, feil-id: GckwsMtS og vRmqMLYg). Se vedlagt bilde.

*Analyse*
 Det viser seg i dette tilfellet at posisjonen pÃ¥ trÃ¦rne havner _utenfor_ range pÃ¥ tilknyttet vegsegment.Â 

Feilen oppstÃ¥r fordi vi runder av desimalene i posisjonen for opprettet Locational-objekt, men ikke for range from-to pÃ¥ vegsegmentet. Det gjÃ¸r at en avrundet posisjon kan havne utenfor range i grensetilfeller.

*Eksempel:*
 I denne saken har vi fÃ¸lgende for Punkt 106 ved stedfesting:

Verdi for posisjon fÃ¸r den avrundes:Â 0.69418185309819
 Avrundet verdi for posisjon:Â 0.69418185
 Range for vegsegment:Â Â 0.69418185309819 -Â 0.75878276

Vi ser at fÃ¸r avrunding er verdien pÃ¥ posisjonen innenfor range, men etter avrunding er den ikke innenfor.

*Hvordan gjenskape:*
 Last opp vedlagt SOSI-fil.Â [^NVDB_TrÃ¦r_199_Del1.sos]
 Stedfest treet med alias *Punkt 106*Â manuelt

Bruker du *stedfesting 1*, fÃ¥r du feilmeldingen ""Uvanlig feil"", som skyldes at posisjonen til vegobjektet ikke ble funnet blant vegsegmentene. _(Exception kastes fra metodenÂ getSegmentIndexOfLocationalPosition i LocationalLineExtender.java)_

Feilen oppstÃ¥r ogsÃ¥ i _stedfesting 2_ nÃ¥r vi bruker stedfesting fra skriv, men da med ei riktigere feilmelding:Â _Ingen relevant vegnettstilknytning ble funnet med de angitte parametere_

*Mulig lÃ¸sning:*

Her mÃ¥ man fÃ¸rst se pÃ¥ hvorfor vi runder av antall desimaler pÃ¥ posisjon for Locational.Â  Vi kan ikke nÃ¸dvendigvis bare slutte med det, uten at det kan gi andre problemer i motsatt ende. MÃ¥ eventuelt vurdere om avrunding pÃ¥ posisjonen kan gjÃ¸res pÃ¥ et mer egnet sted, der vi trenger det.

Evt vurdere Ã¥ gjÃ¸re tilsvarende avrunding, eller tillate et visst slingringsmonn der vi henter ut segmentet for posisjonen? SeÂ _getSegmentIndexOfLocationalPosition i LocationalLineExtender.java_

Â 

Â ",,Datafangst,
Manglende tilbakemelding nÃ¥r vi ikke finner stedfestinger (manuell stedfesting),"h1. Observasjon

NÃ¥r vi ikke finner noen stedfesting for et enkelt objekt, vises en tilbakemelding ""udefined"" i GUI.
h2. Implementasjon

la til message i response som sier ""finner ingen stedfesting""",NVDB-6937,Datafangst,
Manuell stedfesting bruker alltid Skriv,"h2. Observasjon

En bug i localize tool gjÃ¸r at vi alltid bruker skriv ved manuell stedfesting
h2. LÃ¸sning

Feilen ligger i en if-setning som skal sjekke om et boolean flagg er satt for om skriv er aktivert. if-setningen sjekker om metoden for Ã¥ avklare flagget finnes, ikke om flagget er satt.
h2. Fix

hent flagget fra props

Â ",NVDB-6937,Datafangst,
Avvik i meter pÃ¥ fylkesveg,"Gjennomgang av rapport etter testing av 9.1.

Sjekk ut de stÃ¸rste avvikene. Noen avvik henger mulig sammen med NVDB-5101.

Â 

[https://ftp.triona.no/NyttVegNett-2020-Test/Logger-2020-05-12/RoadNetwork-Norge-ERF-K-1.log]
 * WARN ;Segment1.MeterGap;3007;180814;0,98393417;1;3010491;213321;0;;E;V;16;;S;47;1;5925;5933;K;;;;2;1#2;;237382;6683178;161;237386;6683172;161;Gap=412,170m
 ** Ser ikke ut til Ã¥ vÃ¦re noe feil. Litt spesielt ""kryss"" som gjÃ¸r at det ser ut som meter hopper:Â [https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:geodata/@237384,6683214,16/hva:~(~(id~916))/vegnett:~'geometri+~()/valgt:1007827752:916]
 * WARN ;Segment1.MeterGap;3411;650735;0;0,10196736;715063;715043;0;;E;V;6;;S;31;50;0;35;K;A;;;2;1#2;;279135;6756287;128;279103;6756300;127;Gap=124,000m
 ** RekkefÃ¸lgen pÃ¥ stedfestinger for strekningen gjÃ¸r at meter ikke blir sammenhengende:Â [https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:geodata/@279061,6756304,16/hva:~(~(id~916))/vegnett:~'geometri+~()/valgt:1006836709:916|https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@279061,6756304,16/hva:~(~(id~916))/vegnett:~'geometri+~()/valgt:1006836709:916]
 * WARN ;Segment1.MeterGap;3033;443452;0,68360583;0,68766603;475479;475480;0;;E;V;16;;S;56;10;0;10;K;A;Med;1-1;2;1#3;;283363;6678039;204;283363;6678030;204;Gap=4366,045m
 ** [https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:topo4/@283412,6678033,17/hva:~(~(id~916))/vegnett:~'geometri+~()/valgt:1003442491:916|https://vegkart.test.atlas.vegvesen.no/#kartlag:topo4/@283412,6678033,17/hva:~(~(id~916))/vegnett:~'geometri+~()/valgt:1003442491:916]Â Ser ut som noe feil med sekvensnummer/stedfesting pÃ¥ strekningsobjekt. Det gjÃ¸r at 0-10M kommer pÃ¥ meter 4376. Sekvensnummer fÃ¸r er 21000 og etter er 22000. Mens strekningen som ligger mellom har sekvensnummer 11000.Â 

Â 

*LÃ¸sning:*

Det er 2 feil som har blitt avdekket:
 # Fylkesveger som krysser fylkesgrenser starter telling av meter fra 0 igjen
 # Veg bytter vegsystem uten at strekning blir oppdatert, slik at strekning dekker begge vegsystem i tid

Â 

Nummer 1 ble lÃ¸st i NVDB-5562.

Nummer 2 ble lÃ¸st ved Ã¥ ta med perioden for vegsystemet i sectionCache-tabellen, og la perioden bli endel av nÃ¸kkelen for innslagene.

Â ",NVDB-6937,NVDB-IND,
Feilmelding ved stedfesting,"h2. Observasjon

PrÃ¸vde Ã¥ stedfeste (MED Skriv) vedlagte SOSI-fil Vegoppmerking. Da fikk jeg fÃ¸lgende feil
{noformat}
java.lang.IllegalArgumentException: fromIndex(0) > toIndex(-100)
{noformat}
Kibana: https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.8-2020.05.13/doc/?id=sg3UDHIB1fw3jcDZf3o6

PrÃ¸vde ogsÃ¥ Ã¥ stedfeste bÃ¥de Vegoppmerking og Vegdekke samtidig. Da fÃ¥r jeg bare feil fra backend. Ser ikke ut til at jeg fÃ¥r noe respons. Konsoll kaster
{noformat}
VM15323:1 POST https://datafangst-test.kantega.no/rest/vegobjekt/fc9c8fea-412a-4e72-b03f-f1d77fe89d8b/autostedfest net::ERR_EMPTY_RESPONSE
{noformat}
og spinner bare henger og henger

h2. LÃ¸sning
Fikser bug i partisjonering av liste for Ã¥ dele innsendinger til Skriv, for fÃ¸rste feil.

Klarer ikke Ã¥ reprodusere feil nummer to (ERR_EMPTY_RESPONSE). FÃ¥r noen fÃ¸lgefeil om at progress helger siden den har mista tellinga, men det er en annen sak.",NVDB-6937,Datafangst,
FÃ¥r ikke slettet kontrakter fra kontraktslista,"h2. Observasjon

Jeg fÃ¥r ikke slettet egne kontrakter fra kontraktslista. Denne muligheten er ""grÃ¥et ut"". Jeg kan gÃ¥ inn pÃ¥ en av mine og slette fra Innstillinger, sÃ¥ det er ikke feil pÃ¥ rettighetene, men feil i GUI.

Sammenheng med at det er fullt navn og ikke brukernavn som vises?
h2. Analyse

selectoren som avaluerer om brukeren har rettigheter til Ã¥ slette kontrakten ser pÃ¥ name istedet for username. dermed funker ikke evalueringen etter at navn har blitt erstattet med ldapnavn.
h2. LÃ¸sning

evaluer username istedet for name i selectoren",NVDB-6937,Datafangst,
Stedfesting med Skriv: Manuell stedfesting gir rare resultater,"h2. Observasjon

Denne observasjonen er uavhengig av med/uten Skriv. Last inn vedlagte SOSI. Aut.stedfest (se resultat pÃ¥ vedlegg). Merk vei litt bortenfor (se vedlegg), manuelt stedfest PUNKT 1. Da blir ikke stedfestingen som forventet (se vedlegg) - og heller ikke likt som fÃ¸r (ref Prod - som ogsÃ¥ er vedlagt).
h2. Analyse

Skriv bruker veg som holdepunkt nÃ¥r den skal finne kandidater (fx E6).

I kompleksevegsystemer sÃ¥ er ikke det nok til at Skriv finner nÃ¸yaktig riktig veglenke Ã¥ stedfeste til, i dette tilfellet Ã¸nsker man Ã¥ stedfeste til en rampe i et kryss med rampesystem og undergang, og hele vegsystemet ligger under E6.

Skriv tar ogsÃ¥ i mot en paramtere typeVeg, men det var implementert feil, ved at vegstatus ble brukt istedet.

Ved Ã¥ benytte typeVeg riktig kan vi gi Skriv en parameter til for Ã¥ snevre inn kandidatene. Vegnettet i Datafnagst hentes fra VVI, som ikke har noe forhold til TypeVeg. vi mÃ¥ derfor hente TypeVeg fra LES v3 for den aktuelle veglenken.

Skriv vil nÃ¥ kunne hente ut Rampe-kandidater fra vegsystemet, og finne den som er nÃ¦rmest. Det betyr samtidig at brukeren ikke har noen mulighet til Ã¥ selv velge hvilken rampe i vegsystemet det skal stedfestes til, det blir alltid den nÃ¦rmeste. Det kan eksemplifiseres ved Ã¥ prÃ¸ve Ã¥ stedfeste til rampen pÃ¥ andre siden av vegen, som vil gi feil resultat.
h2. Implementasjon

frontend sender nÃ¥ inn hele vegsegmentet til backend, som inneholder det vi trenger, inkludert vegsegmentId.
 locationalService kaller ReadApiGateway som har fÃ¥tt metoder for Ã¥ hente ut typeVeg gitt et vegsegment.Â 

Det er litt prematurt Ã¥ hente inn TypeVeg som avhengighet fra API LES v3 ennÃ¥, sÃ¥ ReadApiGateway konverterer verdiene fra Enum til Streng, som sendes videre inn til les.

Â 

Â ",NVDB-6937,Datafangst,
NVDBREF-642 : Feil status i kontrollpanelet ved opplasting av prosjekter samtidig med start av reindeksering,"Status pÃ¥ fremdrift endres ikke fra UTFÃ˜RT til UTFÃ˜RT_OG_ETTERBEHANDLET i kontrollpanelet, noe som medfÃ¸rer at lÃ¥sen mÃ¥ fjernes manuelt av vegnettsredigererne.
Eksempel:
Vi har etter 2 av de siste reindekseringene av PROD opplevd at prosjekter som leses inn ca 15.30 blir liggende som UTFÃ˜RT etterpÃ¥. Dette er prosjekter som vi ser er etterbehandlet og vi mÃ¥ ta lÃ¥sen pÃ¥ manuelt. Hadde samme problemstilling for noen mÃ¥neder siden, men da gjaldt det mange flere prosjekter. Eksemplene er Fredag 08.05 kl 15.27.34 (Karoline Aylin Atakan [3ce8f8c9-d461-4038-b6c4-15b99efbda5d|https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/3ce8f8c9-d461-4038-b6c4-15b99efbda5d?inkluderResultat=NEI] ) og (788c7dec-b9b1-4c49-897e-15a223c03989 lest inn kl 15.30.13Â  24.04 av Ragnhild Tunheim)
Â 
Â 
Â 
[ {color:#344563}Permalink{color}|https://www.vegvesen.no/jira/browse/NVDBREF-642?focusedCommentId=298973&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-298973] [ {color:#344563}Edit{color}|https://www.vegvesen.no/jira/secure/EditComment!default.jspa?id=167340&commentId=298973] [ {color:#344563}Delete{color}|https://www.vegvesen.no/jira/secure/DeleteComment!default.jspa?id=167340&commentId=298973]
[~linsto] added a comment - 7 hours ago
Kommentar fra Hans JÃ¸rgen pÃ¥ mail 11.05.2020:

_Handler (tror vi) om kommunikasjon mellom Les og Skriv for prosjekter som blir lagret i NVDB i tidsrommet rundt full reindeksering._

_Brukeren fÃ¥r melding om status Â«UtfÃ¸rtÂ» (lagret i NVDB), men fÃ¥r ikke melding om Â«UtfÃ¸rt og etterbehandletÂ» i Skriv sitt Kontrollpanel etter at full reindeksering er fullfÃ¸rt. Ei heller blir +lÃ¥sen+ slettet._
Â ",NVDB-6937,NVDB-IND,
Tillat ny verdi i ikke-eksisterende listeegenskap,"h2. Observasjon

Endringssettet under avvises med ""Egenskapstypen 220004 finnes ikke i objektet"".

{code:json}
{
  ""lÃ¥sing"": null,
  ""kontekst"": null,
  ""validering"": null,
  ""registrer"": {
    ""vegobjekter"": [
      {
        ""egenskaper"": [
          {
            ""verdi"": [
              ""116 - Glatt kjÃ¸rebane""
            ],
            ""typeId"": 5530,
            ""struktur"": null,
            ""geometri"": null,
            ""binaer"": null,
            ""enum"": null
          }
        ],
        ""assosiasjoner"": null,
        ""stedfesting"": {
          ""linje"": null,
          ""punkt"": [
            {
              ""retning"": ""MED"",
              ""sideposisjon"": null,
              ""kjÃ¸refelt"": null,
              ""veglenkesekvensNvdbId"": 287671,
              ""veglenkesekvensTempId"": null,
              ""posisjon"": 0.1836126
            }
          ],
          ""sving"": null
        },
        ""gyldighetsperiode"": {
          ""startdato"": ""2020-05-12"",
          ""sluttdato"": null
        },
        ""validering"": null,
        ""typeId"": 96,
        ""tempId"": ""57428801-3537-4f41-9e73-34304699c4aa""
      },
      {
        ""egenskaper"": [
          {
            ""verdi"": [
              ""117 - Farlig vegskulder""
            ],
            ""typeId"": 5530,
            ""struktur"": null,
            ""geometri"": null,
            ""binaer"": null,
            ""enum"": null
          }
        ],
        ""assosiasjoner"": null,
        ""stedfesting"": {
          ""linje"": null,
          ""punkt"": [
            {
              ""retning"": ""MED"",
              ""sideposisjon"": null,
              ""kjÃ¸refelt"": null,
              ""veglenkesekvensNvdbId"": 287671,
              ""veglenkesekvensTempId"": null,
              ""posisjon"": 0.1836126
            }
          ],
          ""sving"": null
        },
        ""gyldighetsperiode"": {
          ""startdato"": ""2020-05-12"",
          ""sluttdato"": null
        },
        ""validering"": null,
        ""typeId"": 96,
        ""tempId"": ""dec527f7-eea8-47ef-858d-a1e9a651a797""
      }
    ],
    ""vegnett"": null
  },
  ""oppdater"": null,
  ""korriger"": null,
  ""lukk"": null,
  ""fjern"": null,
  ""delvisOppdater"": {
    ""vegobjekter"": [
      {
        ""egenskaper"": [
          {
            ""verdi"": [
              ""Kommune""
            ],
            ""typeId"": 7999,
            ""struktur"": null,
            ""geometri"": null,
            ""binaer"": null,
            ""enum"": null,
            ""operasjon"": ""oppdater""
          }
        ],
        ""assosiasjoner"": [
          {
            ""operasjon"": ""oppdater"",
            ""nvdbId"": [],
            ""tempId"": [
              {
                ""verdi"": ""57428801-3537-4f41-9e73-34304699c4aa"",
                ""operasjon"": ""ny""
              },
              {
                ""verdi"": ""dec527f7-eea8-47ef-858d-a1e9a651a797"",
                ""operasjon"": ""ny""
              }
            ],
            ""typeId"": 220004
          }
        ],
        ""stedfesting"": null,
        ""gyldighetsperiode"": null,
        ""validering"": {
          ""lestFraNvdb"": ""2020-05-11T16:20:51"",
          ""overlappsautomatikk"": null,
          ""reduserPunkttetthet"": null
        },
        ""typeId"": 95,
        ""nvdbId"": 1007893605,
        ""versjon"": 1,
        ""overskriv"": ""JA""
      }
    ],
    ""vegnett"": null
  },
  ""delvisKorriger"": null,
  ""status"": null,
  ""ansvarlig"": null,
  ""datakatalogversjon"": ""2.20"",
  ""id"": null
}
{code}

h2. Analyse

Feilmeldingen stammer fra PartialFeatureEnricherJobFilter, som reagerer pÃ¥ at det forsÃ¸kes Ã¥ legge inn en ny assosiasjonsverd i en assosiasjonsattributt som ikke finnes. OppfÃ¸rselen er ""by design"", men oppleves litt urimelig siden det Ã¥ fjerne alle verdier fra slik attributt godtas og fÃ¸rer til attributten fjernes i sin helhet. Saken endres til ""New Feature"" for Ã¥ implementere stÃ¸tte for den Ã¸nskede operasjonen.

h2. LÃ¸sning

Sjekken i PartialFeatureEnricherJobFilter pÃ¥ om den delvise egenskapsoperasjonen kan gjennomfÃ¸res endres til Ã¥ bare se pÃ¥ operasjon SLETT pÃ¥ egenskapen og operasjon OPPDATER med en eller flere verdier fjernet. Operasjon OPPDATER med en eller flere verdier lagt til skal da gÃ¥ gjennom.",NVDB-6937,Skriv-API,
Lokal kjÃ¸ring og tester fÃ¥r TLS-feil pga. gammel bundlet keystore,"Vi har et oppsett med en bundlet keystore fra 2015, som nÃ¥ ikke virker med nye sertifikater pÃ¥ www.utv og www.test.vegvensen.no.

Ser ut til Ã¥ virke uten custom keystore ellers, sÃ¥ den kan slettes.",NVDB-6937,Datafangst,
"""Helsesjekk"" pÃ¥ full reindeksering","Vi bÃ¸r ha en automatisert mÃ¥te Ã¥ sjekke om full reindeksering med pÃ¥fÃ¸lgende inkrementell indeksering har gÃ¥tt bra eller ikke, slik at vi ikke behÃ¸ver Ã¥ vente pÃ¥ at brukerne oppdager at det. f.eks mangler data.

En enkel variant kan kanskje vÃ¦re Ã¥ telle opp hvor mange man har av de ulike objekttypene fÃ¸r og etter indekseringen, og varsle fra om avviket er stÃ¸rre enn forventet.

Hvor og hvordan det skal varsles mÃ¥ avklares som en del av saken. Det er ikke tilstrekkelig Ã¥ varsle pÃ¥ et sted hvor bare Kantega-ansatte kan se det, som f.eks mattermost.

Â 

*LÃ¸sning*

Det er lagt inn en konsistenssjekk som kjÃ¸res for hvert type under full indeksering. Den teller opp antall dokumenter som har blitt skrevet til Solr, og sammenligner med antallet i NVDB. Hvis antallet er forskjellig logges det en melding. PÃ¥ dashboard-et til NVDBIND i Splunk legger vi en varsling pÃ¥ denne type meldinger, slik at man kan se eventuelle avvik der etter full indeksering.",NVDB-6937,Les-API,
Feil ved lagring nÃ¥r attributt er null,"h2. Observasjon

Sak NVDB-5481 lÃ¸ste at man fÃ¥r opp objekter i datafanen som har ""null"" som verdi for en egenskapstype. Men hvis man prÃ¸ver Ã¥ registrere en slik fÃ¥r man svar fra Skriv:
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1""><message>Request body unmarshalling failed at line: 1, col: 633: cvc-elt.3.1: Attribute 'http://www.w3.org/2001/XMLSchema-instance,nil' must not appear on element 'verdi', because the {nillable} property of 'verdi' is false.</message></fault>
{noformat}
[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-utv-beats-6.8.8-2020.05.08/doc/?id=Rf5C83EBQ6NGvyzfIbQw]

Gjenskap ved Ã¥ laste opp vedlagte fil. Sett attributt 1910 til null i databasen (samme beskrivelse som i NVDB-5481), koble til en mor i NVDB (hvis det ikke eksisterer sÃ¥ opprett en), og registrer.",NVDB-6937,Datafangst,
LocationalTrimmer mÃ¥ ta hÃ¸yde for hÃ¸yde i alle scenarier.,"Dette er en utvidelse av NVDB-5441
h2. Analyse

En feil i ReadApiGateway gjÃ¸r at vi henter veglenker som er utgÃ¥tt pÃ¥ dato. Veglenker som er utgÃ¥tt pÃ¥ dato er ofte erstattet med nye veglenker, pga vegarbeid og utbedringer pÃ¥ vegnettet. Dette resulterer i at vi jobber pÃ¥ en sekvenser med overlappende veglenker.Â 

NÃ¥r vi skal passe pÃ¥ at datter er innenfor mor, gjÃ¸r vi det ved Ã¥ sammenlikne stedfestingen til mor med stedfestingen mor _burde ha hatt_ hvis mor var utvidet til Ã¥ omfavne sin datter. Dette gjÃ¸r vi ved Ã¥ slÃ¥ sammen stedfestingen til mor og datter, og sÃ¥Â *genererer vi en geometri basert pÃ¥ denne stedfestingen*, ved hjelp av veglenkegeometriene fra API LES. Vi gjÃ¸r sÃ¥ en sammenlikning av geometrisk lengde pÃ¥ geometrien fra den gamle stedfesingen, og den nye, genererte geometrien.

I de tilfellene vi genererer en geometri basert pÃ¥ overlappende veglenker, blir det veldig rare resultater, og vi fÃ¥r ofte geometrier som har en lengde som er helt feil, og som vil variere sÃ¥ mye fra den opprinnelige stedfestingen at konklusjonen blir at datter mÃ¥ ligge alt for langt unna mor, og vi avviser sammenkoblingen.
h2. Implementasjon

Legger til datofelter til vÃ¥rt domeneobjekt VegLenke. Legger til et filter som bare slipper gjennom veglenker som er gyldige pÃ¥ dags dato.

Â ",NVDB-6937,Datafangst,
Returner fylke i vegobjektsÃ¸k,"Ved sÃ¸k etter vegobjekter for en type returneres kommune i lokasjonen, mens om man spÃ¸r direkte pÃ¥ enkeltobjekt sÃ¥ kommer bÃ¥de kommune og fylke med.

Plania trenger informasjon om fylke, og denne manglen betyr at de mÃ¥ gjÃ¸re noen ekstra kall.

Eksempel:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/67?inkluder=metadata,egenskaper,lokasjon&antall=10]

vs

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/67/78728407/4]

Oppgaven gÃ¥r pÃ¥ Ã¥ legge til fylke i tillegg til kommune for vegobjektsÃ¸k.",NVDB-6937,Les-API,
Logge spÃ¸rretider mot Solr,"Metrikkene for responstider vi fÃ¥r fra Solr er periodevise metrikker som gir gjennomsnittlige verdier siste minutt, siste 15 minutt, siden oppstart, etc.Â 

Det hadde vÃ¦rt nyttig Ã¥ kunne fÃ¥ spÃ¸rretiden fra Solr per spÃ¸rring i Splunk. Ta da gjerne med TRANSID som kan binde sammen kallet mot API og spÃ¸rringene API gjÃ¸r mot Solr fÃ¸r et svar returneres. Og i tillegg hadde det vÃ¦rt nyttig Ã¥ ta med f.ex collection det spÃ¸rres mot.

NÃ¥r vi fÃ¥r sammenstilt dette er det enklere Ã¥ se om all tid gÃ¥r med til Ã¥ spÃ¸rre Solr eller om det er noe tid som gÃ¥r til andre operasjoner i API fÃ¸r svaret sendes tilbake.",NVDB-6937,Les-API,
Legge pÃ¥ JVM-metrikker pÃ¥ Solr,"I dag har vi disse metrikkene: [https://github.com/nvdb-vegdata/nvdb-common/blob/master/solr/dist/config/solr.xml]

Denne spesifiserer noen JVM-metrikker, men finner de ikke igjen i Splunk pÃ¥ sÃ¸k a la
{noformat}
host IN (svvunvdbsolr06,svvunvdbsolr07,svvunvdbsolr08,svvunvdbsolr09,svvunvdbsolr10) sourcetype=""solr_metrics-log""
{noformat}
FraÂ  [https://lucene.apache.org/solr/guide/8_4/metrics-reporting.html#jvm-registry]Â ser det ut til at JVM-metrikkene benytter `group=jvm` og ikke `group=core`.

Derfor mÃ¥ sikkert disse:
{noformat}
<str name=""filter"">gc.G1-Young-Generation.time</str>
<str name=""filter"">gc.G1-Young-Generation.count</str>
<str name=""filter"">gc.G1-Old-Generation.time</str>
<str name=""filter"">gc.G1-Old-Generation.count</str>
<str name=""filter"">memory.heap.usage</str>
{noformat}
legges inn som noe a la
{noformat}
<metrics>
  <reporter name=""log_metrics"" group=""core"" class=""org.apache.solr.metrics.reporters.SolrSlf4jReporter"">
  ...
  </reporter>
  <reporter name=""log_metrics"" group=""jvm"" class=""org.apache.solr.metrics.reporters.SolrSlf4jReporter"">
    <str name=""filter"">gc.G1-Young-Generation.time</str>
    <str name=""filter"">gc.G1-Young-Generation.count</str>
    <str name=""filter"">gc.G1-Old-Generation.time</str>
    <str name=""filter"">gc.G1-Old-Generation.count</str>
    <str name=""filter"">memory.heap.usage</str>
  </reporter>
</metrics>
{noformat}
{{}}",NVDB-6937,Les-API,
Ta ibruk nvdb-api-client v1.8.4,"Ta ibruk nvdb-api-clientÂ v1.8.4 nÃ¥r den releases.

Dette for Ã¥ fÃ¥ med endring som ikke sluker exceptions i feilhÃ¥ndteringen.",,Rapportgenerator,
Konsollfeil: Cannot read property map,"h2. Observasjon

GÃ¥ tilÂ [https://datafangst-utv.kantega.no/#!/contract/d90aa2ea-684e-41dd-95e3-867aa2f3e3f8/export]

Merk en av objekttypene. Da kastes en haug av disse i konsoll
{noformat}
TypeError: Cannot read property 'map' of undefined
{noformat}",NVDB-6937,Datafangst,
Ta imot veglenketype som liste i vegnettssÃ¸k.,"I arbeid med NVDB-5502 kommer det frem at det mÃ¥ gjÃ¸res Ã©n spÃ¸rring per veglenketype dersom man vil filtrere pÃ¥ flere enn Ã©n. Dette er ikke tilfelle for de andre parametrene. Se spesielt pÃ¥ adskilte lÃ¸p, som ble endret til Ã¥ ta imot liste i forbindelse medÂ NVDB-4704.Â 

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegnett/veglenkesekvenser/segmentert?kartutsnitt=243932.194,6817569.028,246588.616,6821315.535&vegsystemreferanse=E,R,F,K,P,S&veglenketype=hoved,detaljert]",NVDB-6937,Les-API,
Progress i stedfesting 2 henger seg nÃ¥r VisVegInfo-tjenesten er nede.,"__________
Oppdaget en uheldig effekt av at VisVeginfo-tjenesten var nede i stedfesting 2. Loading-indikatoren ble stÃ¥ende og henge og overlappe innholdet. Loading fullfÃ¸res aldri.

!nvdb-5507.PNG|width=769,height=282!

Â 



Dette problemet gjelder generelt i stedfesting2, nÃ¥r vi venter pÃ¥ en respons fra server for Ã¥ legge til en verdi pÃ¥ loading progress.Â 

Ved feilsituasjoner som gir 500-error fra server, har vi ikke angitt en egen error-callback for metodene i server-service.ts. Erroren kastes derfor videre, men blir ikke hÃ¥ndtert. Progress blir ikke lagt til, og progress goal blir aldri nÃ¥dd.

Progress overlay blir stÃ¥ende og henge i evig tid. For brukeren ser det ut som visningen fortsatt laster. I seg selv gir den ingen info hvis loadingen av en eller annen grunn ikke vil la seg fullfÃ¸re.

*Hvordan reprodusere:*
 Med mindre en ekstern avhengighet er nede, mÃ¥ man nesten reprodusere dette gjennom kode. 
 F.eks: Endre koden til Ã¥ kaste en exception i metoden getVVITimestamp (StatusResource.java). Ã…pne stedfesting 2.

*Forslag til lÃ¸sning:*

Forslag 1 er Ã¥ hÃ¥ndtere error pÃ¥ server-kallet i action-metodene, slik at dispatcheren for Ã¥ legge til progress nÃ¥s, progress goal blir mÃ¸tt og progress overlay forsvinner. AltsÃ¥ fullfÃ¸re innlasting til tross for feil. Feilmeldingen for server error vises uansett som ei melding i Ã¸vre hÃ¸yre hjÃ¸rne.

Forslag 2 gjelder ogsÃ¥ Ã¥ hÃ¥ndtere error, men Ã¥ sette et ""loading failure""-flagg som fÃ¸lge av det. Og i slike tilfeller vise ei skikkelig tilbakemelding til bruker om at visningen ikke lar seg laste pga systemfeil/eksterne avhengigheter som er nede.Â 

Valg av lÃ¸sning avhenger jo litt av om det fortsatt er verdi i Ã¥ laste inn fanen selv om eksterne avhengigheter er nede.",NVDB-6937,Datafangst,
Trykk pÃ¥ stedsnavn gir feil-side,"h2. Observasjon

Ã…pen Vegkart i ATM og sÃ¸k etter et stedsnavn. F.ex ""Melhus"" og velg ""Melhus kirke"". Da kommer Vegkart til feilside med feil i konsoll:
{noformat}
ypeError: Cannot read property 'offsetWidth' of undefined at o (dom.js:41) 
at e.panIntoView (Overlay.js:405) 
at e.performAutoPan (Overlay.js:386) 
at e.handleMapChanged (Overlay.js:303) 
at e.dispatchEvent (Target.js:112) 
at e.notify (Object.js:152) 
at e.set (Object.js:171) 
at e.setMap (Overlay.js:354) 
at e.addOverlayInternal_ (PluggableMap.js:496)
...
{noformat}
*NB: Dette fungerer heller ikke i UTV*",NVDB-6937,Vegkart,
NVDBREF-627 : Filter for konnektering pÃ¥ kjÃ¸rebane og kjÃ¸refelt,"Filteret Â«konnekteringÂ» funker bare pÃ¥ lenker pÃ¥ vegtrase-nivÃ¥. Det bÃ¸r ogsÃ¥ vÃ¦re mulig Ã¥ benytte filteret for konnektering pÃ¥ kjÃ¸rebane- og kjÃ¸refelt-nivÃ¥. Disse lenkene er merket som Â«DETALJERT_KONNEKTERINGÂ». Hvis man prÃ¸ver Ã¥ slÃ¥ pÃ¥ filteret forsvinner lenkene av typen kjÃ¸rebane og kjÃ¸refelt.

Â 

!image-2020-05-04-11-22-52-561.png!",NVDB-6937,Vegkart,
NVDBREF-634: Flere metergap pÃ¥ EV6 S1 i STM og ATM som er ok i Prod,"HÃ¥vard oppdaget noen metergap pÃ¥ EV6 S1 i sin kontroll. Det er riktig i Prod, men oppstÃ¥r etter kloning og full reindeksering til STM og ATM.

STM: [https://vegkart-stm.utv.atlas.vegvesen.no/#kartlag:geodata/@285468,6557600,16/hvor:~(vegsystemreferanse~(~'EV6))/vegnett:~'metrering+~()/valgt:971774:4:16]

ATM: [https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@285385,6557578,16/vegnett:~'metrering+~()/valgt:971774:4:11]

Prod: [https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@285434,6557596,16/hvor:~(vegsystemreferanse~(~'EV6))/vegnett:~'metrering+~()/valgt:971774:4:11]

Opprinnelig melding fra HÃ¥vard (fra STM):

INFO ;Road=EV6, StretchType=S, TopologyLevel=0, TrafficTypes=K
 WARN;Segment1.MeterGap;3001;971774;0,14246255;0,14412295;3088748;1797463;0;;E;V;6;;S;1;1;1018;1030;K;;;;1;1#2#3#4;;285408;6557584;45;285414;6557594;45;Gap=2358,684m
 WARN;Segment2.MeterGap;3001;971774;0,14412295;0,1456891;1797463;3088749;0;;E;V;6;;S;1;1;3389;3400;K;;;;1;1#2#3#4;;285414;6557594;45;285420;6557604;45;Gap=2358,684m
 WARN;Segment1.MeterGap;3001;971774;0,1456891;0,19564084;3088749;2578245;0;;E;V;6;;S;1;1;3400;3757;K;;;;1;1#2#3#4;;285420;6557604;45;285570;6557925;56;Gap=7127,069m
 WARN;Segment2.MeterGap;3001;971774;0,19564084;0,21154681;2578245;3088746;0;;E;V;6;;S;1;1;10884;10998;K;;;;1;1#2#3#4;;285570;6557925;56;285598;6558035;58;Gap=7127,069m
 WARN;Segment1.MeterGap;3001;971774;0,22570891;0,23283812;3088745;1797467;0;;E;V;6;;S;1;1;11099;11150;K;;;;1;1#2#3#4;;285628;6558132;60;285647;6558180;61;Gap=554,000m
 WARN;Segment2.MeterGap;3001;971774;0,23283812;0,24182985;1797467;2532381;0;;E;V;6;;S;1;1;11704;11769;K;;;;1;1#2#3#4;;285647;6558180;61;285674;6558238;62;Gap=554,000m
 WARN;Segment1.MeterGap;3001;971774;0,24429056;0,24547458;3088750;991802;0;;E;V;6;;S;1;1;11786;11795;K;;;;1;1#2#3#4;;285682;6558254;62;285685;6558261;62;Gap=225,000m
 WARN;Segment2.MeterGap;3001;971774;0,24547458;0,24719798;991802;3088747;0;;E;V;6;;S;1;1;12020;12032;K;;;;1;1#2#3#4;;285685;6558261;62;285691;6558272;62;Gap=225,000m

Â 

*Analyse*

I spÃ¸rringen som henter ut vegsystem for en strekning til cachen hentes det med dato ""fra-og-med"" til ""til-og-med"". Det gjÃ¸r at akkurat pÃ¥ datoen et vegsystem ble erstattet av et nytt ble begge vegsystemene hentet ut. Det pÃ¥virker senere beregning av meter for strekninger pÃ¥ de vegsystemene.

For S1D1 sekvens 1000 pÃ¥ EV6 ble deler av lenkesekvenser: 930591, 1842458, 930590 og 2582832 feilaktig brukt som fÃ¸rte til det fÃ¸rste hoppet.

*LÃ¸sning*

Endret slik at vegsystemer for cache hentes med dato ""fra-og-med"" til ""til"". Endringen krever full indeksering.",NVDB-6937,NVDB-IND,
Database er kun konfigurert for ISO-8859-1,"(!) *Manuelle steg ved installasjon, se detaljer lengre ned.*
h2. Observasjon

Vegobjekttype 96: Skiltplate

har egenskap 5530 Skiltnavn.

Dette er en enum-egenskap. Enum 7807 inneholder et uvanlig tegn (U+0085) og fÃ¸rer mest sannsynlig til at egenskaper med denne verdien ikke validerer og kan lagres til skriv.

<enumverdi>
 <id>7807</id>
 <kortnavn>808.343</kortnavn>
 <type>Tekst</type>
 <verdi>808.343 - Minste kjÃ¸retÃ¸yavstand â€¦m</verdi>
 <beskrivelse>
 Minste kjÃ¸retÃ¸yavstand  m. (F.o.m. ver. 1.76: Skiltnummer endret fra ""808.32b"")
 </beskrivelse>
 <sorteringsnummer>1142</sorteringsnummer>
 <objektliste_dato>2012-05-08</objektliste_dato>
 <standardverdi>false</standardverdi>
 </enumverdi>

I redigeringsmodus i Jira kan man ogsÃ¥ se [0085] mellom ""Minste kjÃ¸retÃ¸yavstand "" og ""m."" Det vises ogsÃ¥ som [0085] i drop-down (se vedlegg), men nÃ¥r det er lagret og vises etterpÃ¥ stÃ¥r det som et vanlig spÃ¸rsmÃ¥lstegn.

Vi mÃ¥ finne ut hvorfor dette blir feil i Datafangst, og om det ogsÃ¥ kan pÃ¥virke andre tegn.

I tillegg er det greit Ã¥ ha en dialog med innhold i datakatalogen, det var antakeligvis ikke dette tegnet som de mente Ã¥ ha der.
h2. Analyse

Frontend sender 0085 som en Unicode-escape, ""\u0085"". Denne blir tatt i mot riktig av Java, fortsatt verdi 0x0085 for tegn. Vi validerer mot Skriv uten feil, da antar jeg at denne fortsatt er riktig, ellers sÃ¥ burde vi fÃ¥tt samme feil som nÃ¥r vi sender inn.

Ser ut som det fortsatt er riktig fÃ¸r vi skriver til database, men etter at endring er skrevet og lest tilbake sÃ¥ er 0x0085 konvertert til ""?"". Ser ut til at database stÃ¥r pÃ¥ [MariaDB / MySQL default|https://mariadb.com/kb/en/setting-character-sets-and-collations/], som er ""latin1"". Derfor kan vi ikke lagre andre enn vest-europeiske tegn i dag. SÃ¥ ingen polsk Å for eksempel, og i alle fall ingen â˜º.
h2. LÃ¸sning

Database konverteres til Unicode / UTF-8. Databasedriver mÃ¥ oppdateres for Ã¥ fÃ¥ Unicode til Ã¥ virke.
h1. Installasjon

Installasjon av denne saken krever noen manuelle steg.

Husk backup av databasen!
h2. FÃ¸r installasjon

Connect string for database mÃ¥ endres i datafangst.conf, fra "":mysql:"" til "":mariadb:"".
h2. Etter installasjon

Script for endring av tegnsett mÃ¥ kjÃ¸res. Dette krever ca 3 timer der Datafangst er avskrudd, og mÃ¥ gjÃ¸res pÃ¥ kveld eller helg, pluss varsles pÃ¥ forhÃ¥nd.
 # Stopp Datafangst
 # KjÃ¸r vedlagt SQL-script
 # Sjekk at alle tabeller er konvertert, ved Ã¥ kjÃ¸re spÃ¸rring i kommentar
 # Slett ""mysql-connector-java-5.1.35.jar"" fra ""/opt/svv/vt/tc-vt-u04/base-datafangst-01/lib""
 # Start Datafangst pÃ¥ nytt og verifiser",NVDB-6937,Datafangst,
Hjelpefunksjonalitet for lagring,"*Problem*: Fagklienter har spesifikke behov for lagring til NVDB som ikke er ivaretatt idag.


*MÃ¥l*: Sikre at alle klienter fÃ¥r nÃ¸dvendig hjelp til lagring.


*Tiltak*: 
Kartlegge omkringliggende klienters behov og problemer knyttet til lagring. Start med logganalyse.
Prioritere og implementere identifiserte tiltak.


*Interessenter*:
Andre klienter:
Brutus, Bruksklasse, SINUS, MÃ¥lestasjonsregisteret,",NVDB-6937,Skriv-API,
NVDB API Client skjuler/sluker exceptions,"Den +eksterne+ komponenten *nvdb-api-client* som vi bruker for kommunikasjon med NVDB Les API skjuler/sluker exceptions, slik at vÃ¥r kode ikke har mulighet for Ã¥ reagere pÃ¥ enkelte feil.

Dette er feil som oppstÃ¥r nÃ¥r Les API er presset og ikke svarer fort nok. Det er visstnok Openshift/Atlas som ikke venter lenge nok pÃ¥ svar fra Les API.

Det er uheldig at brukere av klienten ikke fÃ¥r informasjon om at noe er feil.

Â 

+*Logg* (etter endring slik at exception ikke slukes):+

{{2020-04-29 15:48:16,406 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-3) Preparing to fetch data for 79, 40 out of 802020-04-29 15:48:16,406 INFOÂ  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (ForkJoinPool.commonPool-worker-3) Preparing to fetch data for 79, 40 out of 802020-04-29 15:49:55,695 ERROR [no.veg.nvd.cli.exc.JsonExceptionParser] (pool-123-thread-1) Could not parse '<html><body><h1>504 Gateway Time-out</h1>The server didn't respond in time.</body></html>' as json ({}): com.google.gson.JsonSyntaxException: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 22 path $ at com.google.gson.JsonParser.parseReader(JsonParser.java:66) at com.google.gson.JsonParser.parseString(JsonParser.java:47) at no.vegvesen.nvdbapi.client.exceptions.JsonExceptionParser.parse(JsonExceptionParser.java:53) at no.vegvesen.nvdbapi.client.clients.util.JerseyHelper.parseError(JerseyHelper.java:64) at no.vegvesen.nvdbapi.client.clients.AsyncResult.doPage(AsyncResult.java:75) at no.vegvesen.nvdbapi.client.clients.AsyncResult.lambda$null$0(AsyncResult.java:54) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)Caused by: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 22 path $ at com.google.gson.stream.JsonReader.syntaxError(JsonReader.java:1564) at com.google.gson.stream.JsonReader.checkLenient(JsonReader.java:1405) at com.google.gson.stream.JsonReader.doPeek(JsonReader.java:543) at com.google.gson.stream.JsonReader.peek(JsonReader.java:426) at com.google.gson.JsonParser.parseReader(JsonParser.java:61) ... 8 more}}

Â ",NVDB-6827,Rapportgenerator,
Leveranseinformasjon,"*Test i AT:*
 * NVDB-3826: Verifiser at omrÃ¥defilter med en type kun viser typen i omrÃ¥det. F.ex Trondheim og Rekkverk.
 * NVDB-5148 (NVDBREF-447): Se beskrivelse og kommentarer. [https://vegkart.test.atlas.vegvesen.no/#kartlag:topo4/@639344,7665312,17/hva:~(~(id~49))/hvor:~(vegsystemreferanse~(~'FV86S1D1))/valgt:91610807:49]Â kan benyttes (om NVDB-id er lik i UTV og ATM).
 * NVDB-5444: Verifiser at trafikantgruppe er med i vegsystemreferansen (bÃ¥de liste og pÃ¥ objketet).
 * NVDB-5007: Sjekk at det logges i ATM
 * NVDB-5379: Verifiser akseptansekriteriene
 * NVDB-5406 (NVDBREF-610): Verifiser at beskrivelsen nÃ¥ fungerer
 * NVDB-5428 (NVDBREF-611): Verifiser at beskrivelsen nÃ¥ fungerer
 * NVDB-5429 (NVDBREF-433):Â Verifiser akseptansekriteriene
 * NVDB-5298: Se at vegnett vises i bÃ¥de Trondheim, TrÃ¸ndelag og Bergen
 * NVDB-5435 (NVDBREF-623): Oppdatert info i spash om v2 og v2-url

Saker i leveransen som ikke er eksplisitt nevnt over trenger ikke Ã¥ testes spesifikt i ATM.",NVDB-6937,Vegkart,
Fjerne twitter-feed i Ã¥pningsbildet til v2,"-Har fÃ¥tt tips pÃ¥ mail fra Stephanie. Vi diskuterte ogsÃ¥ noe lignende i et mÃ¸te med bla. May Britt og Hans Anton:-

-------------------
 -Hei igjen.- 
 -Jeg hÃ¥per du er den riktige person til det ğŸ˜Š.-
 -Kan jeg komme med en liten forslag.- 
 -Ved vegkart v2 kommer det opp en vindu med en eldre NVDB twit. ( se bilde) Jeg tror ideen er veldig bra. Kan man ikke i ny V3 versjonen lage en kopling til den aktuelle NVDB-Twitter-account? [https://twitter.com/NVDBapi]-

-Hilsen Stephanie ğŸ˜Š-
 ------------------- 
 -AltsÃ¥ legge inn Twitter-feeden i Ã¥pningsbildet i vegkart.- 
 -Stephanie sin epostadresse er: [stephanie.lupfert-streich@vegvesen.no|mailto:stephanie.lupfert-streich@vegvesen.no]-

Vi fjerner Twitter-feeden i V2 i stedet.",NVDB-6937,Vegkart,
Tomme verdier sendes inn til API Skriv,"h2. Observasjon

Det er flere ganger at det kommer support-henvendelser pÃ¥ at man ikke fÃ¥r registrert mot Skriv. Dette gjelder ikke nÃ¥r man fÃ¥r AVVIST, men nÃ¥r man fÃ¥r en rÃ¸d feilmelding ved trykk pÃ¥ Registrer. Da fÃ¥r gjerne DF en HTTP 400 med beskjed om at noe er feil ihht skjema pÃ¥ endringssettet.

I mange tilfeller skyldes dette at DF sender inn tomme verdier. Dvs at for en egenskapstype sÃ¥ sender vi inn _<verdi></verdi>_. Slike typer kommer typisk inn via API, og vi har gjort en fix pÃ¥ API for Ã¥ filtrere bort slike verdier (NVDB-5205). Dette kan sees i datafanen ved at en celle for en egenskap er merket oransje/endret uten at det stÃ¥r en verdi der.

Eksemplet fra Kibana

[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.30/doc/?id=Td2TyXEB7uutkyPZqC_y]

[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.30/doc/?id=Ud2TyXEB7uutkyPZqC_y]

Denne oppgaven gÃ¥r ut pÃ¥ Ã¥ fjerne de egenskapene som har _<verdi></verdi>_Â fra endringssettet fÃ¸r vi sender det inn mot Skriv. Brukeren fÃ¥r ingen info om at dette er problemet, og blir stuck.

Videre bÃ¸r vi nok ogsÃ¥ ta en kikk pÃ¥ at filtrering i API fungerer for tomme verdier - spesielt dersom det sendes inn mange features i en innsending hvor noen egenskapstyper har tomme verdier, mens andre har verdier for disse egenskapene.",NVDB-6937,Datafangst,
Sjekk sÃ¸keparametere ogsÃ¥ i paginering,"Vi kan spare kall ved Ã¥ sjekke om sÃ¸keparameterne er utdaterte pÃ¥ flere steder enn det vi gjÃ¸r i dag, blant annet mellom hvert page-kall.

Â 

Estimat (Anders-fart): 2 dager",NVDB-6937,Vegkart,
Stedfesting 2: Mulighet for Ã¥ beholde zoom,"Tilbakemelding fra Jan Vidar StrÃ¸msvold etter test av stedfesting 2
{noformat}
Den tingen som stÃ¥r ut nÃ¥r eg jobber med denne er at den zoomer ut til hele kontraktsomrÃ¥det nÃ¥r en fjerner valgt objekt etter stedfesting.Â 

Det gjelder spesielt i driftkontrakten DK1107 Haugesund. Den strekker seg fra nord pÃ¥ Stord til sÃ¸r pÃ¥ Bokn, og da blir det mye zooming.Â 

Ã˜nsker: Autozoom-knapp slik vi har i objektoversikten. For da kan en fÃ¥ begge deler.
{noformat}
Vedlagt ligger den knappen han Ã¸nsker seg for at det skal vÃ¦re helt tydelig.",NVDB-6937,Datafangst,
Stedfesting 2: Tilbakemelding etter stedfesting av en type,"En tilbakemelding etter test av stedfesting 2Â (Geir Magnus Tungland og Joakim MÃ¸yholm) sier
{noformat}
NÃ¥r operasjonen automatisk stedfesting er ferdig, hadde det vÃ¦rt greit med en dialog/annen knapp enn avbryt for Ã¥ gi brukeren beskjed.
{noformat}
Her tenkes det kanskje pÃ¥ en slags status pÃ¥ at Ã¸nskede typer ble stedefestet, eller lignende.",NVDB-6937,Datafangst,
Crash nÃ¥r skilttekst er null i database,"h2. Observasjon
Jan Vidar StrÃ¸msvold melder om feil under lasting som gjÃ¸r at data i kontrakten ikke kommer fram.

Ã…rsaken viser seg Ã¥ vÃ¦re en NullPointerException nÃ¥r en skiltplate har attributten tekst, men at verdien for attributten er {{null}}. For Ã¥ reprodusere, sett attributt-ID 1910 til null i databasen for en skiltplate.

Stacktrace:
{noformat}
java.lang.NullPointerException: null
	at no.svv.nvdb.datafangst.descriptivename.SkiltplateDescriptiveNameGenerator.generate(SkiltplateDescriptiveNameGenerator.java:27)
	at no.svv.nvdb.datafangst.descriptivename.FeatureDescriptiveNameGeneratorImpl.generateDescriptiveName(FeatureDescriptiveNameGeneratorImpl.java:37)
	at no.svv.nvdb.datafangst.representation.FeatureJson.fromDomain(FeatureJson.java:216)
	at no.svv.nvdb.datafangst.representation.FeatureListJson.lambda$fromDomain$0(FeatureListJson.java:28)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)
	at no.svv.nvdb.datafangst.representation.FeatureListJson.fromDomain(FeatureListJson.java:28)
	at no.svv.nvdb.datafangst.rest.ContractResource.lambda$listFeatures$8(ContractResource.java:684)
	at no.svv.nvdb.datafangst.rest.ContractBaseResource.lambda$getResponseWithLastModified$2(ContractBaseResource.java:84)
	at java.util.Optional.map(Optional.java:215)
	at no.svv.nvdb.datafangst.rest.ContractBaseResource.getResponseWithLastModified(ContractBaseResource.java:74)
	at no.svv.nvdb.datafangst.rest.ContractResource.listFeatures(ContractResource.java:677)
{noformat}",NVDB-6937,Datafangst,
NVDBREF 538 - Hvilke endringer mÃ¥ gjÃ¸res i NVDB API Les ifm fjerning av assosiasjon til kommune i gateobjektet?,"Det er Ã¸nskelig Ã¥ fÃ¥ en vurdering av hvordan navneendring pÃ¥ dagens objekttype 538 Gate berÃ¸rer NVDB API Les. Grovestimat er Ã¸nskelig.

Objektnavnet Gate vil bli endret tilÂ _Vegadresse, fjerning av dagens assosiasjon til 946 Kommune og 536 Kommune 2019, samt_Â 
 * Ny ETÂ _Kommune_
 * ET 4588Â _Adressekode_Â (tall)
 * ET 4589Â _Adressenavn_Â (tekst)
 * ET 9793Â _Sideveg_Â med tillatte verdierÂ _Ja_Â ellerÂ _Nei_Â (uendret)

*API Les*Â 
 * SpesialhÃ¥ndteres objekttypen 538 Gate pÃ¥ noen mÃ¥te i Les V2 eller V3?
 * Har det noen konsekvens for V2 at det ikke lengre vil vÃ¦re noe forhold til 2019-kommuner?
 * Vil det vÃ¦re mest praktisk med en overgangslÃ¸sning der objektet har kommunetilhÃ¸righet bÃ¥de via assosiasjon og egenskap samtidig?
 * Er det noe annet det mÃ¥ tas hÃ¸yde for i denne saken?

Â 

NVDB API Skriv har gjort egen analyse av sakenÂ https://jira.kantega.no/browse/NVDB-5346

Se forÃ¸vrig ogsÃ¥Â [https://www.vegvesen.no/jira/browse/NVDBREF-568]

Â 

Â 

Â ",NVDB-6937,Les-API,
Fjerne brukerveiledning og linke til brukerveiledning,"Brukerveiledning pÃ¥ pdf er tungvint Ã¥ oppdatere. 
ForeslÃ¥r Ã¥ fjerne den som ligger i Datafangst nÃ¥, og heller linke til https://www.vegdata.no/datafangst/brukerveiledning-datafangst/

Denne siden trenger fortsatt litt finpuss, men den er like god som den gamle. ",NVDB-6937,Datafangst,
Sjekk avvik mellom segment og strekningslengde,Vi logger avvik mellom segment og beregnet meter. Sjekk hvorfor det er sÃ¥ mye avvik.,NVDB-6937,NVDB-IND,
Like farger i kategorisering,"h2. Observasjon

Legg inn Trondheim og Fartsgrense. Kategoriser pÃ¥ fartsgrense. Da vil alle kategoriene ha lik farge (grÃ¥). Her burde de fÃ¥tt ulike farger.
{noformat}
https://vegkart.utv.atlas.vegvesen.no/#kartlag:geodata/@268102,7030868,10/hva:~(~(category~(type~'enum~id~2021)~id~105))/hvor:~(kommune~(~5001))
{noformat}
Legger merke til at sÃ¸k etter rekkverk og kategorisering pÃ¥ rekkverkstype gir farger i kategoriene. Noe med typen data?",NVDB-6937,Vegkart,
Henting av vegnett krÃ¦sjer,"h2. Observasjon

Hent inn Trondheim. Vis vegnett. Hent opp TrÃ¸ndelag. Da krÃ¦sjer etterhvert Vegkart med en konsoll-feil
{noformat}
TypeError: Cannot read property 'wkt' of null
{noformat}
Sentry-url sendt: [https://sentry.kantega.org/api/4/store/?sentry_key=0c7933dc738f4239b24be0be4aeff2ce&sentry_version=7]

Det samme skjer ved Ã¥ vise vegnett i Trondheim. Bergen og Stavanger. Dette gÃ¥r bra, men nÃ¥r Rogaland legges til blir det krÃ¦sj.

Ser at det gÃ¥r separate kall for f.ex

/vegnett/veglenkesekvenser/segmentert?kartutsnitt=-609707.338,6466105.14,796020.558,7051059.45&fylke=11&vegsystemreferanse=S

/vegnett/veglenkesekvenser/segmentert?kartutsnitt=-609707.338,6466105.14,796020.558,7051059.45&kommune=5001,4601,1103&vegsystemreferanse=S

men det er nÃ¥r det begynner Ã¥ gÃ¥ et kall per fylke sammen med kommunene at det til slutt krÃ¦sjer. A la

/vegnett/veglenkesekvenser/segmentert?geometritoleranse=30&kartutsnitt=-609707.338,6466105.14,796020.558,7051059.45&fylke=54&kommune=5001,4601,1103&vegsystemreferanse=E,R,F,K,P,S",NVDB-6937,Vegkart,
Direktelenking av omrÃ¥der henter ikke geometri automatisk,"Eks.Â [https://vegkart.utv.atlas.vegvesen.no/#kartlag:geodata/@-23756,6587210,8/hvor:~(kommune~(~1103)~vegsystemreferanse~(~'KV9999))]

StateToHash blir riktig, men siden trigger pÃ¥ henting av omrÃ¥degeometri nÃ¥ er flyttet bort fra OLMap-komponenten, fÃ¥r vi ikke omrÃ¥der tegnet pÃ¥ kartet.",NVDB-6937,Vegkart,
Endringssett restartes gjentatte ganger pga versjonssjekk,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/49f0eb8e-e98e-4d0e-b15c-ac6d895bf4f9 restartes flere ganger i lÃ¸pet av en time pga ENRICHMENT_VERSION_CHECK_FAILED, altsÃ¥ at en annen prosess har endret vegobjekter som denne jobben har beriket inn. Deretter hindres ny versjonssjekk fordi det ikke lar seg gjÃ¸re Ã¥ etablere optimistisk lÃ¥s.

Det virker litt mistenkelig at versjonssjekk for berikinger ikke kommer videre etter en time (muligens mer). MÃ¥ sjekkes ut via Splunk.

h2. Analyse

Fra Splunk:

{noformat}
2020-04-23T10:42:04.840 INFO  [ActiveMQ Transport: tcp://localhost/127.0.0.1:61616@51916] [49f0eb8e-e98e-4d0e-b15c-ac6d895bf4f9] n.v.v.n.a.j.StaleFeatureVersionChecker Feature version op:MODIFY tid:96 id:78798880 v:2 sd:2020-01-01 ed:2020-01-09 - ac:ADD or:AdaptFeaturesToChangedMeterDirectionEnricherFilter vr:false co:false is stale, last version no in NVDB is 2
{noformat}

Som vi ser, skyldes versjonskonflikten et forsÃ¸k pÃ¥ Ã¥ versjonere skiltplaten 78798880v1 fordi det er stedfestet pÃ¥ veglenkesekvens som fÃ¥r endret metreringsretning og datoen for retningsskiftet er innenfor gyldighetsperioden til vegobjektversjonen. Rett etter lÃ¥sing sikrer StaleFeatureVersionChecker at all beriking av jobben forholder seg til korrekte versjoner. NÃ¥r den ser at v2 av et vegobjekt forsÃ¸kes etablert sjekkes at v1 er siste versjon i NVDB. Det er det ikke.

Hvorfor ble v2 forsÃ¸kt etablert av AdaptFeaturesToChangedMeterDirectionEnricherFilter? NÃ¥r det sÃ¸kes i NVDB etter vegobjektversjoner som er berÃ¸rt av metreringsendringen, sÃ¸kes det etter versjoner som er stedfestet pÃ¥ en bestemt veglenkesekvens og er gyldige etter datoen for retningsendringen. I dette tilfelle har v2 av skiltplaten fÃ¥tt stedfesting pÃ¥ en annen veglenkesekvens og det returneres derfor ikke i sÃ¸ket. Senere i AdaptFeaturesToChangedMeterDirectionEnricherFilter undersÃ¸kes om v1 er en framtidig versjon i ensureCurrentVersionsOnly(). I sÃ¥ fall skal endringssettet avvises med feilmelding, noe det ville gjort om det var v2 som ble undersÃ¸kt. Men v1 passer ikke kriteriet for ""framtidig versjon"" og gÃ¥r derfor videre og blir oppdatert til v2.

h2. LÃ¸sning

Lager ny metode som invokeres etter ensureCurrentVersionsOnly, der det undersÃ¸kes om noen av de berÃ¸rte vegobjektversjonene er historiske versjoner. I sÃ¥ fall genereres en feilmelding a la den i ensureCurrentVersionsOnly.",NVDB-6937,Skriv-API,
Fix e2e-tester,E2E-testene feiler. Sannsynligvis pga ny mÃ¥te Ã¥ hente kall fra API pÃ¥. Dette innebÃ¦rer hÃ¸yst sannsynlig noen endringer pÃ¥ ruting i e2e-testene og nye wiremock opptak.,NVDB-6937,Vegkart,
NVDBREF-626 - Validere at kombinasjon av gatekode og gatenavn blir unike innenfor kommunen,"h2. Bakgrunn

Skriv validerer i dag ikke at kombinasjonen av gatekode/gatenavn som sjekkes inn er unike innenfor kommunen. Dersom samme gatekode eller gatenavn eksisterer i samme kommune fra fÃ¸r, sÃ¥ skal ikke endringer som sjekkes inn fravike fra disse.

Valideringen gjelder objekttype 538 Gate sine egenskapstyper 4588 Gatekode og 4589 Gatenavn.
Sjekk om nye og endrede gatekoder og gatenavn eksisterer fra fÃ¸r i kommunen. Avviker kombinasjonen av disse, sÃ¥ skal innsjekket stoppes, og brukeren meldes om hvilke gateobjekter som ikke stemmer overens.
Ã˜nsket meldingstekst: Kombinasjonen Gatekode: [gatekode] og Gatenavn: [gatenavn] pÃ¥ objekt [-ID] i prosjektet stemmer ikke overens med kombinasjonen Gatekode: [gatekode] og Gatenavn: [gatenavn] objekt [ID] som eksisterer i NVDB.
Dersom brukeren sender inn gatekode og gatenavn, og sÃ¥ ligger det objekter i NVDB med kun aktuell gatekode uten gatenavn, sÃ¥ skal innsjekket stoppes. Brukeren skal i slike tilfeller ta bort gatenavn pÃ¥ aktuelle objekter i prosjektet sitt, og sÃ¥ sjekke inn pÃ¥ nytt.
Samme meldingstekst som over benyttes, det vil bare ikke vÃ¦re noe gatenavn pÃ¥ objektet som ligger i NVDB.
Det er ikke behov for varsling nÃ¥r gateobjekt har kun gatekode ved innsjekk dersom gatekoden ikke finnes i NVDB, eller dersom det ligger gateobjekter inne i samme kommune med samme gatekode som heller ikke har gatekode.
Det mÃ¥ tas hÃ¸yde for eventuelle pÃ¥virkninger NVDBREF-568 vil fÃ¥ for dette. Det samme gjelder behovet vi har for Ã¥ lese inn endrede gatenavn (""gatenavnimporten""). Valideringene her mÃ¥ ikke gjÃ¸re det umulig Ã¥ endre gatenavn pÃ¥ objekter som ligger i NVDB pÃ¥ en sÃ¥ enkel mÃ¥te som det er lagt opp til i dag.

h2. Analyse

API Skriv utfÃ¸rer allerede delvis den Ã¸nskede valideringen pÃ¥ Gate-vegobjekter via constraint'en UniformStreetNameForCode. Denne avviser en ny eller endret Gate, nÃ¥r eksisterende gater i NVDB med samme gatekode og kommunetilknytning har et annet gatenavn. Det som mÃ¥ gjÃ¸res er dermed den motsatte valideringen: avvise dersom en ny eller endret Gate har en annen gatekode for angitt gatenavn og kommunetilknytning.

h2. LÃ¸sning

Implementerer ny constraint UniformStreetCodeForName etter mÃ¸nster av UniformStreetNameForCode.",NVDB-6937,Skriv-API,
Online API-dokumentasjon,https://apiskriv.vegdata.no/,NVDB-6937,Skriv-API,
Kopiering av ekisterende med tomme verdier gir feil ved innsending,"h2. Observasjon

[https://datafangst.kantega.no/#!/contract/d8faf56e-0a16-462f-80f9-639860436948/features3]

Ser ut til at verdier for vedlikeholdsansvarlig og eier er fjernet pÃ¥ objektÂ 
 Skiltpunkt:1006287405. Deretter er dette kopiert til et nytt 95. Denne fÃ¥r da satt tomme verdier for disse ved registrering:
 [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.22/doc/?id=wOsNonEBO6kjk0-YSq1F]
 Â 
 [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.22/doc/?id=s-sNonEBO6kjk0-YSq1E]
 Â 
 Feilmelding fra Skriv er at tomme felter ikke er tillatt. Melding kommer kun for nytt objekt, ikke endring pÃ¥ eksisterende.
h2. Analyse

For eksisterende vegobjekter tar vi vare pÃ¥ endringer til tom verdi for Ã¥ kunne fortelle Skriv at her skal verdien slettes.

Dette mÃ¥ behandles annerledes pÃ¥ nye vegobjekter, siden det ikke er snakk om noen sletting her.

Tomme egenskaper mÃ¥ derfor filtreres bort i kopieringsfasen.Â 
h2. LÃ¸sning

implementerte et filter i FeatureCloner som fjerner attributter med tom verdi.",NVDB-6937,Datafangst,
Rydd opp i toppmenyen,"h2. Toppmenyen i DF trenger en overhaling.

<a>-element benyttes semantisk feil

Brukernavn ser ut som det er klikkbart, men det er det ikke

ikoner har ikke visuell feedback ved hover

konsistens: alle menyvalg bÃ¸r ha ikon og tekst

lett omstrukturering:
 * brukernavn bÃ¸r adskilles fra menyvalg-gruppen
 * log ut bÃ¸r grupperes sammen brukernavn

Â 

Lag designskisse og implementer",NVDB-6937,Datafangst,
Ruteberegning: Parameter for start- og sluttdato,"Relatert til sak NVDB-4399, som tilbyr en enkelt betraktningsdato som parameter. Dette er nok nyttig for flere klienter, men for API Skriv som skal beregne stedfesting for et vegobjekt med gyldighet fra og med en dato (startdato) og til en dato (sluttdato), vil det ikke hjelpe. 

Det Ã¸nskes to parametere, fraDato og tilDato, som skal fÃ¸re til at ruten bare beregnes over veglenker som er gyldige pÃ¥ begge datoer. Den siste, tilDato, mÃ¥ kunne settes til ""null"" for Ã¥ angi at kun veglenker med Ã¥pen sluttdato er aktuelle.",NVDB-6937,Les-API,
Aktivere stedfesting2 som default,"sett stedfesting2 som default, tilgjengeliggjÃ¸r stedfesting 1 som toggle som fallback",NVDB-6937,Datafangst,
Forplantning til detaljerte veglenker: maximum number of expressions in a list is 1000,"{quote}
2020-04-22 08:02:51 [taskexecutor] ERROR TaskExecutor - Task IndexTransaction(4814206, 2020-04-21 15:35:31) failed [4814206 2020-04-21 15:35:31]
no.vegvesen.nvdbind.ExportException: Unable to process netelements for transaction 4814206 2020-04-21 15:35:31
        at no.vegvesen.nvdbind.indexing.RoadnetUpdater.run(RoadnetUpdater.java:60)
        at no.vegvesen.nvdbind.tasks.IndexTransactionTask.run(IndexTransactionTask.java:88)
        at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:193)
        at no.vegvesen.nvdbind.tasks.TaskExecutor.start(TaskExecutor.java:113)
        at no.vegvesen.nvdbind.NvdbindCore$TaskExecutorThread.run(NvdbindCore.java:493)
Caused by: java.sql.SQLSyntaxErrorException: ORA-01795: maximum number of expressions in a list is 1000

        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:494)
        at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:446)
        at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1054)
        at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:623)
        at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:252)
        at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:612)
        at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:213)
        at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:37)
        at oracle.jdbc.driver.T4CStatement.executeForDescribe(T4CStatement.java:733)
        at oracle.jdbc.driver.OracleStatement.executeMaybeDescribe(OracleStatement.java:904)
        at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1082)
        at oracle.jdbc.driver.OracleStatement.executeQuery(OracleStatement.java:1276)
        at oracle.jdbc.driver.OracleStatementWrapper.executeQuery(OracleStatementWrapper.java:366)
        at com.zaxxer.hikari.pool.ProxyStatement.executeQuery(ProxyStatement.java:111)
        at com.zaxxer.hikari.pool.HikariProxyStatement.executeQuery(HikariProxyStatement.java)
        at no.vegvesen.nvdb.common.jdbc.dbix.DbSessionImpl.executeQuery(DbSessionImpl.java:185)
        at no.vegvesen.nvdb.common.jdbc.dbix.DbSessionImpl.mapOne(DbSessionImpl.java:118)
        at no.vegvesen.nvdbind.processor.netelements.ModifiedNetElementIdReader.getDetailedLinksCount(ModifiedNetElementIdReader.java:127)
        at no.vegvesen.nvdbind.processor.netelements.ModifiedNetElementIdReader.count(ModifiedNetElementIdReader.java:105)
        at no.vegvesen.nvdbind.processor.netelements.IncrementalNetElementReader.count(IncrementalNetElementReader.java:65)
        at no.vegvesen.nvdbind.indexing.RoadnetUpdater.update(RoadnetUpdater.java:81)
        at no.vegvesen.nvdbind.indexing.RoadnetUpdater.run(RoadnetUpdater.java:58)
        ... 4 common frames omitted
Caused by: oracle.jdbc.OracleDatabaseException: ORA-01795: maximum number of expressions in a list is 1000
{quote}",NVDB-6937,NVDB-IND,
Systemfeil pga endPos > 1.0 ved restedfesting etter geometriutskiftning,"h2. Observasjon

Bruker mortfinn fikk SYSTEMFEIL pÃ¥ fem endringssett fra NovaPoint den 20. april. Eksempel: https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/f461c3f1-d546-40f7-9898-5557942f3b75

{code:java}
java.lang.IllegalArgumentException: end must be less than or equal to 1.0
	at no.vegvesen.vt.nvdb.commons.core.contract.Requires.require(Requires.java:47)
	at no.vegvesen.vt.nvdb.apiskriv.domain.Extent.validateRange(Extent.java:115)
	at no.vegvesen.vt.nvdb.apiskriv.domain.Extent.of(Extent.java:78)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.LocationCalculator.calcLocationalLine(LocationCalculator.java:138)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableLocational.relocalizeToLine(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:1040)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableLocational.relocalize(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:1010)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableFeature.relocalize(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:830)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.addEnrichmentOrReportConflict(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:491)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.doFilter(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:159)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:114)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:92)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:128)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:393)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:163)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

Det kastes en IllegalArgumentException fra Extent.of fordi et reberegnet stedfestingselement har fÃ¥tt sluttposisjon som er (antageligvis) hÃ¥rfint stÃ¸rre enn maksverdien 1.0. Dette skjer i forbindelse med restedfesting pga ny vegnettsgeometri i AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.

Det er ikke mulig Ã¥ reprodusere feilen med noen av de fem endringssettene fra mortfinn, fordi data i NVDB har endret seg siden de ble forsÃ¸kt sendt inn.

h2. LÃ¸sning

Det er lagt inn kontroll og justering av stedfestingselementet dersom det er utenfor gyldighetsomrÃ¥det [0.0, 1.0]. I tillegg er unntaksbeskrivelsen fra Extent.of utvidet til Ã¥ ta med hva den relative posisjonen faktisk er sÃ¥nn at det er enklere Ã¥ tolke lignende situasjoner i framtida.

Under kodeanalyse ble det avdekket at beregnet sluttposision er hÃ¥rfint for kort dersom veglenkens geometri er ""bratt"". Rettet dette i samme slengen.",NVDB-6937,Skriv-API,
GÃ¥ gjennom loggmeldinger fra meterberegning,"FÃ¸lg opp alle meldinger fra meterberegning.
MÃ¥let er at det ikke skal vÃ¦re noen feilmeldinger, og ingen -1-meter.

Loggmeldinger vi skal prÃ¸ve fÃ¥ bort: 
{quote}
WARN RoadNetMeterCalculatorImpl - Failed to get roadsystem and section for netelementid 
WARN RoadSysMeterValue - Position 0.70859735 on netelemtid 625641 was not within reflinkExtent 
WARN RoadNetMeterCalculatorImpl - Could not find start or end section for segment
{quote}

At det ikke er noen -1-meter kan sjekkes ved Ã¥ kjÃ¸re filter ""sysref_section_start_meter:\-1"" i nvdb-roadnet-segments""",NVDB-6937,NVDB-IND,
URL-import feiler hvis tekstboks inneholder linjeskift,"h2. Observasjon
FÃ¥r noen ganger feil nÃ¥r jeg skal importere fra Les API-URL, og tror at mÃ¸nsteret er at det kommer med et linjeskift etter URL nÃ¥r jeg kopierer fra dokument.

OgsÃ¥ rart at jeg fÃ¥ to feilmeldinger (se vedlegg), sÃ¥ mulig det er noe mer pÃ¥ gang her.

h2. Forslag til lÃ¸sning
Trenger sikkert bare en .trim() pÃ¥ riktig sted.",NVDB-6937,Datafangst,
Vegsystemreferanse mangler i lokasjonsobjekt for vegobjekter-sÃ¸k,"h2. Observasjon

For et sÃ¸k etter vegobjekter fÃ¥r jeg ikke med vegsystemreferansen i lokasjons-objektet:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/5?kartutsnitt=269397.028,7041828.583,269773.399,7042295.573&segmentering=true&egenskap=1089%3D13744&inkluder=metadata,egenskaper,lokasjon,geometri&antall=1]

_(SÃ¸k i siden etter objekt med idÂ 579117363)_


FÃ¸lger jeg direktelenken til det aktuelle vegobjektet, finner jeg derimot vegsystemreferansen inkludert:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/5/579117363/1]",NVDB-6937,Les-API,
Bruker som inviterer skal ha riktig sensitiv-rolle,"Basert pÃ¥ diskusjon pÃ¥ mail og i NVDB-5258 opprettes flere saker. 

Brukere som inviterer andre inn pÃ¥ en kontrakt skal ha tilsvarende sensitiv rolle som det kreves for Ã¥ se alle objekter og egenskaper i kontrakten, for Ã¥ kunne invitere.

Se ogsÃ¥ relaterte saker. ",NVDB-6937,Datafangst,
Collection i skjema,"NÃ¥ er collections hardkodet. Vi tror at det vil vÃ¦re en fordel dersom full reindeksering oppretter nye collections.
Ved Ã¥ putte dette i skjemaet vil APIet bytte til nye collection pÃ¥ samme mÃ¥te som nÃ¥.

-----

*OBS*
For Ã¥ ta i bruk dette mÃ¥ config endres fÃ¸r full indeksering, og den/de gamle collections mÃ¥ slettes manuelt nÃ¥r API-et har tatt i bruk den nye collection-en.

For Ã¥ fÃ¥ ny collection for vegobjekter, legg til dette i /data/vegkart/config/nvdbind/nvdbind.properties:
solr.migrate.nvdb-roadobjects.collectionName=nvdb-roadobjects2",NVDB-6937,NVDB-IND,
stedfesting med datter innenfor mor fÃ¸rer til alt for lange stedfestinger,"h2. Observasjon

Via support
{quote}Heia
 Her er noen punkter som jeg sliter med Ã¥ fÃ¥ pÃ¥ plass i Datafangst og NVDB.
 Kontrakten er her:
 [https://datafangst.kantega.no/#!/contract/b9606b08-29ec-404e-a140-fc757469b61a]
 # Jeg sliter med Ã¥ fÃ¥ sammenkoblet belysningsstrekning tilÂ belysningspunkter. FÃ¥r melding om:Â _*Belysningsstrekning ligger for langt unna en eller flere dÃ¸tre.*_Â Jeg har sjekket data i et annet program og koordinater iÂ belysningspunktÂ er helt identiske mot knekkpunkter i belysningstrekning.Â {quote}
Denne kan gjenskapes lokalt.
 Sosi ligger vedlagt: stedfest og sammenkoble objektene. dette fÃ¸rer til en feilmelding.
h2. Analyse

NÃ¥r vi evaluerer om datter er innenfor mor, sammenlikner vi geometrien til mor med geometrien til mor og datter.
 Geometrien til mor og datter finner vi ved Ã¥ lage en ny geometri basert pÃ¥ kombinert range til mor og datter. I dette tilfellet er Range til mor identisk med Range til mor og datter kombinert. med andre ord er datter innendor mor. Men nÃ¥r vi genererer en ny geometri basert pÃ¥ range, sÃ¥ blir den nye geometerien litt annerledes enn geometrien til mors stedfesting. blandt annet fordi ny geometri kan inneholde hÃ¸ydedata, og fordi vegnettet kan ha endret seg.
h2. Â LÃ¸sning

NÃ¥r vi skal sammenligne gammel og ny geometri kan vi fÃ¥ en annen geometri fra LES, selv om range er den samme. Vi mÃ¥ derfor generere ny geometri A basert pÃ¥ gammel range, og geometri B basert pÃ¥ ny range. Da blir begge geometriene basert pÃ¥ samme og oppdatert data fra API LES. samme range vil da garantere lik lengde, og dÃ¸tre vil bli riktig evaluert som innenfor mor.Â 

Â ",NVDB-6937,Datafangst,
Feil feilmelding ved endring av ansvarlig pÃ¥ kontrakt,"Jeg har endret ansvarlig pÃ¥ en haug med kontrakter. Hvis jeg staver brukernavn pÃ¥ den som skal vÃ¦re ny ansvarlig feil, fÃ¥r jeg feilmelding om at jeg ikke har rettigheter til Ã¥ endre kontrakten.

*Observasjon*

Hvis jeg oppdaterer ansvarlig pÃ¥ en kontrakt med et brukernavn som ikke finnes fÃ¥r jeg beskjed om
{noformat}
{""message"":[""Kan ikke sette maybehaa som ansvarlig for kontrakt, bruker har ikke tilgang til Ã¥ redigere kontrakter""]}
{noformat}
[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-utv-beats-6.8.8-2020.04.23/doc/?id=A_xGp3EBO6kjk0-Y9svp]

Den samme meldingen kommer om jeg prÃ¸ver Ã¥ sette et brukernavn som eksisterer, men som ikke har riktig rolle.",NVDB-6937,Datafangst,
NVDBREF-623 Endre URL i info-boks - benytte vegkart-2019.atlas.vegvesen.no,"I infoboksen henviser vi til forrige versjon av vegkart ogÂ [https://www.vegvesen.no/nvdb/vegkart/v2]

Denne bÃ¸r endres til vegkart-2019.atlas.vegvesen.no",NVDB-6937,Vegkart,
Leveranseinformasjon,"*Test i AT:*
 * NVDB-5339: PrÃ¸v testbeskrivelse i saken
 * NVDB-5343: Send et endringssett med og uten ""x-nvdb-dryrun-nolocking"" og ventetid. Sjekk antallet lÃ¥ser i kontrollpanelet.
 * NVDB-5238: Bruk gjerne en tilpasset versjon av vedlegg i saken
 * NVDB-5271: Test innsedning av vedlagte SOSI-filer mot Datafangst i ATM for Ã¥ verifisere.

Saker i leveransen som ikke er nevnt over trenger ikke Ã¥ testes eksplisitt i ATM.",NVDB-6937,Skriv-API,
Prosjektreferanse settes feilaktig pÃ¥ ikke-importerte objekter,"h2. Observasjon

NÃ¥r man har et nytt objekt som man kobler inn under NVDB-mor, sÃ¥ vil ikke NVDB-mor ligge i kontrakten, men vÃ¦re med i endringssettet fordi NVDB-mor sin assosiasjon er oppdatert med det nye objektet. *MEN*, dersom man i registreringen velger Ã¥ bruke kontraktens prosjektreferanse i innsendingen sÃ¥ vil ogsÃ¥ denne NVDB-moren fÃ¥ oppdatert sin egenskap ""Prosjektreferanse"" med kontraktens referanse.

Dette blir feil. Det er kun objektene i kontrakten (altsÃ¥ typen som velges for innsending) som skal fÃ¥ satt prosjektreferanse. Se f.ex endringssett
{noformat}
https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/af58b342-37b4-4a0e-b49e-0fc55e60a2f9
{noformat}
Her er det kun er Leskur (type 25) som er valgt for innsending. Men ogsÃ¥ mÃ¸drene blir oppdaterte med denne referansen.",NVDB-6937,Datafangst,
segmentlengde skal vÃ¦re basert veglenke.lengde,"NÃ¥ er segment.lengde basert pÃ¥ veglenke.geometri.lengde, endre til veglenke.lengde (godkjent lengde)",NVDB-6937,NVDB-IND,
Dok: Systemskisse til drift,"Tegne systemskisse for NVDB Rapporter og legge under:
[https://www.vegvesen.no/wiki/display/NVDBogGeodata/Systemdokumentasjon+NVDB+Rapporter]Â 

For inspirasjon, se pÃ¥ Vegkart:

[https://www.vegvesen.no/wiki/pages/viewpage.action?spaceKey=NVDBogGeodata&title=Systemdokumentasjon+Vegkart+GUI]Â ",NVDB-6825,Rapportgenerator,
NVDBREF-433 : Zooming i kartet,"NÃ¥r jeg skriver inn og velger Fylke eller Kommune zoomes det inn til riktig sted.Â  Men nÃ¥r jeg skriver inn og velger f. eks. vegnummer, stedsnavn eller kontraktsomrÃ¥de zoomes det ikke inn.
Jeg Ã¸nsker meg at det zoomes inn i kartet for de valg jeg velger under ""Hvor"".",NVDB-6937,Vegkart,
NVDBREF-611 : Dokumentasjon - Last ned bilder og pdf,"Velger Fysisk inngrep i vannforekomst og fv860 s2.Â  Objekt 915510048 har tre datterobjekt, dokumentasjon.Â  I disse dokumentasjonsobjektene er det lastet inn bilder og pdf-dokument til NVDB, objekt id: 915510049, 915510050 og 1005594528.
Jeg Ã¸nsker Ã¥ fÃ¥ sett pÃ¥ disse bildene og pdf-dokumentet, men det gÃ¥r ikke.Â  Jeg fÃ¥r tatt ut i NVDB123, men ikke i vegkart.
https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@603515,7677330,10/hva:~(~(id~783))/hvor:~(vegsystemreferanse~(~'FV860S2))/valgt:915510048:783",NVDB-6937,Vegkart,
NVDBREF-295 : Endre konfigurasjon av produksjonsmiljÃ¸et for NVDB,"* Ã˜ke fra 5 til 6 noder (VMâ€™er)
Â * Ã˜ke antall shards til 18, dvs kjÃ¸re 3 per VM
Â * Ã˜ke RAM fra 16G til 64G
Â * Beholde roterende disker",NVDB-6937,Les-API,
"NVDBREF-249 : Oppdatere informasjonsboksen i Vegkart ""Velkommen til Vegkart!""","Fjerne teksten ""Kommunikasjonen med bakenforliggende...""
Utkast til tekst som kan legges til: Vegkart er nÃ¥ tilpasset nytt referansesystem, se informasjon om nytt referansesystem her: https://vegnett.no/2019/10/nytt-referansesystem-for-veg-tas-i-bruk/
Det er ogsÃ¥ mulig Ã¥ benytte Vegkart som benytter gammelt referansesystem det finner du her: 
https://www.vegvesen.no/nvdb/vegkart/v2/#kartlag:geodata/@600000,7225000,3",NVDB-6937,Vegkart,
"NVDBREF-599 : Adskilte lÃ¸p - Ramper markeres ""Med""","Jeg velger EV8 og zoomer inn til Breivika i TromsÃ¸.Â  
Test-atlas: Ser at ramper markeres som ""Adskilte lÃ¸p med"".Â  Adskilte lÃ¸p finnes kun pÃ¥ hovedlÃ¸pet pÃ¥ vegen der vi registrerer strekningsobjekter. Og det gjÃ¸r vi jo ikke pÃ¥ ramper.
https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@654516,7735147,14/hvor:~(vegsystemreferanse~(~'EV8))/vegnett:~'geometri+~(adskiltelop~(~'med))
Det er riktig i prod:
https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@654515,7735088,14/hvor:~(vegsystemreferanse~(~'EV8))/vegnett:~'geometri+~(adskiltelop~(~'med))/vegsystemreferanse:653755.047:7735607.996
Â ",NVDB-6937,Vegkart,
NVDBREF-575 : sosi eksport. feil i datofelt,"Â 
Â 
Endredato 20191022082133Â  
Her der det litt for mange tall..
Â 
Â 
!image-2020-03-25-13-33-00-567.png!",NVDB-6937,Eksport,
GjÃ¸re det mulig Ã¥ markere feilmelding i GUI,"Brukere fÃ¥r ikke til Ã¥ markere og kopiere feilmeldinger som dukker opp i grensesnittet i Datafangst. Dette er grunnet at klikk pÃ¥ feilmeldingen fjerner visningen av den.

Det vil likevel fortsatt vÃ¦re behov for Ã¥ kunne ta bort feilmeldinger etterhvert som de dukker opp, sÃ¥ forslaget er Ã¥ legge pÃ¥ et x-ikon som er klikkbart for Ã¥ lukke meldingen. Klikk pÃ¥ selve teksten bÃ¸r ikke fjerne feilmeldingen.

En x vil ogsÃ¥ gjÃ¸re det lettere Ã¥ skjÃ¸nne at man kan klikke for Ã¥ fÃ¥ bort feilmeldingen. 

Â ",NVDB-6937,Datafangst,
NVDBREF-618 Feil visning av ulykker i Vegkart,"UlykkesmiljÃ¸et har importert ulykker til NVDB og ved sÃ¸k etter ulykker i Vegkart v3Â  for kommunen Nore og UvdalÂ  er responsen at det finnes 1287 ulykker, men i kartet innenfor kommunens grense vises det langt fÃ¦rre enn 1287.Â 

Dersom vi legger pÃ¥ et filter >= 1/1-2012 sÃ¥ er responsen 331 ulykker, men ca 100 stykker vises innenfor kommunegrensen. I dette tilfellet vises resterende ulykker utenfor kommunens grenser.

Ved sÃ¸k i vekart-2019 (v2) finnes ogsÃ¥ 1287 ulykker i Nore og Uvdal, noen vises innenfor kommunegrensen og noen utenfor selv uten at det er lagt pÃ¥ datofilter.",NVDB-6937,Vegkart,
Vise vegsystemreferanse for enkeltobjekter,"Simon StÃ¸lan via support og med hjelp fra Jan Kristian til Ã¥ tolke: 

Ã˜nsker at datafangst skal vise hvilken vegreferanse (gammelt system) objektet vil fÃ¥ fÃ¸r objektet er registrert i NVDB (bÃ¥de gammelt og nytt system hvis mulig).

Ã˜nsker at datafangst skal vise den vegsystemreferansen objektet vil fÃ¥ fÃ¸r objektet er registrert i NVDB.

Jan sier at begge deler er selvsagt mulig, men Ingunn mÃ¥ svare pÃ¥ om det er gjennomfÃ¸rbart med de midlene vi har nÃ¥. 

Prinsippielt er det ingen presist vet veg(system)referansene fÃ¸r objektet er registrert i NVDB,  men nÃ¥r vi kjenner posisjonen (pÃ¥ vegnett eller koordinat) sÃ¥ kan vi selvsagt sjekke hvilken referanse som finnes akkurat der. Det er f.eks. fullt mulig Ã¥ slÃ¥ opp bÃ¥de gammel og ny veg(system)referanse i NVDB api V2 og V3 basert pÃ¥ start- og sluttpunkt for vegtilknytningen (ut fra geometri eller stedfesting pÃ¥ vegnett).  Men jeg kjenner datafangstlÃ¸sningen for dÃ¥rlig til Ã¥ vite om det er en god lÃ¸sning, om det er enkelt Ã¥ implementere eller om det vil blir uhorvelig mye pirk fordi det ikke passer inn med resten av lÃ¸sningen. 

Jan peker pÃ¥ stÃ¸tteverktÃ¸y: Ellers har vi jo en del stÃ¸tteverktÃ¸y for Ã¥ oversette gamle lister til nye vegsystemreferanser. To kartklienter og et FME workspace med forklaring av logikken. 
â€¢	https://www.vegdata.no/2019/12/20/kartlosning-nytt-vegreferansesystem/
â€¢	https://www.vegdata.no/2019/09/24/kartlosning-vis-dagens-og-historisk-vegreferanse/
â€¢	https://github.com/LtGlahn/fme_diverse/tree/master/konverter_vegreferanse

Simon says: Disse stÃ¸tteverktÃ¸yene er sikkert gode, men tror ikke vi kan forvente at vÃ¥re byggeledere/kontrollingeniÃ¸rer vil benytte disse. Det handler Ã¥ Ã¥ gjÃ¸re det sÃ¥ enkelt tilgjengelig som mulig slik det blir prioritert Ã¥ gjennomfÃ¸re det, tror jeg. SÃ¥ hvis det er en mulighet Ã¥ vist vegreferanse og vegsystemreferanse i Datafangst er det et stort pluss for disse brukerne.

Opprinnelig spÃ¸rsmÃ¥l: 
Ifbm oppdatering av etterslep for Vegoppmerking TverrgÃ¥ende er det Ã¸nsket fra fagmiljÃ¸et visning av vegrefranse for enkeltobjekter. Dette for Ã¥ kryssreferere mot gamle sidesystemer/lister.
",NVDB-6937,Datafangst,
Dupliserte assosiasjoner gir HTTP 500 ved registrering,"h2. Observasjon #1

Bruker (Raymond Hermansen, [https://datafangst.kantega.no/#!/contract/f9d684c7-1303-4603-afcb-c93cc7afae52]) melder om at man fÃ¥r systemfeil (HTTP 500 fra DF backend) ved registrering. Det som egentlig kommer er HTTP 400 fra API Skriv pga duplikate nvdb-id'er i samme assosiasjon. Det som skal ha vÃ¦rt utfÃ¸rt er at objekter er importert fra NVDB, for deretter Ã¥ endret pÃ¥ assosiasjonene.

Innsending av /endringssett: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.14/doc/?id=E8Xgd3EBxoPaAPabfHl]

Svar fra API Skriv: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.14/doc/?id=LsXgd3EBxoPaAPabfHl]
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1""><message>delvisOppdater.vegobjekter[3].assosiasjoner[0]: MÃ¥ vÃ¦re unik: nvdbId</message><message>delvisOppdater.vegobjekter[0].assosiasjoner[0]: MÃ¥ vÃ¦re unik: nvdbId</message><message>delvisOppdater.vegobjekter[4].assosiasjoner[0]: MÃ¥ vÃ¦re unik: nvdbId</message></fault>
{noformat}
Ser fra assosiasjonstabellen at det ligger mange duplikate der (se vedlegget):
{noformat}
select * from feature_association2 where parent_feature_id in (select id from feature2 where project_id='f9d684c7-1303-4603-afcb-c93cc7afae52');
{noformat}
h2. Observasjon #2

Annen bruker (Simon StÃ¸lan, [https://datafangst.kantega.no/#!/contract/032017ce-62f6-4ce2-bea1-dc1a5b05785d]) melder om samme problem. Ser i kontrakten at ogsÃ¥ her er det eksisterende objekter, og utfÃ¸rte assosiasjoner.

Innsending av /endringssett: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.14/doc/?id=c8uCeXEBxoPaAPabhBqO]

Svar fra API Skriv: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-beats-6.8.8-2020.04.14/doc/?id=bcuCeXEBxoPaAPabhBqO]

h2. Analyse
Som Tor viser i kommentarene sÃ¥ fÃ¥r vi flere sammenkoblinger mellom sammen objekter ved Les API-import av bÃ¥de mor og datter. Dette mÃ¥ lÃ¸ses i NVDB-4843 sÃ¥nn at det ikke er sÃ¥nn framover.

h2. LÃ¸sning
Oppretter Flyway-script for Ã¥ rydde i gamle duplikater. Endringer i NVDB-4843 skal sÃ¸rge for at det ikke blir nye duplikater, sÃ¥ denne saken bÃ¸r deployes samtidig som eller etter NVDB-4843.
Â 
For sikkerhets skyld kan det vÃ¦re lurt Ã¥ ha en fersk backup av database fÃ¸r installasjon i prod.",NVDB-6937,Datafangst,
Vegkart SOSI-eksport tar for lang tid,"Det gÃ¥r ikke an Ã¥ teste sosieksport fordi knappen er ""dÃ¸d"". Det fremgÃ¥r kun som en tekst. Mulig dette handler om mine tilganger?

[https://www.utv.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@600000,6895453,3]

Â 

Jeg ser nÃ¥ at jeg har vÃ¦rt for utÃ¥lmodig - bÃ¥de pÃ¥ Edge og Chrome kommer med sosi-resultat etter ca 20 sek. (og det er jo sÃ¥pass

lenge at man gir opp...)Â ",NVDB-6937,Eksport,
NVDBREF-610 : Dokumentasjon - Hyperlink virker ikke,"Velger Dokumentasjon og FV860 S2. Velger objektet pÃ¥ meter 7882 id 927786735.

Hyperlinken virker ikke.

[https://vegkart.test.atlas.vegvesen.no/#kartlag:geodata/@609344,7674171,8/hva:~(~(id~446))/hvor:~(vegsystemreferanse~(~'FV860S2))/valgt:927786735:446]

Tester det samme i vegkart-2019

[https://vegkart-2019.test.atlas.vegvesen.no/#kartlag:geodata/hva:(~(farge:'0_0,id:446))/hvor:(vegreferanse:(~'FV860))/@611433,7672251,9/vegobjekt:927786735:40a744:446]

og her virker linken og jeg kommer inn i saksdokumentet.",NVDB-6937,Vegkart,
Feil i hodet pÃ¥ sosifil,"I eksporten sÃ¥ blir ekstremalverdiene i sosifila feil. Og sosiversjon 5.0 tror eg er litt tidlig Ã¥ bruke ennÃ¥.. dessuten tror jeg det er riktig Ã¥ bruke 8.1 siden det er NVDB data
Slik filen er direkte fra vegkart sÃ¥ fÃ¥r man bla ikke transformert eller tegnet/vist den for eksempel i gisline. import til quadri og eksport til ny sosifil gir riktige ekstremalverdier

Eksport fra vegkart:
!image-2020-03-25-11-11-14-309.png|width=460,height=255!
Â 
Her er sosifil importert i quadribase (gisline) og eksportert ut til sosi. Ekstremalverdier er nÃ¥ riktige.. 
!image-2020-03-25-11-11-53-512.png|width=422,height=252!",NVDB-6937,Eksport,
En del vegstrekninger og sideanlegg mangler strekning i vegref,"{color:#172b4d}En del vegstrekning mangler utstrekning i vegreferansen{color}
{color:#172b4d} Eksempler:{color}
 [https://www.test.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser/segmentert/3174486]
{color:#172b4d} ""kortform"": ""EV6""{color}
 [https://www.test.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser/segmentert/121759]
{color:#172b4d} ""referanse"": ""121759-3-1"",{color}
{color:#172b4d} ""kortform"": ""EV39""{color}
{color:#172b4d} Â {color}
{color:#172b4d} Mange sideanlegg mangler strekning i vegreferansen{color}
{color:#172b4d} Eksempler:{color}
 [https://www.test.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser/segmentert/1728393]
{color:#172b4d} ""kortform"": ""EV6 SD1 m40-144""{color}
{color:#172b4d} osv.{color}
{color:#172b4d} Â {color}
 [https://www.test.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser/segmentert/2246024]
{color:#172b4d} ""kortform"": ""EV18 SD1 m0-12""{color}
{color:#172b4d} Â {color}
 [https://www.test.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser/segmentert/141495]
{color:#172b4d} ""kortform"": ""EV18 SD1 m107-111""{color}
{color:#172b4d} osv.{color}
{color:#172b4d} Â {color}
 [https://www.test.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser/segmentert/2507018]
{color:#172b4d} ""kortform"": ""EV18 SD1 m115-152""{color}
{color:#172b4d} osv.{color}
{color:#172b4d} Â {color}",NVDB-6937,Les-API,
NVDBREF-597 : Vegkart viser ikke alle objekter / feiler ved innhenting av vegobjekter,"Har oppdaget et problem i datafangst, med at jeg ikke kan sammenkoble objekter mot et spesifikt vegobjekt (tunellÃ¸p). Etter Ã¥ ha sjekket i vegkart.no sÃ¥ var ikke objektet Ã¥ finne der heller, sÃ¥ da sjekket jeg mot NVDB123 og forsikret meg at vegobjektet enda eksisterte. Det som er merkelig er at samme vegobjekt er Ã¥ finne i v2 av vegkart. Jeg har linket til URL for v2 og v3 mot samme vegobjekt, slik at dere kan finne ut av dette. Jeg trenger tilgang til dette slik at jeg kan fullfÃ¸re innlesing av datafangstprosjektet mitt.

[https://www.vegvesen.no/nvdb/vegkart/v2/#kartlag:geodata/hva:(~(farge:'0_1,id:67))/@-32118,6573055,14/vegobjekt:1004740896:40a744:67]

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-31923,6573235,13/hva:~(~(id~581))/valgt:1004740896:67]

OPPDATERING: Denne saken er ganske kritisk, siden dette pÃ¥virker hvert enkelt system som bruker v3. Jeg hÃ¸rte fra noen som jobber i Plania, at antallet i summeringsrapportene deres gir feil utslag. I vegkart v2 er antallet rett. Dette var et eksempel pÃ¥ Vifte/ventiltor.

I BRUTUS sÃ¥ dukker feilmelding opp i kartvisningen: Det har oppstÃ¥tt en feil. FÃ¸lgende feilmelding ble mottatt fra NVDB: 503.",NVDB-6937,Les-API,
Mangler valideringsfeil ved opplasting av enkeltstÃ¥ende vegobjekt,"h2. Observasjon
Last opp ett enkelt vegobjekt til en samling med ekstern API (dvs. POST til en feature collection). Legg inn en valideringsfeil av typen som valideres mot Skriv for data i vegobjektet, f.eks. ulovlig verdi for attributt. Denne feilen blir ikke gitt tilbake i respons.

h2. Analyse
Ved opplasting av enkeltobjekter gjÃ¸res validering synkront. Da er det kun feil fra ""file validation"" som gis tilbake, dvs. syntax for GeoJSON, versjon av datakatalog, osv. 
For Ã¥ fÃ¥ Ã¸nsket resultat mÃ¥ ogsÃ¥ resultatet fra ""feature validation"" vÃ¦re med i retur.",NVDB-6937,Datafangst,
Posisjonsoppslag finner ikke vegobjekt,"Halvor Lund pÃ¥ Gitter:
{quote}
Da har vi byttet over til Atlas! Kan det hende at v3 mangler noen feltstrekninger (616-objekter)? Som eksempel har veglenke(sekvens) 0.38202973@2433139 feltstrekning i v2, men ikke i v3, men mistenker at det gjelder flere veglenke(sekvens)er:
NVDB v2: https://www.vegvesen.no/nvdb/api/v2/vegobjekter/616?inkluder=egenskaper&veglenke=0.38202973@2433139&antall=1000
NVDB v3: https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/616?inkluder=egenskaper&veglenkesekvens=0.38202973@2433139&antall=1000
{quote}
",NVDB-6937,Les-API,
Avvise import av vegobjekter med geometrifeil,"h2. Observasjon
Det er en del type geometrifeil som bruker ikke kan rette selv pÃ¥ en fornuftig mÃ¥te. Noen (mÃ¥lemetode og nÃ¸yaktighet) er synlige i Datafangst, men er ikke redigerbare. Andre (som hÃ¸yde) kan heller ikke vises direkte. Det er ogsÃ¥ lite hensiktsmessig at dataforvalter skal rette en del av disse feilene. NÃ¥r det er feil med geometrien er det vanskelig Ã¥ vite nÃ¸yaktig hvordan det skulle ha vÃ¦rt.

Det er tidligere opprettet egne saker for noen slike feil, se NVDB-5273 for feil med hÃ¸ydekoordinater, NVDB-5274 for feil med irregulÃ¦r geometri, og NVDB-5369 for ugyldig mÃ¥lemetode.

h2. Analyse
Bruker har ikke muligheten til Ã¥ rette opp denne typen feil i Datafangst i dag. NÃ¥r det er feil med geometri virker det ogsÃ¥ mer hensiktsmessig at denne feilen blir meldt tilbake til entreprenÃ¸r, sÃ¥nn at hen kan sende inn riktige data.

Datafangst burde avvise vegobjekter med geometrifeil pÃ¥ import, pÃ¥ samme mÃ¥te som geometriparametre utenfor tillatt omrÃ¥de i schema blir avist i NVDB-5356.

h2. Forslag til lÃ¸sning
I dag sÃ¥ kjÃ¸res det en validering mot Skriv ved import. Denne bÃ¸r endres slik at gitte koder gjÃ¸r at en feil merkes som ""belongsToRejectedFeature"" (pÃ¥ Location under feilen), da vil vegobjektet automatisk bli avvist etter at endringer i NVDB-5356 er merget inn.

Koder som mÃ¥ hÃ¥nteres er:
* IRREGULÃ†R_GEOMETRI (NVDB-5274)
* UGYLDIG_KVALITETSPARAMETER (NVDB-5369)
* HÃ˜YDE_UTENFOR_GYLDIGHETSOMRÃ…DE (NVDB-5273)

Eventuelt ogsÃ¥ GEOMETRI_MED_INKONSEKVENT_HÃ˜YDE, er litt usikker pÃ¥ om vi klarer Ã¥ fÃ¥ til denne i Datafangst. De kommer nÃ¥r noen koordinater har hÃ¸yde satt i en geometri, og andre ikke. Kan testes ved Ã¥ fjerne en hÃ¸yde fra en fil som ellers har det, og se hvor langt den kommer.

Se DefaultFeatureListValidator.validateNvdb for et egnet sted Ã¥ koble pÃ¥ sjekk av kode.

h2. Test
Se sakene med enkeltfeil som er lenket i denne saken for Ã¥ finne testcase.",NVDB-6937,Datafangst,
Innsending med prosjektreferanse bÃ¸r oppdatere objektene i datafanen,"Basert pÃ¥ sak NVDB-5323.

Hvis man har satt en verdi for prosjektreferanse pÃ¥ enkeltobjektene i datafanen, men registrerer med kontraktens prosjektreferanse, sÃ¥ vil enkeltobjektene ligge som synkroniserte i datafanen - *men* med en prosjektreferanse som ikke stemmer med hva som er lagret i NVDB.

Her ville det naturlige vÃ¦re Ã¥ oppdatere disse objektenes prosjektreferanseegenskap med den som er lagret pÃ¥ objektet. Det samme gjelder objekter som ikke har sattÂ prosjektreferanseegenskapen i datafanen.

Usikker pÃ¥ om dette vil skape krÃ¸ll for de som bruker referansen aktivt. Evt kan vi hÃ¸re med Jan Vidar StrÃ¸msvold, som under demo brukte prosjektreferansen aktivt.",NVDB-6937,Datafangst,
filter `relasjon` in `vegobjekter?egenskap` is failing,https://github.com/nvdb-vegdata/nvdb-api-client/issues/60,NVDB-6937,Les-API,
Bedre gruppering av logglinjer fra ett request,"Logging i Datafangst bruker i dag feltet ""requestNo"" i logg for Ã¥ gruppere alle linjer i ett request. Dette er bare et lÃ¸penummer, som gjÃ¸r det vanskelig Ã¥ sÃ¸ke pÃ¥. I tillegg sÃ¥ er ikke navnet tydelig pÃ¥ hva det er, og gjÃ¸r at flere ikke vet om det.

Som et minimum sÃ¥ burde feltet endre navn, og nummer kodes som en fast streng i BASE36 (""00000A01C2"") sÃ¥nn at det er enklere Ã¥ sÃ¸ke opp uten Ã¥ spesifisere feltet direkte.

I tillegg sÃ¥ kan det gjÃ¸res flere forbedringer rundt dette (muligens som egne saker):
 * Ta inn generert request-ID fra klient og kombinere med intern request-ID (logges som ""frontend07-00000A01C2"")
 * Lage en request-ID pÃ¥ frontend fÃ¸r hver kall og sende den med for logging

Disse siste to punktene er registrert som NVDB-5623",NVDB-6937,Datafangst,
Grafbare responstider i Datafangst,"Datafangst logger responstid per kall i dag (i AccessLogFilter), men gjÃ¸r det pÃ¥ en mÃ¥te som er vanskelig Ã¥ lese og Ã¥ grafe.

Vi har tidvis klager om at Datafangst er treigt, sÃ¥d et hadde vÃ¦rt veldig nyttig Ã¥ grafe responstider over tid. Det skal veldig lite til for Ã¥ omstrukturere denne logginga for Ã¥ gjÃ¸re det enkelt Ã¥ grafe. Responstid mÃ¥ logges som et eget felt, og gjerne ogsÃ¥ responskode.

Tekst som logges bÃ¸r ogsÃ¥ endres til Ã¥ vÃ¦re mindre krypisk.",NVDB-6937,Datafangst,
GjÃ¸re eksternAPI-dokumentasjonen lettere Ã¥ lese,"[https://apiskriv.vegdata.no/datafangst.html]

GjÃ¸re API-dokumentasjonen lettere Ã¥ lese:
 * Alle endepunkt med
 * Dataobjekt beskrevet
 * Evt gruppere pÃ¥ type
 * Bedre visningÂ 

Repo:Â [https://github.com/nvdb-vegdata/apiskrivdokumentasjon]",NVDB-6937,Datafangst,
Paus NVDBIND dersom Solr ikke er OK,"Paus alle operasjoner mot Solr dersom en eller flere av Solr-helsesjekkene feiler. 
Pausing kan ogsÃ¥ gjÃ¸res fra Forvaltning.

Testes ved Ã¥ se i logg at progresjon stopper.",NVDB-6937,NVDB-IND,
Bruk soft commit,Se om vi kan bruke soft commit mer i nvdbind,NVDB-6937,NVDB-IND,
En spÃ¸rring per omrÃ¥de,"NÃ¥r man velger flere omrÃ¥der lager Vegkart en spÃ¸rring med alle omrÃ¥dene i en egenskapspÃ¸rring.
Endre til Ã¥ gjÃ¸re en spÃ¸rring per omrÃ¥de",NVDB-6937,Vegkart,
Konverteringsfeil pÃ¥ posisjoner med lesing fra ekstern API,"h2. Observasjon
Sigmund Fredriksen rapporterer pÃ¥ datafangst-support 27. mars om at de mener at de ser en forskjell pÃ¥ posisjon i WGS84 pÃ¥ hva de sender inn med ekstern API, og hva de leser tilbake.

""Som tidligere nevnt jobber vi nÃ¥ med Ã¥ skrive oss bort fra internAPIâ€™et i Datafangst.

Vi ser at dere nÃ¥ i kartet i Datafangst konverterer korrekt fra UTM33 til WGS84. Vi har ogsÃ¥ dataene korrekt i vÃ¥r gamle klient (da konverterer vi selv fra UTM33 til WGS84). Men i vÃ¥r nye klient er den lille forskyvingen tilbake. Her mottar vi dataene i WGS84 fra Datafangst.

Kan dere sjekke om dere fortsatt konverterer litt unÃ¸yaktig i dataene som leveres ut via GeoJSON pÃ¥ endepunktet SINUS entreprenÃ¸r mottar dataene?

Antenne i VardÃ¸ i SINUS entreprenÃ¸r med WGS84 koordinater konvertert i datafangst. Antenne ligger pÃ¥ Â«prikkenÂ» bÃ¥de i gamle SINUS entreprenÃ¸r og i Datafangst-kartet.""

h2. Analyse
Jeg har ikke test-data fra Triona, men tester med et vilkÃ¥rlig punkt i VardÃ¸ sentrum, 31.107466Â° Ã¸st, 70.370236Â° nord. 

Hvis jeg konverterer dette til UTM 33 og tilbake til WGS 84 igjen med JTS, sÃ¥ blir det er avvik som kan samsvare med det Triona ser. Jeg har ogsÃ¥ prÃ¸vd med [Proj4J|https://github.com/locationtech/proj4j], som gir et veldig likt resultat. Konverteringa som Triona gjÃ¸r fra UTM 33 gjÃ¸res i JavaScript med [Proj4JS|https://github.com/proj4js/proj4js]. Har ogsÃ¥ kjÃ¸rt en test med konvertering fram og tilbake der, og da ender jeg opp med posisjonen som ble putta inn, sÃ¥ den er i alle fall symetrisk.


||          || JTS                                                                           || Proj4J (java)                                                         || Proj4JS (JavaScript)                                              ||
| UTM 33 | 1097734.0253844042E, 7886942.538062702N | 1097734.0257150712E, 7886942.536846994N | 1097734.0328950887E, 7886942.538235272N |
| WGS 84 | 31.107395949840612E, 70.37023701197327    | 31.107395949840626E, 70.37023697572975N | 31.107466000000006E, 70.370236N                  |

NÃ¥r JTS kjÃ¸res med assertions (default i IDEA) sÃ¥ fÃ¥r jeg denne meldinga: 
bq. The transform result may be 2.622 meters away from the expected position. Are you sure that the input coordinates are inside this map projection area of validity? The point is located 16Â°06.4'E away from the central meridian and 70Â°22.2'N away from the latitude of origin. The projection is ""Transverse_Mercator"".
Forventet avvik der stemmer i alle fall ganske godt med resultatet.
",NVDB-6937,Datafangst,
NVDBREF - 600 (B) Feil i metrering av kryssdeler,"HÃ¥vard har meldt feil pÃ¥ kryssdeler. Har sjekket originaldataene for disse eksemplene, og kryssdelene ser helt riktige ut nÃ¥r jeg henter dem ut i NP. SÃ¥ her spÃ¸rs det om LES ikke hÃ¥ndterer dette riktig. BÃ¸r sjekkes om tilsvarende problem gjelder sideanleggsdeler.

*Rampefeil:*

Det viser seg ogsÃ¥ Ã¥ vÃ¦re mange metreringsfeil pÃ¥ ramper.Â  En gjenganger ser ut til Ã¥ vÃ¦re at rampelÃ¸pet starter pÃ¥ et hÃ¸yt metertall (burde vÃ¦rt 0) og stiger for deretter Ã¥ sprette tilbake til 0 og sÃ¥ stige igjen.

Â 

Eksempel 1:

WARNÂ  Segment1.MeterBreak;3001;2572844-3-6;0,69121467;1;2793371;2572840;0;;E;V;6;S1D1 M4229;K;1001;4;654;668;K;;;;3;1;;286644;6560321;28;286635;6560332;28

WARNÂ  Segment2.MeterBreak;3001;971313-2-11;0,00713499;0,14238919;2572840;3087634;0;;E;V;6;S1D1 M4229;K;1001;4;0;88;K;;;;3;1;;286635;6560332;28;286565;6560380;28

Â 

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@286575,6560318,16/hvor:~(vegsystemreferanse~(~'EV6S1D1))/vegnett:~'geometri+~()/valgt:2572844:3:6]

Â 

Eksempel 2:

WARNÂ  Segment1.MeterBreak;3003;971315-1-10;0;0,03556154;990196;1717232;0;C;E;V;6;S2D1 M4241;K;1002;4;342;346;K;;;;3;;;283119;6566219;20;283120;6566223;20

WARNÂ  Segment2.MeterBreak;3003;1717245-1-8;0;0,71273572;1717232;3091737;0;;E;V;6;S2D1 M4241;K;1002;4;0;243;K;;;;3;1;;283120;6566223;20;283267;6566085;20

Â 

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@283258,6566203,15/hvor:~(vegsystemreferanse~(~'EV6S2D1))/vegnett:~'geometri+~()/valgt:971315:1:10]

Â 

Andre rampeproblemer:

Eksempel 3: SÃ¸r for Ryenkrysset. Komplisert rampesystem: SkjÃ¸nner ikke helt hva som er problemet her

WARNÂ  Segment1.MeterGap 49,000m;301;2516106-2-6;0,35819621;1;2516103;2516104;0;;E;V;6;S16D1 M545;K;1028;2;41;114;K;;;;3;1;;265435;6646451;134;265393;6646508;132

WARNÂ  Segment2.MeterGap 49,000m;301;625635-12-6;0,19867722;0,46165134;2516104;640323;0;;E;V;6;S16D1 M545;K;1028;2;163;365;K;;;;3;1#3K;;265393;6646508;132;265338;6646702;130

Â 

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@265487,6646387,15/hvor:~(vegsystemreferanse~(~'EV6S16D1))/vegnett:~'geometri+~()/valgt:2516106:2:6/vegsystemreferanse:265482.78:6646950.581]

Â 

Eksempel 4:

Ryenkrysset: SkjÃ¸nner ikke konstruksjonen her!

WARNÂ  Segment1.MeterDirectionProblem?;301;2704126-1-6;1;0;2703939;2703938;0;;E;V;6;S16D1 M1209;K;1029;5;42;61;K;;;;2;1;MOT;265439;6647182;129;265437;6647200;130

WARNÂ  Segment2.MeterDirectionProblem?;301;2373738-4-8;0,73567446;0,91670658;2703938;3066632;0;;E;V;6;S16D1 M1209;K;1029;5;42;72;K;;;;3;1;;265437;6647200;130;265430;6647208;129

Â 

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@265433,6647068,15/hvor:~(vegsystemreferanse~(~'EV6S16D1))/vegnett:~'geometri+~()/valgt:2704126:1:6]

Â 

Eksempel 5: Ã…penbar metreringsfeil men skjÃ¸nner ikke hva som er Ã¥rsaken: En veldig kort lenke med mange meter (fra 0 til 285), deretter en lang lenke med fÃ¥ meter (fra 0 til 35) - atpÃ¥til pÃ¥ samme veglenke.

WARNÂ  Segment1.MeterDirectionProblem?;4204;121315-1-9;0;0,04750256;140647;2946519;0;C;E;V;18;S4D1 M265;K;1006;2;0;285;K;;;;3;;;94920;6468350;16;94916;6468353;16

WARNÂ  Segment2.MeterDirectionProblem?;4204;121315-2-9;0,04750256;0,38372629;2946519;140638;0;;E;V;18;S4D1 M265;K;1006;2;0;35;K;;;;3;1;;94916;6468353;16;94905;6468384;15

Â 

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:topo4/@94918,6468336,17/hvor:~(vegsystemreferanse~(~'EV18S4D1))/vegnett:~'geometri+~()/valgt:121315:1:9/vegsystemreferanse:95211.199:6469009.446]

Â 

Eksempel 6: RampelÃ¸pet er metrert i feil retning?

WARNÂ  Segment1.MeterDirectionProblem?;4202;21738-13-12;0,31928508;0,48617094;3096409;27110;0;;E;V;18;S10D1 M160;K;1017;3;0;185;K;;;;3;1;;123769;6484776;33;123692;6484783;35

WARNÂ  Segment2.MeterDirectionProblem?;4202;21738-4-11;0,48617094;0,61975806;27110;1706661;0;;E;V;18;S10D1 M160;K;1017;3;0;65;K;;;;2;1#2;;123692;6484783;35;123637;6484774;33

Â 

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@123832,6484737,16/hvor:~(vegsystemreferanse~(~'EV18S10D1))/vegnett:~'geometri+~()/valgt:21738:12:10]

Â 

*LÃ¸sning*

Finner ikke noe mer feil enn det som er rettet i NVDB-5200. I tillegg er det endel ""datafeil"" ved at rekkefÃ¸lgen pÃ¥ stedfestinger til kryssdeler er feil, slik at meter 0 starter midt inne i kryssdelen osv. Gjennomgang av alle eksempler her:
 * Eksempel 1 og 2: Ser rett ut fra dataene som ligger der, men det kan se ut som det er en ""datafeil"". Om stedfestingene til kryssdelen hadde byttet plass, ville meter 0 startet ut fra rundkjÃ¸ringen. RekkefÃ¸lgen pÃ¥ stedfestingene for kryssdel er avgjÃ¸rende for meterberegningen, starter med meter 0 pÃ¥ starten pÃ¥ fÃ¸rste stedfesting.
 * Eksempel 3: Her er det 3 stedfestinger pÃ¥ kryssdelen. Det ser ut som den fÃ¸rste og andre mÃ¥ bytte plass for Ã¥ fÃ¥ meter 0 i starten av kryssdelen. NÃ¥ starter meter 0 litt inni, noe likt eksempel 1 og 2. Forsatt ser det riktig ut gitt de dataene som er der.
 * Eksempel 4: Litt vanskelig Ã¥ knekke denne, KD5 bestÃ¥r av en slags liggende T, der ene utlÃ¸pet har metreringsretning MOT. Her er det en feil med meterberegning, men den ser ut til Ã¥ ha blitt rettet i NVDB-5200. Vedlagt bilde pÃ¥ hvordan metrering gÃ¥r.
 * Eksempel 5: Retting i NVDB-5200 ser ut til Ã¥ forbedre der det mangler start/sluttmeter (altsÃ¥ den som har 0-285). I tillegg er det likt eksempel 1, at rekkefÃ¸lgen pÃ¥ stedfestinger til kryssdel burde endres litt for at det skal bli riktig (meter 0 ut fra rundkjÃ¸ringen)
 * Eksempel 6: FÃ¸rste og andre stedfesting til kryssdelen (kryssdel 3) mÃ¥ bytte plass. I tillegg har feilen som gav 0-185m pÃ¥ den ene lenken blitt rettet i NVDB-5200.

Â Det er altsÃ¥ ingen kodeendringer i denne saken, men tester den igjen etter NVDB-5200 er klar.

Â ",NVDB-6937,Les-API,
Avviser fÃ¸lgeoppdatering av ikke-versjonerbart vegobjekt som lukkes i endringssettet,"h2. Observasjon

Endringssettet https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/0589bee7-0a8f-488c-8ab7-8d39dc67b713 avvises fordi det ikke kan lages fÃ¸lgeoppdatering (ny versjon med redusert stedfesting) pÃ¥ vegobjekt av type som ikke tillater versjonering.

h2. Analyse

I endringssettet lukkes strekningen 0.497689207642542-1.0 pÃ¥ lenkesekvens 3198119 pÃ¥ dato 2020-03-25. Under behandling finner filteret AdaptFeaturesToClosedNetworkEnricherFilter ut at fÃ¸lgende fire vegobjekter som alle har stedfesting 0.0-1.0@3198119, dvs. er delvis stedfestet pÃ¥ det lukkede vegnettet:

1) Serviceveg (924), id 1006280902:1
2) Vegmyndighet kan bli endret (922), id 1006280900:1
3) Beredskapsveg (923), id 1006280901:1
4) GSV langs annen vegkategori (949), id 1006280899:1

Samtlige vegobjekter har startdato 2020-03-01, som er fÃ¸r lukkedato for vegnettet. Dermed forsÃ¸ker det nevnte filteret Ã¥ versjonere de fire vegobjektene med startdato 2020-03-25 pÃ¥ versjon 2. FÃ¸r jobben berikes med denne fÃ¸lgeoppdateringen kontrolleres at vegobjekttypen tillater versjonering. I dette tilfelle gjÃ¸r ingen av de fire vegobjekttypene det, og det registreres en fÃ¸lgeoppdateringsfeil pga. dette. At de fire vegobjektene blir lukket i endringssettet pÃ¥ samme dato som vegnettet lukkes, tas ikke hensyn til fÃ¸r litt senere i filteret.

h2. LÃ¸sning

Flytter kontrollen pÃ¥ versjonerbarhet til etter berikingen er godkjent for jobben og nye versjoner skal til Ã¥ bli innlemmet i jobben.",NVDB-6937,Skriv-API,
Catch-all-route i veglister,HÃ¥ndtere dynamiske ruter i vegliste-applikasjonen slik at for eksemel */arbeid* kan deles som en lenke,,Rapportgenerator,
Stedfesting 2: BlÃ¥ ramme rundt checkbox pÃ¥ Firefox,"PÃ¥ Firefox kommer det en blÃ¥ ramme rundt checkboxer pÃ¥ visningsvalg.

Litt feilsÃ¸king viser at disse er knyttet til CSS for outline pÃ¥ klasse placeholder-checkbox, dvs. hvis man fjerner denne definisjonen i inspector sÃ¥ blir ramme borte.",NVDB-6937,Datafangst,
NVDBREF-576: (A) Alle objekter mangler segmenter,"Url=https://www.vegvesen.no/nvdb/api/v3/vegobjekter/538?inkluder=egenskaper,vegsegmenter,metadata
Dette har fungert tidligere men gir nÃ¥ fullstendig manglende stedfesting for absolutt alle objekter. Kun egenskaper og metadata kommer ut mens stedfestingen returneres som ""vegsegmenter"": []
Problemet startet i natt og er vedvarende i dag. 
Det ser imidlertid ut som relativt begrensede datamengder inneholder vegsegmenter.",NVDB-6937,Les-API,
Ã˜nske om Ã¥ oppgi posisjon for Ã¥ fÃ¥ ut det aktuelle segmentet for posisjonen,"Mottatt fra Tor K Moseng:

Et Ã¸nske fra gitter er Ã¥ kunne hente ut et vegsegment for en gitt posisjon pÃ¥ en veglenkesekvens. F.ex [https://www.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser/segmentert/2726198] gir ut alle for 2726198, mens brukeren Ã¸nsket Ã¥ kunne gi inn posisjon for Ã¥ fÃ¥ ut kun det aktuelle segmentet for denne posisjonen.",NVDB-6937,Les-API,
Analyser datafeil 2,"*GjÃ¸res fÃ¸rst i mai/juni.*

Oppgaven gÃ¥r pÃ¥ Ã¥ gjÃ¸re samme oppgave som i NVDB-5034 med fokus pÃ¥ fra og med april da flere av feilene som ble oppdaget er fikset. Se om det har kommet til noen flere/andre.

I nvdb-skrive-api prosjektet ligger det et skript man kan kjÃ¸re (nvdb-skrive-api/performance-test/src/test/python/rejectReasonsInProd). Eksempel:
{noformat}
** Example 1 **
Find reject reasons for all clients Des 2019 - Feb 2020
$ python3 getChangesets.py --user exttxm --fTime 1575154800000 --tTime 1583017200000

** Example 2 **
Find reject reasons for Datafangst Des 2019 - Feb 2020 and changeset ids for errors that Datafangst should handle (found through Example 1)
$ python3 getChangesets.py --user exttxm --fTime 1575154800000 --tTime 1583017200000 --client Datafangst --errorCodes UGYLDIG_KVALITETSPARAMETER,UGYLDIG_FLERVERDI,IRREGULÃ†R_GEOMETRI,HÃ˜YDE_UTENFOR_GYLDIGHETSOMRÃ…DE,STÃ˜RRE_ENN_ABSOLUTT_MAKSIMUM,MANGLER_OBLIGATORISKE_EGENSKAPER,EGENSKAPEN_FINNES_IKKE,FLERE_ENN_MAKSIMUM_ANTALL,OVERSKRIDER_FELTLENGDE{noformat}
Se pÃ¥ NVDB-5034 og de identifiserte feilene for Ã¥ se om ting er bedre.",NVDB-6937,Datafangst,
NVDBREF-597: Vegkart viser ikke alle objekter/feiler ved innhenting av vegobjekter,"Har oppdaget et problem i datafangst, med at jeg ikke kan sammenkoble objekter mot et spesifikt vegobjekt (tunellÃ¸p). Etter Ã¥ ha sjekket i vegkart.no sÃ¥ var ikke objektet Ã¥ finne der heller, sÃ¥ da sjekket jeg mot NVDB123 og forsikret meg at vegobjektet enda eksisterte. Det som er merkelig er at samme vegobjekt er Ã¥ finne i v2 av vegkart. Jeg har linket til URL for v2 og v3 mot samme vegobjekt, slik at dere kan finne ut av dette. Jeg trenger tilgang til dette slik at jeg kan fullfÃ¸re innlesing av datafangstprosjektet mitt.

[https://www.vegvesen.no/nvdb/vegkart/v2/#kartlag:geodata/hva:(~(farge:'0_1,id:67))/@-32118,6573055,14/vegobjekt:1004740896:40a744:67]

[https://vegkart.atlas.vegvesen.no/#kartlag:geodata/@-31923,6573235,13/hva:~(~(id~581))/valgt:1004740896:67]",NVDB-6937,Les-API,
Ugyldig mÃ¥lemetode blir innsendt til Skriv,"h2. Observasjon

Datafangst tar ikke hensyn til valideringsfeil fra Skriv ved opplasting. Se relaterte saker det er lenket til. Her er det ugyldig hÃ¸ydemetode som Skriv sier i fra om, Datafangst gir beskjed i filfanen, men laster inn objektene. En bruker som ikke er oppmerksom i filfanen (og hvorfro skal hen det nÃ¥r objektene blir importert) fÃ¥r fÃ¸rst beskjed om dette ved registrering til API Skriv.

Eksempel endringssett: [https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/2509943f-f16d-4c83-b00b-ca22e0f2267f]

Endringssettet kommer fra kontrakt:Â [https://datafangst.kantega.no/#!/contract/ddd092b6-863e-499f-8cfd-c160465257c3/files]

Bruk gjerne vedlagte SOSI for Ã¥ gjenskape.",NVDB-6937,Datafangst,
Endrede assosiasjoner oppdateres ikke i databasen etter registrering,"h2. Observasjon

Kommer fra testing av NVDB-5348. Viste seg at feilen eksisterte fÃ¸r denne saken. Observasjonene ligger i kommentarer pÃ¥ denne saken, men er gjengitt her.

Tar inn en NVDB-skiltplate, kobler denne til ny NVDB-mor. Da vil sammenkoblingsfanen vise at skiltplata er koblet til to mÃ¸dre. Fjerner da manuelt den gamle koblinga. Registrerer. SÃ¥ tar jeg inn en helt ny skiltplate og kobler til ny NVDB-mor. Endringssettet ser riktig ut for akkurat denne koblinga,Â *men*Â forrige re-assosiasjon kommer ogsÃ¥ med pÃ¥ denne registreringen. Dvs at allerede utfÃ¸rt re-assosiasjon kommer med pÃ¥ ny registrering s.a. denne feiler med versjonskrÃ¸ll da Datafangst vil oppdatere versjon 1 som nÃ¥ er blitt til versjon 2 pga forrige registrering. Ny registrering bÃ¸r ikke ta med endringer som allerede er utfÃ¸rt.

Feil som kastes i eskportfanen:Â _1006280773: Versjon oppgitt for oppdatering er ikke siste versjon. Siste versjon er 4_

Databasen ser slik ut ved de ulike stegene
{noformat}
Initielt
99a8ae06-9f0a-4bed-8a19-0f72e534bac3 1006280030 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 READ 
Koblet til ny mor (derfor vises det dobbelt i UI)
99a8ae06-9f0a-4bed-8a19-0f72e534bac3 1006280030 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 READ
dd0a5d27-ebdc-45e5-a74a-15fe370655ac 1006280773 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 WRITE 
Koblet fra gammel mor (manuelt i UI)
3f085af4-1629-45fd-b2c7-dca479ab2814 1006280773 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 WRITE
99a8ae06-9f0a-4bed-8a19-0f72e534bac3 1006280030 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 DELETE
Etter registrering
3f085af4-1629-45fd-b2c7-dca479ab2814 1006280773 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 WRITE
99a8ae06-9f0a-4bed-8a19-0f72e534bac3 1006280030 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 DELETE 
Lagt inn ny skiltplate
aaf6640b-f392-4212-8cab-71cd12dd21cf 1006280908 52073785-7f8f-4746-9607-6e70e6d8651e WRITE
3f085af4-1629-45fd-b2c7-dca479ab2814 1006280773 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 WRITE
99a8ae06-9f0a-4bed-8a19-0f72e534bac3 1006280030 fd3e6e54-1976-4f96-b94e-cb7e30e31b03 DELETE
{noformat}
Basert pÃ¥ databaseinfo sÃ¥ oppdaterer ikke Datafangst assosiasjonene til READ etter registrering.",NVDB-6937,Datafangst,
Ruteberegning:  Returnerte segmenter henger ikke sammen,"Â 

Avhenger av at sak NVDB-5259 er behandlet.Â  Â  De rutene som beregnes over avstander feiler fort uten NVB-5259!

Â 

Ruteberegning fÃ¥r noen strekker med feil geometri som vist pÃ¥ feil_geometri.png (ut av og sÃ¸r for Lillehammer).Â  Geometrien er klippet feil vei og gÃ¥r fra hverandre og ikke mot.Â  Â Her skulle jo den blÃ¥ streken gÃ¥tt fra start til slutt, og ikke slik den er pÃ¥ bildet hvor det gÃ¥r fra hverandre..

Parametre som ble brukt var disse:
 start=256051.91275786122,6783157.609644701
 &slutt=255761.9136374836,6779041.962313057
 &maks_avstand=100
 &omkrets=100

Lenke:Â 
 [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?start=256051.91275786122,6783157.609644701&slutt=255761.9136374836,6779041.962313057&maks_avstand=100&omkrets=1000&konnekteringslenker=true&detaljerte_lenker=true&pretty=true&kortform=true]

Â 

Â 

Jeg fikk ogsÃ¥ feil pÃ¥ denne feil_geometri.png (Vestby):Â  Â  Â 
 Â [https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?start=259500.4664128776,6614944.128838652&slutt=259544.12486595605,6614376.287577341&maks_avstand=100&omkrets=100&konnekteringslenker=true&detaljerte_lenker=true&pretty=true&kortform=true]

Â 
h2. Â TODO
 * Koblingen mellom lenker er noder. I dag er denne koblingen kun pÃ¥ nodeid.
 Endre koblingen i klassen Vertex tilÂ  Ã¥ gjelde:
 ** part
 ** segmentÂ 
 ** nodeid

Â Og derav fikse feilaktige segmenter returnert.",NVDB-6937,Les-API,
SÃ¥rbarheter i JavaScript-avhengigheter,"NPM rapporterer om 38316(!) sÃ¥rbarheter. Heldigvis er nok noen av dem telt flere ganger.

Kun i byggesystem og test, men greit Ã¥ ordne sÃ¥nn at det ikke maskerer sÃ¥rbarheter i biblioteker som brukes av kode.",NVDB-6937,Datafangst,
NVDBREF-618 filtrering av trafikkulykke pÃ¥ ulykkesdato og omrÃ¥de gir snÃ¥le resultatsett.,"{quote}Heisann, filtrering av trafikkulykke pÃ¥ ulykkesdato og omrÃ¥de (kommune=3052 Nore og Uvda) gir snÃ¥le resultatsett. [https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/570?segmentering=true&kartutsnitt=64013.815,6561187.485,302687.692,6808292.777&egenskap=(area(946,3052))+AND+(5055]>='2011-01-01')
 Filtering kun pÃ¥ omrÃ¥de kommune=3052 Nore og Uvdal gir Ã¸nsket resultat. Her er lenke til vegkart-sÃ¸k som demonstrerer problemet tydelig: vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@158050,6713655,5/hva:~(~(filter~(~(operator~'3e3d~type_id~5055~verdi~(~'2011-01-01)))~id~570))/hvor:~(kommune~(~3052))
{quote}
SpÃ¸rring etter ulykker i Vegkart v2 gir heller ikke utÂ  korrekt svar ved spÃ¸rring innenfor en kommune.

Â 

Har dette sammenheng med at mange av ulykkene er stedfestet pÃ¥ fiktiv veg?

Â 

Det er heller ikke samsvar mellom antallet i sÃ¸keresultatet og hva som kommer ut pÃ¥ CSV-eksport. Oppdal kommune og trafikkulykke gir et sÃ¸keresultat pÃ¥ 605, mens csv-eksporten gir 632 ulykker.",NVDB-6937,Les-API,
Mulighet til Ã¥ velge flere kjÃ¸refelt,"Skriv vil ha inn en liste med kjÃ¸refelt.

Skriv om kjÃ¸refelt-editoren til en modal med checkboxer

kjÃ¸refeltvisningen mÃ¥ kunne vise flere kjÃ¸refelt pÃ¥ en god mÃ¥te

Â ",NVDB-6937,Datafangst,
API: Helsesjekk utvides med mer info om NVDB-status,"Helsesjekk tar med metadata om egen og Les-API's status.
Ref. for eksempelÂ [https://nvdbrapportapi.utv.atlas.vegvesen.no/health]).

Denne utvides med oppdateringstidspunkt for NVDB. Dette er interessant nÃ¥r man gjÃ¸r endringer i NVDB og Ã¸nsker Ã¥ ta ut rapport nÃ¥r det er tilgjengelig fra Les API.

Ref.Â [https://nvdbapiles-v3.atlas.vegvesen.no/status]

Info fra Helsesjekk er kanskje ogsÃ¥ aktuelt Ã¥ vise i GUI med en egen link/knapp, eller fortlÃ¸pende polling? Nyttig for Vegliste-gruppa Ã¥ fÃ¥ denne informasjonen i rapport-verktÃ¸yet (front-end).",NVDB-6825,Rapportgenerator,
entertast fÃ¸rer til error hvis ingen elementer har fokus,"h2. Observasjon

fra sentry:Â [https://sentry.kantega.org/kantega/datafangst/issues/10]

trykk pÃ¥ enter hvis ingen elementer har fokus fÃ¸rer til feilmeldinger i konsoll
h2. Analyse

Noen ganger har vi ikke fokus, f.eks hvis bruker har sÃ¸kt etter noe som ikke finnes.

gjenskapes ved Ã¥ sÃ¸ke etter noe som ikke gir resultat, og deretter trykker enter.

metoden som hÃ¥ndterer entertrykk mÃ¥ returnere hvis den ikke klarer Ã¥ finne fokus-cellen.

Â 

Â ",NVDB-6937,Datafangst,
"Datafanen: ""undefined error"" i focusedattribute selector","h2. Observasjon

fra Sentry:Â [https://sentry.kantega.org/kantega/datafangst/issues/17]

FocusedAttribute selectoren krÃ¦sjer hvis vi ingen vegobjekter har fokus.
h2. Analyse

Legg inn sjekk for undefined focused feature og returner null.",NVDB-6937,Datafangst,
Validering av grenseverdier fra Skriv XML-schema ved import av data,"h2. Analyse
Skriv har to typer validering. Den ene er den som kommer i en vanlig respons med feil / advarsel / notabene per vegobjekt og HTTP-respons 200. Den andre er validering av XML-schema, som gir HTTP-respons 400 tilbake. 

PÃ¥ validering av XML-schema sÃ¥ fÃ¥r vi feilmeldinger som er vanskelige Ã¥ bruke direkte (se NVDB-5321 for et eksempel), sÃ¥ de ender opp med en generisk feil i stedet. (I skrivende stund ogsÃ¥ en systemfeil, helt til NVDB-5321 er hÃ¥ndtert.)

Ã… mappe de feilene vi fÃ¥r fra XML-schema tilbake til noe som kan forstÃ¥s av bruker er ikke nÃ¸dvendigvis enkelt. [Tore sier|https://mattermost.kantega.no/svv/pl/58kthfxf8fyumcagwqa9p7edea] ""nÃ¥r jeg snakker med klientutviklere til API Skriv, frarÃ¥der jeg Ã¥ behandle payloaden fra 400-responser pÃ¥ annen mÃ¥te enn Ã¥ logge den og gi en generell systemfeil-melding til brukeren. 400-responsen har en temmelig Ã¥pen kontrakt, som i praksis sier at den bestÃ¥r av en liste med strenger, uten noen garantert formattering eller syntaks. Meldingene kan endre ordlyd over natta.""


h2. Forslag til lÃ¸sning

Tores [forslag til lÃ¸sning|https://mattermost.kantega.no/svv/pl/dy1sh9i3rtncbe6pkhnxysib1a] er at Datafangst gÃ¥r over alle [constraint-annotasjonene|https://javaee.github.io/javaee-spec/javadocs/javax/validation/constraints/package-summary.html] (@Min / @Max o.l) i de [relevante dataklassene|https://github.com/nvdb-vegdata/nvdb-skrive-api/tree/master/plugins/representation/src/main/java/no/vegvesen/vt/nvdb/apiskriv/representation/model/domain/changeset/v3] i Skriv, og lager valideringsregler i Datafangst basert pÃ¥ dem.

Vi bÃ¸r i hovedsak avvise data som bryter med disse valideringsreglene, da f.eks. en mÃ¥lemetode for hÃ¸yde oppgitt uten for lovlig intervall ikke enkelt kan rettes av bruker. Vi kan se etter hvert om det er enkelte feil som kan tillate import, men gi feil pÃ¥ objektet i stedet. Merk at data som har schema-feil ikke kan sendes inn til Skriv for validering fÃ¸r alle verdier er innenfor lovlig verdi for schema.

Vi bÃ¸r samle opp alle feil for hvert datasett og presentere dem samlet til bruker, med referanse til fil / linje eller objekt-ID for hver feil.

Se NVDB-5357 for relatert problemstilling, implementasjonen her bÃ¸r kunne gjenbrukes til sjekk ogsÃ¥ i andre sammenhenger.",NVDB-6937,Datafangst,
Cluster forsvinner pÃ¥ lavt nivÃ¥,"h2. Observasjon

Last inn vedlagte SOSI og vis eksisterende objekter i datafanen. Velg Norkart. Da sees cluster, f.ex 11 i et cluster. Zoom inn et hakk (evt flere), men fra et nivÃ¥ til neste sÃ¥ mister man cluster, og bare et enkeltstÃ¥ende NVDB-objekt stÃ¥r igjen i stedet for cluster. Se vedlagt bilder for zoom pÃ¥ nivÃ¥ n og n+1.",NVDB-6937,Datafangst,
Ruteberegning:  Gir punkt sammen med linjegeometri,"Ruteberegning via geometri beregner rute fra punkt til punkt. Dersom noen punkter er veldig nÃ¦rme, sÃ¥ nÃ¦rme at strekningslengden blir 0, sÃ¥ blir det altsÃ¥ et punkt.Â  Â Neste strekning starter da i samme punktet, men har en utstrekning og blir til en linje.Â  Â  NÃ¥r ruteberegningen kjÃ¸rer , sÃ¥ slÃ¥r den sammen segmenter som overlapper, men det ser ut til at noen punkter ikke blir slÃ¥tt sammen med neste strekning.Â  Â Â 

Â 

Man kan fint gjenskape dette ved Ã¥ kjÃ¸re en geometri som har samme punktet flere ganger i geometrien.

Â 

Â 

Â 

Denne geomtrien gir ut et punkt sammen med mange linjer.Â  Â Akkurat denne geometrien lar seg ikke teste mot en server som indekserer Trionadatabasen NVDB01. Den mangler vegsystemer og fÃ¥r ikke dette punktet med i resultatet:

Â 
 <type>Punkt</type>
 <veglenkesekvensid>42330</veglenkesekvensid>
 <relativPosisjon>0.0</relativPosisjon>
 <kortform>0.0@42330</kortform>
 Â 

Â 

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?geometri=LINESTRING%20Z(270203.15%207041918.45%209.11,%20270203.12%207041921.1%209.03,%20270202.94%207041928.89%208.85,%20270202.66%207041928.89%208.86,%20270202.44%207041933.08%208.92,%20270202.25%207041935.64%208.93,%20270200.05%207041935.65%208.87,%20270200.05%207041935.8%208.86,%20270199.01%207041935.78%208.86,%20270198.99%207041934.8%208.77,%20270199.16%207041934.81%208.78,%20270199.19%207041934.7%208.75,%20270199.11%207041932.03%209.49,%20270198.99%207041930.45%208.9,%20270198.74%207041927.6%208.9,%20270198.06%207041923.11%208.95,%20270197.77%207041919.43%208.96,%20270197.78%207041918.45%208.99,%20270198%207041907.98%209.07,%20270198.19%207041899.17%209.09,%20270198.36%207041891.49%209.18,%20270198.9%207041866.11%209.51,%20270198.94%207041864.52%209.53,%20270199.12%207041857.34%209.64,%20270199.18%207041854.59%209.68,%20270199.27%207041851%2010.48,%20270199.31%207041850.23%2010.49,%20270199.41%207041849.44%2010.51,%20270199.55%207041848.68%2010.49,%20270199.98%207041847.36%2010.51,%20270200.4%207041846.4%2010.54,%20270200.64%207041845.98%2010.54,%20270201.12%207041845.19%2010.54,%20270201.97%207041844.02%2010.55,%20270202.49%207041843.43%2010.57,%20270203.15%207041842.75%2010.57,%20270204.44%207041841.7%2010.57,%20270205.79%207041840.88%2010.58,%20270206.53%207041840.52%2010.57,%20270208.16%207041839.97%2010.53,%20270209.05%207041839.76%2010.53,%20270213.19%207041839.19%2010.54,%20270213.46%207041839.15%209.77,%20270218.3%207041843.78%209.74,%20270215.37%207041844.25%209.74,%20270215.4%207041844.64%209.77,%20270214.77%207041844.75%209.76,%20270215.12%207041848.74%209.82,%20270214.22%207041851.31%209.85,%20270213.63%207041851.39%2010.6,%20270205.68%207041852.3%2010.53,%20270205.4%207041852.44%2010.57,%20270205.14%207041852.67%2010.55,%20270204.91%207041852.92%2010.58,%20270204.69%207041853.33%2010.57,%20270204.64%207041853.47%2010.42,%20270204.22%207041854.08%209.84,%20270204.21%207041855.44%2010.5,%20270204.16%207041857.09%209.8,%20270203.69%207041857.07%209.65,%20270203.68%207041858.67%209.64,%20270204.31%207041858.68%209.65,%20270204.32%207041858.79%209.76,%20270204.38%207041858.78%209.78,%20270204.38%207041859.94%209.88,%20270204.44%207041859.93%209.88,%20270204.43%207041860.7%209.88,%20270204.37%207041860.7%209.88,%20270204.25%207041866.91%209.88,%20270204.16%207041870.76%209.64,%20270203.94%207041881.99%209.57,%20270203.56%207041881.99%209.36,%20270203.51%207041883.67%209.36,%20270203.9%207041883.67%209.36,%20270203.72%207041891.79%209.38,%20270203.45%207041903.53%209.25,%20270203.41%207041905.85%209.19,%20270203.17%207041917.19%209.17,%20270203.15%207041918.45%209.16)&maks_avstand=100&pretty=true&kortform=true]",NVDB-6937,Les-API,
Statistikk og antall vegobjekter,"*Observasjon #1 med vegref og med egenskapsfilter - {color:#de350b}AVVIK{color}*

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/445/statistikk?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608&vegsystemreferanse=EV8&egenskap=%282326%21%3D4200%29]

--> 0 (UTV og ATM)

vs

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/445?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608&vegsystemreferanse=EV8&egenskap=%282326%21%3D4200%29|https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/445/statistikk?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608&vegsystemreferanse=EV8&egenskap=%282326%21%3D4200%29]

--> 21 (UTV og ATM)

*Observasjon #1 med vegref og uten egenskapsfilter - {color:#de350b}AVVIK{color}*

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/445/statistikk?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608&vegsystemreferanse=EV8]

--> 37 (UTV og ATM)

vs

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/445?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608&vegsystemreferanse=EV8|https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/445/statistikk?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608&vegsystemreferanse=EV8]

--> 44 (UTV og ATM)

*Observasjon #1 uten vegref og utenÂ egenskapsfilter - {color:#00875a}OK{color}*

[https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/445/statistikk?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608]

--> 1316 (UTV), 1313 (ATM)

[https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/445?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608|https://nvdbapiles-v3.test.atlas.vegvesen.no/vegobjekter/445/statistikk?segmentering=true&kartutsnitt=626430.051%2C7662359.568%2C712746.312%2C7763587.608]

--> 1316 (UTV), 1313 (ATM)

*Observasjon #2*

Se lenker i NVDB-5345

Â ",NVDB-6937,Les-API,
Sjekk filtrering av segmenter for objekter med sluttdato,"Det ser ut som det kun filtreres pÃ¥ tidspunktparameter, sÃ¥ alle_versjoner=true vil kanskje gi tom segmentliste for objekter med sluttdato. 
Disse skal ha segmentene med samme sluttdato som selve objektet.",NVDB-6937,Les-API,
Kan ikke sende inn vegobjekt med kobling til mor i NVDB,"h2. Observasjon
FÃ¥r systemfeil ved innsending av endringsett der mor er eksisterende NVDB-objekt (men i kontrakten) med eksisterende dÃ¸tre, og har i tillegg en datter som er ny i kontrakten.

For Ã¥ reprodusere, importer f.eks. et skiltpunkt i kontrakt, kopiÃ©r geometri til skiltplate, og koble skiltplate til skiltpunkt. FÃ¥r da systemfeil ved innsending.

h2. Analyse
Skriv har endret pÃ¥ sin XSD (https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/endringssett.xsd) i forbindelse med muligheten for Ã¥ ikke sende inn alle sammenkoblinger. SÃ¥ den XML'en vi sender i dette tilfellet validerer ikke lengre. Sjekk feilen ""Invalid content was found starting with element 'tempId'"" i Kibana, tror alle tilfeller siden midten av februar er dette.

Ser ut som rekkefÃ¸lgen pÃ¥ elementene har blitt byttet om, i tillegg er det et problem at vi sender XML som er en blanding av DelvisAssosiasjon (som er endret i ny XSD) og Assosiasjon (som antakeligvis er den som vi burde brukt slik det er i dag).

h2. LÃ¸sning
Ta i bruk DelvisAssosiasjon slik den nye versjonen av Skriv Ã¥pner for. Ã…rsaken til denne endringa i Skriv var Ã¥ gjÃ¸re det mulig Ã¥ sende inn  kun endrede sammenkoblinger. Dette var ikke mulig fÃ¸r februar, og derfor har Datafangst kode for Ã¥ hente de andre sammenkoblingene fra eksisterende NVDB-objekter og sende de inn samtidig. Vi gÃ¥r over til Ã¥ lage DevisAssosiasjon med kun endrede elementer, og sletter koden som henter inn eksisterende koblinger fra Skriv.",NVDB-6937,Datafangst,
"NVDBREF 568: 538 Gate: Fjerne assosiasjon til kommune, innfÃ¸re egenskap i stedet","h2. Bakgrunn

Gateobjektene i NVDB har bl.a. informasjon om vegnavn. Dette er viktig informasjon for blÃ¥lysetater, ruteplanleggere generelt og adressekart. Denne objekttypen ble definert i NVDB for mange Ã¥r siden, og vi ser nÃ¥ at det er behov for Ã¥ gjÃ¸re noen endringer pÃ¥ denne.

_Fjerne assosiasjon til kommune_

Gateobjektet har i dag en assosiasjon til objekttype 946 Kommune og 536 Kommune 2019. Dette er koblingen til kommunen den aktuelle gata hÃ¸rer hjemme i. Vi skal nÃ¥ forenkle denne objekttypen ved Ã¥ fjerne denne assosiasjonen, og heller innfÃ¸re _kommune _som en _egenskap _til objektet.

_Endre navn pÃ¥ objekttype og egenskaper_

Objekttype 538 Gate er i dag definert med disse egenskapene:
* ET 4588 _Gatekode _(tall)
* ET 4589 _Gatenavn_ (tekst)
* ET 9793 _Sideveg_ med tillatte verdier _Ja_ eller _Nei_

I tillegg har objekttypen en assosiasjon til 946 Kommune og 536 Kommune 2019 som beskrevet over.

Objekttypen 538 Gate vil fÃ¥ nytt navn; Vegadresse, og bli definert slik:
* Ny ET Kommune
* ET 4588 Adressekode (tall)
* ET 4589 Adressenavn (tekst)
* ET 9793 Sideveg med tillatte verdier Ja eller Nei (uendret)

Dette betyr at 538 Vegadresse etter denne endringen kun kjenner til kommunene som var gyldige etter 1.1.2020.

[Samlesak i SVV-Jira|https://www.vegvesen.no/jira/browse/NVDBREF-568] viser oversikt over nÃ¸dvendige endringer i alle berÃ¸rte komponenter. 

h2. Analyse

Omleggingen av mÃ¥ten kommunetilhÃ¸righet angis pÃ¥ for en gate fÃ¥r fÃ¸lger for et par valideringstrinn i API Skriv. Disse validerer at assosiert kommune er den samme kommunen som indikeres av veglenkene gaten er stedfestet pÃ¥ og at bruk av gatenavn (adressenavn) er uniform gitt gatekode (adressekode) og kommune. En overgangslÃ¸sning der API Skriv takler kommunetilhÃ¸righet bÃ¥de via assosiasjon og egenskap gÃ¥r an, men det dobler kompleksiteten pÃ¥ saken og estimatet. Gevinsten er API Skriv da kan rulles ut nÃ¥r man Ã¸nsker FÃ˜R det gjÃ¸res endringer i NVDB eller datakatalog. Det krever imidlertid at egenskapsid for den nye kommuneegenskapen er kjent pÃ¥ forhÃ¥nd.

BerÃ¸rte klasser i API Skriv og det som mÃ¥ gjÃ¸res med dem:
* LocationMatchesAssociatedMunicipalityVallidator - Constraint som validerer at assosiert kommune stemmer med kommunen(e) pÃ¥ veglenkene Gate-objektet er stedfestet pÃ¥. OmdÃ¸pes til LocationMatchesMunicipalityAttributeValidator. Bruk av kommuneassosiasjon erstattes med kommuneegenskap. En del metode med ""Street"" i navnet omdÃ¸pes til ""RoadAddress"". Logikk relatert til pre-2020 gater kan fjernes.
* UniformStreetNameForCodeValidator - Constraint som validerer at gatenavnet er ens for alle gater med samme gatekode i samme kommune. OmdÃ¸pes til UniformRoadAddressNameForCodeValidator. Bruk av municipalityNvdbId (fra assosiasjon) erstattes med municipalityNo (fra egenskap). En del metode med ""Street"" i navnet omdÃ¸pes til ""RoadAddress"". Logikk relatert til pre-2020 gater kan fjernes.
* StreetEnricherFilter - Filteret beriker jobben med eksisterende Gate-objekter som forberedelse til validering i UniformStreetNameForCodeValidator. OmdÃ¸pes til RoadAddressEnricherFilter. Metoden getExistingStreets omdÃ¸pes til getExistingRoadAddresses og finner Vegadresse-objekter gitt adressekode og kommunenr i stedet for kommuneassosiasjon. Logikk relatert til pre-2020 gater kan fjernes.
* StreetId - OmdÃ¸pes til RoadAddress. Property municipalityNvdbId erstattes med municipalityNo fra egenskap. Logikk relatert til pre-2020 gater kan fjernes.
* MunicipalityEnricherFilter - Filter som beriker jobben med Kommune-objekter. Kan fjernes siden kommunenr nÃ¥ er angitt eksplisitt i Vegadresse-objektene.

Estimat: 1 dv",NVDB-6937,Skriv-API,
Feil pÃ¥ veglengder,"2020-03-23 16:01
 Nybakken Lars Erik:
 Er det flere som har feil pÃ¥ veglengde? Ser at det er over dobbel lengde mot det skal vÃ¦re pÃ¥ noen veger. Ser ogsÃ¥ at det er feil pÃ¥ riksveglisten for 12/65. F.eks. E6 viken gr. - Ã…kerjordet er vel ca. 15mil, men stÃ¥r med nesten 35 mil. 892 Bk 12/65, uoff

Â 

Â 

*De nedenfor var feil, men ble lÃ¸st. Bruker dem som testcase:*Â 

905 Bk normal, Vestladn Eksempel fra Vestland (det finnes flere):Â  I NVDB har vegen en totallengde pÃ¥ 83.852:Â 

!image001.png|thumbnail!

I Rapporten kommer det slik:Â 

!image002.png|thumbnail!

Â 

905 Bk normal, uoff Fv17 i Nord-TrÃ¸ndelag og Nordland - ser grei ut

905 Bk normal, uoff: Fv 40 Kongsberg - X E134 - Geilo x rv.7 - 160 km.Â 

Â ",,Rapportgenerator,
"NVDBREF-474: PrÃ¸veinnsjekk av vegnettsendring (Dry run) skal ikke sette lÃ¥ser, eller stoppes av lÃ¥ser","h2. Bakgrunn

PrÃ¸veinnsjekk mÃ¥ kjÃ¸res uten at det settes noen lÃ¥ser, eller at prÃ¸veinnsjekket stoppes av andre lÃ¥ser.

h2. Analyse

LÃ¥sing sikrer at valideringen er gyldig. Bruk av ""dry-run"" header skal behandle et endringssett pÃ¥ vanlig mÃ¥te, inkludert lÃ¥sing, for Ã¥ indikere om det er feilfritt og kan sendes inn ""pÃ¥ ekte"". Vi kan ikke endre denne kontrakten, da den brukes av mange klienter. For Ã¥ realisere prÃ¸veinnsjekk uten lÃ¥sing, mÃ¥ vi definere en ny header, f.eks. ""dry-run-no-locking"", for dette scenariet.

NÃ¥r lÃ¥sing droppes kan vi risikere at et endringssett lykkes i prÃ¸veinnsjekket, men feiler pga. lÃ¥sekonflikt eller relasjonell valideringsfeil i det ekte innsjekket. Vegnettsgruppa har bekreftet at dette er OK.

h2. LÃ¸sning

ChangesetResource: aksepter ny header ""x-nvdb-dryrun-nolocking"".
job/ProcessingDirectives: ny property, noLocking
JobWorker: etabler oppdrag og optimistiske lÃ¥ser bare nÃ¥r noLocking=false

Estimat: 2 dv",NVDB-6937,Skriv-API,
Transaksjonsendepunktet trigger OutOfMemoryError,"h2. Observasjon

Ved anrop av https://www.vegvesen.no/nvdb/apiskriv/rest/v1/transaksjon, altsÃ¥ uten sÃ¸keparametere og resultatavgrensning, stÃ¥r nettelseren og henger og API Skriv trigger OutOfMemoryError.

Default resultatavgrensning er 1000 innslag, men det virker som det ikke har effekt.

h2. Analyse

FÃ¸lgende SQL brukes:

{code:sql}
SELECT * FROM ( 
   SELECT original.*, ROWNUM row_no FROM ( 
      WITH unique_transactions AS ( 
         SELECT DISTINCT tt.taskid task_id, tt.transactiondatetime tx_time
         FROM nvdb.transactiontasks tt)
      SELECT VALUE(tt) AS tx_task
      FROM nvdb.transactiontasks tt, unique_transactions ut
      WHERE (tt.taskid = ut.task_id) AND (tt.transactiondatetime = ut.tx_time)
   ) original
WHERE ROWNUM <= 1000 ) WHERE row_no >= 0
{code}

Resultatavgrensning ser ut til Ã¥ vÃ¦re i orden. Men denne query'en genererer et massivt resultatsett fordi transaksjonene er nÃ¸stet i NVDB og kan inneholde mengder med objekt-beskrivelser.  SQL-queryer tar noen sekunder, mens transformasjonen til representasjonsmodell tar mange minutter og ender i OutOfMemoryError. Ved nÃ¦rmere analyse viser det seg at minne- og tidsbruk skyldes oppbygging URIer med UriBuilder.

h2. LÃ¸sning

Hindrer fri utlisting av 1000-vis av transaksjoner ved Ã¥ kontrollere at minst en sÃ¸keparameter er angitt i requesten.",NVDB-6937,Skriv-API,
Kan ikke re-sende inn feilet innsending til NVDB,"h2. Observasjon

Sender inn skiltpunkt og skiltplate.

Objektene inneholderÂ  feil og blir avvist av NVDB

NÃ¥ kan jeg ikke lenger trykke pÃ¥ Send til NVDB-knappen. klikk pÃ¥ den gjÃ¸r ingenting.

NÃ¥r jeg derimot navigerer til en ny objekttype, blir denne forsÃ¸kt sendt inn automatisk, og uten at jeg vil det.

Se:Â [http://localhost:8082/#!/contract/aa9ab282-e332-4164-ab54-b35418511761/export2]",NVDB-6937,Datafangst,
Datafane: Import av atlas-url feiler,"h2. Observasjon

GÃ¥ til datafanen og importer via url. Denne hÃ¥ndterer ikke Atlas-url'er. F.ex:
 * OK v2:Â https://www.vegvesen.no/nvdb/api/v2/vegobjekter/581?segmentering=true&inkluder=lokasjon%2Cegenskaper%2Cmetadata&kartutsnitt=-2326086%2C5579077%2C3526086%2C8870923&egenskap=5225%3D%27L%C3%A6rdalstunnelen%27
 * OK v3:Â https://www.vegvesen.no/nvdb/api/v3/vegobjekter/581?segmentering=true&inkluder=lokasjon%2Cegenskaper%2Cmetadata&kartutsnitt=-2326086%2C5579077%2C3526086%2C8870923&egenskap=5225%3D%27L%C3%A6rdalstunnelen%27
 * Feil v2:Â https://nvdbapiles-v2.atlas.vegvesen.no/vegobjekter/581?segmentering=true&inkluder=lokasjon%2Cegenskaper%2Cmetadata&kartutsnitt=-2326086%2C5579077%2C3526086%2C8870923&egenskap=5225%3D%27L%C3%A6rdalstunnelen%27
 * Feil v3:Â https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/581?segmentering=true&inkluder=lokasjon%2Cegenskaper%2Cmetadata&kartutsnitt=-2326086%2C5579077%2C3526086%2C8870923&egenskap=5225%3D%27L%C3%A6rdalstunnelen%27",NVDB-6937,Datafangst,
Stedfesting2: Filter for leverte objekter,"Lag et filter for leverte objekter.

filteret skal skjule leverte objekter som default.",NVDB-6937,Datafangst,
"Feil oppramsing for bruksklasse-egenskap ""Spesiell begrensing"" ","Vi fant en feil i veglisteproduksjon for kommunal- og fylkesveger, Bk 905 Normaltransport, uoffisiell for av den biten av Kv57035 i Gjemnes kommune som har spesiell begrensning, markert med rÃ¸dt i kartet:Â 

!image-2020-03-20-14-20-15-905.png!

Til grunn for oppramsingen ligger dette NVDB objektet

Â 

nvdbid: 779637308
versjon: 3
fraDato: 2017-03-10
sistmodifisert: 2017-05-11T13:33:29
Bruksklasse: Spesiell begrensning
Bruksklasse vinter: NULLÂ 
Maks vogntoglengde: 12,40
Strekningsbeskrivelse: Ã…bakken bru 
Maks totalvekt kjÃ¸retÃ¸y, skiltet: NULL
Maks totalvekt vogntog, skiltet: NULL
Merknad: Maks totalvekt 12t
vegsystemreferanse: KV57035 S1D1 m3165-3302
stedfesting: 0.9173444-1.0@224247
segmentlengde: 136,35783423604818
segment nr: 4

Â 

I tabellen kommer det somÂ 

Â 
|Kv. 57035|Ã…bakkvegen: TrÃ¸a - Ã…bakken bru|1.930|BkT8/50|Bk10/50|19.50|

Â 

Dette skal vÃ¦re:Â 

Â 
|Kv. 57035|Ã…bakken bru
Maks totalvekt 12t|0.235|Spesiell begrensing|Â |12.40|",,Rapportgenerator,
Feil i beregnet lengde Kv 57035 ,"Vi har avdekket en feil i beregnede lengder forÂ KV57035 i Gjemnes kommune, kommunenummer 1557, for objekttypen 905 bruksklasse normaltransport, uoffisiellÂ 

Langs Kv57305 finnes det 4 NVDB -objekter, fordelt slik:Â 

!image-2020-03-20-14-07-41-885.png!

Fargelegging her = de ulike bruksklasse-verdiene.Â 

!image-2020-03-20-14-08-17-234.png!

De to objektene i grÃ¸nt inngÃ¥r i sekkeposten ""Ã¸vrige veger"", og vi har ikke prÃ¸vd Ã¥ etterprÃ¸ve lengdeberegning av dem. Feilrapporten gjelder de to NVDB - objekteneÂ 777857447 ogÂ 779637308, markert med brunt og rÃ¸dt i kartskissen.Â 

I vegliste-produksjon er disse objektene opphav til denne utlistingen, pÃ¥fÃ¸rt mine anmerkinger (de to kolonnene lengst til hÃ¸yre). Alt ettersom man bruker geometrisk lengde eller metrert lengde vil man fÃ¥ litt ulike svar, derfor har vi et intervall.Â 

Â 
|Vegnr|Strekningsbeskrivelse|Lengde|Bruksklasse|Bruksklasse, vinger|Lengde|NVDB ID|Riktig lengde|
|Kv. 57035|Ã…bakkvegen: TrÃ¸a - Ã…bakken bru|1.930|BkT8/50|Bk10/50|19.50|777857447|Riktig lengde=1554-1559 meter.|
|Kv. 57035|Ã…bakkvegen: TrÃ¸a - Ã…bakken bru
Maks totalvekt 12t|0.235|BkT8/50|Bk10/50|19.50|779637308|Riktig lengde=136-137meter|

Â 

Â 

Â 

Â ",,Rapportgenerator,
NVDBREF-275: Mange segmenter pÃ¥ Ev6 S3D1 fÃ¥r beregnet fra/til-meter 0,"Klippet fra SVV-jira. Beskrivelsen der er litt bedre formatert: 

Mange segmenter fÃ¥r ingen vegreferanse-utstrekning:
Eksempel:
 
""veglenkesekvensid"": 3154374,
""startposisjon"": 0.0,
""sluttposisjon"": 0.14183124,
""kortform"": ""0.0-0.14183124@3154374"",
""veglenkenummer"": 1,
""segmentnummer"": 2,
""startnode"": ""3154393"",
""sluttnode"": ""3154385"",
""referanse"": ""3154374-1-2"",
""lengde"": 544.343,
""vegsystemreferanse"": {
    ""kortform"": ""EV6 S13D1 m0""
},
Andre referanser med samme problem:
 
 
3154373-1-2;3154374-1-2;3154374-2-2;3154374-3-2;3154375-1-2;3154375-2-2;
3154375-3-2;3154375-4-2;3154375-5-2;3154376-1-2;3154376-2-2;3154376-3-2;
3154376-4-2;3154376-5-2;3154377-1-2;3154377-2-2;3154377-3-2;3154377-11-2;
3154377-12-2;3154378-1-2;3154403-1-2;",NVDB-6937,NVDB-IND,
Oppdatere datakatalog pÃ¥ fil,"Ny datakatalog er tilgjengelig i Prod. Se [https://apilesv3.atlas.vegvesen.no/status]
 ogÂ [http://tfprod1.sintef.no/datakatalog/]
{noformat}
<datakatalog>
  <id>870</id>
  <dato>2020-03-20</dato>
  <versjon>2.20</versjon>
</datakatalog>
{noformat}
Datafangst trenger ny dump av datakatalogen til fil.

*UtfÃ¸rt arbeid*
 * Oppdatert bash-script for Ã¥ hente nye filer
 * Hentet versjon 2.20-870
 * Oppdatert kode og tester til Ã¥ bruke 2.20-870
 * Refaktorert DataCatalogFromFile, slik at koden er litt ryddigere. Deduplisert kode.
 * Oppdatert dokumentasjon pÃ¥Â [https://wiki.kantega.no/display/AV/Datafangst]",NVDB-6937,Datafangst,
Manglende objekter,"Jens Erik Thyholdt @jethy57 10:36 20. mars pÃ¥ gitter:
{quote}
Vi hentet ut alle stikkrenner/kulverter for Vestland fylke. Selvsagt API V3. Sjekket statistikk og antall vi hadde fÃ¥tt over som begge viste 67067. Alt ser derfor ut til Ã¥ vÃ¦re i orden. Men, sÃ¥ sjekket vi logger og oppdaget at flere vegobjekter var ignorert og ikke tatt med fordi vegsystemreferanse ikke var angitt. Tenkte fÃ¸rst at her gjÃ¸r kanskje vi noe feil, men med dobbeltsjekk mot vegkart.no sÃ¥ har vi i vÃ¥r lÃ¸sning (Adaptive Veg) og vegkart samme oppfatning av hvordan slike objekter skal hÃ¥ndteres. Hvis vi f.eks ser pÃ¥ stikkrenne med id 78923149 sÃ¥ mangler denne vegsystemreferanse, men stedfesting har den. ForsÃ¸kte derfor Ã¥ lete opp for Ã¥ se om denne likevel var i kartet. Skal ligge til veglenkesekvensid 384520 med posisjon 0.4474. (https://www.vegvesen.no/nvdb/api/v3/vegobjekter/79/78923149).

SpÃ¸rsmÃ¥let vi sitter tilbake med er hvorfor forsvinner disse vegobjekter fra statistikk, men dersom man henter ut alle vegobjekter via LES sÃ¥ ligger de i uttrekket? Dessuten, siden stedfesting er angitt â€“ kan ikke vegsystemreferansen beregnes der den mangler? Til slutt â€“ vi kan gjerne beregne vegsystemreferansen og fÃ¥ dette vegobjektet vist i kartet, men da vil ikke vegkart.no og vÃ¥r lÃ¸sning vise samme? Helt tilslutt â€“ er det ingen som savner disse vegobjektene?
{quote}

Analyse:
Stikkrenne med id 78923149 er stedfestet pÃ¥ lukket vegnett (384520 med posisjon 0.4474), derfor kommer det ikke noen vegsystemreferanse pÃ¥ det objektet. Mulig stikkrenne-objektet ogsÃ¥ skulle vÃ¦rt lukka, eller ha endra stedfesting.
Det er 572 Ã¥pne objekter uten vegsystemreferanse av typeId 79 i fylke 46, og ved gjennomgang av de gÃ¥r det igjen at de er stedfestet pÃ¥ lukket vegnett.
Hvis man trekker fra disse blir antallet objekter likt statistikk-spÃ¸rringen.",NVDB-6937,Les-API,
NVDBREF-563 Vegkart v2 og v3 viser forskjelige egenskaper,,NVDB-6937,Vegkart,
Ruteberegning: Fjerne/lime sammen duplikat segmenter om en rute starter og slutter pÃ¥ samme vei,"Â 

Den lange lenken nedenfor gir en rute i prinsenkrysset med duplikatsegmenter:

{color:#FF0000}""kortform"" : ""0.87291786-1.0@2510771""{color}
 ""kortform"" : ""0.78970927-0.79084754@72812""
 ""kortform"" : ""0.79084754-0.79107803@72812""
 ""kortform"" : ""0.79084754-0.79084941@72812""
 ""kortform"" : ""0.78970927-0.79084754@72812""
 {color:#FF0000}""kortform"" : ""0.0-1.0@2510771""{color}
 {color:#0747a6}""kortform"" : ""0.6140563-1.0@2510770{color}""
 ""kortform"" : ""0.41611159-0.6140563@2510770""
 ""kortform"" : ""0.5736928-0.6140563@2510770""
 {color:#0747a6}""kortform"" : ""0.6140563-1.0@2510770""{color}
 {color:#FF0000}""kortform"" : ""0.0-0.87291786@2510771""{color}

Â 

Dersom du limer inn geometren (fra lenken) og fÃ¥r den vist i nvdb-visrute ([https://nvdb-vegdata.github.io/nvdb-visrute/STM/]Â ) ,Â  ser du at den gule geometrien viser et polygon nÃ¦r Prinsenkrysset i Trondheim.Â  Se vedlegg rute.png.Â 

Â 

NÃ¥r den lager ruteberegning for et polygon / linje sÃ¥ kjÃ¸rer den gjennom alle punktene og lager raskeste rute mellom to og to punkter ned pÃ¥ vegnettet. Dette polygonet blir stedfestet ned pÃ¥ en og samme veg med vegsystemreferanse=fv6690.Â  Â NÃ¥r den kjÃ¸rer stedfesting for alle punktene i denne gitte geometrien ned pÃ¥ en og samme veg, sÃ¥ blir det duplikate stedfestinger.

Â Vi mÃ¥ legge inn logikk slik at man stopper ruten der den begynner Ã¥ gÃ¥ tilbake samme veien som den kom.Â Â 

Â 

Â 

Â 

Lenke:Â 

[http://localhost:12002/beta/vegnett/rute?geometri=LINESTRING%20Z(270203.15%207041918.45%209.11,%20270203.12%207041921.1%209.03,%20270202.94%207041928.89%208.85,%20270202.66%207041928.89%208.86,%20270202.44%207041933.08%208.92,%20270202.25%207041935.64%208.93,%20270200.05%207041935.65%208.87,%20270200.05%207041935.8%208.86,%20270199.01%207041935.78%208.86,%20270198.99%207041934.8%208.77,%20270199.16%207041934.81%208.78,%20270199.19%207041934.7%208.75,%20270199.11%207041932.03%209.49,%20270198.99%207041930.45%208.9,%20270198.74%207041927.6%208.9,%20270198.06%207041923.11%208.95,%20270197.77%207041919.43%208.96,%20270197.78%207041918.45%208.99,%20270198%207041907.98%209.07,%20270198.19%207041899.17%209.09,%20270198.36%207041891.49%209.18,%20270198.9%207041866.11%209.51,%20270198.94%207041864.52%209.53,%20270199.12%207041857.34%209.64,%20270199.18%207041854.59%209.68,%20270199.27%207041851%2010.48,%20270199.31%207041850.23%2010.49,%20270199.41%207041849.44%2010.51,%20270199.55%207041848.68%2010.49,%20270199.98%207041847.36%2010.51,%20270200.4%207041846.4%2010.54,%20270200.64%207041845.98%2010.54,%20270201.12%207041845.19%2010.54,%20270201.97%207041844.02%2010.55,%20270202.49%207041843.43%2010.57,%20270203.15%207041842.75%2010.57,%20270204.44%207041841.7%2010.57,%20270205.79%207041840.88%2010.58,%20270206.53%207041840.52%2010.57,%20270208.16%207041839.97%2010.53,%20270209.05%207041839.76%2010.53,%20270213.19%207041839.19%2010.54,%20270213.46%207041839.15%209.77,%20270218.3%207041843.78%209.74,%20270215.37%207041844.25%209.74,%20270215.4%207041844.64%209.77,%20270214.77%207041844.75%209.76,%20270215.12%207041848.74%209.82,%20270214.22%207041851.31%209.85,%20270213.63%207041851.39%2010.6,%20270205.68%207041852.3%2010.53,%20270205.4%207041852.44%2010.57,%20270205.14%207041852.67%2010.55,%20270204.91%207041852.92%2010.58,%20270204.69%207041853.33%2010.57,%20270204.64%207041853.47%2010.42,%20270204.22%207041854.08%209.84,%20270204.21%207041855.44%2010.5,%20270204.16%207041857.09%209.8,%20270203.69%207041857.07%209.65,%20270203.68%207041858.67%209.64,%20270204.31%207041858.68%209.65,%20270204.32%207041858.79%209.76,%20270204.38%207041858.78%209.78,%20270204.38%207041859.94%209.88,%20270204.44%207041859.93%209.88,%20270204.43%207041860.7%209.88,%20270204.37%207041860.7%209.88,%20270204.25%207041866.91%209.88,%20270204.16%207041870.76%209.64,%20270203.94%207041881.99%209.57,%20270203.56%207041881.99%209.36,%20270203.51%207041883.67%209.36,%20270203.9%207041883.67%209.36,%20270203.72%207041891.79%209.38,%20270203.45%207041903.53%209.25,%20270203.41%207041905.85%209.19,%20270203.17%207041917.19%209.17,%20270203.15%207041918.45%209.16)&maks_avstand=100&vegsystemreferanse=FV6690&pretty=true&kortform=true]

Â 

Â 

Â 

Â ",NVDB-6937,Les-API,
Release: nvdb-vegnett-og-objektdata-app,,NVDB-6827,Rapportgenerator,
Release: nvdb-veglister-app,,NVDB-6825,Rapportgenerator,
NPE ved restedfesting etter geometriutskiftning,"h2. Observasjon

Endingssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/48e81808-daac-4188-9106-070d73558f8a havner i SYSTEMFEIL:

{code:java}
java.lang.NullPointerException
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableFeature.lambda$removeLocationalsOutOfRange$1(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:810)
	at java.util.ArrayList.removeIf(ArrayList.java:1413)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableFeature.removeLocationalsOutOfRange(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:808)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.lambda$getFeatureVersionsToRelocalize$2(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:241)
	at java.util.ArrayList.forEach(ArrayList.java:1257)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.getFeatureVersionsToRelocalize(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:235)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.doFilter(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:153)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:114)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:92)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:128)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:386)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:163)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
	at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1390)
	at org.apache.activemq.ActiveMQMessageConsumer.iterate(ActiveMQMessageConsumer.java:1552)
	at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:191)
	at org.apache.activemq.ActiveMQSessionExecutor.wakeup(ActiveMQSessionExecutor.java:111)
	at org.apache.activemq.ActiveMQMessageConsumer.start(ActiveMQMessageConsumer.java:1527)
	at org.apache.activemq.ActiveMQMessageConsumer$7.run(ActiveMQMessageConsumer.java:1308)
	at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)
	at java.util.TimerThread.mainLoop(Timer.java:555)
	at java.util.TimerThread.run(Timer.java:505)
{code}

h2. Analyse

NullPointerException kastes ved beregning av avstand mellom vegobjektgeometri og vegnettgeometri fordi vegobjektet av type Vegdekke (241) med id 724114244v3 fullstendig mangler geometriegenskap(er) i NVDB. Dette er dog ikke en datafeil, siden datakatalogen ikke krever at geometriegenskaper er populert. Versjon 3 berÃ¸res egentlig ikke av endret vegnettsgeometri, men versjon 1 gjÃ¸r det og versjon 3 oppdateres til ny versjon 4 med redusert stedfesting fordi den treffes av lukket vegnett. Derfor er denne versjonen en kandidat for restedfesting. En smule komplisert, for Ã¥ si det mildt... Dersom v3 ikke hadde blitt truffet av lukket vegnett, ville vi ikke fÃ¥tt NPE fordi det ikke lastes vegobjektversjoner fra NVDB som mangler geometri. 

h2. LÃ¸sning

Stopper forsÃ¸k pÃ¥ restedfesting av vegobjekter som mangler geometriegenskaper i AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.getAffectedFeatureVersions og registerer en notabene om funnet.",NVDB-6937,Skriv-API,
"NullPointerException i AbstractRoadReportDefinition (Publisering, TÃ¸mmer, TrÃ¸ndelag)","NullPointerException i AbstractRoadReportDefinition (Publisering, TÃ¸mmer, TrÃ¸ndelag).

Oppdaget i versjon 1.0.7

KjÃ¸rte ok fire minutter etterpÃ¥ (ingen kodeendringer, og sannsynligvis ingen endinger i NVDB i mellomtiden)...

Â 

Logg:

2020-03-18 23:20:45,034 ERROR [no.veg.nvd.RapportResource] (ForkJoinPool.commonPool-worker-10) Handling exception for job 29faa6f6-2461-4ab0-bd6d-69577f6bee98: java.util.concurrent.CompletionException: java.lang.NullPointerException
 at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
 at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606)
 at java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1596)
 at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
 at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)
 at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)
 at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157)
 Caused by: java.lang.NullPointerException
 at no.svv.veirapporter.engine.reports.roadreport.AbstractRoadReportDefinition.lambda$getDefaultValueProviders$1(AbstractRoadReportDefinition.java:87)
 at no.svv.veirapporter.engine.models.defaultvalueproviders.ConditionalDefaultValueProvider.getValue(ConditionalDefaultValueProvider.java:26)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.lambda$addDefaultValues$14(SegmentPopulator.java:89)
 at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
 at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
 at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
 at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
 at java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290)
 at java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:731)
 at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
 at java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:401)
 at java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:734)
 at java.util.stream.ForEachOps$ForEachOp.evaluateParallel(ForEachOps.java:159)
 at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateParallel(ForEachOps.java:173)
 at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233)
 at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:485)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.addDefaultValues(SegmentPopulator.java:89)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.lambda$populateSegments$7(SegmentPopulator.java:54)
 at java.util.stream.ReferencePipeline$11$1.accept(ReferencePipeline.java:439)
 at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
 at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
 at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
 at java.util.stream.ReduceOps$ReduceTask.doLeaf(ReduceOps.java:747)
 at java.util.stream.ReduceOps$ReduceTask.doLeaf(ReduceOps.java:721)
 at java.util.stream.AbstractTask.compute(AbstractTask.java:327)
 at java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:731)
 at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
 at java.util.concurrent.ForkJoinPool$WorkQueue.pollAndExecCC(ForkJoinPool.java:1190)
 at java.util.concurrent.ForkJoinPool.helpComplete(ForkJoinPool.java:1879)
 at java.util.concurrent.ForkJoinPool.awaitJoin(ForkJoinPool.java:2045)
 at java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:404)
 at java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:734)
 at java.util.stream.ReduceOps$ReduceOp.evaluateParallel(ReduceOps.java:714)
 at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233)
 at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.populateSegments(SegmentPopulator.java:59)
 at no.svv.veirapporter.engine.ReportGenerator.getReport(ReportGenerator.java:116)
 at no.svv.veirapporter.engine.ReportGenerator.createReport(ReportGenerator.java:81)
 at no.vegvesen.nvdbrapportapi.RapportService.getVegliste(RapportService.java:105)
 at no.vegvesen.nvdbrapportapi.RapportService_ClientProxy.getVegliste(RapportService_ClientProxy.zig:38)
 at no.vegvesen.nvdbrapportapi.RapportResource.lambda$getVeglister$0(RapportResource.java:117)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604)

KjÃ¸rer pÃ¥ nytt uten NPE, men har da en warning:
 2020-03-18 23:24:42,707 WARN [no.veg.nvd.map.VeglisteMapper] (ForkJoinPool.commonPool-worker-1) 0 lengde pÃ¥ veg i Rapport Veglister for: TÃ¸mmertransport, uoffisiell (901), fylke=TrÃ¸ndelag ([50]), kommune=, vegsystemreferanse=[FV, KV], Tabell TrÃ¸ndelag, StjÃ¸rdal kommune, SekundÃ¦re- og Ã¸vrige fylkesveger, Kolonne: Veglengde (km), Linje FV6810 Kvithammer x E6 - Alstad x fv. 6814",,Rapportgenerator,
stedfesting2: marker valg av start og stopp for ankerpunktene,"h2. Observasjon

Stedfesting 1 markerer tydelig trykk pÃ¥ Start og Stopp med en grÃ¸nn farge. Dette gjÃ¸r ikke Stedfesting 2. Om det er grÃ¸nn som er riktig er en annen ting, men litt mer tydelig at du faktisk har trykket pÃ¥ og satt Start og Stopp.

Bruk gjrene vedlagte SOSI som mÃ¥ ha manuelle ankerpunkter for Ã¥ bli stedfestet.",NVDB-6937,Datafangst,
stedfesting2: gi beskjed om Ã¥ bruke manuelle ankerpunkter,"h2. Observasjon

PrÃ¸ver Ã¥ stedfeste et objekt med vanlig markering. Kallet _/rest/vegobjekt/<id>/localize2_ gir tilbake beskjed om _Store vegobjekter med samme start og stopp mÃ¥ stedfestes med manuelle ankerpunkter_. Stedfesting 2 bÃ¸r gi denne beskjeden tilbake til brukeren. Stedfesting 1 gjÃ¸r dette.

Bruk vedlagte SOSI for Ã¥ fremprovosere dette.",NVDB-6937,Datafangst,
Feil pÃ¥ innsending med endret prosjektreferanse,"h2. Observasjon

NÃ¥r man fjerner prosjektreferanse som egenskapsverdi for et eksisterende objekt og samtidig registrer med Ã¥ bruke kontraktensÂ prosjektreferanse, sÃ¥ feiler innsending. API Skriv gir HTTP 400 med en beskrivende feilmelding tilbake. Datafangst gir bare beskjed om _Systemfeil ved operasjon: Registrere vegobjekter i NVDB_.

Gjenskap ved Ã¥:
 * Last opp vedlagte SOSI pÃ¥ en kontrakt _uten_ prosjektref i Innstillingene
 * Stedfest og sett prosjektreferanse i datafanen
 * Registrer -> UTFÃ˜RT
 * Slett egenskapsverdienÂ prosjektreferanse i datafanen
 * Sett en annenÂ prosjektreferanse i kontraktens innstillinger
 * Registrer *med* Ã¥ huke av for Ã¥ bruke kontraktensÂ prosjektreferanse

Datafangst vil sende
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><endringssett xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><delvisOppdater><vegobjekter><vegobjekt typeId=""95"" nvdbId=""1006280785"" versjon=""1"" overskriv=""JA""><egenskaper><egenskap typeId=""11078"" operasjon=""slett""/><egenskap typeId=""11078"" operasjon=""oppdater""><verdi>Ny_Ref_Id</verdi></egenskap></egenskaper><validering><lestFraNvdb>2020-03-18T14:25:28</lestFraNvdb><reduserPunkttetthet>JA</reduserPunkttetthet></validering></vegobjekt></vegobjekter></delvisOppdater><ansvarlig>exttxm</ansvarlig><datakatalogversjon>2.20</datakatalogversjon></endringssett>
{noformat}
Skriv svarer med HTTP 400 og
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1""><message>delvisOppdater.vegobjekter[0].egenskaper: MÃ¥ vÃ¦re unik: typeId</message></fault>
{noformat}
Denne er relatert til sakene:
 * NVDB-5321
 * NVDB-5322 (notis om Eksportfanen i beskrivelsen)",NVDB-6937,Datafangst,
Datafane: HÃ¥ndtere HTTP 400 fra Skriv,"h2. Observasjon

Se sak NVDB-5321. Der hÃ¥ndteres ikke HTTP 400 ved filopplasting. Denne er relevant.

NÃ¥r fÃ¸rst noe feil er kommet inn i Datafangst vil en endring pÃ¥ objekt som har feil gjÃ¸re at API Skriv gi HTTP 400 tilbake. Datafangst kaster da bare en rÃ¸d feilmeldingsboks tilbake.

Gjenskap med Ã¥ laste inn vedlagte SOSI, for deretter Ã¥ prÃ¸ve Ã¥ endre en verdi i datafanen.

Regner med at lÃ¸sning pÃ¥ NVDB-5321 vil hjelpe i denne saken ogsÃ¥, men i stedet for Ã¥ kaste en feil ""Systemfeil ved operasjon: Oppdater vegobjekter"" sÃ¥ burde man fanget opp HTTP 400 responsen fra Skriv som sier hva som er galt. 

Tror det forÃ¸vrig er ofte at nÃ¥r det kommer HTTP 400 fra Skriv - *med* en beskrivelse av hva som er feil - sÃ¥ kastes feilen _Failed to invoke NVDB API Skriv, while validating changeset_ i Datafangst-alarm kanalen.

Stacktrace: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.7-2020.03.18/doc/?id=4-_B7XAB9KCz2i26wu4e]

HTTP 400 respons fra Skriv: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.7-2020.03.18/doc/?id=6u_B7XAB9KCz2i26wu4e]

*Tillegg*

Jeg har ikke laget egen sak, men vi bÃ¸r ogsÃ¥ hÃ¥ndtere slike feil i Eksportfanen nÃ¥r Datafangst sender inn noe som Skriv avviser med HTTP 400 og beskrivende feilmelding.Â 

h2. Analyse
Feilmeldingene fra Skriv er ikke godt egnet for Ã¥ kunne parses og presenteres til bruker. Tore anbefaler at vi validerer i vÃ¥r kode fÃ¸r vi sender inn, dette blir hÃ¥ndtert i NVDB-5357.

Det som mÃ¥ gjÃ¸res her er Ã¥ hindre at det blir en systemfeil (fordi vi prÃ¸ver Ã¥ parse en feilrespons i et vanlig feilobjekt), og sÃ¸rge for en god logging av feil mot Skriv.

NÃ¥r NVDB-5357 og NVDB-5356 er lÃ¸st burde gjenvÃ¦rende 400-feil bety at det er gjort en feil av utvikler, og sÃ¥nn sett er det viktig Ã¥ fange opp dem pÃ¥ en god mÃ¥te.

h2. LÃ¸sning
400 fra Skriv fanges og logges, og rapporteres som systemfeil til bruker. PÃ¥ grunn av endringer fra NVDB-5356 med validering sÃ¥ vil vegobjekter med verdier som er utenfor Skrivs XML-schema ikke bli sendt til Skriv for validering, sÃ¥ det finnes ingen kjent mÃ¥te Ã¥ fÃ¥ en HTTP 400 fra Skriv nÃ¥.",NVDB-6937,Datafangst,
Filopplasting: HÃ¥ndtere HTTP 400 fra Skriv,"h2. Observasjon

En bruker har lastet opp en SOSI-fil som API Skriv avviser tidlig i valideringslÃ¸ypa s.a. Skriv sender HTTP 400 tilbake i stedet for vanlige HTTP 200 med AVVIST om det er noe Datafangst mÃ¥ ta hensyn til. NÃ¥r Datafangst mottar HTTP 400 fra API Skriv, sÃ¥ kastes en Exception, men brukeren ser ikke at noe er galt.

NÃ¥r sÃ¥ brukeren vil editere pÃ¥ denne typen med feil, sÃ¥ vil fortsatt Skriv respondere med HTTP 400 - og da kaster Datafangst en feil ""Systemfeil ved operasjon: Oppdatere vegobjekt"" i datafanen.

Vedlagt ligger SOSI med feil mÃ¥lemetode som Skriv reagerer pÃ¥.

Se request til Skriv : [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.7-2020.03.18/doc/?id=UO-47XAB9KCz2i26usjd]

Se respons fra Skriv: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.7-2020.03.18/doc/?id=Tu-47XAB9KCz2i26usjd]

Se stacktrace i DF: [https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.7-2020.03.18/doc/?id=VO-47XAB9KCz2i26usjd]

og

[https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-test-beats-6.8.7-2020.03.18/doc/?id=z]â€“47XAB9KCz2i26vsjI

Datafangst bÃ¸r hÃ¥ndtere HTTP 400 fra Skriv ved validering pÃ¥ opplastet fil pÃ¥ en bedre mÃ¥te. Skriv sier bare i fra hva som er feil, og dette bÃ¸r Datafangst hÃ¸re pÃ¥.
h2. Analyse

Feilmeldingene fra Skriv er ikke godt egnet for Ã¥ kunne parses og presenteres til bruker. Tore anbefaler at vi validerer i vÃ¥r kode fÃ¸r vi sender inn, dette blir hÃ¥ndtert i NVDB-5356.

Det som mÃ¥ gjÃ¸res her er Ã¥ hindre at det blir en systemfeil (fordi vi prÃ¸ver Ã¥ parse en feilrespons i et vanlig feilobjekt), og sÃ¸rge for en god logging av feil mot Skriv.

NÃ¥r NVDB-5356 er lÃ¸st burde gjenvÃ¦rende 400-feil bety at det er gjort en feil av utvikler, og sÃ¥nn sett er det viktig Ã¥ fange opp dem pÃ¥ en god mÃ¥te.
h2. LÃ¸sning

NÃ¥r skriv sender tilbake en 400 som fÃ¸lge av at datasettet ikke har gyldig datastruktur, sÃ¥ forkastes hele datasettet. Ugyldig datastruktur kan ikke fikses i datafangst.

NÃ¥r dette skjer genererer vi en valideringsfeil med grad FATAL, som fÃ¸rer til at datasettet forkastes, og tilbakemelding til brukeren gis i status-fanen for opplastingen.",NVDB-6937,Datafangst,
"Innsending til NVDB er alltid med ""overskriv""","[~tormos] oppdaga at etter NVDB-5222 sÃ¥ gÃ¥r alle innsedinger til NVDB som ""overskriv eksisterende versjoner"", uavhengig om det er denne knappen eller vanlig innsending som brukes.",NVDB-6937,Datafangst,
Leveranseinformasjon,"*Test i AT:*
 * NVDB-5316: Eksport av SOSI skal gi ut NN2000. Se flere detaljer i testbeskrivelse i saken.
 * NVDB-5320: Innsending til NVDB skal ikke bruke ""overskriv"" ved vanlig innsending.
 * NVDB-5292: Regresjonstest av kart og dets oppfÃ¸rsel rundt om.
 * NVDB-5071: Regresjonstest av ny stedfestingsfane. Inkluderer sakene NVDB-5062, NVDB-5064, NVDB-5065, NVDB-5311. Hva disse dekker stÃ¥r i de respektive sakene.",NVDB-6937,Datafangst,
PROD: HÃ¥ndtere feil med 504 Gateway Timeout,"Logg fra *PROD* (2020-03-18):

2020-03-18 10:09:37,585 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-10) Veglister request 905,[18],[],[FV, KV],2020-03-18,nb_NO,true...
 2020-03-18 10:09:37,586 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-10) Added job ad6b6422-26aa-41e8-af42-df46decb96a0 with TTL PT30M
 2020-03-18 10:09:37,586 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-10) Purge expired jobs...
 2020-03-18 10:09:37,587 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-10) Veglister returns response status 202
 2020-03-18 10:09:37,587 INFO [no.svv.vei.eng.ReportGenerator] (Thread-39) Starting download of data from NVDB
 2020-03-18 10:09:37,671 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Login successful
 2020-03-18 10:09:39,502 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 915, 1 out of 8
 2020-03-18 10:10:39,374 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Fetched 7174 objects of type 915
 2020-03-18 10:10:39,375 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 916, 2 out of 8
 2020-03-18 10:11:57,918 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Fetched 11105 objects of type 916
 2020-03-18 10:11:57,918 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 917, 3 out of 8
 2020-03-18 10:12:12,957 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Fetched 29 objects of type 917
 2020-03-18 10:12:12,958 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 918, 4 out of 8
 2020-03-18 10:12:25,199 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Fetched 29 objects of type 918
 2020-03-18 10:12:25,200 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 919, 5 out of 8
 2020-03-18 10:12:31,232 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Fetched 21 objects of type 919
 2020-03-18 10:12:31,233 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 920, 6 out of 8
 2020-03-18 10:12:41,835 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Fetched 21 objects of type 920
 2020-03-18 10:12:41,835 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 577, 7 out of 8
 2020-03-18 10:12:44,272 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Fetched 3 objects of type 577
 2020-03-18 10:12:44,273 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-39) Preparing to fetch data for 905, 8 out of 8
 2020-03-18 10:13:46,956 WARN [no.veg.nvd.cli.exc.JsonExceptionParser] (pool-333-thread-1) Could not parse '<html><body><h1>504 Gateway Time-out</h1>
 The server didn't respond in time.
 </body></html>
 ' as json.
 2020-03-18 10:13:46,963 ERROR [no.veg.nvd.RapportResource] (Thread-39) Handling exception for job ad6b6422-26aa-41e8-af42-df46decb96a0: java.util.concurrent.CompletionException: HTTP error 504:
 at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
 at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606)
 at java.lang.Thread.run(Thread.java:748)
 Caused by: HTTP error 504:
 at no.vegvesen.nvdbapi.client.clients.util.JerseyHelper.parseError(JerseyHelper.java:61)
 at no.vegvesen.nvdbapi.client.clients.AsyncResult.doPage(AsyncResult.java:75)
 at no.vegvesen.nvdbapi.client.clients.AsyncResult.lambda$null$0(AsyncResult.java:54)
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
 ... 1 more
 2020-03-18 10:13:47,638 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-15) NOT Removing job ad6b6422-26aa-41e8-af42-df46decb96a0 (temporarily disabled - job will be purged after configured TTL PT30M)
 2020-03-18 10:21:52,389 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-6) Veglister request 905,[18],[],[FV, KV],2020-03-18,nb_NO,true...
 2020-03-18 10:21:52,390 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-6) Added job bff79890-1ef1-45f3-87cc-b47c353b5ffb with TTL PT30M
 2020-03-18 10:21:52,390 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-6) Purge expired jobs...
 2020-03-18 10:21:52,390 WARN [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-6) Purge removed 1 expired jobs: 410075e0-114a-42c8-8811-7b12c5a99ca1 (SUCCESS). Timetolive is configured to 30 Minutes - consider increasing it
 2020-03-18 10:21:52,390 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-6) Veglister returns response status 202
 2020-03-18 10:21:52,391 INFO [no.svv.vei.eng.ReportGenerator] (Thread-40) Starting download of data from NVDB
 2020-03-18 10:21:52,511 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-40) Login successful
 2020-03-18 10:21:53,011 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-40) Preparing to fetch data for 915, 1 out of 8
 2020-03-18 10:22:27,431 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-6) Veglister request 903,[15],[],[FV, KV],2020-03-18,nb_NO,true...
 2020-03-18 10:22:27,432 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-6) Added job bd21d4ef-f0f4-426c-a5c4-ecc6bf195267 with TTL PT30M
 2020-03-18 10:22:27,432 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-6) Purge expired jobs...
 2020-03-18 10:22:27,432 WARN [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-6) Purge removed 1 expired jobs: 76976b43-d14a-4195-9405-3d915e3addfa (SUCCESS). Timetolive is configured to 30 Minutes - consider increasing it
 2020-03-18 10:22:27,432 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-6) Veglister returns response status 202
 2020-03-18 10:22:27,432 INFO [no.svv.vei.eng.ReportGenerator] (Thread-41) Starting download of data from NVDB
 2020-03-18 10:22:27,519 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-41) Login successful

Â ",NVDB-6825,Rapportgenerator,
Ruteberegning: Api skriv trenger mÃ¥lt/godkjent lengde (ikke geometri lengde),"Â 

Ruteberegning: Api skriv trenger mÃ¥lt/godkjent lengde (ikke geometri lengde)

I dag regnes lengden pÃ¥ klippede segmenter pÃ¥ geomtrien. Ikke pÃ¥ mÃ¥lt lengde.

Â 
h2. TODO
 * Sjekk hva nvdbind / reader lagrer av lengde pÃ¥ veglenkene. Er det geometriens lengde eller er det lengden pÃ¥ lenkene. Det mest naturlige var at det er mÃ¥lt lengde som lagres. (Geometriens lengde er bare Ã¥ regne ut av geometrien).
 * Endre RoadNetSegment.updateRelativePositionGeometryAndRoadRefÂ  til Ã¥ regne med lenkens lengde og ikke bruke geometrien.Â 

Â 

Â 

*LÃ¸sning:*Â 

NVDB-5431 endret slik at segmenter bruker mÃ¥lt lengde og ikke lengde fra geometri. Har endret klipping av segmenter (updateRelativePositionGeometryAndRoadRef) til Ã¥ bruke lengde pÃ¥ segmenter og ikke lengde pÃ¥ geometri.

Â 

Â ",NVDB-6937,Les-API,
Eksport av SOSI gis ut pÃ¥ NN54,"h2. Observasjon

Vegobjekter fra bÃ¥de SOSI med satt NN54 og SOSI med satt NN2000 blir eksportert i Eksportfanen med NN54. Dette mÃ¥ rettes raskt.

Se kontraktÂ [https://datafangst.kantega.no/#!/contract/40e2ba3a-8665-4a36-8cde-51d7cdff9e3d/export]

hvor skiltplatene er lastet inn med SOSI og NN2000, mens skiltpunktene er lastet inn med SOSI og NN54.",NVDB-6937,Datafangst,
Justeringer i vegnettsfilter.,"Fra mail:

Â 

Hei!
 Â 
 Her er det gjort mange forbedringerÂ 
 Etter Ã¥ ha testet den nye funksjonaliteten har jeg et par forslag til endringer:
 Â 
 *Grupperingene i utvalget*

NÃ¥r alle valgene fjernes fra en gruppering bÃ¸r vegnettet bli borte. For eksempel hvis man slÃ¥r av alt vegnett for Â«KjÃ¸rendeÂ» og alt vegnett for Â«GÃ¥ende og syklendeÂ» samtidig. Dette gjeller ogsÃ¥ for grupperingen Â«Adskilte lÃ¸pÂ» og grupperingen Â«DetaljnivÃ¥Â».
 Det er ulogisk at alt slÃ¥tt av gir samme resultat som at alt slÃ¥tt pÃ¥ i en gruppering.
 Â 
 Det kan med fordel gjÃ¸res tydeligere hvilke avkryssinger som hÃ¸rer til samme gruppering. For eksempel med bokser eller streker:

!image001.jpg|thumbnail! Â 

*Tri-state-toggles*

Jeg mener det er mest logisk at fÃ¸rste trykk i tri-state-toggles gÃ¥r til Â«utenÂ». Alt vegnett blir i utgangspunktet tegnet opp og brukeren kan da etterfÃ¸lgende velge hvilke deler av vegnettet som ikke skal vises. NÃ¥r brukeren holder pÃ¥ Ã¥ velge bort vegnett er det ulogisk at fÃ¸rste trykk pÃ¥ tri-state-toggles gÃ¥r til Â«medÂ»

Jeg tror ogsÃ¥ at der er flere som Ã¸nsker Ã¥ skrue av enn Ã¥ skru pÃ¥ visningen av armer, kryssystem, sideanlegg og konnektering.

*DetaljnivÃ¥*
 I vegnettsmodellen har vi tre detaljnivÃ¥er. Vegtrase-, kjÃ¸rebane- og kjÃ¸refeltnivÃ¥, der vegtrasenivÃ¥ og kjÃ¸rebanenivÃ¥ er komplett for hele landet. Det mest logiske er at avkryssingsboksen: Â«vegtrase og kjÃ¸rebaneÂ» fjernes slik at det gjenspeiler de tre detaljnivÃ¥ene i vegnettsmodellen.
 Â 
 Vegtrase skal da vise lenkene av typen Â«VegtraseÂ» og Â«Vegtrase og kjÃ¸rebaneÂ» som her:

!image011.jpg|thumbnail!
 Â 
 KjÃ¸rebane skal vise lenkene av typen Â«KjÃ¸rebaneÂ» og Â«Vegtrase og kjÃ¸rebaneÂ» som her:

!image012.jpg|thumbnail!
 Â 
 KjÃ¸refelt skal vise lenkene av typen Â«KjÃ¸refeltÂ» som her:

!image013.jpg|thumbnail!
 Â 
 Egenskapene som vises nÃ¥r man trykker pÃ¥ en lenke er uoversiktlig og der er redundant informasjon. Egenskapene kan med fordel sorteres bedre og deles inn i kategorier.
 Â 
 Her er to eksempler pÃ¥ sortering og inndelinger i kategorier:

!image02.png|thumbnail!

Â 
 Vennlig hilsen
 Nikolaj Fyhn",NVDB-6937,Vegkart,
Systemfeil i RoadCategoryEnricherFilter,"h2. Observasjon

Endringssettet https://www.utv.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/e73dc2f1-7afa-4539-9594-ce4bcae5400f havner i SYSTEMFEIL:

{code:java}
java.lang.IllegalArgumentException: Upper extent can't be empty
	at no.vegvesen.vt.nvdb.commons.core.contract.Requires.require(Requires.java:47)
	at no.vegvesen.vt.nvdb.apiskriv.domain.ExtentProjection.<init>(ExtentProjection.java:30)
	at no.vegvesen.vt.nvdb.apiskriv.domain.ExtentProjection.of(ExtentProjection.java:23)
	at no.vegvesen.vt.nvdb.apiskriv.validation.netelement.RoadCategoryEnricherFilter.getMainRefLinkExtentProjection(RoadCategoryEnricherFilter.java:158)
	at no.vegvesen.vt.nvdb.apiskriv.validation.netelement.RoadCategoryEnricherFilter.getRoadCategoryForPart(RoadCategoryEnricherFilter.java:99)
	at no.vegvesen.vt.nvdb.apiskriv.validation.netelement.RoadCategoryEnricherFilter.lambda$getRoadCategoriesForPart$1(RoadCategoryEnricherFilter.java:79)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at no.vegvesen.vt.nvdb.apiskriv.validation.netelement.RoadCategoryEnricherFilter.getRoadCategoriesForPart(RoadCategoryEnricherFilter.java:81)
	at no.vegvesen.vt.nvdb.apiskriv.validation.netelement.RoadCategoryEnricherFilter.lambda$doFilter$0(RoadCategoryEnricherFilter.java:65)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at no.vegvesen.vt.nvdb.apiskriv.validation.netelement.RoadCategoryEnricherFilter.doFilter(RoadCategoryEnricherFilter.java:67)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.JobNetElementFilters.doFilter(JobNetElementFilters.java:30)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:114)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:92)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:128)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:386)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:163)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

Problemet oppstÃ¥r i et filter som beriker veglenker med vegkategori-verdi basert pÃ¥ Vegsystem-objekter. Det kastes IllegalArgumentException fra ExtenProjection.of fordi fÃ¸rste parameter er en tom extent. Denne verdien stammer fra superstedfestingen til detaljert veglenke 1 hos veglenkesekvens 706044 i uxpdbnvdb1. Superstedfestingen er [0, 0), som er fullstendig meningslÃ¸st. Dette er en datafeil i NVDB.
 
Transaksjonsloggen antyder at et script er ""synderen"":

{noformat}
TX_TIME    TASK_TYPE_ID OBJECT_TYPE   OBJECT_TYPE_ID  OBJECT_ID OBJECT_VERSION TX_TYPE       TASKUSER_NAME                  TASK_NAME                                         
---------- ------------ ------------- -------------- ---------- -------------- ------------- ------------------------------ --------------------------------------------------
05.06.2006          500 NETELEMENT             50002     706044                FV_UPDATED(1) Tore Dyvik                                                                       
20.06.2008        11467 NETELEMENT             50002     706044                FV_UPDATED(1) Henning SÃ¸rlie                 0403_gs                                           
17.01.2013        44268 NETELEMENT             50002     706044                FV_UPDATED(1) Arne Sonf                      4                                                 
24.02.2014        54146 NETELEMENT             50002     706044                FV_UPDATED(1) Hans Anton Ã…lien               Skript: addMunicipality                           
24.02.2014        54146 NETELEMENT             50002     706044                FV_UPDATED(1) Hans Anton Ã…lien               Skript: addMunicipality                           
24.02.2014        54146 NETELEMENT             50002     706044                FV_UPDATED(1) Hans Anton Ã…lien               Skript: addMunicipality                           
24.02.2014        54146 NETELEMENT             50002     706044                FV_UPDATED(1) Hans Anton Ã…lien               Skript: addMunicipality                           
24.02.2014        54146 NETELEMENT             50002     706044                FV_UPDATED(1) Hans Anton Ã…lien               Skript: addMunicipality                           
14.09.2018        90706 NETELEMENT             50002     706044                FV_UPDATED(1) Hans JÃ¸rgen Ekker              Skript: generateNodesBetweenRefLinkParts          
09.09.2019        99320 NETELEMENT             50002     706044                FV_UPDATED(1) Hans JÃ¸rgen Ekker              Skript: fixRefLinkHoles                           
14.02.2020       101565 NETELEMENT             50002     706044                FV_UPDATED(1) Hans Anton Ã…lien               Skript: fixDetailedInconsistencies                
14.02.2020       101565 NETELEMENT             50002     706044                FV_UPDATED(1)                                Skript: fixDetailedInconsistencies                
{noformat}

Datafeilen finnes ikke i PROD.

h2. LÃ¸sning

Kontrollerer om superstedfesting er tom i RoadCategoryEnricherFilter.getMainRefLinkExtentProjection.
",NVDB-6937,Skriv-API,
Beregne sideposisjon for relevante vegobjekttyper,"h2. Bakgrunn

NÃ¥r stedfestingstjenesten beregner stedfesting for en sideposisjonrelevant vegobjekttype, skal sideposisjon beregnes og angis i responsen.

h2. Analyse

SidePositionCalculator ble implementert i forbindelse med restedfesting ved geometriendring pÃ¥ vegnett. Grunnalgoritmen er derfor allerede pÃ¥ plass.

Estimat: 2 dv.",NVDB-6937,Skriv-API,
stedfesting2: vis avhaking-symbol pÃ¥ aktive pÃ¥litelighets-filter,"Knappene som toggler pÃ¥litelighetfilter bÃ¸r ha hake-symboler som forteller at de er aktive

Vi mÃ¥ ogsÃ¥ ha et filter for leverte vegobjekter.

det er antakelig hensiktsmessig Ã¥ liste ut filtrene vertikalt istedet for horisontalt nÃ¥r vi fÃ¥r 4 filtre, og forklarende tekst kan ogsÃ¥ utvides til Ã¥ bli mer hjelpsom

Filteret for Ã¥ vise leverte objekter bÃ¸r default vÃ¦re av

Â ",NVDB-6937,Datafangst,
stedfesting 2: smÃ¥ endringer,"Et par observasjoner som mÃ¥ fikses:
 * fÃ¥r ikke til Ã¥ logge inn via locational2-URL
 ** la inn sjekk for innlogging
 * vis veglenke-info pÃ¥ single stedfesting-info (evt se neste punkt)
 ** la inf reflink info i listne
 * vis mer info om stedfestinger, prÃ¸v grense pÃ¥ 5
 ** lister ut opp til 5 vegobjekter ekspandert
 * se om vi kan zoome lengre inn / bytt kartlag til norkart som default og se om vi fÃ¥r reaksjoner
 ** byttet til norkart",NVDB-6937,Datafangst,
Verifiser at /featuretypesummary er borte,"h2. Observasjon

/featuretypesummary benyttes ikke lengre. Dobbeltsjekk at denne er borte og ikke trengs pÃ¥ noe sted.",NVDB-6937,Datafangst,
Gi gruppeadmin tilgang til overskriv i eksport v2,"I dag har kun globale admin tilgang til ""Overskriv i NVDB"" pÃ¥ Eksport v2. Denne funksjonen bÃ¸r ogsÃ¥ vÃ¦re tilgjengelig for gruppeadmin, se NVDB-5222 for eksport v1.

Eksport v2 ble utsatt bÃ¥de fordi status pÃ¥ arbeidet er litt usikker, og fordi den ikke har kontraktsgruppe eller annen kontraktinformasjon enn ID i state, sÃ¥ hvis global state for React blir implementert fÃ¸r vi gjÃ¸r denne blir det mindre endringer og mindre datalasting.",NVDB-6937,Datafangst,
Ingen popup for import pÃ¥ kurve,"h2. Observasjon
Viser eksisterende vegobjekter av en type som er kurve. FÃ¥r ikke popup nÃ¥r jeg klikker pÃ¥ objekt, selv om musepeker er endret til peker. Ingen feilmelding i console eller nettverksrequester.

Punktobjekter virker fortsatt fint. En sjanse for at dette ble innfÃ¸rt med NVDB-5073.",NVDB-6937,Datafangst,
Scrolling skal kun zoome i heltallsintervaller,"Ved Ã¥ bruke scroll for Ã¥ navigere i zoomnivÃ¥er i kartet kan man fÃ¥ nivÃ¥er som er mellom resolusjonen for bakgrunnskartet. Oppgaven bestÃ¥r i Ã¥ sette zoomnivÃ¥er til Ã¥ kun hoppe mellom heltall, da disse representerer de ulike tile-settene vi bruker.",NVDB-6937,Vegkart,
Overgang til Atlas for API Les,"31.mars gÃ¥r API Les over til Ã¥ bruke Atlas i alle sine miljÃ¸er. ForelÃ¸pig vil forespÃ¸rsler mot autopro-miljÃ¸ene i ATM og Prod bli rutet til Atlas (30x), mens de i UTV og STM vil saneres.

Nye URL-er mot API Les (merk at */nvdb/api/v3* ikke benyttes pÃ¥ Atlas):

Prod: [https://nvdbapiles-v3.atlas.vegvesen.no/status]

ATM:Â [https://nvdbapiles-v3.test.atlas.vegvesen.no/status]

STM: [https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/status|https://nvdbapiles-v3-stm.utv.atlas.vegvesen.no/]

UTV: [https://nvdbapiles-v3.utv.atlas.vegvesen.no/status]

Eksplisitt satt pÃ¥ eksemplet mot */status* for Ã¥ markere forksjellen fra tidligere */nvdb/api/v3/status*.",NVDB-6937,Datafangst,
Ta i bruk API Skriv sin stedfestingsfunksjon,"API Skriv utvikler en stedfestingsfunksjon som videre benytter API Les sitt /rute endepunkt. Denne har bedre tilgang til riktige data enn det nÃ¥ er i Datafangst, og kan ogsÃ¥ brukes av andre klienter.

Stedfesting i Skriv skal pÃ¥ sikt erstatte stedfestingsalgoritmen i Datafangst, men i fÃ¸rste omgang er stedfesting med Skriv tilgjengelig bak en feature toggle.",NVDB-6937,Datafangst,
Ikke konsekvent resultat fra /veg,"h2. Observasjon

Gjentatte relastinger mot [https://www.utv.vegvesen.no/nvdb/api/v3/veg?vegsystemreferanse=RV150%20S2D1%20m5193%20KD8%20m47]Â gir ulike veglenkeposisjoner:

_0.33696112@625480_ og _0.34779243@625480_

Ser det samme medÂ [https://nvdbapiles-v3.utv.atlas.vegvesen.no/veg?vegsystemreferanse=EV39%20S78D1%20m3284]",NVDB-6937,Les-API,
Backup av GitHub-repos til intern Bitbucket,"SVV har krav om at koderepoene vi har i GitHub skal sikkerhetskopieres over til intern Bitbucket ([https://git.vegvesen.no/projects/NVDBDATA]). Fra fÃ¸r av har vi bare Atlas-config i Bitbucket.

Aktuelle GiHub-repos (pr. 2020-03-12) er:
 * [https://github.com/nvdb-vegdata/nvdb-rapport-api]
 * [https://github.com/nvdb-vegdata/nvdb-veglister-app]
 * [https://github.com/nvdb-vegdata/nvdb-vegnett-og-objektdata-app]

Frist fÃ¸r sommeren? [~exta61]?",NVDB-6825,Rapportgenerator,
Ã…pne objekter med lukka segmenter,"Ã…pne objekter uten noen Ã¥pne segmenter gjÃ¸r at det blir avvik mellom objektspÃ¸rring og statistikkspÃ¸rring.

Â 

Sjekk ut hvorfor noen objekter er Ã¥pne uten Ã¥ ha noen Ã¥pne segmenter.

Â Oppdaget ved testing av NVDB-4651

Â 

*Analyse*

I [https://nvdbapiles-v3.utv.atlas.vegvesen.no/]Â er det 32 objekter av typen 95 for kommuneÂ 4227 som har Ã¥pne objekter uten segmenter. Dette tilsvarer avviket mellom statistikkspÃ¸rring og antall ved objektspÃ¸rring.

Noen stikkprÃ¸ver:

86181964 har stedfestingÂ 0.99481476@121754. Veglenka som er der er lukket, veglenkenummer 82 pÃ¥ 121754.

86253045 har stedfestingÂ 0.33013237@121470. Veglenka som er der er lukket, veglenkenummer 5 pÃ¥ 121470.

86316545 har stedfestingÂ 0.06603622@121755. Veglenka som er der er lukket, veglenkenummer 4 pÃ¥Â 121755.

Feilen ser ut til Ã¥ skyldes datafeil. Vegobjekter har ikke fÃ¥tt satt sluttdato nÃ¥r vegnettet objektet er stedfestet pÃ¥ er lukket.",NVDB-6937,Les-API,
Opplasting av binÃ¦robjekter,"Sak
 En bruker har meldt inn Ã¸nske om Ã¥ kunne laste opp binÃ¦rfiler som brukes som type vedlegg pÃ¥ enkelte objekttyper. F.ex typen Dokumentasjon har en egenskap vedlegg som tar inn et binÃ¦robjekt. API Skriv stÃ¸tter opplasting av binÃ¦robjekter, for deretter Ã¥ bruke den returnerte referansen i den aktuelle egenskapen.
 SeÂ [https://apiskriv.vegdata.no/binaer.html]
 Â 
 Originalt fra bruker (Raymond Hermansen,Â [raymond.hermansen@vtfk.no|mailto:raymond.hermansen@vtfk.no])
{noformat}
Jeg tenker i fÃ¸rste omgang at entreprenÃ¸r har mulighet til Ã¥ kunne laste opp filer i kontrakten sÃ¥nn at vi har tilgang til de i Datafangst helt generelt, at jeg i det minste kan lagre pÃ¥ PC og ta de videre igjen. Hovedpoenget er at entreprenÃ¸r har kun et sted Ã¥ levere fra seg dokumentasjon tilhÃ¸rende NVDB, og ikke flere steder de mÃ¥ laste opp filer for samme jobben og til det samme formÃ¥l. Det samme gjelder da for oss som skal legge inn, dumt Ã¥ mÃ¥tte gÃ¥ flere steder for Ã¥ skrive til NVDB for samme jobben. SÃ¥ det aller beste hadde selvsagt vÃ¦rt Ã¥ kunne lagre de inn til NVDB ogsÃ¥ via Datafangst. Fremvisning/det Ã¥ Ã¥pne og lese filene som allerede er lagret i NVDB, i Datafangst, er strengt tatt ikke helt nÃ¸dvendig, det mÃ¥ vi kunne gjÃ¸re i en innloggingslÃ¸sning i Vegkart istedenfor. Skal vi kun se pÃ¥ filene som er levert inn sÃ¥ gÃ¥r det veldig raskt Ã¥ laste de ned fÃ¸r de Ã¥pnes vil jeg tro.{noformat}
Â Mitt svar
{noformat}
Du tenker nÃ¥ pÃ¥ Ã¥ kunne laste opp bilder som skal registreres som en egenskap pÃ¥ enkelte objekter? AltsÃ¥ at du har en objekttype som har en egenskap av typen binÃ¦r-data (f.ex et png-bilde), og Ã¸nsker Ã¥ registrere dette objektet med bildet som egenskap? 
Som API Skriv dokumenterer her: https://apiskriv.vegdata.no/binaer.html 
For du tenker ikke Ã¥ kunne lagre bilder/dokumenter knyttet til kontrakten som kun skal lastes opp, ligge som type â€œvedleggâ€ i kontrakten, og lastes ned fra Datafangst ved behov?
{noformat}
Â Svar fra bruker
{noformat}
Tror jeg forstÃ¥r hva du spÃ¸r om, det er ikke tenkt at det skal ligge masse dokumenter som tilhÃ¸rer et prosjekt nei, kun en og annen fil som er naturlig Ã¥ linke opp mot et NVDB objekt og typisk mest via Driftskontrakter. Der det for stÃ¸rre prosjekter er mange filer som med fordel kan kobles til NVDB objekter sÃ¥ lagres det et sted pÃ¥ prosjektserveren uansett og fÃ¥s tak i der, sÃ¥ det blir en helt annen greie. Ellers sÃ¥ stemmer det du skriver om egenskap til et objekt nÃ¥r det skal lagres inn til NVDB, det kan her tenkes minst to fremtidige lÃ¸p egentlig. Det du beskriver, legge pÃ¥ en fil inn under objektet Dokumentasjon som en egenskap og at Dokumentasjon da ligger pÃ¥ som en datter til et annet objekt, her snakker vi da om Ã¥ vÃ¦re datter til Skred og fila kan vÃ¦re en word-/PDF-fil med flere bilder i, eller kun en bildefil. Det kan ogsÃ¥ tenkes at filene som leveres inn via Datafangst lastes over i en annen lagringslÃ¸sning etterhvert for de forskjellige etatene og at det der ifra opprettes en link til fila, ogsÃ¥ det som en egenskap pÃ¥ et objekt. Det siste her kan jo kanskje lÃ¸ses pÃ¥ andre vis senere, lagres rett pÃ¥ aktuell server og at det opprettes link samtidig f.eks. Uansett ved begge disse lÃ¸pene sÃ¥ kan det jo tenkes at Datafangst automatisk sletter disse vedleggsfilene nÃ¥r vi arkiverer kontraktene, om det skulle vÃ¦re at dere tenke pÃ¥ lagringskapasitet via Datafangst, men det blir jo ikke vanvittige mengder av filer her sÃ¥nn jeg tenker da.
{noformat}
Â ",NVDB-6937,Datafangst,
Oppgradere GeoTools,Vi bruker en flere Ã¥r gammel versjon av GeoTools. Oppgradering krever noe kodeendring pga. endrede pakkenavn.,NVDB-6937,Datafangst,
Rulle tilbake Â«nested pathÂ»,Bruken av NestPathField som ble introdusert i NVDB-4342 har negtive konsekvenser for ytelsen. ,NVDB-6937,NVDB-IND,
Leveranseinformasjon,"*Test i AT:*
 * NVDB-5246: Verifiser visning i kart ihht sakens testbeskrivelse
 * NVDB-5073: Test importmodul i datafanen
 * NVDB-5248: UtfÃ¸r pÃ¥fÃ¸lgende lukkinger og sjekk at fÃ¸rste ikke blir med pÃ¥ andre
 * NVDB-4842: Importer objekt og manipuler datter-relasjonen samtidig som man observerer riktig tilstand i databasen
 * NVDB-5279: Verifiser at vedlagte featurecollections lar seg importere

NVDB-4848 trenger ikke Ã¥ testes.",NVDB-6937,Datafangst,
Innlesing av omrÃ¥degrenser med API Skriv,"h2. Bakgrunn

Fra 2006 til i dag har vi brukt innlesingsprogrammet VDBImporter til Ã¥ oppdatere omrÃ¥degrenser i NVDB (Fylkesgrenser og Kommunegrenser). Disse mottar vi fra Kartverket pÃ¥ SOSI-format. Det kan vÃ¦re bÃ¥de grensejusteringer og sammenslÃ¥inger som krever oppdatering av grensene i NVDB.

Det er flere svakheter ved dette, bl.a. lang tidsbruk pÃ¥ innlesing og ingen stÃ¸tte for enklaver eller kommuner som er sammenslÃ¥tt, men som ikke grenser til hverandre (eks. Kinn kommune).

Fra Hans Anton:Â Dette programmet er sÃ¥ vidt jeg vet ikke rÃ¸rt siden ca. 2006, da NVDB ble etablert.Â Siden klassisk NVDB skal fases ut, er det uansett naturlig og pÃ¥ hÃ¸y tid at dette nÃ¥ kan hÃ¥ndteres i Skriv.Â Om det mÃ¥ lages en ny funksjon, eller om f.eks. Datafangst eller NVDB Vegnett kan formidle dette som en enkel Korriger-operasjon pÃ¥ Kommune- og Fylke-objekter, gjenstÃ¥r Ã¥ se.

Eksempler pÃ¥ enklaver og eksklaver i Norge:Â https://no.wikipedia.org/wiki/Enklave_og_eksklave

Legger ogsÃ¥ ved kartutsnitt over Kinn kommune (rÃ¸dt).

Vi ber altsÃ¥ om at Skriv ser pÃ¥ muligheten for Ã¥ hÃ¥ndtere disse omrÃ¥degrensene framover.

h2. Analyse

Om dette handler om Ã¥ tillate korrigering av geometrien til Fylke- og Kommune-objekter, er dette enkel sak Ã¥ implementere. Fylke- og Kommune-objekter er i dag blokkert for oppdatering gjennom API Skriv, sÃ¥ de mÃ¥ avblokkeres, men bare for geometriutskiftning.

Her trenger vi flere detaljer, gjerne dokumentasjon pÃ¥ VDB Importer.

Estimat: 1 dv (gitt forutsetningen over).",NVDB-6938,Skriv-API,
"NVDBREF-547 : Forskjell pÃ¥ Edge og Chrome, i visning av objektdetaljer","Hei!
 Har fÃ¥tt ny Edge, uten at jeg har tenkt noe over om det er forskjell fra den gamle. Men en liten observasjon jeg gjorde nÃ¥:
 Henter inn den samme linken i Edge og i Chrome:
 [https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/hva:(~(farge:'0_0,id:919),(farge:'1_1,id:920))/hvor:(vegsystemreferanse:(~'E6))/@286398,6689825,15/vegobjekt:1004496343:40a744:919]

Â 

Â 

I Edge kommer det opp informasjon om Assosierte Sideanleggsdel, merket i gult. Dette kommer ikke opp i Chrome. Tilsvarende skjer om jeg ser pÃ¥ skiltpunkt som ogsÃ¥ har assosierte objekter. Litt rart, eller?

Mvh Linda",NVDB-6937,Vegkart,
"NullPointerException ved Publisering: Normal uoff, TrÃ¸ndelag","Fra loggen (UTV):

2020-03-11 08:15:10,437 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-7) Veglister request 905,[50],[],[FV, KV],2020-03-11,nb_NO,true...
 2020-03-11 08:15:10,438 INFO [no.veg.nvd.val.VeglisteValidator] (vert.x-worker-thread-7) 2020-03-11 -> Wed Mar 11 00:00:00 CET 2020
 2020-03-11 08:15:10,438 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-7) Added job 73380886-60e9-494d-98ba-253246d65833 with TTL PT30M
 2020-03-11 08:15:10,438 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-7) Purge expired jobs...
 2020-03-11 08:15:10,439 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-7) Veglister returns response status 202
 2020-03-11 08:15:10,439 INFO [no.svv.vei.eng.ReportGenerator] (Thread-12) Starting download of data from NVDB
 2020-03-11 08:15:10,578 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Login successful
 2020-03-11 08:15:11,940 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 915, 1 out of 8
 2020-03-11 08:15:31,527 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 9022 objects of type 915
 2020-03-11 08:15:31,527 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 916, 2 out of 8
 2020-03-11 08:15:38,779 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 14436 objects of type 916
 2020-03-11 08:15:38,779 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 917, 3 out of 8
 2020-03-11 08:15:39,233 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 186 objects of type 917
 2020-03-11 08:15:39,233 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 918, 4 out of 8
 2020-03-11 08:15:39,363 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 192 objects of type 918
 2020-03-11 08:15:39,363 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 919, 5 out of 8
 2020-03-11 08:15:39,439 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 43 objects of type 919
 2020-03-11 08:15:39,439 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 920, 6 out of 8
 2020-03-11 08:15:39,522 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 46 objects of type 920
 2020-03-11 08:15:39,523 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 577, 7 out of 8
 2020-03-11 08:15:41,995 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 24 objects of type 577
 2020-03-11 08:15:41,996 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Preparing to fetch data for 905, 8 out of 8
 2020-03-11 08:15:51,882 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Fetched 9598 objects of type 905
 2020-03-11 08:15:51,882 INFO [no.svv.vei.eng.ReportGenerator] (Thread-12) 33547 features found
 2020-03-11 08:15:51,908 INFO [no.svv.vei.eng.ReportGenerator] (Thread-12) Starting download of roadnet from NVDB
 2020-03-11 08:16:09,216 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) Downloaded 63793 segments on main network. Fetching any missing segmentlinks.
 2020-03-11 08:16:15,360 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-12) 0 additional Segmentlinks found.
 2020-03-11 08:16:15,360 INFO [no.svv.vei.eng.ReportGenerator] (Thread-12) 63793 segments found
 2020-03-11 08:16:15,360 INFO [no.svv.vei.eng.ReportGenerator] (Thread-12) Creating segments
 2020-03-11 08:17:43,942 INFO [no.svv.vei.eng.ReportGenerator] (Thread-12) 65111 additional segments created
 2020-03-11 08:17:43,943 INFO [no.svv.vei.eng.seg.SegmentPopulator] (Thread-12) Starting populating 128904 segments using 33547 roadObjects
 2020-03-11 08:18:21,375 INFO [no.svv.vei.eng.seg.SegmentPopulator] (Thread-12) Basic properties added, adding details and filtering.
 2020-03-11 08:18:22,081 ERROR [no.veg.nvd.RapportResource] (Thread-12) Handling exception for job 73380886-60e9-494d-98ba-253246d65833: java.util.concurrent.CompletionException: java.lang.NullPointerException
 at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
 at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606)
 at java.lang.Thread.run(Thread.java:748)
 Caused by: java.lang.NullPointerException
 at no.svv.veirapporter.engine.models.derivedvalueproviders.WinterUseClassProvider.deriveValue(WinterUseClassProvider.java:23)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.assignDerivedValue(SegmentPopulator.java:100)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.lambda$addDerivedValues$16(SegmentPopulator.java:96)
 at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
 at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
 at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
 at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
 at java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290)
 at java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:731)
 at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
 at java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:401)
 at java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:734)
 at java.util.stream.ForEachOps$ForEachOp.evaluateParallel(ForEachOps.java:159)
 at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateParallel(ForEachOps.java:173)
 at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233)
 at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:485)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.addDerivedValues(SegmentPopulator.java:96)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.lambda$populateSegments$8(SegmentPopulator.java:56)
 at java.util.stream.ReferencePipeline$11$1.accept(ReferencePipeline.java:439)
 at java.util.stream.ReferencePipeline$11$1.accept(ReferencePipeline.java:440)
 at java.util.stream.ReferencePipeline$11$1.accept(ReferencePipeline.java:440)
 at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
 at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
 at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
 at java.util.stream.ReduceOps$ReduceTask.doLeaf(ReduceOps.java:747)
 at java.util.stream.ReduceOps$ReduceTask.doLeaf(ReduceOps.java:721)
 at java.util.stream.AbstractTask.compute(AbstractTask.java:327)
 at java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:731)
 at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
 at java.util.concurrent.ForkJoinPool.helpComplete(ForkJoinPool.java:1870)
 at java.util.concurrent.ForkJoinPool.externalHelpComplete(ForkJoinPool.java:2467)
 at java.util.concurrent.ForkJoinTask.externalAwaitDone(ForkJoinTask.java:324)
 at java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:405)
 at java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:734)
 at java.util.stream.ReduceOps$ReduceOp.evaluateParallel(ReduceOps.java:714)
 at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233)
 at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)
 at no.svv.veirapporter.engine.segmentation.SegmentPopulator.populateSegments(SegmentPopulator.java:59)
 at no.svv.veirapporter.engine.ReportGenerator.getReport(ReportGenerator.java:117)
 at no.svv.veirapporter.engine.ReportGenerator.createReport(ReportGenerator.java:81)
 at no.vegvesen.nvdbrapportapi.RapportService.getVegliste(RapportService.java:105)
 at no.vegvesen.nvdbrapportapi.RapportService_ClientProxy.getVegliste(RapportService_ClientProxy.zig:38)
 at no.vegvesen.nvdbrapportapi.RapportResource.lambda$getVeglister$0(RapportResource.java:117)
 at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604)
 ... 1 more",,Rapportgenerator,
Geometrifeil ved import av objekter i e-API,"h2. Observasjon

Import av NVDB-objekt gir feil. Kan det ha en sammenheng med at API Les i ATM nÃ¥ gir 5973 som srid?
{noformat}
{ ""type"": ""FeatureCollection"", ""features"": [{ ""type"": ""Feature"", ""properties"": { ""comment"": ""1"", ""dataCatalogVersion"": ""2.14"", ""nvdbVersion"": 3, ""typeId"": 95, ""tag"": ""85467073"", ""attributes"": {}, ""operation"": ""CORRECT"", ""nvdbId"": 85467073 } }] }
{noformat}
feiler med:
{noformat}
https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-utv-beats-6.8.6-2020.03.10/doc/?id=khyXxHABir-TAgFFck9-{noformat}
respons fra API Les:
{noformat}
https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-utv-beats-6.8.6-2020.03.10/doc/?id=ohyXxHABir-TAgFFck9_
{noformat}
*Observasjon # 2*

Samme resultat ved import av et rekkverk:
{noformat}
{ ""type"": ""FeatureCollection"", ""features"": [{ ""type"": ""Feature"", ""properties"": { ""comment"": ""1"", ""dataCatalogVersion"": ""2.14"", ""nvdbVersion"": 4, ""typeId"": 5, ""tag"": ""78772629"", ""attributes"": {}, ""operation"": ""CORRECT"", ""nvdbId"": 78772629 } }] }
{noformat}
Kibana:Â 
{noformat}
https://vegdata.kantega.no/kibana/app/kibana#/doc/datafangst-logs-*/datafangst-logs-utv-beats-6.8.6-2020.03.10/doc/?id=4RyyxHABir-TAgFFueh5
{noformat}

h2. Analyse
Det feiler ved konvertering av koordinater fordi vi ikke fÃ¥r ut noen verdi for ""axis order"" for UTM33 + NN2000. Det finnes en definisjon av denne i JTS, men den virker ikke likt som de vi har lagt inn selv. Muligens fordi dette er en compound definisjon.

h2. LÃ¸sning
Legger inn en fil for SRID 5973 i plugins/geodetics/src/main/resources/crs-definitions tilsvarende den vi har for UTM 33 + NN54. PÃ¥ sikt burde vi sett pÃ¥ om vi fÃ¥r hentet axis order ut fra definisjoner bundlet med JTS.",NVDB-6937,Datafangst,
Lengde under lokasjon blir 0,"h2. Observasjon

EksempelvisÂ [https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/105?antall=7500&egenskap=(area(946,3430))&vegsystemreferanse=FV30&segmentering=true&inkluder=alle]Â (ogsÃ¥ for segmentering=false) blir lengde 0 under lokasjon.

Observerer det samme ved Ã¥ gÃ¥ direkte pÃ¥ et av objektene:Â [https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/105/88320495/1]",NVDB-6937,Les-API,
Finner ingen objekter ved Ã¥ oppgi strekningsmeter eksakt,"h2. Observasjon

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/918/1004493429/1]

gir strekningsmeter 1293.181 og kortform _FV6660 S2D1 m1293 KD1 m0-85_

Oppslag pÃ¥

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/918?antall=16&vegsystemreferanse=FV6660S2D1M1293&inkluder=lokasjon&inkludergeometri=ingen]

gir ingen treff, mens det blir treff ved Ã¥ bruke intervall

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/918?antall=16&vegsystemreferanse=FV6660S2D1M1293-1294&inkluder=lokasjon&inkludergeometri=ingen]

FÃ¥r imidlertid treff ved Ã¥ legge til kryssystemet:

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/918?antall=16&vegsystemreferanse=FV6660S2D1M1293KS1002&inkluder=lokasjon&inkludergeometri=ingen]",NVDB-6937,Les-API,
IrregulÃ¦r geometri blir innsendt til Skriv,"h2. Observasjon

Innlasting av vedlagt SOSI gjÃ¸r at Datafangst reagerer i filfanen og sier at SOSI inneholder en feil av type ""irregulÃ¦r geometri"". Objektet blir likevel importert og kan registreres. Men da vil API Skriv avvise registreringen med ""irregulÃ¦r geometri"".

Datafangst burde ikke tatt inn dette objektet - evt flagget det pÃ¥ datafanen eller i eksportfanen i tillegg til filfanen. Skriv gir i hvertfall beskjed om irregulÃ¦r geometri gjennom /validator-kallet ved opplasting (se svaret under)

Det er flere eksempler pÃ¥ slike kontrakter. En av disse er Trafikklomme iÂ [https://datafangst.kantega.no/#!/contract/487e4c20-cf49-4a39-a5a8-a304bc1ef713/files]

Endringssett:Â [https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/0d553deb-4db0-4c71-9aa2-4dc1679f45cf]

Svar som fÃ¥s fra Skriv
{noformat}
<status xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><mottatt>2020-03-20T10:01:52.039</mottatt><fremdrift>AVVIST</fremdrift><fremdriftOppdatert>2020-03-20T10:01:52.039</fremdriftOppdatert><avvistÃ¥rsak>VALIDERINGSFEIL</avvistÃ¥rsak><etterbehandling><tilgjengeligILes>false</tilgjengeligILes></etterbehandling><resultat><feil/><advarsler/><notabener/><vegobjekter><vegobjekt tempId=""724aa0eb-c501-43fa-9086-cc8cb23f7e78""><feil><feil kode=""IRREGULÃ†R_GEOMETRI""><melding>Geometrien har irregulÃ¦r form: Geometrien krysser seg selv</melding><referanse>https://datakatalogen.vegdata.no/47</referanse><egenskapTypeId>5900</egenskapTypeId><geometrideler srid=""5973""><wkt>POINT (265598.0655644346 7103056.74404415)</wkt></geometrideler></feil></feil><advarsler/><notabener/></vegobjekt></vegobjekter><veglenkesekvenser/><noder/></resultat><eier>tjedatafangst_nvdbapiskriv</eier><klient>Datafangst</klient><apiversjon>3</apiversjon><transaksjon/></status>
{noformat}",NVDB-6937,Datafangst,
Gi valideringsfeil pÃ¥ hÃ¸ydekoordinater utenfor Skriv sine grenser,"h2. Observasjon

Datafangst tar ikke hensyn til valideringsfeil fra Skriv. Dersom det ligger (typisk) feilregistreringer i geometrien for objekter som er utenfor min og max grensene til API Skriv vil disse registreringene bli avvist - bÃ¥de i validering ved filopplasting og ved innsending. Her er valideringsrespons fra Skriv
{noformat}
<status xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><mottatt>2020-03-20T11:06:53.01</mottatt><fremdrift>AVVIST</fremdrift><fremdriftOppdatert>2020-03-20T11:06:53.01</fremdriftOppdatert><avvistÃ¥rsak>VALIDERINGSFEIL</avvistÃ¥rsak><etterbehandling><tilgjengeligILes>false</tilgjengeligILes></etterbehandling><resultat><feil/><advarsler/><notabener/><vegobjekter><vegobjekt tempId=""a16c6dd5-fe50-436e-8783-c552f264d37a""><feil><feil kode=""HÃ˜YDE_UTENFOR_GYLDIGHETSOMRÃ…DE""><melding>Vegobjektet har geometri med hÃ¸yde-koordinat(er) utenfor gyldig verdiomrÃ¥de -500.0 m - 3000.0 m</melding><referanse>https://datakatalogen.vegdata.no/13</referanse><egenskapTypeId>4721</egenskapTypeId></feil></feil><advarsler><advarsel kode=""MANGLER_BETINGET_PÃ…KREVDE_EGENSKAPER""><melding>Objektet, av typen Port/DÃ¸r (13), mangler egenskaper med viktighet 'betinget': [BranndÃ¸r (3509)]</melding><referanse>https://datakatalogen.vegdata.no/13</referanse></advarsel></advarsler><notabener/></vegobjekt></vegobjekter><veglenkesekvenser/><noder/></resultat><eier>tjedatafangst_nvdbapiskriv</eier><klient>Datafangst</klient><apiversjon>3</apiversjon><transaksjon/></status>
{noformat}
Grensene til API Skriv er min -500 og max 3000 for hÃ¸ydekoordinatene.

Det er flere eksempler pÃ¥ at endringssett er avvist i Skriv, og bruker har ikke noen mulighet til Ã¥ endre pÃ¥ dette - bortsett fra a manuelt endre objektene fÃ¸r registrering i Datafangst (men da mister brukeren det som er gjort av endringer i Datafangst).

Eksempel endringssett:Â [https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/54111973-67c4-4fb2-bbf4-b81ba5e5629d]

(hvor et av punktene har koordinatÂ 229212.0771766245 6952109.619714831 4999.897259613275).

Et annet eksempel er fra kontraktÂ 8f14f6b6-0412-4b7f-8f73-eed4938674de hvor problemobjekt er vedlagt i SOSI for Ã¥ gjenskape problemet.",NVDB-6937,Datafangst,
Value is not an Enum,"Log fra PROD:

2020-03-09 13:19:53,201 INFO  [no.veg.nvd.RapportResource] (vert.x-worker-thread-13) Veglister request 889,[],[5028],[],2020-03-09,nb_NO,false...
2020-03-09 13:19:53,201 INFO  [no.veg.nvd.RapportResource] (vert.x-worker-thread-13) Setting vegsystemreferanse '[]' to null
2020-03-09 13:19:53,201 INFO  [no.veg.nvd.val.VeglisteValidator] (vert.x-worker-thread-13) 2020-03-09 -> Mon Mar 09 00:00:00 CET 2020
2020-03-09 13:19:53,201 INFO  [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-13) Added job bf58eff0-60a4-4738-a5d6-147bb47c85c3 with TTL PT30M
2020-03-09 13:19:53,201 INFO  [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-13) Purge expired jobs...
2020-03-09 13:19:53,202 WARN  [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-13) Purge removed 4 expired jobs: a7762340-3f7b-4540-9c34-9dfa6fe7bf5b (SUCCESS), 71ba7145-eb95-4cfd-b314-3b3d5b951e5c (SUCCESS), 9b5d9f09-a62f-4b80-a471-797e3df076c6 (SUCCESS), 3753a32a-2d09-4d43-94eb-92e4f18c0b9b (SUCCESS). Timetolive is configured to 30 Minutes - consider increasing it
2020-03-09 13:19:53,202 INFO  [no.veg.nvd.RapportResource] (vert.x-worker-thread-13) Veglister returns response status 202
2020-03-09 13:19:53,203 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) Starting download of data from NVDB
2020-03-09 13:19:54,330 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 915, 1 out of 8
2020-03-09 13:20:10,426 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 207 objects of type 915
2020-03-09 13:20:10,426 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 916, 2 out of 8
2020-03-09 13:20:19,743 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 331 objects of type 916
2020-03-09 13:20:19,744 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 917, 3 out of 8
2020-03-09 13:20:19,805 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 14 objects of type 917
2020-03-09 13:20:19,805 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 918, 4 out of 8
2020-03-09 13:20:19,947 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 26 objects of type 918
2020-03-09 13:20:19,947 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 919, 5 out of 8
2020-03-09 13:20:20,000 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 0 objects of type 919
2020-03-09 13:20:20,002 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 920, 6 out of 8
2020-03-09 13:20:20,022 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 0 objects of type 920
2020-03-09 13:20:20,022 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 577, 7 out of 8
2020-03-09 13:20:20,854 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 5 objects of type 577
2020-03-09 13:20:20,855 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Preparing to fetch data for 889, 8 out of 8
2020-03-09 13:20:21,582 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Fetched 8 objects of type 889
2020-03-09 13:20:21,582 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) 591 features found
2020-03-09 13:20:21,582 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) Starting download of roadnet from NVDB
2020-03-09 13:20:24,680 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) Downloaded 1896 segments on main network. Fetching any missing segmentlinks.
2020-03-09 13:20:24,683 INFO  [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-31) 0 additional Segmentlinks found.
2020-03-09 13:20:24,683 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) 1896 segments found
2020-03-09 13:20:24,683 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) Creating segments
2020-03-09 13:20:24,823 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) 1913 additional segments created
2020-03-09 13:20:24,824 INFO  [no.svv.vei.eng.seg.SegmentPopulator] (Thread-31) Starting populating 3809 segments using 591 roadObjects
2020-03-09 13:20:24,841 INFO  [no.svv.vei.eng.seg.SegmentPopulator] (Thread-31) Basic properties added, adding details and filtering.
2020-03-09 13:20:24,872 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) Segments populated and filtered. 266 segments remain
2020-03-09 13:20:24,872 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) Starting to merge segments
2020-03-09 13:20:24,873 INFO  [no.svv.vei.eng.seg.Merger] (Thread-31) Starting to merge 266 segments
2020-03-09 13:20:24,876 INFO  [no.svv.vei.eng.seg.Merger] (Thread-31) Done merging 266 segments into 4 segments
2020-03-09 13:20:24,876 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) Merging segments complete
2020-03-09 13:20:24,877 INFO  [no.svv.vei.eng.ReportGenerator] (Thread-31) Sorting and segmenting report
2020-03-09 13:20:24,877 ERROR [no.veg.nvd.RapportResource] (Thread-31) Handling exception for job bf58eff0-60a4-4738-a5d6-147bb47c85c3: java.util.concurrent.CompletionException: java.lang.IllegalArgumentException: Value is not an enum
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.IllegalArgumentException: Value is not an enum
	at no.svv.veirapporter.engine.models.SegmentValue.enumValue(SegmentValue.java:78)
	at no.svv.veirapporter.engine.reports.roadreport.ModuleTruckRoadReport.enrichReportLine(ModuleTruckRoadReport.java:47)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290)
	at java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:731)
	at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
	at java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:401)
	at java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:734)
	at java.util.stream.ForEachOps$ForEachOp.evaluateParallel(ForEachOps.java:159)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateParallel(ForEachOps.java:173)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:485)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:650)
	at no.svv.veirapporter.engine.reports.roadreport.AbstractRoadReportDefinition.finalizeReport(AbstractRoadReportDefinition.java:147)
	at no.svv.veirapporter.engine.ReportGenerator.calculateSegments(ReportGenerator.java:135)
	at no.svv.veirapporter.engine.ReportGenerator.getReport(ReportGenerator.java:120)
	at no.svv.veirapporter.engine.ReportGenerator.createReport(ReportGenerator.java:81)
	at no.vegvesen.nvdbrapportapi.RapportService.getVegliste(RapportService.java:105)
	at no.vegvesen.nvdbrapportapi.RapportService_ClientProxy.getVegliste(RapportService_ClientProxy.zig:38)
	at no.vegvesen.nvdbrapportapi.RapportResource.lambda$getVeglister$0(RapportResource.java:117)
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604)
	... 1 more
",,Rapportgenerator,
Multiple vegsystemreferanser og vegsegmenter som er helt like,"h2. Observasjon

Eksemplene under gir mange vegsystemreferanser tilbake som er helt like (kun med vegsystem).

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/174?antall=14&inkluder=lokasjon&inkludergeometri=ingen&kommune=301]

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/3?antall=14&inkluder=lokasjon&inkludergeometri=ingen&kommune=301]

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/7?antall=14&inkluder=lokasjon,vegsegmenter&inkludergeometri=ingen&kommune=301]

Hvis man hiver pÃ¥ _&inkluder=vegsegmenter_ sÃ¥ kommer det mange duplikate segmenter ogsÃ¥. F.ex

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/7?antall=14&inkluder=lokasjon,vegsegmenter&inkludergeometri=ingen&kommune=301]

Annet eksempel. Se forskjellen i vegsystemreferanser for objektetÂ 88320495 ved segmentering false vs true:

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/105?antall=7500&egenskap=(area(946,3430))&vegsystemreferanse=FV30&segmentering=false&inkluder=alle]

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/105?antall=7500&egenskap=(area(946,3430))&vegsystemreferanse=FV30&segmentering=true&inkluder=alle]",NVDB-6937,Les-API,
Release,"Release [nvdb-rapport-api|https://github.com/nvdb-vegdata/nvdb-rapport-api] slik at vi har god nok kontroll pÃ¥ hva som gÃ¥r i prod.

Front-end i egne saker.",NVDB-6825,Rapportgenerator,
"PROD: sÃ¸k pÃ¥ Normaltrafikk, Stad (4649) feilet med org.apache.http.ConnectionClosedException: Premature end of chunk coded message body: closing chunk expected","Kommune 4649 er Stad.

Bruker prÃ¸vde pÃ¥ nytt og det sÃ¥ ut til Ã¥ fungere da.

UndersÃ¸ke hva dette var...

Log:

{color:#c1c7d0}2020-03-09 10:41:08,541 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-15) Veglister request 904,[],[4649],[FV],2020-03-09,nb_NO,false...{color}
 {color:#c1c7d0} 2020-03-09 10:41:08,543 INFO [no.veg.nvd.val.VeglisteValidator] (vert.x-worker-thread-15) 2020-03-09 -> Mon Mar 09 00:00:00 CET 2020{color}
 {color:#c1c7d0} 2020-03-09 10:41:08,543 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-15) Added job 6dcb6dd2-bf73-4f29-ae5d-042c336dcfe5 with TTL PT30M{color}
 {color:#c1c7d0} 2020-03-09 10:41:08,543 INFO [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-15) Purge expired jobs...{color}
 {color:#c1c7d0} 2020-03-09 10:41:08,543 WARN [no.veg.nvd.job.ReportJobManager] (vert.x-worker-thread-15) Purge removed 2 expired jobs: 8403f7f7-1539-46f2-8b57-7291196ea7f1 (SUCCESS), 0f5411f6-797a-4910-8b4f-15a43280f86a (SUCCESS). Timetolive is configured to 30 Minutes - consider increasing it{color}
 {color:#c1c7d0} 2020-03-09 10:41:08,543 INFO [no.veg.nvd.RapportResource] (vert.x-worker-thread-15) Veglister returns response status 202{color}
 {color:#c1c7d0} 2020-03-09 10:41:08,544 INFO [no.svv.vei.eng.ReportGenerator] (Thread-25) Starting download of data from NVDB{color}
 {color:#c1c7d0} 2020-03-09 10:41:09,899 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 915, 1 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:24,279 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 44 objects of type 915{color}
 {color:#c1c7d0} 2020-03-09 10:41:24,279 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 916, 2 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:31,212 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 64 objects of type 916{color}
 {color:#c1c7d0} 2020-03-09 10:41:31,213 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 917, 3 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:36,058 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 0 objects of type 917{color}
 {color:#c1c7d0} 2020-03-09 10:41:36,059 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 918, 4 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:36,092 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 0 objects of type 918{color}
 {color:#c1c7d0} 2020-03-09 10:41:36,092 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 919, 5 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:37,083 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 1 objects of type 919{color}
 {color:#c1c7d0} 2020-03-09 10:41:37,083 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 920, 6 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:37,182 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 1 objects of type 920{color}
 {color:#c1c7d0} 2020-03-09 10:41:37,183 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 577, 7 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:37,908 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 24 objects of type 577{color}
 {color:#c1c7d0} 2020-03-09 10:41:37,909 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Preparing to fetch data for 904, 8 out of 8{color}
 {color:#c1c7d0} 2020-03-09 10:41:39,036 INFO [no.svv.vei.dat.rep.NvdbRoadObjectRepository] (Thread-25) Fetched 31 objects of type 904{color}
 {color:#c1c7d0} 2020-03-09 10:41:39,037 INFO [no.svv.vei.eng.ReportGenerator] (Thread-25) 165 features found{color}
 {color:#c1c7d0} 2020-03-09 10:41:39,037 INFO [no.svv.vei.eng.ReportGenerator] (Thread-25) Starting download of roadnet from NVDB{color}

{color:#c1c7d0}2020-03-09 10:42:47,851 ERROR [no.veg.nvd.RapportResource] (Thread-25) Handling exception for job 6dcb6dd2-bf73-4f29-ae5d-042c336dcfe5: java.util.concurrent.CompletionException: HTTP error 200 for request 20de6a6d-1d97-a018-0538-4f0c143315a2:{color}
 {color:#c1c7d0} at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273){color}
 {color:#c1c7d0} at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280){color}
 {color:#c1c7d0} at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606){color}
 {color:#c1c7d0} at java.lang.Thread.run(Thread.java:748){color}
 {color:#c1c7d0} Caused by: HTTP error 200 for request 20de6a6d-1d97-a018-0538-4f0c143315a2:{color}
 {color:#c1c7d0} at no.vegvesen.nvdbapi.client.clients.AsyncResult.doPage(AsyncResult.java:113){color}
 {color:#c1c7d0} at no.vegvesen.nvdbapi.client.clients.AsyncResult.lambda$null$0(AsyncResult.java:52){color}
 {color:#c1c7d0} at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149){color}
 {color:#c1c7d0} at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624){color}
 {color:#c1c7d0} ... 1 more{color}
 {color:#c1c7d0} Caused by: org.apache.http.ConnectionClosedException: Premature end of chunk coded message body: closing chunk expected{color}
 {color:#c1c7d0} at org.apache.http.impl.io.ChunkedInputStream.getChunkSize(ChunkedInputStream.java:263){color}
 {color:#c1c7d0} at org.apache.http.impl.io.ChunkedInputStream.nextChunk(ChunkedInputStream.java:222){color}
 {color:#c1c7d0} at org.apache.http.impl.io.ChunkedInputStream.read(ChunkedInputStream.java:183){color}
 {color:#c1c7d0} at org.apache.http.conn.EofSensorInputStream.read(EofSensorInputStream.java:135){color}
 {color:#c1c7d0} at java.io.BufferedInputStream.read1(BufferedInputStream.java:284){color}
 {color:#c1c7d0} at java.io.BufferedInputStream.read(BufferedInputStream.java:345){color}
 {color:#c1c7d0} at java.io.FilterInputStream.read(FilterInputStream.java:133){color}
 {color:#c1c7d0} at java.io.BufferedInputStream.read1(BufferedInputStream.java:284){color}
 {color:#c1c7d0} at java.io.BufferedInputStream.read(BufferedInputStream.java:345){color}
 {color:#c1c7d0} at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284){color}
 {color:#c1c7d0} at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326){color}
 {color:#c1c7d0} at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178){color}
 {color:#c1c7d0} at java.io.InputStreamReader.read(InputStreamReader.java:184){color}
 {color:#c1c7d0} at com.google.gson.stream.JsonReader.fillBuffer(JsonReader.java:1291){color}
 {color:#c1c7d0} at com.google.gson.stream.JsonReader.nextNonWhitespace(JsonReader.java:1329){color}
 {color:#c1c7d0} at com.google.gson.stream.JsonReader.doPeek(JsonReader.java:468){color}
 {color:#c1c7d0} at com.google.gson.stream.JsonReader.hasNext(JsonReader.java:415){color}
 {color:#c1c7d0} at no.vegvesen.nvdbapi.client.clients.AsyncResult.doPage(AsyncResult.java:87){color}
 {color:#c1c7d0} ... 4 more{color}

Â 

Â ",,Rapportgenerator,
NVDBREF-531: Kombinere oppdatering med korrigering (samme objekt),"h2. Bakgrunn

Fra SVV-Jira: 
Saken er opprettes som resultat av analyse i NVDBREF-491.
Bruker ville korrigere stedfesting til et objekt fÃ¸r dette skulle lukkes. (Grunnen var at det ikke var snappet korrekt til en port og dette ga feilmelding i NVDB Vegnett).

Det gitte caset er ikke mulig med dagens SKRIV api.
I Klassisk klient API hadde NVDB Vegnett kontroll pÃ¥ versjoner.
Dette er nÃ¥ litt vanskelig Ã¥ fÃ¥ til og SKRIV bÃ¸r endres som beskrevet under.
 
Fra Richard:
Et det mulig Ã¥ fÃ¥ alt dette til med en endringssett? * Korriger versjon 1 
Oppdater versjon 1 => Skriv oppretter versjon 2 pÃ¥ serveren
Lukk versjon 2 => vil Skriv finne versjon 2?
 
Svar fra Tore:
Per i dag mÃ¥ dette caset realiseres med to separat endringssett, fordi oppdatering ikke kan kombineres med korrigering. Dette er en begrensning som ble etablert i API Skriv sin barndom (2014), og jeg tror ikke det ville vÃ¦rt en stor jobb Ã¥ implementere stÃ¸tte for det i dag. Det mÃ¥ i sÃ¥ fall bestilles.

h2. Analyse

FÃ¸lgeoppdateringene i API Skriv genererer allerede korrigeringer av historiske versjoner samtidig som det oppdateres (lages ny versjon) pÃ¥ samme vegobjekt. Hoveddelen av maskineriet skulle derfor vÃ¦re pÃ¥ plass. Mulig det eneste som mÃ¥ gjÃ¸res er Ã¥ fjerne noen Bean Validation-annotasjoner.

Estimat: 4 dv.

h2. LÃ¸sning

* (/) Fjern bean validations som hindrer korrigering og oppdatering pÃ¥ samme vegobjekt.
* (/) Endre PartialFeatureEnricherJobFilter til Ã¥ ta utgangspunkt i korrigert siste versjon ved delvisOppdatering, dersom det finnes i endringssettet.
* (/) Endre PrepareForModifyEnricherFilter til Ã¥ ta utgangspunkt i korrigert siste versjon ved validering og generering av beriking, dersom det finnes i endringssettet.
",NVDB-6937,Skriv-API,
NVDBREF-502: Ikke forenkle (slÃ¥ sammen) stedfesting for Kryssdel i rundkjÃ¸ring,"h2. Bakgrunn

Fra SVV-Jira. NB! der der det bilder og eksempler som kan vÃ¦re nyttige. 
RundkjÃ¸ringer er  en lenkesekvens som biter seg selv i halen og har utstrekning 0-1.
NÃ¥r vi stedfester Kryssdel-objektet i NVDB Vegnett velger vi startpunktet for objektet der hvor kjÃ¸rebane fra tilstÃ¸tende veg treffer rundkjÃ¸ringen. I mange tilfeller er dette startpunktet i port 1 til rundkjÃ¸ringen, mens i andre tilfeller er det en helt annen port.
I de andre tilfellene stedfester vi en ""rute"" langs hele rundkjÃ¸ringen med definert start- og sluttpunkt. Siden startpunktet er ulik port 1 vil stedfestingen blir delt opp i to. Det kan for eksempel vÃ¦re 0.5-1 + 0-0.5.
(Se vedlagt bilde av rundkjÃ¸ring fÃ¸r og etter at ny kryssdel med ny stedfesting ble definert.)
I innsjekket vil imidlertid API Skriv slÃ¥ dette sammen til 0-1. Og da mister vi det definerte startpunktet til rundkjÃ¸ringen.
Dette vises som en notabenemelding: 
0: FORENKLET_STEDFESTING Stedfestingen ble forenklet fra 2 til 1 verdi
MarkÃ¸r navn: Kryssdel (-3)
Vi trenger et unntak for rundkjÃ¸ringer.
Eksempel: https://www.test.vegvesen.no/nvdb/apiskrivbeta/kontrollpanel/#/jobs/view/75041e83-fecd-4235-bfe2-21cc5fdac6f2

h2. Analyse

Forenkling av stedfesting skjer i OptimizeLocationalAttributeFilter. For Ã¥ avgjÃ¸re om forenkling skal skje mÃ¥ vi vite lenkesevensens typeVeg. Vegnettet leses imidlertid ikke inn i jobben fÃ¸r lenge senere i dagens pipeline (BeforeLockingPipeline).

I mange filtere sammenlignes gammel og ny verdi for egenskaper (korrigering og oppdatering) og disse kan forutsette at optimalisering/forenkling er gjennomfÃ¸rt. Dersom optimaliseringfilteret flyttes til etter NetworkEnricherFilter, mÃ¥ vi sikre at dette ikke skaper trÃ¸bbel ved sammenligning av stedfestinger.

Alternativet til Ã¥ flytte OptimizeLocationalAttributeFilter er Ã¥ hente inn typeVeg for berÃ¸rt vegnett rett fra NVDB. Dette er bare realistisk dersom antallet slik database-sÃ¸k er relativt lite. Her er det jo kun snakk om Kryssdel-objekter.

Estimat: 4 dv

h2. LÃ¸sning

Flyttet OptimizeLocationalAttributeFilter til etter NetworkEnricherFilter. La inn sjekk pÃ¥ om vegobjektet er av type Kryssdel og er stedfestet pÃ¥ veglenker med typeVeg rundkjÃ¸ring. I sÃ¥ fall returneres false fra shouldOptimize().",NVDB-6937,Skriv-API,
NVDBREF-401: Fjerne eksisterende noder og koblinger,"h2. Bakgrunn
 
Saken er overfÃ¸rt fra https://jira.kantega.no/browse/VEGREF-334

I dag bruker vi SQL-script for Ã¥ slette noder som er skaper trÃ¸bbel for en vegnettsbruker. Det kan vÃ¦re feilplasserte noder, noder som er koblet til flere porter pÃ¥ en lenkesekvens, noder som er koblet til ""historikk-grums"" fra VDB eller noder som kobler sammen lenker som egentlig skulle vÃ¦rt i to plan.
Ulempen med script-lÃ¸sning er at brukeren mÃ¥ begynne jobben pÃ¥ nytt om man kommer i en fastlÃ¥st node-situasjon.
Det er grunn til Ã¥ tro at nÃ¥r vegnettsbrukerne skal fÃ¥ inn all historikk fra NVDB i framtidige modeller sÃ¥ vil man kunne stÃ¸te pÃ¥ slik nodeproblematikk oftere.
Vi ser ingen opplagt grunn til at det ikke skal vÃ¦re mulig Ã¥ slette en node i NVDB Vegnett pÃ¥ samme mÃ¥te som med script.
For NVDB Vegnett sin del er dette en liten jobb (1-2 timer). Noden vil bli merket som slettet og alle knytninger mellom noden og lenkesekvensene blir fjernet. I mange tilfeller skal det registreres en ny node med riktige koblinger som erstatning.
Noder er heller ikke bÃ¦rere av data/objekter sÃ¥ ingen fÃ¸lgeoppdateringer er nÃ¸dvendige. Det kan imidlertid vÃ¦re svingerestriksjoner knyttet til noder, dette mÃ¥ hÃ¥ndteres.
Vi Ã¸nsker at Skriv gjÃ¸r en vurdering av denne saken.

h2. Analyse

Fjerning av noder innebÃ¦rer ""ingen"" fÃ¸lgeoppdateringer, siden det ikke stedfestes vegobjekter pÃ¥ noder (untatt Svingerestriksjon). At et nettelement er fjernet innebÃ¦rer en ny tilstand som behandlingspipelinen i API Skriv mÃ¥ forholde seg til.

Estimat: 5 dv.

h2. LÃ¸sning

* (/) Representasjonsmodell: Nye klasser FjernetNode (inneholder kun attributten ""nvdbId"") og FjernetVegnett (inneholder liste med FjernetNode). Klassen Fjerning utvides med element-property ""vegnett"" av type FjernetVegnett.
* (/) Representasjonsmodell: Bean validation som sikrer at samme node ikke bÃ¥de fjernes og oppdateres.
* (/) Domenemodell: NetElement.Operation fÃ¥r ny verdi ""REMOVE"", med hÃ¸yeste signifikans.
* (/) Transformasjon: NetElementTransforms mÃ¥ utvides til Ã¥ hÃ¥ndtere transformasjon mellom FjernetNode (representasjonsmodell) og Node (domenemodell).
* (/) Validering: Alle constraints som jobber pÃ¥ noder eller nodeporter mÃ¥ ta hensyn til at noder kan vÃ¦re merket for fjerning (se spesielt pÃ¥ LocationNetElementExistsValidator). I sÃ¥ fall skal det ikke valideres. Dette er muligens allerede hÃ¥ndtert via qualifiers i Node.getErrorConstraints().
* (/) Validering: PrepareForRemoveEnricherFilter mÃ¥ utvides med hÃ¥ndtering av fjernede noder. Det mÃ¥ kontrolleres at angitte noder faktisk finnes i NVDB og om de finnes skal innholdet (geometri, porter) kopieres inn.
* (/) Validering: Alle filtere som jobber pÃ¥ noder mÃ¥ filtrere bort de som er merket for fjerning. De er Ã¥ anse som ikke-eksisterende.
* (/) Validering: Verifiser at det ikke finnes veglenkesekvenser med kobling til den fjernede noden, verken i NVDB eller endringssettet.
* (/) Validering: Verifiser at det ikke finnes vegobjekter med sving-stedfesting pÃ¥ den fjernede noden, verken i NVDB eller endringssettet. Eget filter a la AdaptToClosedNetwork sÃ¥ vi slipper Ã¥ berike jobben med Svingrestriksjon.
* (/) Validering: Verifiser at veglenkesekvenser i NVDB er dekoblet fra noden som fjernes. Ny port-constraint aktivert for fjernede noder: PortDisconnected.
* (/) NVDB: NvdbTransactionWriter utvides med ny metode deleteNetElements om invokeres fra writeJob.
* (/) NVDB: NetElementRepository utvides med ny metode deleteNetElements.
* (/) NVDB: SqlGenerationService utvides med ny metode generateDeleteNetElementSql.",NVDB-6937,Skriv-API,
Assosiasjon til flere barn enn tillatt,"h2. Observasjon

Datafangst tillater at man kobler en mor til flere barn enn hva datakatalogen tillater for akkurat denne mor-datter koblingen. API Skriv vil avvise innsendingen.

I dette tilfelle er det Signalanlegg (89) >Â Â Styreapparat (456) som tillater max 1 assosiasjon (se vedlagt bilde fra Datakat Javaapp). Sjekk om API Les gir ut nok info for at DF skal kunne finne ut av dette selv:Â [https://www.test.vegvesen.no/nvdb/api/v3/vegobjekttyper/89]

Se eksempelkontrakt her:Â [https://datafangst-test.kantega.no/#!/contract/0ca57876-853c-498a-bd6f-aea369515400/association]

Vedlagt SOSI for signalanlegg og styreapparat. Kan gjenskapes med Ã¥ koble objektene i SOSI-filene (mÃ¥ ha 100 m som avstand).

Kommer opprinnelig fra kontraktÂ 1813e611-e55d-42c3-acc1-8f7770e5a5eb og endringssettÂ 2bb054b1-b94f-4d91-a9a6-de6986121e7f.",NVDB-6937,Datafangst,
"NVDBREF-281: Nytt felt for ""ekstern referanse"" i endringssett","h2. Bakgrunn

EndringsÃ¸nske beskrivelse hentet fra SVV-Jira:

I ""Endringssett"" vinduet, hvor man ser prosjektene man har lastet opp i NVDB, ser vi i dag ID, LÃ¥se ID, Transaksjons ID, Eier, Mottatt, Klient, Status og Ã…rsak. Vi synes det er vanskelig Ã¥ identifisere prosjektene, spesielt dersom man i lÃ¸pet av en dag har sjekket inn flere prosjekt. Vi Ã¸nsker derfor Ã¥ fÃ¥ inn navnet pÃ¥ Quadri modellen som er jobbet med (feks. NVDB 2019-11-13 16-06). Eventuelt en annen identifikator pÃ¥ hvilket prosjekt det gjelder som er enkel Ã¥ fÃ¥ inn her. Dette tror vi vil gjÃ¸re det enklere Ã¥ skille mellom prosjektene i Endringssettvinduet.
h2. Analyse

Behovet dekkes av et nytt felt i endringssett for ekstern referanse. Det mÃ¥ etableres et nytt felt i tabellen JOB (EXTERNAL_REF) og tilsvarende property i Job (externalRef) og Endringssett (eksternRef). I kontrollpanelet mÃ¥ verdien i dette feltet vises i toppen av detaljvisningen for et endringssett.
h2. LÃ¸sning

Lagt til et nytt felt i endringssettet, for ekstern referanse som blir lagt inn i jobb-databasen. Kun gjort endring for endringssett V3.

Â 

Estimat: 1 dv",NVDB-6937,Skriv-API,
Laster-indikator ved eksportering,"Det tar litt tid fra man klikker en eksportlenke til resultatet begynner Ã¥ laste ned, sÃ¥ det er hensiktsmessig Ã¥ implementere en laster-indikator for eksport av vegobjekter.",NVDB-6937,Vegkart,
Les V3 Metrikker,"Implementer metrikker i Prometheus-format for JVM-informasjon.
",NVDB-6937,Les-API,
NPE ved deassosiering av trunkerte datterobjekter,"h2. Observasjon

Endringssett https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/5aad2f0c-d2e2-42f4-a613-e35793371124 havner i SystemFeil under deassosiering av trunkerte datterobjekter:

{code:java}
java.lang.NullPointerException
	at no.vegvesen.vt.nvdb.apiskriv.domain.feature.Feature.lambda$mergeWith$21(Feature.java:694)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at no.vegvesen.vt.nvdb.apiskriv.domain.feature.Feature.mergeWith(Feature.java:681)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.enrichment.FeatureConflictResolver.resolveAttemptedModify(FeatureConflictResolver.java:301)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.enrichment.FeatureConflictResolver.resolveConflict(FeatureConflictResolver.java:65)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.enrichment.EnrichmentEvaluator.lambda$evaluate$4(EnrichmentEvaluator.java:119)
	at java.lang.Iterable.forEach(Iterable.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.enrichment.EnrichmentEvaluator.evaluate(EnrichmentEvaluator.java:118)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.DeassociateTruncatedFeaturesEnricherFilter.createModifyEnrichmentOrReportConflict(DeassociateTruncatedFeaturesEnricherFilter.java:216)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.DeassociateTruncatedFeaturesEnricherFilter.lambda$null$1(DeassociateTruncatedFeaturesEnricherFilter.java:127)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)
	at java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:270)
	at java.util.TreeMap$ValueSpliterator.forEachRemaining(TreeMap.java:2897)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.DeassociateTruncatedFeaturesEnricherFilter.lambda$null$2(DeassociateTruncatedFeaturesEnricherFilter.java:122)
	at java.util.HashMap$ValueSpliterator.forEachRemaining(HashMap.java:1628)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.DeassociateTruncatedFeaturesEnricherFilter.lambda$null$3(DeassociateTruncatedFeaturesEnricherFilter.java:119)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.DeassociateTruncatedFeaturesEnricherFilter.lambda$createEnrichmentsOrReportConflicts$4(DeassociateTruncatedFeaturesEnricherFilter.java:114)
	at java.util.ArrayList.forEach(ArrayList.java:1257)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.DeassociateTruncatedFeaturesEnricherFilter.createEnrichmentsOrReportConflicts(DeassociateTruncatedFeaturesEnricherFilter.java:112)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.DeassociateTruncatedFeaturesEnricherFilter.doFilter(DeassociateTruncatedFeaturesEnricherFilter.java:70)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.lambda$process$0(JobProcessor.java:114)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:92)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:126)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:386)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:163)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

I forbindelse med fjerning av en assosiasjon til et datterobjekt (Skiltplate) som lukkes i endringssette forsÃ¸ker filtereret DeassociateTruncatedFeaturesEnricherFilter Ã¥ berike jobben med korrigering av morobjektet (Skiltpunkt). Dette morobjektet (nvdbId 1005382545) er imidlertid ogsÃ¥ korrigert av endringssettet, men denne konflikten lÃ¸ses opp av FeatureConflictResolver ved at endringene som endringssettet gjÃ¸r pÃ¥ skiltpunktet flettes inn i berikingen. Dette skjer i Feature.mergeWith og det er her NullPointerException kastes fordi skiltpunktet fra endringssettet mangler en ProcessingInfo-instans pÃ¥ geometriegenskapen. Ã…rsaken er at geometriegenskapen transformeres fra StringAttribute til SpatialAttribute i TransformAttributeFilter, men den ProcessingInfo-instansen som finnes i StringAttribute, kopieres ikke over i SpatialAttribute.

h2. LÃ¸sning

I TransformAttributeFilter mÃ¥ de tre metodene transformStringAttribute, transformEnumAttribute og transformSpatialStructAttribute utvides til Ã¥ kalle setDefaultProcInfoIfMissing.",NVDB-6937,Skriv-API,
Analyser lÃ¸sning for Ã¥ kunne skjerme for sensitive data,"FormÃ¥l: SVV skal ikke legge til rette for deling av sensitive data til brukere som ikke har riktig sensitivrolle (sensitivrolle 3) 
To steg:
1. sÃ¸rge for at data som er lagret i NVDB ikke vises for brukere uten riktig rolle, og ikke kan deles. 
2. finne ut av hÃ¥ndtering av data som er lastet inn i Datafangst men ikke lagret (senere hvis ikke utviklerne ser en smart lÃ¸sning)

i tillegg:
3. Det er ikke lagt til rette for Ã¥ hente skjermede data fra Les i Datafangst.
* handler om innloggingsmekanisme mellom Datafangst og Les

Det finnes en tautshetserklÃ¦ring for de som har rollen, som ogsÃ¥ sier at de ikke skal dele sensitive data med andre. Men det er antageligvis lurt Ã¥ sikre i Datafangst i tillegg sÃ¥nn at ikke noen deler til noen uten rolle uten Ã¥ tenke seg om. 

Jirasaker er opprettet for Ã¥ implementere lÃ¸sning. ",NVDB-6937,Datafangst,
Ruteberegning:   Error loops not allowed,"Â 

Feilmelding :

Â 

: 2020-03-06T09:32:41,978+0100 TRANSID=""23f004a4-0edf-d5b3-1375-405e752f53ae"" ELAPSED_TIME_MS=""83"" BYTES=""-1"" SESSION="""" CLIENT="""" USER_AGENT=""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36"" REQUEST_PATH=""/beta/vegnett/rute"" QUERY_PARAMS=""start=0@42317&slutt=1@42317&"" ACCEPT=""application/json, text/plain, /"" RESPONSE_STATUS_CODE=""500"" Error loops not allowed

Â 

Â 

Dette skjer nÃ¥r ruteberegning legger inn i grafen en edge som starter og slutt er i samme punkt. Se lenke:Â [https://stackoverflow.com/questions/35802005/simple-weighted-graph-loops-not-allowed-exception]

Â 

Â 

Â ",NVDB-6937,Les-API,
Ruteberegning: Feil  - Linestring som input klarer bare Ã¥ gi  to punkter til svar,"Sjekk lenken nedenfor. Her er det en geometri med en masse punkter som som skal gi stedfesting langs lenkesekvenser.Â  Responsen man forventer er type linje med start og slutt-posisjoner pÃ¥ lenkesekvenser.Â  Â Ikke 2 punkt!

Â 

Â 

Â 

Dagens ruteberegning via geometriÂ  blir feil.Â  Innebygget validering sjekket at man via input-geometri fikk veglenker som hang sammen i sekvens.Â  NÃ¥r man stedfeter geometrier et stykke fra vegnettet (100 meter eller sÃ¥) vil de nedprojiserte punktene treffe ""tilfeldige"" veglenker som nÃ¸dvendigvis ikke henger sammen.

Â 

Derfor skriver vi om ruteberegning via geometri til Ã¥ bruke punkt til punkt beregning pÃ¥ hele geometriens sekvens av punkter.Â 

Â 
h2. Â TODO:

Endre ruteberegning nÃ¥r input er geometri.
 * (Ferdig) Lagt inn slik at en kan tegne geometrier i visrute.Â  Â Se vedlegg tegnerute.png
 * (Ferdig) Vi endrer slik at beregning via geometri kjÃ¸rer punkt til punkt ruteberegning for inkommende geometris sekvens av punkter.
 * (Ferdig) Resultatet av punkt til punkt ruteberegningene blir flere ""ruter"" med tihÃ¸rende segmenter, som kommer etter hverandre. Lim sammen de klippede start og slutt-segmentene pÃ¥ rutenes ender slik at de ""henger"" sammen.
 * For noen geometrier fÃ¥r man litt rare ruter. Se eksempel ""rarrute.png"".Â 
 * Lagt inn klipping av blindvei slik at du i stedet for ""rarrute.png"" fÃ¥r ""klippetrute.png"". Se vedlegg

Â 

Â 

Â 

Â 

Â 

Â 

Â 

Â 

Â 

Â 

Â 

Â 

Â 

Responsen den gir er to punkt!

Â <vegnettsrute>
 Â  Â  Â <vegnettrutesegment>
 Â  Â  Â  Â <type>Punkt</type>
 Â  Â  Â  <veglenkesekvensid>42330</veglenkesekvensid>
 Â  Â  Â  <relativPosisjon>0.0</relativPosisjon>
 Â  Â  Â  <kortform>0.0@42330</kortform>
 Â  Â </vegnettrutesegment>
 Â  Â <vegnettrutesegment>
 Â  Â  Â  Â <type>Punkt</type>
 Â  Â  Â  Â <veglenkesekvensid>41363</veglenkesekvensid>
 Â  Â  Â  Â <relativPosisjon>0.65968995</relativPosisjon>
 Â  Â  Â  Â <kortform>0.65968995@41363</kortform>
 Â  Â </vegnettrutesegment>
 </vegnettsrute>

Â Â 

Denne geometrien starter og slutter faktisk i samme punkt ogsÃ¥.Â Â 

Â 

Geometri:
 LINESTRING Z(270203.15 7041918.45 9.11, 270203.12 7041921.1 9.03, 270202.94 7041928.89 8.85, 270202.66 7041928.89 8.86, 270202.44 7041933.08 8.92, 270202.25 7041935.64 8.93, 270200.05 7041935.65 8.87, 270200.05 7041935.8 8.86, 270199.01 7041935.78 8.86, 270198.99 7041934.8 8.77, 270199.16 7041934.81 8.78, 270199.19 7041934.7 8.75, 270199.11 7041932.03 9.49, 270198.99 7041930.45 8.9, 270198.74 7041927.6 8.9, 270198.06 7041923.11 8.95, 270197.77 7041919.43 8.96, 270197.78 7041918.45 8.99, 270198 7041907.98 9.07, 270198.19 7041899.17 9.09, 270198.36 7041891.49 9.18, 270198.9 7041866.11 9.51, 270198.94 7041864.52 9.53, 270199.12 7041857.34 9.64, 270199.18 7041854.59 9.68, 270199.27 7041851 10.48, 270199.31 7041850.23 10.49, 270199.41 7041849.44 10.51, 270199.55 7041848.68 10.49, 270199.98 7041847.36 10.51, 270200.4 7041846.4 10.54, 270200.64 7041845.98 10.54, 270201.12 7041845.19 10.54, 270201.97 7041844.02 10.55, 270202.49 7041843.43 10.57, 270203.15 7041842.75 10.57, 270204.44 7041841.7 10.57, 270205.79 7041840.88 10.58, 270206.53 7041840.52 10.57, 270208.16 7041839.97 10.53, 270209.05 7041839.76 10.53, 270213.19 7041839.19 10.54, 270213.46 7041839.15 9.77, 270218.3 7041843.78 9.74, 270215.37 7041844.25 9.74, 270215.4 7041844.64 9.77, 270214.77 7041844.75 9.76, 270215.12 7041848.74 9.82, 270214.22 7041851.31 9.85, 270213.63 7041851.39 10.6, 270205.68 7041852.3 10.53, 270205.4 7041852.44 10.57, 270205.14 7041852.67 10.55, 270204.91 7041852.92 10.58, 270204.69 7041853.33 10.57, 270204.64 7041853.47 10.42, 270204.22 7041854.08 9.84, 270204.21 7041855.44 10.5, 270204.16 7041857.09 9.8, 270203.69 7041857.07 9.65, 270203.68 7041858.67 9.64, 270204.31 7041858.68 9.65, 270204.32 7041858.79 9.76, 270204.38 7041858.78 9.78, 270204.38 7041859.94 9.88, 270204.44 7041859.93 9.88, 270204.43 7041860.7 9.88, 270204.37 7041860.7 9.88, 270204.25 7041866.91 9.88, 270204.16 7041870.76 9.64, 270203.94 7041881.99 9.57, 270203.56 7041881.99 9.36, 270203.51 7041883.67 9.36, 270203.9 7041883.67 9.36, 270203.72 7041891.79 9.38, 270203.45 7041903.53 9.25, 270203.41 7041905.85 9.19, 270203.17 7041917.19 9.17, 270203.15 7041918.45 9.16)

Â 

Maks_avstand = 100

Â 

Â 

Â 

Direktelenke med geometri:

[https://nvdbapiles-v3.utv.atlas.vegvesen.no/beta/vegnett/rute?geometri=LINESTRING%20Z(270203.15%207041918.45%209.11,%20270203.12%207041921.1%209.03,%20270202.94%207041928.89%208.85,%20270202.66%207041928.89%208.86,%20270202.44%207041933.08%208.92,%20270202.25%207041935.64%208.93,%20270200.05%207041935.65%208.87,%20270200.05%207041935.8%208.86,%20270199.01%207041935.78%208.86,%20270198.99%207041934.8%208.77,%20270199.16%207041934.81%208.78,%20270199.19%207041934.7%208.75,%20270199.11%207041932.03%209.49,%20270198.99%207041930.45%208.9,%20270198.74%207041927.6%208.9,%20270198.06%207041923.11%208.95,%20270197.77%207041919.43%208.96,%20270197.78%207041918.45%208.99,%20270198%207041907.98%209.07,%20270198.19%207041899.17%209.09,%20270198.36%207041891.49%209.18,%20270198.9%207041866.11%209.51,%20270198.94%207041864.52%209.53,%20270199.12%207041857.34%209.64,%20270199.18%207041854.59%209.68,%20270199.27%207041851%2010.48,%20270199.31%207041850.23%2010.49,%20270199.41%207041849.44%2010.51,%20270199.55%207041848.68%2010.49,%20270199.98%207041847.36%2010.51,%20270200.4%207041846.4%2010.54,%20270200.64%207041845.98%2010.54,%20270201.12%207041845.19%2010.54,%20270201.97%207041844.02%2010.55,%20270202.49%207041843.43%2010.57,%20270203.15%207041842.75%2010.57,%20270204.44%207041841.7%2010.57,%20270205.79%207041840.88%2010.58,%20270206.53%207041840.52%2010.57,%20270208.16%207041839.97%2010.53,%20270209.05%207041839.76%2010.53,%20270213.19%207041839.19%2010.54,%20270213.46%207041839.15%209.77,%20270218.3%207041843.78%209.74,%20270215.37%207041844.25%209.74,%20270215.4%207041844.64%209.77,%20270214.77%207041844.75%209.76,%20270215.12%207041848.74%209.82,%20270214.22%207041851.31%209.85,%20270213.63%207041851.39%2010.6,%20270205.68%207041852.3%2010.53,%20270205.4%207041852.44%2010.57,%20270205.14%207041852.67%2010.55,%20270204.91%207041852.92%2010.58,%20270204.69%207041853.33%2010.57,%20270204.64%207041853.47%2010.42,%20270204.22%207041854.08%209.84,%20270204.21%207041855.44%2010.5,%20270204.16%207041857.09%209.8,%20270203.69%207041857.07%209.65,%20270203.68%207041858.67%209.64,%20270204.31%207041858.68%209.65,%20270204.32%207041858.79%209.76,%20270204.38%207041858.78%209.78,%20270204.38%207041859.94%209.88,%20270204.44%207041859.93%209.88,%20270204.43%207041860.7%209.88,%20270204.37%207041860.7%209.88,%20270204.25%207041866.91%209.88,%20270204.16%207041870.76%209.64,%20270203.94%207041881.99%209.57,%20270203.56%207041881.99%209.36,%20270203.51%207041883.67%209.36,%20270203.9%207041883.67%209.36,%20270203.72%207041891.79%209.38,%20270203.45%207041903.53%209.25,%20270203.41%207041905.85%209.19,%20270203.17%207041917.19%209.17,%20270203.15%207041918.45%209.16)&maks_avstand=100&pretty=true&kortform=true]",NVDB-6937,Les-API,
Stramme opp pÃ¥loggingsregime,"Pga stort tidspress og harde frister tok vi et par snarveier i vÃ¥r hÃ¥ndtering av pÃ¥logging mot NVDB api LES, disse bÃ¸r ryddes opp i. Men denne endringen settes IKKE i produksjon fÃ¸r veglisteproduksjon er fullfÃ¸rt (19.3).Â ",NVDB-6825,Rapportgenerator,
Rydde i kartprojeksjoner pÃ¥ kart og data i datafangst,"Det er litt rotete med ulike referansesystemer i datafangst, i dag. Noen projeksjoner er oppgitt med WKT, noen med EPSG-id'er. Det er strenger og proj4js-objekter.

Vi burde rydde litt, og legge info om alle referansesystemer Ã©n plass, slik at vi er sikre pÃ¥ at alle komponenter bruker samme projeksjon og refsys.",NVDB-6937,Datafangst,
Veglister pÃ¥ MS Edge: sÃ¸k starter ikke!,"Microsoft Edge 41.16299.1480.0

KjÃ¸rer Veglister pÃ¥ for eksempel PROD:Â [https://nvdb-veglister.utv.atlas.vegvesen.no/]

Kallet til server initieres ikke (ingen spor i logg). Spinner gÃ¥r, men viser ingen tid (siden tiden er basert pÃ¥ respons fra server).",,Rapportgenerator,
FullfÃ¸re e2e-tester for vegnett,Sverre startet pÃ¥ e2e-testene for vegnett. Oppgaven gÃ¥r pÃ¥ Ã¥ fullfÃ¸re dette.,NVDB-6937,Vegkart,
SÃ¸k pÃ¥ BK 12/100 og 12/65 gir tom rapport,"Fra Tone Wiig (kjÃ¸rt 2020-03-04 19:01 i prod):

SÃ¸k pÃ¥ 12/100 uoffisiell og 12/65Â uoffisiell, TrÃ¸ndelag, Fv og Kv, Arbeidsmodus gir tomme tabeller",,Rapportgenerator,
Leveranseinformasjon,"*Test i AT:*
 * NVDB-5242: Verifiser at riktige roller kommer ut for en tjenestebruker (dersom de har noen roller i LDAP i ATM)
 * NVDB-5188: Sjekk at innsending med srid 6173 blir avvist, mens 5973 blir godkjent. Ta gjerne utg.pkt i generator-case 95.

Sak i leveransen som ikke er nevnt over trenger ikke spesifikk testing i ATM.",NVDB-6937,Skriv-API,
"Ukjent linje 2 pÃ¥ Vegliste E39 TrÃ¸ndelag, normaltransport (uoff)","Fra Tone Wiig:
Se pÃ¥ E39 TrÃ¸ndelag, normaltransport i excelfila og rapporten. Hvor i alle dager kommer linje 2 pÃ¥ E39 i rapporten fra. Excelfila er tatt fra NVDB innsyn uof.

[^nvdb-rapport-2020-03-04-9129658659122760080 (1).docx]Â ",,Rapportgenerator,
Leveranseinformasjon,"*Test i AT:*
 * NVDB-5205: Send inn tomme egenskapsverdier via e-API og se at de ikke blir merket som endret i datafanen.
 * NVDB-5201: Registrer i NVDB av pÃ¥fÃ¸lgende lukkinger skal ikke ta med tidligere lukkinger ^1)^
 * NVDB-5192: Innsending av NN54 og NN2000 skal konvertere hÃ¸yden ihht konfig satt pÃ¥ server. Se testbeskrivelse i saken.
 * NVDB-5202: Endringsmarkering pÃ¥ kontrakter skal forsvinne ved besÃ¸k pÃ¥ en kontrakt
 * NVDB-5182: Verifiser at eksisterende data med tette nabopunkter blir lagret
 * NVDB-4085: Stedfesting skal ikke ha flere enn 8 desimaler

^1)^ Denne saken fortsettes i sak NVDB-5248. Saken blir med pÃ¥ leveransen siden det som er gjort fortsatt gir verdi.

Â ",NVDB-6937,Datafangst,
Lukker objekt pÃ¥ nytt med UtfÃ¸r lukking nÃ¥,"h2. Observasjon

Test av NVDB-5201 viser at dobbel lukking er fjernet fra ""Registrer i NVDB"", men ikke ved bruk av knappen ""UtfÃ¸r lukking nÃ¥"".

Se mer beskrivelse av problemet i navnte sak.",NVDB-6937,Datafangst,
Geopackage ,"Geopackage er et lagringsformat for geografiske data bygget pÃ¥ sqlite. [https://www.geopackage.org/]

Jans forslag er Ã¥ dumpe alle NVDB-objekter i datauttaket til geopackage, en tabell per objekttype pluss eventuelt en tabell for vegnett.

Geografiske objekter i geopackage bestÃ¥r av et skjema med egenskapverdier (flat tabell) pluss en geometri. Standard i geopackage er at geometrien kan vÃ¦re hvilken som helst geometritype (punkt, linje, flate, multi... ). Eventuell kompleksitet med Ã¥ hÃ¥ndtere at NVDB-objekter kan ha ulike geometrityper blir dermed elegant dyttet over pÃ¥ klienten. Alt som kreves, er at [WKT|https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry]-teksten i ""geometri"" -elementet blir transformert til et fullverdig geometriobjekt.

I tillegg mÃ¥ vi ut fra datakatalogen bygge skjemadefinisjon for angjeldende objekttype. Dernest mÃ¥ de egenskapverdiene som finnes pÃ¥ hvert enkelt objekt _(typisk et subsett av datakatalogdefinisjonen)_ puttes pÃ¥ rett sted ihht dette skjemaet. Vi har litt spillerom pÃ¥ hvilket _navn_ vi bruker pÃ¥ de ulike egenskapverdiene, en av
 1. Navn - Mest brukervennlig, men inneholder litt spesialtegn og nasjonale karrakterer
 1. ID for egenskapen - minst brukervennlig, garantert maskinlesbart.
 1. SOSI navn - En hybrid mellom de to over. Garantert maskinlesbar og stort sett brukervennlig forkortelse av det fulle navnet, pluss ID for egenskapen.

For vegnett fÃ¥r vi en engangsjobb med Ã¥ bygge skjema som samsvarer med det vegnettet vi fÃ¥r ut fra NVDB api. Ellers er logikken med oversettelse til geografiske objekt pluss fast skjema den samme som for vegobjekter.

Det mest lovende java-biblioteket for skriving av geopackage ser ut til Ã¥ vÃ¦re [https://github.com/ngageoint/geopackage-java]

Â 

EDIT: Ser at nvdbapiles bruker [https://locationtech.github.io/jts/javadoc/overview-summary.html]Â for generell hÃ¥ndtering av geometri.Â ",NVDB-6827,Rapportgenerator,
Leveranseinformasjon Vegkart 2020.2.2,"Kun endring i konfighÃ¥ndtering slik at Vegkart starter konsekvent.

Tips til akseptansetest: www.test.vegvesen.no/nvdb/vegkart/v3 og vegkart.test.atlas.vegvesen.no laster.",NVDB-6937,Vegkart,
Feil ved koordinatkonvertering/visning i Nordnorge,"h2. Observasjon
Triona forteller om vegobjekter Ã¸st i Finnmark (dvs langt utenfor UTM33) som fÃ¥r feil plassering / en forskyvning pÃ¥ kartet. De har ett eksempel som er vedlagt.

h2. Analyse
Ser ut som data er riktig i databasen, men at en gammel versjon av proj4 (for konvertering av koordinater) pÃ¥ klientsida forÃ¥rsaker denne feilen.

h2. LÃ¸sning
Oppgrader til nyeste proj4. Dette krever endringer i TypeScript-oppsettet, sÃ¥ det drar ogsÃ¥ med seg noen andre kodeendringer.",NVDB-6937,Datafangst,
Leveranseinformasjon,"*Test i AT:*
 * NVDB-5035: Bruk url som angitt i kommentar pÃ¥ saken til Ã¥ se at det nÃ¥ retureners mange 532 innenfor kontraktsomrÃ¥de. Kan gjerne verifiseres av innmelder.
 * NVDB-5145: Test i hht til testbeskrivelse i saken.
 * NVDB-4400: Bruk [https://nvdb-vegdata.github.io/nvdb-visrute/ATM/]Â til Ã¥ teste de ulike parametrene. God testbeskrivelse i saken.
 * NVDB-5135: Test er inkludert i regresjonstest nevnt under.
 * NVDB-5227: Sjekk at /beta/vegnett/rute kommer ut i rota av /nvdb/api/v3
 * Regresjonstest av API: Dette kan gjÃ¸res ved Ã¥ kjÃ¸re de aut. API-testrene mot ATM.

Saker i denne leveransen som ikke er spesifikt nevnt trenger ikke Ã¥ testes i ATM utover regresjonstesten nevnt over.",NVDB-6937,Les-API,
Mangler lokasjon.stedfestinger for responsrevisjon 0,"h2. Observasjon

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/573?antall=10&inkluder=alle]

med ""Accept:Â application/vnd.vegvesen.nvdb-v3-rev0+json"" gir tomt lokasjon.stedfestinger-element.

Samme kall med ""Accept:Â application/vnd.vegvesen.nvdb-v3-rev1+json"" gir info.",NVDB-6937,Les-API,
Mangler vegsegmenter ved inkludering av vegsegmenter,"h2. Observasjon

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/581?antall=10&inkluder=vegsegmenter,metadata&segmentering=false]

gir ingen vegsegmenter.

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekter/581?antall=10&inkluder=alle&segmentering=false]

gir vegsegmenter.",NVDB-6937,Les-API,
Send inn SRID med hÃ¸ydereferanse til NVDB,"I forbindelse med overgang til NN2000 (NVDB-5192) ser vi at vi sender inn SRID for UTM33 til NVDB, men det er ikke en SRID som ogsÃ¥ angir hÃ¸ydereferanse som vi bruker.
Vi bruker 25833 (EUREF UTM33), mens vi (etter overgangen) burde bruke 5973 (EUREF UTM33 med NN2000).

PÃ¥ sett og vis er det ogsÃ¥ treffende at vi bruker en SRID uten hÃ¸ydereferanse, siden vi ikke har helt kontroll i eget hus. Det er noen hÃ¸yder som ikke blir konvertert til NVDBs hÃ¸ydereferanse, se NVDB-5233 og NVDB-5234. Etter at vi har fÃ¥tt ryddet mer opp her sÃ¥ burde vi begynne Ã¥ sende inn SRID med hÃ¸ydereferanse.",NVDB-6937,Datafangst,
Systemfeil pga to lukkinger av samme vegobjektversjon,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/12254060-1c8b-40c2-aa62-9adbe7b5bad2 havner i status SYSTEMFEIL pga uventet konflikt mellom to berikinger i jobben:

{code:java}
java.lang.IllegalStateException: Unexpected conflict between op:DISCONTINUE tid:438 id:79022580 v:1 sd:2003-07-22 ed:2012-01-01 - ac:CLOSE or:CascadingTruncateEnricherFilter vr:false and op:INTERNAL tid:438 id:79022580 v:1 sd:2003-07-22 ed:2012-01-01 - ac:CLOSE or:AdaptFeaturesToClosedNetworkEnricherFilter vr:false
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.FeatureConflictResolver.resolveAttemptedDiscontinue(FeatureConflictResolver.java:145)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.FeatureConflictResolver.resolveConflict(FeatureConflictResolver.java:56)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.EnrichmentEvaluator.lambda$evaluate$4(EnrichmentEvaluator.java:118)
	at java.lang.Iterable.forEach(Iterable.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.EnrichmentEvaluator.evaluate(EnrichmentEvaluator.java:117)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.CascadingTruncateEnricherFilter.lambda$null$6(CascadingTruncateEnricherFilter.java:161)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)
	at java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:270)
	at java.util.TreeMap$ValueSpliterator.forEachRemaining(TreeMap.java:2897)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.CascadingTruncateEnricherFilter.lambda$null$8(CascadingTruncateEnricherFilter.java:145)
	at java.util.HashMap$ValueSpliterator.forEachRemaining(HashMap.java:1628)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.CascadingTruncateEnricherFilter.lambda$findAndTruncateChildren$9(CascadingTruncateEnricherFilter.java:138)
	at java.util.ArrayList.forEach(ArrayList.java:1257)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.CascadingTruncateEnricherFilter.findAndTruncateChildren(CascadingTruncateEnricherFilter.java:135)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.CascadingTruncateEnricherFilter.lambda$getFeaturesForCascadingTruncate$2(CascadingTruncateEnricherFilter.java:99)
	at java.util.ArrayList.forEach(ArrayList.java:1257)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.CascadingTruncateEnricherFilter.getFeaturesForCascadingTruncate(CascadingTruncateEnricherFilter.java:98)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.CascadingTruncateEnricherFilter.doFilter(CascadingTruncateEnricherFilter.java:65)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:107)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:122)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$13(JobWorker.java:389)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$validateBeforeLock$14(JobWorker.java:388)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:387)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:163)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

Som angitt av stacktrace over forsÃ¸ker CascadingTruncateEnricherFilter Ã¥ lukke (siste versjon av) et vegobjekt som allerede er lukket av et tidligere fÃ¸lgeoppdateringsfilter, AdaptFeaturesToClosedNetworkEnricherFilter, pga. lukket vegnett. Sistnevnte lagde en fÃ¸lgeoppdatering med operation INTERNAL, action CLOSE for Ã¥ unngÃ¥ fÃ¸lgeoppdateringer pga lukkingen, siden vegobjektet allerede hadde sluttdato (2012-06-25) i NVDB. CascadingTruncateEnricherFilter, derimot, tar ikke hensyn til at vegobjektversjonene allerede har sluttdato og prÃ¸ver Ã¥ legge inn DISCONTINUE med ny sluttdato. Dette avvises korrekt som konflikt.

h2. LÃ¸sning

Feilen er at CascadingTruncateEnricherFilter unnlater Ã¥ bruker INTERNAL:CLOSE nÃ¥r vegobjektversjonen allerede er lukket. Dette rettes i metoden createEnrichmentForTruncation.
",NVDB-6937,Skriv-API,
Atlas: KjÃ¸re nvdb-rapport-api pÃ¥ separate noder for Veglister og Driftskontrakter,"KjÃ¸re nvdb-rapport-api pÃ¥ separate noder for Veglister og Driftskontrakter i miljÃ¸ene UTV, ATM og PROD. Dette for Ã¥ forhindre at ulike klienttyper (Veglister og Driftskontrakter) pÃ¥virker kjÃ¸remiljÃ¸et for hverandre.",NVDB-6825,Rapportgenerator,
"NVDBREF-270: Avvis overlappende Strekning, Sideanleggsdel og/eller Kryssdel","h2. Bakgrunn

Registrert i SVV-Jira av Ekker Hans JÃ¸rgen
Beskrivelse i NNVDBREF-270: 
I endringssett:

https://www.test.vegvesen.no/nvdb/apiskrivbeta/kontrollpanel/#/jobs/view/c774be4e-13a0-46fb-af2e-f7bb606b428e

har jeg opprettet bÃ¥de Strekning og Sideanleggsdel pÃ¥ samme lenke (lenke 1, lenkesekvens -1). Prosessen gikk fram til Completed i et prÃ¸veinnsjekk i ATM.

916 Strekning, 918 Kryssdel og 920 Sideanleggsdel er gjensidig utelukkende.

(NVDB Vegnett validerer dette, men kun som Advarsel og ikke Feil. Dette mÃ¥ endres i egen sak).

h2. Analyse

Det mÃ¥ realiseres en ny constraint som verifiserer at det ikke er overlappende vegystemreferanse-vegobjekter pÃ¥ vegnettet, hverken innenfor endringssettet eller endringssettet+NVDB. Den eksisterende NoOverlap-constraint'en kan brukes som modell. 

Det er ingen beriking av jobben med Kryssdel og Sideanleggsdel i dag, bare Strekning. Dette mÃ¥ antagelig realiseres. I sÃ¥ fall kan filteret AdaptFeaturesToChangedMeterDirectionEnricherFilter omskrives litt. Dette filteret henter ogsÃ¥ inn Kryssdel- og Sideanleggsdel-objekter.

Estimat: 5 dv

h2. LÃ¸sning

Nytt berikingsfilter ReadInterOverlappedFeaturesEnricherFilter leser inn relevante vegsystemreferanse-objekter fra NVDB. Disse brukes ved validering av overlapp innad blant disse vegobjekttypene i den nye constraint'en NoInterOverlap.
",NVDB-6937,Skriv-API,
Mors stedfesting dekker ikke datter,"h2. Observasjon

Det kom inn en henvendelse fra SINUS Infra om en feilmelding fra API Skriv ved delvis korrigering av mor og datter i samme endringssett. Dette er v2 av API. Her endres stedfesting for bÃ¥de mor og dÃ¸tre, men Skriv sier at stedfestingen til mor ikke dekker datter.

Endringssett:Â [https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/8a6ac299-340a-480b-98b2-eda6f159f801]

Vedlagt er endringssettet som feiler. Dette feiler med: _Objektet har ikke stedfesting som fullstendig dekker datterobjekt av type Skiltplate (96): nvdbId 86612764_

Har gjenskapt feilen pÃ¥ STM ogsÃ¥.

h2. Analyse

I endringssettet korrigeres stedfestingen til:

1) Et morobjekt av type Skiltpunkt, nvdbId 86612765, versjon 1, med levetid 2003-02-17 ->
2) Et datterobjekt av type Skiltplate, nvdbId 86612764, versjon 2, med levetid 2003-06-09 ->

Endringssettet avvises fordi datterobjektet ogsÃ¥ finnes i versjon 1, med levetid 2003-02-17 - 2003-06-09, og etter korrigering av stedfestingen til morobjektet er ikke lenger v1 av datter stedfestet innenfor mor. Dette kunne vÃ¦rt lÃ¸st ved at v1 av datterobjektet ogsÃ¥ fikk sin stedfesting korrigert. Dette stÃ¸ttes imidlertid bare i versjon 3 av endringssett-endepunktet. 

h2. LÃ¸sning

Det er ingen bug Ã¥ fikse, men utvider valideringsmeldingen med versjonsnummer for Ã¥ tydeliggjÃ¸re at problemet ligger pÃ¥ en historisk versjon.
Â ",NVDB-6937,Skriv-API,
Implementer endringslogg,"Oppgaven bestÃ¥r i Ã¥ implementere en versjonslogg som brukeren av Vegkart har tilgang til.

Det er mest hensiktsmessig Ã¥ ha en link til versjonsloggen i splash-vinduet (der ""Ikke vis""-checkboxen er i dag â€“ flytt checkboxen til plassen over footer i stedet).

Et forslag er Ã¥ ha en fil per release som forklarer endringer i markdown-stil, som kan parses av komponenten som skal vise fram dette. Deretter kan man bestemme hvor mange tidligere versjoner man Ã¸nsker Ã¥ vise i loggen. Muligens de to eller tre siste? For konsistent visning kan man ha scrollbar her som default.

Vurder samtidig om man Ã¸nsker en indikator for om noe er endret siden sist brukeren var innom Vegkart. Denne skal ikke vises ved fÃ¸rste besÃ¸k.

Dersom Ã¸nskelig av utvikleren, kan det opprettes et eget byggsteg som sjekker at en fil for neste release er laget, og feile bygget dersom denne ikke eksisterer.",NVDB-6937,Vegkart,
Mulighet for Ã¥ oppgi hÃ¸ydereferanse ved bruk av eksternt API,"For vegobjekter som kommer inn med ekstern API sÃ¥ er posisjon angitt i WGS 84 (""GPS""), og hÃ¸yde er ogsÃ¥ angitt relativ til dette (""WGS 84-ellipsoiden""). Slike objekter har hÃ¸ydesystem (""heightRef"") ""ELLIPSOID"" i databasen.

NVDB API forutsetter at hÃ¸ydereferanse er NN54 (eller snart NN2000, se NVDB-5192), men det skjer ingen konvertering mellom WGS 84 og norsk hÃ¸ydereferanse ved innsending til NVDB, som medfÃ¸rer at alle hÃ¸yder fra ekstern API blir feil i NVDB hvis det er WGS 84-hÃ¸yde som brukes.

*LÃ¸sning*
Datafangst endres til at ekstern API skal gjÃ¸re det mulig Ã¥ oppgi hva slags hÃ¸ydereferanse som brukes. Kun NN2000 og NN54 skal vÃ¦re tillatte verdier, hvis det er oppgitt en annen verdi enn disse skal vegobjektet avises med beskrivende feilmelding.
Hvis hÃ¸ydereferanse ikke er oppgitt skal hÃ¸yde tolkes og lagres som  NN2000, men NN54 aksepteres (ettersom vi har en konvertering).
NB! data som ikke har hÃ¸yde trenger heller ikke hÃ¸ydereferanse, og skal aksepteres. 

API-dokumentasjon skal ogsÃ¥ oppdateres.",NVDB-6937,Datafangst,
HÃ¥ndering av gamle hÃ¸ydesystemer i Datafangst,"API Skriv forutsetter at koordinater med hÃ¸yde som sendes inn er i ""riktig"" hÃ¸ydesystem, dvs. per nÃ¥ NN54, snart NN2000. Skriv gjÃ¸r ingen konvertering av data som sendes inn.

Datafangst gjÃ¸r til en viss grad konvertering av hÃ¸ydedata, men bare for hÃ¸ydesystemer der det er satt opp eksplisitt konvertering. Det vil si i dag fra NN2000 til NN54, og snart ogsÃ¥ fra NN54 til NN2000.

Det er ogsÃ¥ andre hÃ¸ydesystemer i bruk i data som sendes inn til Datafangst. Det er noe bruk av gamle systemer med ""OSLO"" (ca 1% av vegobjekter) og NNN57 (ca. 0,01%). Det er ikke noen konvertering for disse i dag, sÃ¥ slik det er nÃ¥ vil de gÃ¥ rett inn i NVDB som de er, og hÃ¸ydeverdien i NVDB vil ikke vÃ¦re riktig. Slik det er nÃ¥ godtar vi alle hÃ¸ydesystemer som er definert i SOSI-standarden, men det er bare NN2000 / NN54 og lokalt hÃ¸ydesystem for Trondheim som konverteres.

Vi bÃ¸r enten avvise andre hÃ¸ydesystemer enn NN54, NN2000 og WGS84 framover, eller sÃ¥ mÃ¥ vi fÃ¥ pÃ¥ plass konvertering ogsÃ¥ for de gamle systemene som vi godtar.

Dette dukket opp i forbindelse med overgang til hÃ¸ydesystem NN2000 i NVDB (se NVDB-5192).",NVDB-6937,Datafangst,
Eksport: Markere type innsending,"En bruker Ã¸nsker Ã¥ kunne se operasjon som inngÃ¥r i en registrering. F.ex dersom et endringssett kun inneholder operasjonen ""Lukk"" vil bruker se dette i tabellen over registreringer. En mulighet er Ã¥ legge til info om type operasjon i kolonne til hÃ¸yre for status (eksempelvis UTFÃ˜RT | Lukk).

Fra bruker (Tanja Caliskaner, Tanja.Jeanette.Molland.Caliskaner@vlfk.no):
{noformat}
Er det mulig nÃ¥r man oppdaterer NVDB at de objekt som slettes fÃ¥r markert dette bak objektet slik at man ser i loggen at sletting er utfÃ¸rt? Se eksempel under hvor jeg fÃ¸rst utfÃ¸rte sletting pÃ¥ stikkrenne/kulvert og sÃ¥ oppdatert ny, men de ser helt like ut i loggen.
{noformat}",NVDB-6937,Datafangst,
LÃ¥ste vegobjekter skal kunne kopieres,"Et Ã¸nske fra bruker er at lÃ¥ste objekter skal kunne kopieres til nye objekter. Vi hindrer dette i dag, men ser ingen grunn til at vi ikke kan oppfylle dette Ã¸nsket.

Fra bruker (Espen Refsdal Thiem, Espen.Refsdal.Thiem@vlfk.no):
{noformat}
Ved Ã¥ lÃ¥se objekter forsvinner muligheten for Ã¥ kopiere. Burde ikke kopieringsmulighetene vÃ¦rt der fremdeles? Man mÃ¥ da kunne fÃ¥ kopiere et objekt selv det er lÃ¥st, da lÃ¥singen bare skal hindre endringer pÃ¥ det aktuelle objektet. En kopiering medfÃ¸rer ikke noen endring for objektet som blir kopiert.
{noformat}",NVDB-6937,Datafangst,
NVDBREF-493 - Ikke tilgang ved filtrering pÃ¥ sensitiv egenskap,"h2. Observasjon

Bruker exttxm har rolle sensitiv_1 i ATM. SpÃ¸r etter {{/vegobjekter/570?antall=10&inkluder=egenskaper}} og fÃ¥r opp bl.a. egenskap 5061. Men {{/vegobjekter/570?antall=10&egenskap=(5061!=null)&inkluder=egenskaper}} gir _Anmeldelsesnummer(5061) er en sensitiv egenskapstype som krever innlogging og rettigheter for visning av Trafikkulykke(570)_

NÃ¥r bruker har riktig rolle skal ogsÃ¥ filtrering pÃ¥ sensitiv egenskap fungere.

Til info sÃ¥ fungerer filtrering pÃ¥ egenskap (ikke sensitiv) for skjermet type (etter Ã¥ ha lagt til tilgang for denne) medÂ /vegobjekter/905?antall=1&egenskap=(10914!=null)&inkluder=egenskaper.",NVDB-6937,Les-API,
Ustabil integrasjonstest AssociationIt.shouldRejectIndirectAssociationToChildFeatureWithOperationDelete,"Test shouldRejectIndirectAssociationToChildFeatureWithOperationDelete feiler forholdsvis ofte, uten noen Ã¥penbar Ã¥rsak.

Logg viser at en grunn til feil er at den fÃ¥r to instanser av en NVDB-ID i databasen. Jeg og Tor klarer ikke Ã¥ se helt hvordan dette henger sammen, men testen i seg selv er laget sÃ¥nn at den egentlig tester to forskjellige ting, og gjenbruker NVDB-ID som det testes med. Ã… splitte testen i to vil kanskje gjÃ¸re den mer stabil.",NVDB-6937,Datafangst,
Fjerne mulighet for multigeometri i Datafangst,"h2. Observasjon

TNE klager pÃ¥ en geometri som er lest inn som multilinestring pÃ¥ objektÂ 1006883957. Dette objektet kommer fra Datafangst.

Kontrakt:Â [https://datafangst.kantega.no/#!/contract/c7eebb4e-12f7-4f07-afa3-764c10b5fe3d/export]

Endringssett:Â [https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/486ec384-3166-48d6-b41f-fde6459d76ca]

Det er snakk om objektet ""Ny Vegdekke_1"" (type 241). Det er litt vanskelig Ã¥ se hvor det kommer fra, men det ser ut som om et NVDB-objekt er kopiert inn med ny geometri, for deretter Ã¥ bli klippet i to (se event-fanen med Ã¥ filtrere pÃ¥ objektets guid). Hvorfor dette objektet har blitt liggende med multigeometri er vanskelig Ã¥ si.

Pga problemene til TNE har Hans Anton slettet geometrien til objektet:Â [https://www.vegvesen.no/nvdb/apiskriv/rest/v3/les/vegobjekt/241/1006883957/1]

Dette kan sees her: [https://www.vegvesen.no/nvdb/apiskriv/rest/v1/transaksjon?vegobjektId=1006883957]

Det vi kan gjÃ¸re i denne saken er Ã¥ se om hvordan vi hÃ¥ndterer import av NVDB-objekter med multigeometri, samt se om klipping kan generere multigeometri.

Â ",NVDB-6937,Datafangst,
Ruteberegning: Legge inn dokumentasjon av endepunkt i apiary,"h2. TODO
 * (Ferdig) Legge inn api-dokumentasjon for beregning av rute punkt til punk og med geometri
 * (Ferdig) Legge inn slik at endepunkt /beta/vegnett/rute vises i oversikt for lenke-url til Leseapi (f.eks vises i lenken [https://apilesv3.atlas.vegvesen.no)|https://apilesv3.atlas.vegvesen.no%29/]
 * (Ferdig) Fikse slik at direktelenkene peker inn pÃ¥ riktig sted i dokumentasjonen nÃ¥r man kaller Leseapi med feil parameter, f.eks:
 ** <errors>
 Â  Â <error>
 Â  Â  Â  <code>4002</code>
 Â  Â  Â  <message>Â Ugyldig verdi '3?dsflkjhdsfj' for heltallsparameter 'antall'.</message>
 Â  Â  Â  <help_url>[https://nvdbapilesv3.docs.apiary.io/#/reference/0/vegobjekter]</help_url>
 Â  </error>
 </errors>

Â 

NÃ¥r det gjaldt dirktelenkene inn i dokumentasjonen viste det seg Ã¥ vÃ¦re tegnet ""/"" som kom etter hashtegnet ""#"" som gjorde at direktelenken ikke fungerte.Â  Â Oppdaterte defaults.properties og fjernet ""/"" tegnet og da virker lenkene.

Â 

Â 

Â ",NVDB-6937,Les-API,
Legg pÃ¥ mer informativ tekst rundt Overskriv i NVDB,"Det er i dag ikke mange som vet hva ""Overskriv i NVDB"" gjÃ¸r til forskjell fra ""Registrer i NVDB"". NÃ¥r vi nÃ¥ har fÃ¥tt flere gruppeadmin som ikke har historikken til de ""opprinnelige"" globale admin som denne funskjonen var laget for, trenger denne funksjonen en mer informativ tekst som sier hva den gjÃ¸r.

Spesielt pga sak NVDB-5222.

Teksten kan evt legges inn i en modal som kommer opp nÃ¥r man trykker pÃ¥ knappen. BÃ¸r inneholde rÃ¥d om Ã¥ i hovedsak bruke ""Registrer i NVDB"".",NVDB-6937,Datafangst,
Gi gruppeadmin tilgang til overskriv i NVDB funksjonen,"I dag har kun globale admin tilgang til ""Overskriv i NVDB"" pÃ¥ Eksport. Denne funksjonen bÃ¸r ogsÃ¥ vÃ¦re tilgjengelig for gruppeadmin.",NVDB-6937,Datafangst,
StÃ¸tte kjÃ¸ring pÃ¥ flere Atlas-noder,"ReportJobManagerÂ holder styr pÃ¥ asynkroneÂ jobber mellom frontend og backend. Denne tilstanden holdesÂ i en intern Map. Siden denne manageren erÂ ApplicationScoped vil det feile hvis vi kjÃ¸rer lÃ¸sningen pÃ¥ flere noder, da den interne tilstanden ikke deles pÃ¥ tvers av VM'er.

Vi kjÃ¸rer derfor i dag bare med Ã©n node.

PÃ¥ grunn av store minneproblemer (NVDBREF-482) er det sannsynligvis nÃ¸dvendig Ã¥ lastbalansere mellom flere noder. Viktigst for Driftskontrakter, men ogsÃ¥ for Veglister.

Det har vÃ¦rt diskutert at tilstanden sannsynligvis hÃ¸rer hjemme i en database.",NVDB-6825,Rapportgenerator,
"Oppgradere dependencies, mars 2020","PÃ¥ tide Ã¥ sjekke dependencies igjen.

Siden sist har Typescript kommet i versjon 3.8:Â [https://devblogs.microsoft.com/typescript/announcing-typescript-3-8/]

NPM har en ny patch-versjon: 6.13.1 -> 6.13.7",NVDB-6937,Vegkart,
Direktelenke av vegnettsfilter fungerer ikke,"GÃ¥ tilÂ [https://vegkart-v3.utv.atlas.vegvesen.no/], Ã¥pne vegnettsfilteret og klikk ""Rampe"".

Refresh siden. Vegkart enten krÃ¦sjer eller klarer ikke parse filteret.",NVDB-6937,Vegkart,
Overgang til nytt hÃ¸ydesystem - fra NN 1954 til NN2000,"Alle Z-koordinater skal ved overgang til NN2000 regnes om ved scriptkjÃ¸ring - se NVDB klassisk sakÂ https://jira.kantega.no/browse/SVNK-470

Det er Ã¸nskelig Ã¥ fÃ¥ implementert denne endringen i produksjon i midten av mars. I forkant mÃ¥ det gjÃ¸res tilpasninger i NVDB api skriv og Datafangst, og vurdering av om det innebÃ¦rer noe mer enn reindeksering for NVDB api les v2 og v3. https://jira.kantega.no/browse/NVDB-5188Â ogÂ https://jira.kantega.no/browse/NVDB-5192

Â 

Hans Anton Ã…lien vil sÃ¸rge for retest av scriptet som endrer Z-koordinatene.",NVDB-6937,Eksport,
Atlas: OutOfMemoryError,"UTV har problemer med minne ved kjÃ¸ring av Normaltransport/TrÃ¸ndelag
Terminating due to java.lang.OutOfMemoryError: Java heap space",,Rapportgenerator,
Automatisk regresjonstest,"Oppsett av automatisk regresjonstest. Test at for en gitt Vegliste sÃ¥ blir rapporten den samme. For Ã¥ unngÃ¥ at testen skal feile ved oppdateringer i NVDB mÃ¥ svar fra lese-apiet lagres og mockes.

UndersÃ¸k om testen mÃ¥ kjÃ¸re nattlig for Ã¥ holde byggetid nede, eller om den kan vÃ¦re en del av vanlig bygg.

Â 
 Estimat, t-skjorte-stÃ¸rrelse: Medium",NVDB-6825,Rapportgenerator,
SOSI-nedlasting feiler,[https://nvdbapi-eksport-v3.utv.atlas.vegvesen.no/vegobjekter/5.sosi?segmentering=true&egenskap=(area(946%2C5021))&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri%2Cvegsegmenter&tegnsett=utf8],NVDB-6937,Eksport,
Leveranseinformasjon  NVDBIND-V3 2020.5.0,"Etter indeksering i produksjon skal dataerror.log deles opp i de forskjellige typene feil og sendes til Hans Anton, Hans JÃ¸rgen og Linda.

*Test i AT:*
 * NVDB-5152: Verifiser at multi-geometri kommer ut for de som har dette som egengeometri.
 * NVDB-5074: Verifiser at segmenterte deler uten Vegsystem kommer ut fra API

Saker i leveransen som ikke er nevnt over trenger ikke Ã¥ testes spesifikt i ATM. ",NVDB-6937,NVDB-IND,
Leveranseinformasjon Skrive-API 2020-3,"*Test i AT:*
 * NVDB-5194: Retest endringssett som angitt i saken. Se ogsÃ¥ ^1)^
 * NVDB-5157: Retest innsending fra datafangst-test pÃ¥ kontrakt som angitt i saken.
 * NVDB-5110: Verifiser at _/nvdb/apiskriv/rest/v1/autorisasjon/<brukernavn>_Â gir rettigheter for en bruker som har satt rettigheter og ingen rettigheter for en systemadmin-bruker (f.ex exttxm)

Saker som ikke er nevnt som er en del av denne leveransen trenger ikke spesifikk test i ATM.

^1)^ Men siden leveranse Skrive-API 2020-2 inneholdt en feil som er rettet her, er det Ã¸nskelig at VNE re-tester denne leveransen i ATM. Dette gjelder sakene som beskrevet i NVDB-5176.",NVDB-6937,Skriv-API,
"NVDBREF 476 - CSV-eksport for ""Elektrisk anlegg"" gir kun kryptiske tegn i CSV-fila","Jeg velger MÃ¥lselv kommune og Elektrisk anlegg, og jeg fÃ¥r fram 14 objekter i kartet. Men jeg fÃ¥r ikke objektene over til CSV-fil. Det eneste som kommer med i fila er Ã¯Â»Â¿ i rute A1.

[https://vegkart-v3.test.atlas.vegvesen.no/#kartlag:geodata/@653592,7666650,9/hva:~(~(id~461))/hvor:~(kommune~(~5418]))",NVDB-6937,Eksport,
SQLException ved innhenting av transaksjonstidspunkt,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/556ace93-f8df-443a-a52b-62f98e422b10 havarerer med SYSTEMERROR ved transaksjonskontroll av vegobjekt:

{code:java}
java.lang.RuntimeException: Failed to execute query
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Executors.executeQuery(Executors.java:125)
	at no.vegvesen.vt.nvdb.apiskriv.nvdbrepository.JdbcTransactionRepository.lambda$getLatestTxTimeForFeatureVersions$10(JdbcTransactionRepository.java:169)
	at java.util.HashMap$Values.forEach(HashMap.java:981)
	at no.vegvesen.vt.nvdb.apiskriv.nvdbrepository.JdbcTransactionRepository.getLatestTxTimeForFeatureVersions(JdbcTransactionRepository.java:168)
	at no.vegvesen.vt.nvdb.apiskriv.auditing.DefaultAuditService.lambda$getLatestUpdateTimeForFeatureVersions$6(DefaultAuditService.java:202)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:60)
	at no.vegvesen.vt.nvdb.apiskriv.auditing.DefaultAuditService.getLatestUpdateTimeForFeatureVersions(DefaultAuditService.java:202)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.FeatureVersionContentionFilter.validateFeatures(FeatureVersionContentionFilter.java:49)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.FeatureVersionContentionFilter.doFilter(FeatureVersionContentionFilter.java:42)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:107)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateAfterLocking(DefaultValidationService.java:129)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$21(JobWorker.java:512)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$validateAfterLock$22(JobWorker.java:511)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateAfterLock(JobWorker.java:510)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:177)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
	at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1390)
	at org.apache.activemq.ActiveMQMessageConsumer.iterate(ActiveMQMessageConsumer.java:1552)
	at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:191)
	at org.apache.activemq.ActiveMQSessionExecutor.wakeup(ActiveMQSessionExecutor.java:111)
	at org.apache.activemq.ActiveMQMessageConsumer.start(ActiveMQMessageConsumer.java:1527)
	at org.apache.activemq.ActiveMQMessageConsumer$7.run(ActiveMQMessageConsumer.java:1308)
	at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)
	at java.util.TimerThread.mainLoop(Timer.java:555)
	at java.util.TimerThread.run(Timer.java:505)
Caused by: java.sql.SQLException: Missing IN or OUT parameter at index:: 503
	at oracle.jdbc.driver.OraclePreparedStatement.processCompletedBindRow(OraclePreparedStatement.java:2086)
	at oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:3772)
	at oracle.jdbc.driver.T4CPreparedStatement.executeInternal(T4CPreparedStatement.java:1343)
	at oracle.jdbc.driver.OraclePreparedStatement.executeQuery(OraclePreparedStatement.java:3822)
	at oracle.jdbc.driver.OraclePreparedStatementWrapper.executeQuery(OraclePreparedStatementWrapper.java:1165)
	at sun.reflect.GeneratedMethodAccessor304.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at oracle.ucp.jdbc.proxy.PreparedStatementProxyFactory.invoke(PreparedStatementProxyFactory.java:176)
	at com.sun.proxy.$Proxy87.executeQuery(Unknown Source)
	at no.vegvesen.vt.nvdb.apiskriv.database.proxy.PreparedStatementProxy.executeQuery(PreparedStatementProxy.java:37)
	at no.vegvesen.vt.nvdb.apiskriv.database.proxy.PreparedStatementProxy.executeQuery(PreparedStatementProxy.java:37)
	at no.vegvesen.vt.nvdb.apiskriv.database.proxy.PreparedStatementProxy.executeQuery(PreparedStatementProxy.java:37)
	at no.vegvesen.vt.nvdb.apiskriv.database.metric.MetricPreparedStatement.lambda$executeQuery$0(MetricPreparedStatement.java:22)
	at no.vegvesen.vt.nvdb.apiskriv.database.metric.MetricUtils.time(MetricUtils.java:20)
	at no.vegvesen.vt.nvdb.apiskriv.database.metric.MetricPreparedStatement.executeQuery(MetricPreparedStatement.java:22)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Executors.executeQuery(Executors.java:122)
{code}

h2. Analyse

I JdbcTransactionRepository.getLatestTxTimeForFeatureVersions() hentes siste transaksjonstidspunkt for en liste av vegobjektid'er. For Ã¥ omgÃ¥ begrensningen i antall verdier for en IN-klausul i Oracle, partisjoneres listen i sublister Ã¡ 500 id'er. I det aktuelle endringssettet er over 600 vegobjekter som oppdateres med overskriving. Dermed blir det to partisjoner. Men, i oppbyggingen av SQL-setningen lages parametermarkÃ¸rer for hele (mer enn 600) listen av id'er i stedet for bare partisjonen. Dermed blir det flere parametermarkÃ¸rer enn parametere og JDBC kaster SQLException som ventet.

h2. LÃ¸sning

Endrer antall parametermarkÃ¸rer til det antallet id'er som finnes i den aktuelle partisjonen.",NVDB-6937,Skriv-API,
Rettigheter pÃ¥ kontraktnivÃ¥ funker ikke med query-param,"h2. Observasjon

Raymond KrossÃ¸y Hermansen har problemer pÃ¥Â 

[https://datafangst.kantega.no/#!/contract/1710fb1a-063b-4c35-9dbe-c935f351a9fb/features3]

han fÃ¥r ikke til Ã¥ kopiere sideposisjon fra mor, men fÃ¥r til Ã¥ redigere sideposisjon manuelt.

backend svarer med 403 forbidden.

det er samme mekanisme som avklarer permissions i begge tilfellene, men av eller annen grunn funker det ikke pÃ¥ sideposisjon fra mor.

Min bruker fÃ¥r ikke til Ã¥ gjenskape problemet.Â 

installerer en fersk database i pÃ¥ dev for Ã¥ prÃ¸ve Ã¥ gjenskape problemet der.

Â 
h2. Analyse
 * brukeren har de nÃ¸dvendige rettigheter
 * kallet for manuell sideposisjon bruker path-param, fra mor query-param
 * En feil i Permission resolver gjÃ¸r at bare kontraktgruppe-rettigheter blir plukket opp ved bruk av query param men ikke kontrakt-rettigheter

h2. LÃ¸sning

Legge til evaluering av queryparam for kontrakt-rettigheter

Â ",NVDB-6937,Datafangst,
API: Filtrere bort tomme egenskapsverdier,"h2. Observasjon

Innsending til DF via API med tomme egenskapsverdier vil DF tolke som utfylte egenskapsverdier med ingen verdi. Dette inkluderer ogsÃ¥ egenskapsverdier som enten ikke skal eksistere eller ha en enum-verdi, men altsÃ¥ ikke tom verdi. F.ex Gemini EntreprenÃ¸r har sendt inn data hvor enum-egenskapsverdier er oppgitt som type _""<id>: """"_ i geojson.Â 

Frem til nÃ¥ har API Skriv gitt en feil pÃ¥ dette s.a. API har gitt REJECT tilbake, *men* likevel tatt inn objektene. API Skriv endres nÃ¥ til Ã¥ filtrere bort tomme egenskapsverdier s.a. dette er lov Ã¥ oppgi, men DF-API bÃ¸r filtrere bort disse s.a. ikke slike egenskapsverdier opptrer i datafanen som endrede verdier uten verdi nÃ¥r de ikke har lov til ikke Ã¥ ha verdi.

Oppgaven gÃ¥r pÃ¥ Ã¥ filtrere bort alle egenskaper som har tomme verdier.

Eksempel pÃ¥ geojson som gir denne observasjonen:
{code:java}
{ ""type"": ""FeatureCollection"", ""features"": [ { ""type"": ""Feature"", ""geometry"": { ""type"": ""Polygon"", ""coordinates"": [ [ [10.39241731, 63.43053048], [10.39495434, 63.43043698], [10.39579151, 63.42898665], [10.39272171, 63.42909269], [10.39241731, 63.43053048] ] ] }, ""properties"": { ""tag"": ""Forsterkningslag#1"", ""dataCatalogVersion"": ""2.07"", ""typeId"": 227, ""comment"": ""Usikker pÃ¥ mÃ¥ledatoen"", ""attributes"": { ""5543"": ""20160802"", ""1212"": """", ""1631"": """" } } } ] }
{code}",NVDB-6937,Datafangst,
NVDBREF - 469 Lenke 626064 presenteres i api'et som to segmenter i stedet for et,"En lenke som i NVDB vegnett ser ut til Ã¥ vÃ¦re 18,114 meter presenteres i api'etÂ ",NVDB-6937,Les-API,
"NVDBREF-466 Valg av Inkluder=""ARMER"" i vegnett gir feil resultat","Det ser ut som man fÃ¥r med seg mer enn armene ut; ogsÃ¥ midlertidige strekninger (de som er under omklassifiseringÂ  gml T-strekninger) samt konnekteringslenker. Se under.Â 

[https://vegkart-v3.test.atlas.vegvesen.no/#kartlag:geodata/@191522,6572918,11/vegnett:~'geometri*~(arm~'true~kryssystem~'false~sideanlegg~'false)]

!Eksempel arm med feil innhold.JPG|thumbnail!",NVDB-6937,Vegkart,
Markering av sist endret blir ikke borte,"h2. Observasjon

NÃ¥r en kontrakt er markert som endret i kontraktslisten sÃ¥ blir ikke denne markeringen borte etter Ã¥ ha besÃ¸kt kontrakten.

Kan gjenskapes ved Ã¥ opprette en kontrakt. Invitere inn en annen deltaker. Logg ut. Logg inn som den andre deltakeren og f.ex laster opp en SOSI. Logg ut. GÃ¥ deretter inn som bruker som opprettet kontrakten. Da er kontrakten markert som endret, og kontrakt-id fremkommer i kalletÂ /rest/contract/listchangecounts. BesÃ¸k kontrakten. GÃ¥ tilbake og se at kontrakten fortsatt er markert.

Tidligere (husker ikke nÃ¥r) var det et kall _/rest/contract/${contractId}/visit_ som gikk da man besÃ¸kte en kontrakt. Ser ikke dette nÃ¥ lengre.

h2. LÃ¸sning
Vi knytter oppdatering av visited til Ã¥pning av kontrakt i stedet. Da blir det ikke noe eget kall, men forhÃ¥pentligvis mer riktig, dekker bl.a. tilfellet der bruker gÃ¥r rett inn pÃ¥ kontrakt med lenke.",NVDB-6937,Datafangst,
Lukker objekt pÃ¥ nytt,"h2. Observasjon

Dette er rapportert fra bruker. NÃ¥r man registrerer en lukking til NVDB, blir det sendt et endringssett med operasjon Lukk pÃ¥ objektet. Hvis man deretter legger til flere objekter for lukking og trykker registrer, blir ogsÃ¥ fÃ¸rste lukking sendt med pÃ¥ nytt. GjÃ¸res dette pÃ¥ samme dag vil lukkedato stemme overens, men om siste operasjon gjÃ¸res en dag senere vil Skriv klage pÃ¥ at versjon til lukking allerede er lukket.

Dette er gjenskapt i kontrakt:Â [https://datafangst-test.kantega.no/#!/contract/01ee9be7-8331-40b2-8057-3219dee948a9/export]

Del av fÃ¸rste endringssett:Â [https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/89e5dec1-fce5-45ac-af8d-d070fcb64e37]
{noformat}
""lukk"": { ""vegobjekter"": [ { ""lukkedato"": ""2020-02-19"", ""kaskadelukking"": ""JA"", ""typeId"": 96, ""nvdbId"": 85757915, ""versjon"": 6 } ] }
{noformat}
Del av andre endringssett:Â [https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/fc4696c2-65c0-4b0b-ba71-68e78f8ee13f]
{noformat}
""lukk"": {Â Â Â Â ""vegobjekter"": [Â Â Â Â Â Â {Â Â Â Â Â Â Â Â ""lukkedato"": ""2020-02-19"",Â Â Â Â Â Â Â Â ""kaskadelukking"": ""JA"",Â Â Â Â Â Â Â Â ""typeId"": 96,Â Â Â Â Â Â Â Â ""nvdbId"": 85757912,Â Â Â Â Â Â Â Â ""versjon"": 6Â Â Â Â Â Â },Â Â Â Â Â Â {Â Â Â Â Â Â Â Â ""lukkedato"": ""2020-02-19"",Â Â Â Â Â Â Â Â ""kaskadelukking"": ""JA"",Â Â Â Â Â Â Â Â ""typeId"": 96,Â Â Â Â Â Â Â Â ""nvdbId"": 85757915,Â Â Â Â Â Â Â Â ""versjon"": 6Â Â Â Â Â Â }Â Â Â Â ]Â Â },
{noformat}
Opprinnelig problemkontrakt:Â [https://datafangst.kantega.no/#!/contract/a3f22d82-112d-460f-9ded-3d2985922512/export]

Â 

*Analyse og retting*

Lukkinger blir alltid hÃ¥ndtert som om de er ""endring"" i datafangst i dag. Dette stemte nok tidligere.

NÃ¥ legger vi dirty- og exporting-feltene til grunn nÃ¥r vi velger ut hvilke lukkinger som skal sendes inn.",NVDB-6937,Datafangst,
NVDBREF-447 Sjekk hvorfor objekt har tre vegsystemreferanser,"Det ser ut som de kunne vÃ¦rt slÃ¥tt sammen.

[https://nvdbapiles-v3.atlas.vegvesen.no/vegobjekter/49/91610807/2.json]

Â 

*Analyse*

De blir ikke slÃ¥tt sammen pÃ¥ grunn av ulike meterverdier. Det er ogsÃ¥ rare meterverdier, det er et ""ekstra"" segment som ser ut til Ã¥ gÃ¥ over hele spennet.Â Kryssdelen har 2 stedfestinger, 0.89-1 og 0-0.89. Et av segmentene fÃ¥r sluttposisjon 0.89, og da ble stedfestingen 0.89-1 valgt som gir 0 meter siden det er fÃ¸rste punkt i fÃ¸rste stedfesting. Den skulle valgt 0.89 pÃ¥ den andre stedfestingen som ville gitt lengden fra hele lenken.

FV86 S1D1 m134 KD1 m0-22

FV86 S1D1 m134 KD1 m22-94

FV86 S1D1 m134 KD1 m0-94

*LÃ¸sning*

La til en parameter til beregningen av meter som sier om det er start eller slutt som beregnes og ut fra det kan velge riktig stedfesting i tilfeller som dette.Â ",NVDB-6937,NVDB-IND,
Retry ved connection error,"{quote}
2020-02-19 08:34:48 [queuer] WARN  ProxyConnection - NVDB - Connection oracle.jdbc.driver.T4CConnection@7ff7f947 marked as broken because of SQLSTATE(08006), ErrorCode(17002)
java.sql.SQLRecoverableException: IO Error: Socket read interrupted
    at oracle.jdbc.driver.T4CStatement.executeForDescribe(T4CStatement.java:747)
    at oracle.jdbc.driver.OracleStatement.executeMaybeDescribe(OracleStatement.java:904)
    at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1082)
    at oracle.jdbc.driver.OracleStatement.executeQuery(OracleStatement.java:1276)
    at oracle.jdbc.driver.OracleStatementWrapper.executeQuery(OracleStatementWrapper.java:366)
    at com.zaxxer.hikari.pool.ProxyStatement.executeQuery(ProxyStatement.java:111)
    at com.zaxxer.hikari.pool.HikariProxyStatement.executeQuery(HikariProxyStatement.java)
    at no.vegvesen.nvdb.common.jdbc.dbix.DbSessionImpl.executeQuery(DbSessionImpl.java:185)
    at no.vegvesen.nvdb.common.jdbc.dbix.DbSessionImpl.rows(DbSessionImpl.java:129)
    at no.vegvesen.nvdbind.processor.AbstractBatchQueuer.doReadIds(AbstractBatchQueuer.java:59)
    at no.vegvesen.nvdbind.processor.AbstractBatchQueuer.doReadIds(AbstractBatchQueuer.java:51)
    at no.vegvesen.nvdbind.processor.AbstractBatchQueuer.start(AbstractBatchQueuer.java:45)
    at no.vegvesen.nvdb.threading.prw.Producer.run(Producer.java:25)
    at no.vegvesen.nvdb.threading.prw.Processor$Wrapper.run(Processor.java:282)
    at no.vegvesen.nvdb.threading.prw.Processor.run(Processor.java:71)
    at no.vegvesen.nvdbind.processor.feature.ThreadedFeatureReader.getFeatures(ThreadedFeatureReader.java:62)
    at no.vegvesen.nvdbind.processor.feature.ThreadedFeatureReader.getFeatures(ThreadedFeatureReader.java:33)
    at no.vegvesen.nvdbind.tasks.RebuildSectionCacheTask.run(RebuildSectionCacheTask.java:80)
    at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:199)
    at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:143)
    at no.vegvesen.nvdbind.tasks.DefaultTaskExecutionContext.execute(DefaultTaskExecutionContext.java:42)
    at no.vegvesen.nvdbind.tasks.RebuildCachesTask.run(RebuildCachesTask.java:60)
    at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:199)
    at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:143)
    at no.vegvesen.nvdbind.tasks.DefaultTaskExecutionContext.execute(DefaultTaskExecutionContext.java:42)
    at no.vegvesen.nvdbind.tasks.FullExportTask.run(FullExportTask.java:38)
    at no.vegvesen.nvdbind.tasks.TaskExecutor.execute(TaskExecutor.java:192)
    at no.vegvesen.nvdbind.tasks.TaskExecutor.start(TaskExecutor.java:112)
    at no.vegvesen.nvdbind.NvdbindCore$TaskExecutorThread.run(NvdbindCore.java:488)
Caused by: java.net.SocketTimeoutException: Socket read interrupted
    at oracle.net.nt.TimeoutSocketChannel.read(TimeoutSocketChannel.java:152)
    at oracle.net.ns.NIOHeader.readHeaderBuffer(NIOHeader.java:82)
    at oracle.net.ns.NIOPacket.readFromSocketChannel(NIOPacket.java:139)
    at oracle.net.ns.NIOPacket.readFromSocketCha
{quote}
{quote}
2020-02-18 17:50:22 [daemon] ERROR Dbix - HikariProxyConnection@1228298062 wrapping oracle.jdbc.driver.T4CConnection@18d062c1 closed: false, not valid: true threadLocalSession: null
no.vegvesen.nvdb.common.jdbc.dbix.ConnectionException: Connection closed or not valid
        at no.vegvesen.nvdb.common.jdbc.dbix.Dbix.checkConnection(Dbix.java:87)
        at no.vegvesen.nvdb.common.jdbc.dbix.Dbix.openSession(Dbix.java:59)
        at no.vegvesen.nvdb.common.jdbc.dbix.Dbix.openSession(Dbix.java:49)
        at no.vegvesen.nvdb.jdbc.NvdbImpl.getSysDate(NvdbImpl.java:47)
        at no.vegvesen.nvdbind.SyncService.getNewTransactions(SyncService.java:31)
        at no.vegvesen.nvdbind.daemon.UpdatePoller.getNewTransactions(UpdatePoller.java:115)
        at no.vegvesen.nvdbind.daemon.UpdatePoller.doPoll(UpdatePoller.java:92)
        at no.vegvesen.nvdbind.daemon.UpdatePoller.run(UpdatePoller.java:57)
        at no.vegvesen.nvdbind.daemon.NvdbindDaemon.daemonThread(NvdbindDaemon.java:94)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: Connection closed or not valid
        ... 14 common frames omitted
{quote}

Ved slike feil skal NVDBIND kunne fortsette ved Ã¥ prÃ¸ve pÃ¥ nytt med ny connection.",NVDB-6937,NVDB-IND,
NVDBREF-467: FÃ¥r bare valgt en veg i hvorutvalget,"Jeg Ã¸nsker Ã¥ fÃ¥ fram vegnett og vegobjekter for EV6 og EV8 i Balsfjord kommune.

Jeg velger fÃ¸rst Balsfjord kommune og sÃ¥ EV8, men nÃ¥r jeg skriver inn EV6 skjer det ingenting. Jeg fÃ¥r ikke EV6 opp.

Velger vegobjekt, f.eks. stedsnavn og jeg fÃ¥r bare opp stedsnavn pÃ¥ EV8 i Balsfjord kommune. Jeg Ã¸nsket i tillegg Ã¥ fÃ¥ opp stedsnavn for EV6, men dette lar seg ikke gjÃ¸re.",NVDB-6937,Vegkart,
KontraktsomrÃ¥de blir ikke oppdatert ved transaksjon,"{quote}
Hans JÃ¸rgen Ekker

I forbindelse med test av 4729 sÃ¥ ser det ut som jeg har innfÃ¸rt to gyldige versjoner av et KontraktsomrÃ¥de-objekt:
https://www.test.vegvesen.no/nvdb/api/v3/vegobjekter/580/600316727/12?dybde=full
og
https://www.test.vegvesen.no/nvdb/api/v3/vegobjekter/580/600316727/13?dybde=full

Men nÃ¥r jeg sÃ¸ker i basen sÃ¥ skal versjon 12 ha blitt lukket i transaksjon 4714595. (Samme transaksjon som opprettet versjon 13). Er det bare Les som er litt pÃ¥ etterskudd her?

Marvin Lillehaug

Tror det er noe som er feil, ikke pÃ¥ etterskudd. 
PÃ¥ grunn av at det ofte er veldig mange versjoner av kontraktsomrÃ¥der tror jeg det blir litt spesialhÃ¥ndtert. 
{quote}",NVDB-6937,NVDB-IND,
NVDBREF-471 Enkelte punktobjekter fÃ¥r linjegeometri,"Ved uttak av objekter med segmentert stedfesting fÃ¥r enkelte objekter linjegeometri i stedet for punktgeometri. Og til overmÃ¥l bestÃ¥r linjegeometrien av 2 identiske punkt.

Eksempel for Stedsnavn(343):

[https://www.test.vegvesen.no/nvdb/api/v3/vegobjekter/343?vegsystemreferanse=FV5198S1D10&inkluder=egenskaper,vegsegmenter,metadata]
<segment>
<veglenkesekvensid>1666565</veglenkesekvensid>
<startposisjon>1.4E-7</startposisjon>
<sluttposisjon>1.4E-7</sluttposisjon>
<lengde>0.0</lengde>
<veglenkeType>HOVED</veglenkeType>
<detaljnivÃ¥>Vegtrase</detaljnivÃ¥>
<typeVeg>Kanalisert veg</typeVeg>
<typeVeg_sosi>kanalisertVeg</typeVeg_sosi>
<startdato>2020-01-01</startdato>
<geometri>
<wkt>
*LINESTRING*Â Z(-30030.85 6727933.93 102.27, -30030.85 6727933.93 102.27)
</wkt>
<srid>6173</srid>
</geometri>
Â 
*LINESTRING burde ha vÃ¦rt POINT*",NVDB-6937,NVDB-IND,
Full gjennomgang av domene-klasser,"Vegkart har en domenemappe med klasser som representerer objekter i NVDB.

I mange tilfeller er det overlapp av klasser, og vanskeligheter med Ã¥ skille domeneklasser fra stateklasser. Noen domeneklasser er ikke i bruk lenger.

SÃ¥ det trengs en opprydding.",NVDB-6937,Vegkart,
NVDBREF-472 - FÃ¸lgeoppdatering avvises pga manglende sensitivrolle,"h2. Observasjon

Endringssettet https://www.test.vegvesen.no/nvdb/apiskrivbeta/kontrollpanel/#/jobs/view/94aabcd8-5b3c-49fb-9840-addaf15c5a31 avvises fordi brukeren ikke har rolle til Ã¥ manipulere sensitive egenskaper. Men det er en fÃ¸lgeoppdatering som ikke (?) endrer slike egenskaper som trigger avvisningen. Det virker litt strengt.

h2. Analyse

Det trigges oppdatering av eksisterende vegobjekter fordi deler av vegnettet lukkes. Et vegobjekt av type RÃ¸rledning berÃ¸res og dette har sensitive egenskaper. Bruker i dette tilfellet, hanekk, har ingen roller i LDAP som tillater oppdatering av slike egenskaper. I AttributeTypeAuthorizationFilter genereres *ikke* autorisasjonsfeil pÃ¥ ny versjon av rÃ¸rledningen, fordi der har alle egenskaper (unntatt stedfesting) operasjon READ. Men lukkingen av opprinnelig versjon har operasjon IMPLICIT pÃ¥ alle egenskaper og dermed smeller det...

h2. LÃ¸sning

Problemet lÃ¸ses ved Ã¥ ikke gjÃ¸re autorisasjonskontroll pÃ¥ vegobjekter med operasjon MODIFY:CLOSE, det er MODIFY:ADD vi er interessert i.",NVDB-6937,Skriv-API,
Gi tilgang til skjermede data fra Vegkart,"Vi Ã¸nsker Ã¥ gi brukere som har fÃ¥tt tildelt sensitive roller i LDAPÂ  tilgang til skjermede data i NVDB via Vegkart.

Â ",NVDB-6937,Vegkart,
Overgang til nytt hÃ¸ydesystem - fra NN 1954 til NN2000,"Alle Z-koordinater skal ved overgang til NN2000 regnes om ved scriptkjÃ¸ring - se NVDB klassisk sakÂ SVNK-470

Det er Ã¸nskelig Ã¥ fÃ¥ implementert denne endringen i produksjon i midten av mars. I forkant mÃ¥ det gjÃ¸res tilpasninger i NVDB API skriv og Datafangst, og vurdering av om det innebÃ¦rer noe mer enn reindeksering for NVDB api les v2 og v3.

Etter konvertering sÃ¥ vil ikke lengre Skriv godta innsending med NN54 (eller i alle fall SRID som indikerer dette). Datafangst i dag konverterer alle hÃ¸yder til NN54 fÃ¸r innsending. Vi mÃ¥ endre til at bruk av hÃ¸ydereferanse er konfigurerbar, slik at dette kan skrus om med en bryter nÃ¥r konvertering av NVDB er fullfÃ¸rt. I tillegg sÃ¥ mÃ¥ Datafangst endres til Ã¥ kunne konvertere fra NN54 til NN2000 fÃ¸r innsending, denne konverteringen finnes ikke i Datafangst i dag.",NVDB-6937,Datafangst,
NVDBIND sletter data fÃ¸r full reindeksering,Noe gjÃ¸r at schemacleanup kjÃ¸res ved sletting av eksportmappe.,NVDB-6937,NVDB-IND,
UniversalConnectionPoolException under behandling av endringssett,"h2. Observasjon

En del endringssett har havarert fordi det ikke er ledige connections mot databasene:

{code:java}
Exception occurred while getting connection: oracle.ucp.UniversalConnectionPoolException: All connections in the Universal Connection Pool are in use
	at oracle.ucp.util.UCPErrorHandler.newSQLException(UCPErrorHandler.java:456) ~[ucp.jar:12.2.0.1.0]
	at oracle.ucp.util.UCPErrorHandler.throwSQLException(UCPErrorHandler.java:133) ~[ucp.jar:12.2.0.1.0]
	at oracle.ucp.jdbc.PoolDataSourceImpl.getConnection(PoolDataSourceImpl.java:2013) ~[ucp.jar:12.2.0.1.0]
	at oracle.ucp.jdbc.PoolDataSourceImpl.access$500(PoolDataSourceImpl.java:198) ~[ucp.jar:12.2.0.1.0]
	at oracle.ucp.jdbc.PoolDataSourceImpl$30.build(PoolDataSourceImpl.java:4353) ~[ucp.jar:12.2.0.1.0]
	at oracle.ucp.jdbc.PoolDataSourceImpl.getConnection(PoolDataSourceImpl.java:1924) ~[ucp.jar:12.2.0.1.0]
	at oracle.ucp.jdbc.PoolDataSourceImpl.getConnection(PoolDataSourceImpl.java:1887) ~[ucp.jar:12.2.0.1.0]
	at oracle.ucp.jdbc.PoolDataSourceImpl.getConnection(PoolDataSourceImpl.java:1872) ~[ucp.jar:12.2.0.1.0]
	at no.vegvesen.vt.nvdb.apiskriv.database.WrappedOracleDataSource.getConnection(WrappedOracleDataSource.java:23) ~[na:na]
	at no.vegvesen.vt.nvdb.apiskriv.database.metric.MetricDataSource.getConnection(MetricDataSource.java:25) ~[na:na]
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.transactional(Jdbc.java:122) ~[nvdbapiskriv-jdbc-2020-1.4.jar:na]
{code}

Se ogsÃ¥ Splunk: https://loggsentralen.vegvesen.no/loggsentralen/en-GB/app/SVV_nvdb/search?q=search%20index%3Dsvvpnvdb%20host%3Dsvvptomcat25%20OR%20host%3Dsvvptomcat26%20%22Universal%20Connection%20Pool%22&display.page.search.mode=verbose&dispatch.sample_ratio=1&earliest=1579474800&latest=1581548400&sid=1581673723.382900_792DCE67-808E-4AE2-B026-0EE345D04AD5

h2. Analyse

Lengden pÃ¥ tx-skopet ved oppdatering av NVDB i sluttfasen av endringssettbehandling har blitt betydelig lengre i det siste, fordi bÃ¥de AreaLocations og transportlenker genereres *innenfor* transaksjonen for skriving til NVDB. Dette Ã¸ker risikoen for at connection-pool'en ikke har ledige koblinger i andre trÃ¥der.

h2. LÃ¸sning

Deler opp databasetransaksjonene mot NVDB i NvdbTransactionWriter i flere mindre transaksjoner der det er mulig.",NVDB-6937,Skriv-API,
Overgang til nytt hÃ¸ydesystem - fra NN 1954 til NN2000,"h2. Bakgrunn

Alle Z-koordinater skal ved overgang til NN2000 regnes om ved scriptkjÃ¸ring - se sakÂ https://jira.kantega.no/browse/SVNK-470

Det er Ã¸nskelig Ã¥ fÃ¥ implementert denne endringen i produksjon i midten av mars. I forkant mÃ¥ det gjÃ¸res tilpasninger i NVDB api skriv og Datafangst, og vurdering av om det innebÃ¦rer noe mer enn reindeksering for NVDB api les v2 og v3.

Hans Anton Ã…lien vil sÃ¸rge for retest av scriptet som endrer Z-koordinatene.

Se ogsÃ¥ sak for NVDB klassiskÂ https://jira.kantega.no/browse/SVNK-470Â sakÂ https://jira.kantega.no/browse/NVDB-5187Â for NVDB api Les og https://jira.kantega.no/browse/NVDB-5192Â for Datafangst

h2. Analyse

To eller tre enkle tiltak mÃ¥ gjÃ¸res i API Skriv:

1) Sett korrekte SRID-verdier i SpatialValue-klassen. Kodeutsnittet under viser dagens SRID-konstanter:

{code:java}
public static final int SRID_WGS84_UTM33N = 32633;
public static final int SRID_EUREF89_UTM33 = 25833;
public static final int SRID_EUREF89_UTM33_NN54 = 6173;
public static final int SRID_EUREF89_UTM33_NN2000 = 5973;

public static final int SRID_CHANGESET_DEFAULT = SRID_WGS84_UTM33N;
public static final int SRID_NVDB = SRID_EUREF89_UTM33;

public static final Set<Integer> SRIDS_COMPATIBLE_WITH_NVDB_SRID = asSet(SRID_WGS84_UTM33N, SRID_EUREF89_UTM33, SRID_EUREF89_UTM33_NN54);
{code}

a) SRID_NVDB mÃ¥ gis verdien av SRID_EUREF89_UTM33_NN2000
b) I SRIDS_COMPATIBLE_WITH_NVDB_SRID fjernes SRID_EUREF89_UTM33_NN54, mens SRID_EUREF89_UTM33_NN2000 legges til

2) Dersom et endringssett leveres med SRID 6173, mÃ¥ det avvises da det har ugyldig hÃ¸ydereferansesystem. Dette kan realiseres som en ny ValueConstraint.
Â 
3) I dag lagres geometrier fra API Skriv i NVDB med SRID 82347, som er Oracle sin mÃ¥te Ã¥ kode SRID 32633 pÃ¥. Om det skal endres pÃ¥ dette mÃ¥ konstanten ORACLE_SRID_NVDB i klassen SdoGeometry oppdateres. Besluttet i mÃ¸te 4/3: Bruker 82347 inntil videre. ",NVDB-6937,Skriv-API,
Overgang til nytt hÃ¸ydesystem - fra NN 1954 til NN2000,"Alle Z-koordinater skal ved overgang til NN2000 regnes om ved scriptkjÃ¸ring - se NVDB klassisk sakÂ https://jira.kantega.no/browse/SVNK-470

Det er Ã¸nskelig Ã¥ fÃ¥ implementert denne endringen i produksjon i midten av mars. I forkant mÃ¥ det gjÃ¸res tilpasninger i NVDB api skriv og Datafangst, og vurdering av om det innebÃ¦rer noe mer enn reindeksering for NVDB api les v2 og v3. https://jira.kantega.no/browse/NVDB-5188Â ogÂ https://jira.kantega.no/browse/NVDB-5192

Â 

Hans Anton Ã…lien vil sÃ¸rge for retest av scriptet som endrer Z-koordinatene.

Â ",NVDB-6937,Les-API,
Ã˜vrige veger - bÃ¥de som sekkepost og detaljert,"Fra demo 2020-02-12 ([https://www.vegvesen.no/wiki/display/NVDBogGeodata/Demo+NVDB+rapporter+2020-02-12])

Data for ""Ã˜vrige veger"" skal hÃ¥ndteres ulikt i genererte veglister fra flytene Arbeid og Produksjon:
 * *Arbeid*: vegliste genereres uten sekkepost.
Dvs full utlisting av alle veger som ellers ville inngÃ¥tt i sekkeposten.
Ã˜nske om at gatenavn fÃ¸yes til utlisting.
I excel (NVDBREF-375): Ny kolonne. PÃ¥ web tilfÃ¸yelse Gatenavn: <Oppramsing av Navn fra de gate-objektene i NVDB som overlapper med BK-objektet>


 * *Produksjon*: beholder dagens lÃ¸sning med sekkepost.",NVDB-6825,Rapportgenerator,
Filer pÃ¥ prosjekter med data mangler nabopunkt rensk,"Per idag sÃ¥ er det en feil pÃ¥ objekter som enda forÃ¥rsaker at data ikke blir lest inn til NVDB. Dette er nÃ¥ ""To eller flere nabopunkter i geometrien er mindre enn 0.001 meter fra hverandre"". Datafangst har idag lagt til rette for Ã¥ utfÃ¸re rensking nÃ¥r objekter ligger for nÃ¦re hverandre. Dette fungere kjempefint nÃ¥r jeg laster opp filer til nye datafangst.

Problemet ligger hos datafangst prosjekter som har filer opplaster fÃ¸r denne funksjonen ble implementert. NÃ¥r jeg redigerer en egenskap pÃ¥ vegopbjektene, sÃ¥ fÃ¥r jeg en notabene som et varsel om at her er det nabopunkter og datafangst har fjernet det. Men dette gjenspeiler seg ikke nÃ¥r en sender data inn til NVDB.

For at jeg skal fÃ¥ lese inn data pÃ¥ slike prosjekter, sÃ¥ bruker jeg Ã¥ opprette et nytt prosjekt og laster opp filene fra original prosjektet. PÃ¥ den mÃ¥ten fÃ¥r jeg fjernet nabopunktene.

Det jeg Ã¸nsker meg er en kanskje en knapp som ""oppfrisker"" geometrien i fil-menyen, uten at en laster fila opp pÃ¥ ny. Dette er jo fordi en ikke har lyst Ã¥ miste egenskapene som er lagt inn i etterkant av opplasting.",NVDB-6937,Datafangst,
Fil kontroll - TydeligjÃ¸re feil pÃ¥ NVDB objekter,"Kontroll funksjonen i Datafangst har et forbedringspotensial. Nylig har jeg oppdaget noen objekter som bli forkastet pga valideringsfeil. Her finnes det allerede en fin nedtrekksmeny som lister opp hvilke objekter som ble kastet ut og grunnen til dette.

Grunnen til at jeg melder om denne oppdagelsen, er at filen var allerede tilsynelatende ok. Jeg mÃ¥tte utfÃ¸re en rensk gjennom et GIS verktÃ¸y og eksportere ny fil som skulle bli klar til innlesing. Feilen som fÃ¸rte til valideringsfeil er ""Kun Ã©n av NÃ˜ eller NÃ˜H mÃ¥ oppgis"". I original filen, sÃ¥ er de samme objektene ogsÃ¥ merket med en feil, men dette kommer ikke tydelig frem noen sted. Her er feilen ""HÃ¸yde -2466526 er urimelig lav"".

Det jeg Ã¸nsker da er et eget filter som kan skille ut alle objektene med Type = feil. Dette gjÃ¸r det lettere for oss Ã¥ samle alt som mÃ¥ rettes opp og rapporte tilbake til entreprenÃ¸r.",NVDB-6937,Datafangst,
NVDBREF 462 - Ufullstendig vegsystemreferanse pÃ¥ en enkelt veglenke,"[En lenke pÃ¥ en rampe viser ufullstendig vegsystemreferanse, viser kun EV18, strekning eller delstrekning og meterverdier vises ikke.Â HansÂ JÃ¸rgenÂ harÂ sjekketÂ vegnettetÂ ogÂ detÂ serÂ rettÂ ut.Â ErÂ detÂ feilÂ vedÂ visningÂ iÂ VegkartÂ ellerÂ erÂ detÂ api'etÂ somÂ girÂ utÂ feilÂ verdi?|https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@235713,6639465,18/vegnett]

Â 

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@235713,6639465,18/vegnett]{color:#3d3c40}:(trafikantgruppe:'alle,veglenketype:'alle,adskiltelop:'alle){color}",NVDB-6937,Les-API,
Leveranseinformasjon Lese API V3 2020.3.0,"*Test i AT:*
 * NVDB-5036: MÃ¥ vente til sensitive roller er pÃ¥ plass + reindeksering av sensitive egenskaper er gjort. Testes senere.
 * NVDB-5095: Sjekk at feltet medium_nvdb blir gitt ut for geometrien til objekter
 * NVDB-5126: Sjekk Splunk ihht sakens beskrivelse

Saker som ikke er nevnt trenger ikke eksplisitt test i ATM.",NVDB-6937,Les-API,
"API Skriv lager ""hull"" i lokasjonsattributter for noen omrÃ¥detyper","h2. Observasjon

Klassiske klienter, for eksempel NVDB123 viser fortsatt flere omrÃ¥degrenser enn fylke og kommune. Derfor mÃ¥ denne mangelen fikses.

Fra beskrivelsen i: [https://www.vegvesen.no/jira/browse/NVDBREF-421] registrert 2020-01-20Â 

Det har dukket opp noen feil av type ""hull"" i lokasjonsattributt for omrÃ¥der etter vegnettsredigering. Det viser seg at dette ogsÃ¥ gjelder fylke 2019 og kommune 2019 (i fÃ¸rste omgang trodde vi det ikke var feil i disse.)

I Ã¸yeblikket er det snakk om disse lenkene:
||Featuretype||Featureid||FeatureStartpos||FeatureEndpos||Netelementid||startdate||enddate||fylkenr||kommunenr||vkat||vstov||vegnr||hp||frameter||tilmeter||Feilid||
|532|292207048|0.91751703|0.9814527|704696|2011.04.06|Â |4|0|F|V|201|4|7987|8484|2123639296|
|532|292207049|0.9814527|1.0|704696|2011.04.06|Â |4|0|F|V|201|4|8484|8626|2123639297|
|532|1006511990|0.04606171|0.5428323|2140603|2020.01.10|Â |4|37|P|V|97559|1|11|133|2123639298|
|532|361115726|0.76114295|1.0|2216339|2011.01.10|Â |7|16|P|V|97912|1|0|185|2123639299|
|532|330044257|0.0|0.04606171|2140603|2009.07.01|Â |4|37|P|V|97559|1|0|11|2123639300|

Det siste eksemplet, lenkesekvens 2140603 ble lest inn i NVDB i dag ettermiddag:

[https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/deea8f87-c2e7-447e-8869-26936ce69c03]

Oversikt over lokasjonsattributt for omrÃ¥der for nettelement med id 2140603

FT_ID F_ID V_ID N_ID STARTDIST ENDDIST
 ---------- ---------- ----- ---------- ---------- ----------
 946 1002101499 1 2140603 0 .04606171
 945 1006202690 1 2140603 0 1
 946 1002101498 1 2140603 .04606171 1
 534 1 1 2140603 .5428323 1
 535 5 1 2140603 .5428323 1
 536 84 1 2140603 .5428323 1
 537 459 1 2140603 .5428323 1
 579 488 1 2140603 .5428323 1

OmrÃ¥detype 534, 535, 536, 537 og 579 mÃ¥ ogsÃ¥ oppdateres i areaLocations.

Mangler i prod rettes jevnlig med script. Nye mangler avdekkes gjennom de nattlige datakontrollene.Â 

h2. Analyse

Ser pÃ¥ endringssettet angitt over, og spesielt pÃ¥ AreaLocations som genereres fra veglenkesekvens 2140603. Denne ligger tilsynelatende i Tynset kommune, tett opp mot (og toucher) kommunegrensen til Alvdal: https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/hva:(~(farge:'0_0,id:536))/@273842,6906127,16/vegnett:(trafikantgruppe:'alle,veglenketype:'alle,adskiltelop:'alle)/vegobjekt:85:40a744:536.

Veglenkesekvensen har tre veglenker fordelt pÃ¥ posisjonsintervallene 0.0 - 0.04606171, 0.04606171 - 0.5428323, 0.5428323 - 1.0. FÃ¸rstnevnte har angitt kommunenr 3428 (Alvdal), de to siste har kommunenr 3427 (Tynset). AreaLocations for Kommune (946) fordeles derfor tilsvarende. Hullene oppstÃ¥r nÃ¥r det skal genereres AreaLocations for Kommune_2019 (536). Dette skjer i AreaLocationHarvester ved Ã¥ matche veglenkegeometrien mot geometrien (polygonet) til Kommune_2019-objektene ""i nÃ¦rheten"". Det gjÃ¸res et sÃ¸k direkte i vegobjekttabellen for Kommune_2019 i NVDB ved hjelp av spesielle geometrioperatorer. Dette finner kommunene som overlapper veglenkesekvensen. NÃ¸yaktig hvilke kommuner og hvor stor del av veglenkesekvensen som hÃ¸rer hjemme i de ulike kommunene beregnes programmatisk etterpÃ¥. For veglenkesekvens 2140603 finner imidlertid geometrisÃ¸ket bare overlapp med Tynset kommune, antagelig fordi geometrien til veglenke 1 stryker langs kommunegrensen mellom Tynset og Alvdal. NÃ¥r posisjonsintervallene beregnes med stor nÃ¸yaktighet etterpÃ¥ tilordnes bare veglenke 2 og 3 Tynset, mens veglenke 1 utelates siden den ikke matcher med Tynset.

Ã˜vrige innslag i AreaLocations for Fylke_2019, Region, Politidistrikt og Vegavdeling blir alle avledet fra de beregnede Kommune_2019-innslagene. NÃ¥r det er hull for sistnevnte vil det forplante seg til disse.

h2. LÃ¸sning

Ved geometrisÃ¸k etter overlappende kommuneobjekter, utvides geometrien til veglenkesekvensen med et ""buffer"" pÃ¥ 5 m for Ã¥ sikre at nabokommuner tas med nÃ¥r vegnettsgeometrien toucher kommunegrenser. I dette tilfellet fÃ¸rer dette til at bÃ¥de Tynset og Alvdal fÃ¥r treff og posisjonsintervallene for de to kommunene beregnes deretter slik:

Alvdal: 0.0 - 0.04584709
Tynset: 0.04584709 - 1.0

Skillet mellom kommunene (posisjon 0.04584709) avviker med ca 5 cm sammenlignet med kommunenummereringen pÃ¥ veglenkene (0.04606171). Dette skyldes at noden mellom veglenke 1 og 2 ikke er plassert 100% nÃ¸yaktig pÃ¥ kommunegrensen.
",NVDB-6937,Skriv-API,
NVDBREF - 459 Operator-feil ved filterering av vegobjekter,"Jeg velger EV8 og Skred og fÃ¥r opp at det er 38 vegobjekter. Skriver ut til CSV.
 Jeg Ã¸nsker Ã¥ filtrere sÃ¸keresultatet mitt. FÃ¸rst pÃ¥ type skred, Velger ""=SnÃ¸"", fÃ¥r ingen treff. Dette er feil da det er mange snÃ¸skred i CSV-lista. Velger sÃ¥ ""!=SnÃ¸"", skriver ut resultatet til CSV og fÃ¥r da ut alle skredtyper som ikke er SnÃ¸, dette resultatet er riktig. Velger sÃ¥ ""har verdi"" og fÃ¥r ingen treff, til tross for at alle skredene har verdi for ""Type skred"".

[https://www.utv.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@656092,7713661,8/hva:~(~]
 (filter~(~(operator~'*21*3d~type_id~2326~verdi~null))~id~445))/hvor:~(vegsystemreferanse~(~'EV8))

Filtrerer pÃ¥ ""Blokkert veglengde"". FÃ¥r ikke opp noen resultat nÃ¥r operator er ""="", men nÃ¥r jeg velger ""!="" fÃ¥r jeg opp resultater. 
 Antall objekter ser ut til Ã¥ vÃ¦re 38 for alle valg som gir treff.",NVDB-6937,Vegkart,
NVDBREF - 458 - Vegkart viser feil antall forekomster ved kategorisering,,NVDB-6937,Vegkart,
Mobilvisning: Blank boks legger seg over kartet,"h2. Observasjon

PÃ¥ mobil (iPhone8 / Chrome) sÃ¸ker jeg etter tunneller. Tar opp panel. Da fÃ¥r jeg vedlagt bilde 1. En blank boks ligger under sÃ¸keresultatet. Velger jeg fÃ¸rste treff i lista, for deretter Ã¥ trykke pÃ¥ tunnellÃ¸p-datter sÃ¥ ser jeg mye ekstra space under relasjoner (bilde 2).

Men hovedproblemet kommer nÃ¥r jeg fjerner tunnel fra sÃ¸ket. Da legger det seg en blank boks over hele siden uten mulighet til Ã¥ komme unna (bilde 3).",NVDB-6937,Vegkart,
NVDBIND kan konfigureres fra Forvaltning,,NVDB-6937,NVDB-IND,
"ORA-00936: missing expression, relasjonsspÃ¸rring","{quote}
Slf4jActivityLogger: Feil i transaksjon 2b07888f-4895-1453-367a-74d225dddd79:
Uventet feil for URL: http://www.vegvesen.no/nvdb/api/v3/vegobjekter/95/statistikk?segmentering=true&kartutsnitt=-445917.7345639113%2C6416283.581025881%2C856943.5945639112%2C6896992.37897412&egenskap=area%28945%2C30%29%20AND%20egenskap=relasjon%2896%2C%20egenskap%285530%29=null%29&alle_versjoner=false
java.sql.SQLSyntaxErrorException: ORA-00936: missing expression
{quote}
{quote}
Slf4jActivityLogger: Feil i transaksjon 2a45f29d-1e1c-dc3e-a9ef-9a4cb5dc71db:
Uventet feil for URL: http://www.vegvesen.no/nvdb/api/v3/vegobjekter/95/statistikk?segmentering=true&kartutsnitt=-445917.7345639113%2C6416283.581025881%2C856943.5945639112%2C6896992.37897412&egenskap=area%28945%2C30%29%20AND%20egenskap=relasjon%2896%2C%20egenskap%285530%29=null%29&alle_versjoner=false
java.sql.SQLSyntaxErrorException: ORA-00936: missing expression
{quote}",NVDB-6937,Les-API,
GrÃ¥tonekart i datafanen,"Det er et Ã¸nske om Ã¥ tilby et grÃ¥tonekart i datafenen. Ref Vegkart som i dag tilbyr visning pÃ¥ et grÃ¥tonekart.
h2. LÃ¸sning

GrÃ¥tonekart er implementert som en toggle, som ligger ved siden av kartlag-velgeren.
GrÃ¥tonekartet er et filter som skal fungere pÃ¥ alle kartlagene",NVDB-6937,Datafangst,
Vise hvilken lÃ¥s som hindrer registrering ved VENTER_PÃ…_LÃ…S status,"NÃ¥r brukere fÃ¥r status VENTER og Ã¥rsak VENTER_PÃ…_LÃ…S fra API Skriv sÃ¥ er det en liten prosess Ã¥ gÃ¥ gjennom Kontrollpanel hos Skriv for Ã¥ se hvilken lÃ¥s som blokkerer denne registreringen.

Dette kunne vÃ¦rt lÃ¸st ved at Datafangst henter opp blokkerende lÃ¥s og gir informasjon om denne til brukeren i eksportfanen. F.ex kallet

[https://www.test.vegvesen.no/nvdb/apiskriv/kontrollpanel/data/lock?max=10&skip=0&sortBy=TIME&sortAscending=true&blockingJobId=0cb46176-d924-4135-900d-84d2454c3135]

Brukes av API Skriv for Ã¥ vise blokkerende lÃ¥ser for et gitt endringssett. Lenke over gir info
{noformat}
{""count"":1,""locks"":[{""lockId"":16362410,""username"":""lillir"",""fullName"":""Lillian RÃ¸ang"",""created"":""2020-01-09T12:57:00Z"",""type"":""NORMAL"",""networkLock"":true,""featureTypes"":""Feltstrekning, Vegsystem, Strekning + 11 til"",""refLinks"":""0.0-1.0@1004310, 0.0-1.0@1060089, 0.0-1.0@1036423 + 144 til""}]}
{noformat}",NVDB-6937,Datafangst,
Re-stedfesting av datter ved re-stedfesting av mor,"Ved restedfesting av mor (bÃ¥de nytt objekt og eksisterende NVDB objekt) - enten som manuell endring av stedfesting eller ved geometriendring som trigger re-stedfesting - bÃ¸r ogsÃ¥ datter/dÃ¸tre fÃ¥ oppdaterte sine stedfestinger.

Dette kan skje automatisk med en liten beskjed til bruker, eller som et valg der bruker kan velge bort Ã¥ re-stedfeste datter/dÃ¸tre.

Dette scenarioet har kommet fra en bruker pÃ¥ support.",NVDB-6937,Datafangst,
Fjern stÃ¸tte for responsrevisjon 0,"Finn oversikt over hvem som fortsatt ikke har tatt i bruk rev1 og be dem migrere.

Splunk for februar viser at det er
 * Vegkart (ny versjon i ATM benytter revisjon 1)
 * NVDB2TNE
 * Sweco

som benytter revisjon 0
{noformat}
https://loggsentralen.vegvesen.no/loggsentralen/en-US/app/SVV_nvdbapil/search?q=search%20host%3Dsvvpnvdb*%20AND%20(source%3D*api-v3-request.log%20OR%20sourcetype%3Dnvdbapil-api-v3-request%3ANA-log)%20AND%20%22application%2Fvnd.vegvesen.nvdb-v3-rev0%2Bjson%22%20%20%7C%20stats%20count%20by%20ACCEPT%2C%20CLIENT&display.page.search.mode=fast&dispatch.sample_ratio=1&earliest=1580511600&latest=1583017200&display.page.search.tab=statistics&display.general.type=statistics&display.statistics.sortColumn=count&display.statistics.sortDirection=desc&sid=1583246329.124186_792DCE67-808E-4AE2-B026-0EE345D04AD5 
{noformat}
Se vedlagt bilde.",NVDB-6937,Les-API,
HTTP 500 ved henting av endringssett,"h2. Observasjon

[https://www.vegvesen.no/nvdb/apiskriv/rest/v3/endringssett/2e347a69-7734-41f0-a12b-df2cb1beb81f]

gir HTTP 500 med
{noformat}
{""message"":[""Illegal attribute subclass: no.vegvesen.vt.nvdb.apiskriv.domain.attribute.SpatialStructAttribute""]}
{noformat}
Vedlagt er endringssett som forÃ¥rsaket dette.

h2. Analyse

Exception kastes fra AttributeTransforms.fromPartialAttribute fordi det mangler en switch-case for delvis egenskap av type SpatialStructAttribute.

h2. LÃ¸sning

Oppdaterer AttributeTransforms.fromPartialAttribute med case for SpatialStructAttribute som delegerer til ny metode fromPartialSpatialStructAttribute.",NVDB-6937,Skriv-API,
Egengeometri blir normalisert basert pÃ¥ datakatalogen.,"Noen klager pÃ¥ at de fÃ¥r skrevet multilinestring og ikke fÃ¥r det ut igjen.

{quote}
Sender nytt objekt i endringssett med MULITILINESTRING som egengeometri. NÃ¥r jeg leser inn dette objektet igjen via les, fÃ¥r jeg tilbake LINESTRING bestÃ¥ende av fÃ¸rste linje i innsendt MULTILINESTRING.
Se fÃ¸lgende endringssett (test.vegvesen.no)

Endringssett: c5b7b0fe-49df-41d5-941f-b1831e4d09f9

Objektet hentet tilbake via les:
https://www.test.vegvesen.no/nvdb/api/v3/vegobjekter/470/1006280077/1
{quote}

Dette skjer i OracleFeatureReader.normalizeGeometry",NVDB-6937,NVDB-IND,
Ukjent parameter: typeveg veglenkesekvenser?typeveg=enkelBilveg,"https://www.vegvesen.no/nvdb/api/v3/vegnett/veglenkesekvenser.json?typeveg=enkelBilveg gir 
{code:json}
[
   {
       ""code"": 4013,
       ""message"": ""Ukjent parameter: typeveg"",
       ""help_url"": ""https://nvdbapilesv3.docs.apiary.io/#/reference/0/vegnett""
   }
]
{code}",NVDB-6937,Les-API,
Sette geometri for objekter,"*Problem*

Flere brukere har problemer med nÃ¸yaktighet nÃ¥r de skal endre et objekts geometri med dagens ""rediger geometri"" funksjon. I tillegg vil en ikke helt nÃ¸yaktig geometri gi ulik stedfesting om et objekt skal sammenkobles med et annet objekt, f.ex ved Ã¥ bytte et objekt med et annet.

*Mulige alternativ*
 * Gi brukerne mulighet for Ã¥ lime inn en geometri (type wkt-streng) for et valgt objekt
 * Kopiere en geometri fra et eksisterende objekt (enten NVDB-objekter som er importert i kontrakten eller gjennom en kopieringsknapp i modalen for vsining av NVDB-objekter i kartet). Denne funksjonen kunne blitt utfÃ¸rt pÃ¥ alle valgte objekter - evt bare kopiere til clipboard for videre Ã¥ lime inn for enkeltobjekter.

LÃ¸sningsalternativ bÃ¸r diskuteres litt nÃ¦rmere.

*Melding fra bruker*
{noformat}
Det blir en del tilfeller av at eksisterende objekt i NVDB flyttes pÃ¥ eller mÃ¥les inn fra Ã¥ ikke ha vÃ¦rt mÃ¥lt tidligere. Manga av disse tilfellene ville det ha vÃ¦rt en stor fordel Ã¥ kunne beholde eksisterende NVDB-id da den kan vÃ¦r koblet mot andre systemer eller lignende. Quick fix pÃ¥ det problemet kunne ha vÃ¦rt Ã¥ ha mulighet for Ã¥ kopiere med seg egengeometrien med Kvalitetsparametrene og sÃ¥ ha mulighet til Ã¥ lime de inn pÃ¥ eksisterende. Ses dette pÃ¥ som en mulighet det skal jobbes mot frem i tid?
{noformat}
Â 
{noformat}
Det beste hadde vÃ¦rt om det var mulighet for Ã¥ massivt koble ny geometri(enten fra Sinus eller SOSI-filer) til nÃ¦rmeste eksisterende objekter som ligger i NVDB fra fÃ¸r, innenfor samme objekttype som i sosi-fila selvsagt. Litt som stedfestinga funker i dag f.eks. Bruken av dette ville ha vÃ¦rt veldig bra for de tilfellene jeg nevner under, og for Ã¥ skifte ut objekter koblet direkte pÃ¥ vegreferanse med egengeometri fra FKB-data eller annet som mÃ¥les inn nytt uten Ã¥ ha koblet til data fra NVDB gjennom innmÃ¥lingslÃ¸sning.
{noformat}",NVDB-6937,Datafangst,
NVDBREF- 447 TrafikkÃ¸y-CSV-fil det listes opp for mange objekter i fila,"Jeg Zoomer meg inn til fÃ¸rste rundkjÃ¸ring pÃ¥ FV86, ca. FV86 S1D1 m130.
 SÃ¸ker opp trafikkÃ¸y og fÃ¥r tegnet 3 objekter i kartet.

[https://www.utv.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@639341,7665314,18/hva:~(~(id~49]))

Trykker pÃ¥ "">"" for Ã¥ se vegsystemreferansene til disse trafikkÃ¸yene, og her kommer det opp 5 referanser. Jeg laster ned CSV-fil og legger denne med her.

Her ser det ut til at det er 3 sentralÃ¸yer til rundkjÃ¸ringa, men det er bare 1. Dette bÃ¸r rettes opp.",NVDB-6937,Vegkart,
Azerbaijan / Georgia,"Observasjon

Kartet vbil i enkelte tilfeller lastes feil og vise bare grÃ¥ tiles, bortsett fra Azerbaijan eller Georgia oppe i hjÃ¸rnet.

Analyse
 * Gjenskapbart ved veldig bredt vindu
 * Georgia ved moderat bredt, Azerbaijan ved bredere
 * Ved brede vinduer vil ogsÃ¥ kartet vise mye udefinert kart ved default zoomnivÃ¥
 * Symptomene dempes ved Ã¥ justere default zoom-nivÃ¥ ett hakk.

LÃ¸sning

justerer default zoom-nivÃ¥

Â ",NVDB-6937,Datafangst,
Oppdatere info-boksen Vegkart v2,"Forslag til tekst i info-boks for Vegkart v2:

{color:#0747a6}*Vegkart med gammelt vegreferansesystem*{color}

{color:#0747a6}Denne versjonen av Vegkart baserer seg pÃ¥ gammelt vegrefeansesystem og forholder seg ogsÃ¥ til kommune- og fylkestrukturen fra 2019 og vil senest bli faset ut 1/8-2021.{color}

{color:#0747a6}Ny versjon av Vegkart med nytt referansesystem finnes her:{color}

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@600000,7225000,3]Â 

Â ",NVDB-6937,Vegkart,
Hoppende meter,"{quote}VÃ¥r leverandÃ¸r Viatech har funnet en snÃ¥l feil i spÃ¸rringer mot veg/ endepunktet pÃ¥ veglenkesekvens 2497857, som har snudd metrering pÃ¥ hele veglenkesekvensen . Meterverdiene ""skifter retning"", dvs teller fÃ¸rst nedover (riktig), og deretter oppover (galt) nÃ¥r du ber om posisjoner fra 0 til 1.

0.0@2497857 -> EV136 S5D1 m4305
 0.1@2497857 -> EV136 S5D1 m4375
 0.2@2497857 -> EV136 S5D1 m3748
 0.3@2497857 -> EV136 S5D1 m3818
 0.4@2497857 -> EV136 S5D1 m3887
 0.5@2497857 -> EV136 S5D1 m3957
 0.6@2497857 -> EV136 S5D1 m4027
 0.7@2497857 -> EV136 S5D1 m4096
 0.8@2497857 -> EV136 S5D1 m4166
 0.9@2497857 -> EV136 S5D1 m4235
 1.0@2497857 -> EV136 S5D1 m4305

Denne veglenkesekvensen har to veglenker, fra 0 til ca 0.13, og fra 0.13-1. Jeg ser ingenting rart eller mystisk pÃ¥ disse, men utelukker ikke at det er noe snÃ¥lt jeg overser.

Ut fra litt klikking pÃ¥ Vegkart v3 i UTV - miljÃ¸et sÃ¥ klarer jeg lett gjenskape problemet med synkende, deretter stigende meterverdier langs E136 i dette omrÃ¥det
 [https://www.utv.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@110664,6959636,16]
 SÃ¥ det ser dessverre ut som om dette ikke er en feil som er retta i kommende versjoner (ennÃ¥)...
{quote}
Â 

Tillegg

----------Â 

Det er hoppende meter langs stedfesting av rekkverk ogsÃ¥.Â Det var en sak pÃ¥ dette tidligere hvor meterverdier hoppet i sak NVDB-4986.

Se vedlegg feilmeter_1-3.png .Â  Â  Â 

Lenke til visning i vegkart:Â  [https://vegkart-v3.atlas.vegvesen.no/#kartlag:geodata/vegsystemreferanse:157078.14748962832:6533374.608415884/hva:(~(farge:'0_0,id:5))/hvor:(vegsystemreferanse:(~'EV18S20-21))/@158329,6533722,12/vegobjekt:218329497:40a744:5]Â .Â 

Â 

Â 

Tillegg 2:

--------------

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/vegsystemreferanse:248855.45432158827:6622518.368734654/@248389,6622785,13/vegnett:(trafikantgruppe:'alle,veglenketype:'alle,adskiltelop:'alle)]

Se vedlegg tillegg2_feilmeter1-4.pngÂ 

Â 

Â 

Â 

Â 

Â 

Â 

Â ",NVDB-6937,Les-API,
RunTimeException ved beregning av sideposisjon,"h2. Observasjon

Endringssettet https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/1df5e245-70dc-4468-a7fb-85fb2176f987 havner i SYSTEMFEIL i sluttfasen av restedfesting av vegobjekter pga oppdatert vegnettsgeometri:

{code:java}
java.lang.RuntimeException: No line segment found for refLinkPosition 1.0
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.lambda$lineSegmentFromPosition$4(SidePositionCalculator.java:146)
	at java.util.Optional.orElseThrow(Optional.java:290)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.lineSegmentFromPosition(SidePositionCalculator.java:146)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.calculateSidePositionForPointLocational(SidePositionCalculator.java:106)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.calculateSidePosition(SidePositionCalculator.java:94)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.compareSidePositions(SidePositionCalculator.java:80)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.SidePositionCalculator.compareUpdatedSidePositionToOld(SidePositionCalculator.java:50)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.compareUpdatedSidePositionToOld(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:497)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.lambda$addEnrichmentOrReportConflict$10(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:443)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.EnrichmentEvaluator.evaluate(EnrichmentEvaluator.java:115)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.addEnrichmentOrReportConflict(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:487)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.doFilter(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:153)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:107)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:122)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$13(JobWorker.java:389)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$validateBeforeLock$14(JobWorker.java:388)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:387)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:163)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

SidePositionCalculator forsÃ¸ker Ã¥ finne linjesegmentet av en veglenkegeometri som en relativ posisjon tilhÃ¸rer. Algoritmen i RefLinkPart.getLineSegmentAtPosition finner ikke et slikt linjesegment for posisjon 1.0, selv om veglenken dekker denne posisjonen. Ã…rsaken er mangel pÃ¥ numerisk presisjon ved summering av linjesegmentlengder.

h2. LÃ¸sning

Bruker en DoubleComparator som tillater avvik noen brÃ¸kdels millimetere ved sammenligning av lengder.",NVDB-6937,Skriv-API,
Datafane: FÃ¥r ikke satt lengde for rÃ¸rledning og kabel,"Observasjon

Last inn vedlagte SOSI. Disse har ikke egenskapen lengde satt, s.a. beskrivende navn beregner lengde. PrÃ¸v Ã¥ sette lengde i egenskapen ""Lengde"" (vis alle egenskaper fÃ¸rst). Da fÃ¥r du satt lengde med heltall, men ikke som desimaltall. API Les oppgir at denne egenskapen er Flyttall:

[https://www.utv.vegvesen.no/nvdb/api/v3/vegobjekttyper/77.json]
{code:java}
{
""id"": 1322,
""navn"": ""Lengde"",
""kortnavn"": ""leng"",
""beskrivelse"": ""Angir lengde av vegobjektet"",
""kategori"": 23,
""egenskapstype"": ""Flyttall"",
""datatype"": ""Tall"",
""sensitivitet"": 0,
""sorteringsnummer"": 18,
""veiledning"": ""Kan beregnes av egengeometri (linje/kurve). Skal angis manuelt om manglende/mangelfull egengeometri"",
""viktighet"": ""BETINGET"",
""sosinvdbnavn"": ""Lengde_1322"",
""skrivebeskyttet"": false,
""nÃ¸yaktighetskrav_grunnriss"": 0,
""hÃ¸ydereferanse_tall"": 0,
""nÃ¸yaktighetskrav_hÃ¸yde"": 0,
""referansegeometri_tilstrekkelig"": false,
""avledet"": false,
""obligatorisk_verdi"": false,
""gruppesorteringsnummer"": 0,
""lengdeavhengig_verdi"": false,
""ajourhold_snu"": false,
""standardverdi"": 0,
""min_anbefalt"": 0,
""maks_anbefalt"": 3000,
""min"": 0,
""maks"": 9999.9,
""desimaler"": 1,
""feltlengde"": 6,
""enhet"": {
""id"": 1,
""navn"": ""Meter"",
""kortnavn"": ""m""
},
""fortegnsendring_snu"": false
},
{code}",NVDB-6937,Datafangst,
Ratelimit V3,https://resilience4j.readme.io/docs/ratelimiter,NVDB-6937,Les-API,
Ratelimit V2,https://resilience4j.readme.io/docs/ratelimiter,NVDB-6937,Les-API,
SÃ¸k pÃ¥ vegobjekt med dybde>=2 gir ukomplette relasjoner,"Ved sÃ¸k pÃ¥ vegobjekt med dybde>=2 fÃ¥r man ut full beskrivelse pÃ¥ noen av relasjonene, men ikke pÃ¥ andre.

Eksempel:Â [https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/67/85346775/5?inkludergeometri=utledet&dybde=2&inkluder=alle]

Under relasjonen ""BetongutstÃ¸pning"" fÃ¥r jeg full informasjon om ett av vegobjektene, men ikke det andre. Se vedlagt bilde.

Vegobjekt jeg ikke fÃ¥r full informasjon om: [https://nvdbapiles-v3.utv.atlas.vegvesen.no/vegobjekter/71/85347379/1?inkluder=alle]",NVDB-6937,Les-API,
StÃ¸tt import av vegobjekter med Les API v2,"Brukere har gamle lagrede URL'er med Les API v2, sÃ¥ vi mÃ¥ stÃ¸tte v2 i tillegg til v3",NVDB-6937,Datafangst,
"Assosierte egenskaper fÃ¥r alltid ""undefined"" i visning av valgt objekt.","PÃ¥ tide Ã¥ gjÃ¸re noe med disse?

[https://vegkart-v3.utv.atlas.vegvesen.no/#kartlag:geodata/@275971,7041297,13/hva:~(~(id~67))/valgt:85346775:67]",NVDB-6937,Vegkart,
Datakontroll - unike sekvensnumre for streknings-objekter,"JÃ¸rn Vidar oppdaget et tilfelle hvor en privat veg har to tilfeller av samme sekvensnummer innenfor samme strekning. Vi Ã¸nsker i fÃ¸rste omgang Ã¥ se omfanget av dette problemet, og om nÃ¸dvendig lage et datakontroll-script som holder oversikten over tid.",,Database,
Logg innkommende request (V2),NÃ¥ logges kun fullfÃ¸rte requester. Logg innkommende requester til requestlogg.,NVDB-6937,Les-API,
Logg innkommende request (V3),NÃ¥ logges kunn fullfÃ¸rte requester. Logg innkommende requester til requestlogg.,NVDB-6937,Les-API,
Vegobjekt uten geometristruktur i sÃ¸k,"Datafangst har fÃ¥tt feilmelding fra bruker om en API-import som feiler, med denne URL'en: [https://www.vegvesen.no/nvdb/api/v3/vegobjekter/49.json?segmentering=true&vegsystemreferanse=F&egenskap=(area(945%2C34))%20AND%20(10768%3D17447)&inkluder=lokasjon%2Cmetadata%2Cegenskaper%2Cgeometri]

NÃ¥r jeg ser pÃ¥ dataene jeg fÃ¥r ser jeg at vegobjekt med ID 88357242 mangler ""geometri"" pÃ¥ toppnivÃ¥, og det er derfor Datafangst gir feil. NÃ¥r jeg gÃ¥r direkte pÃ¥ objektet ([https://www.vegvesen.no/nvdb/api/v3/vegobjekter/49/88357242/2.json]) fÃ¥r jeg ut geometri, og noen av dataene for stedfesting virker mer fornuftige (lengde ""0"" i sÃ¸k, mens lengde er satt nÃ¥r jeg fÃ¥r direkte pÃ¥ vegobjekt).

Â 

Ekstra info:

- ObjektetÂ 88357242 har ikke egengeometri som de andre objektene som kommer opp i sÃ¸ket.

- I utlisting fra sÃ¸ket ser det ut som alle objektene ikke har egengeometri, men hvis man gÃ¥r inn pÃ¥ objektene har de fleste egengeometri (bortsett fra den over)",NVDB-6937,Les-API,
Leveranseinformasjon Datafangst 2020-1.0.4,"h2. Leveranseinformasjon Datafangst 2020-1.0.4

*Test i AT*
 * NVDB-5119: Retting pÃ¥ innsending av korrigerte NVDB-objekter. Testes ved Ã¥ sende inn et korrigert NVDB-objekt. Kan ogsÃ¥ teste innsending av et nytt barn som kobles til en eksisterende NVDB-mor.

Det er kun nevnte sak som ligger i denne leveransen.",NVDB-6937,Datafangst,
Kobling til mor i NVDB bÃ¸r sendes inn som UPDATE,"Fra NVDB-5119: NÃ¥r vi sender inn en kobling til mor i NVDB, er dette er endring utover det som bÃ¸r vÃ¦re pÃ¥ korrigÃ©r. Mor bÃ¸r ha operasjon ""oppdater"" i dette tilfellet. 
Dette kan vi sette selv nÃ¥r vi henter mÃ¸dre fra NVDB.",NVDB-6937,Datafangst,
Korrigering setter ny gyldighetsdato,"h2. Observasjon

En bruker har nye barn som kobles til NVDB-mor. Ved registrering sender DF inn overskrivende oppdatering = JA. Dette betyr korrigering. Samtidig sendes ogsÃ¥ ny gyldighetsdato inn. Det skal ikke en korrigering av egenskaper og assosiasjoner (her) ha. **MEN** det hadde vÃ¦rt riktigst Ã¥ lage en ny versjon av mor nÃ¥r mor fÃ¥r nye barn. Da burde ikke overskrivende oppdatering = JA vÃ¦re med.

Kontrakt i DF:Â [https://datafangst.kantega.no/#!/contract/2e3e39c6-6d9a-4ab7-aa48-dc95d9072f4b/export]

Endringssett i Skriv:Â [https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/df5e44f9-05e7-40fd-aa18-fc09389eea39]

Aktuell del fra endringssettet:
{noformat}
{""delvisOppdater"": { ""vegobjekter"": [ { ""gyldighetsperiode"": { ""startdato"": ""2020-01-30"" }, ""validering"": { ""lestFraNvdb"": ""2020-01-30T16:23:44.447"" }, ""typeId"": 57, ""nvdbId"": 846434436, ""versjon"": 3, ""overskriv"": ""JA"", ""egenskaper"": [ { ""typeId"": 11055, ""verdi"": [ ""Driftskontrakt"" ], ""operasjon"": ""oppdater"" } ], ""assosiasjoner"": [ { ""typeId"": 220122, ""tempId"": [ ""bacc5216-5ffe-49b9-af4e-ca67bf5d6e20"", ""8a521621-aaaa-4538-af82-0823d8d5b769"", ""172880c2-3c9d-47e8-bb0f-51ca3c78555e"" ], ""nvdbId"": [], ""operasjon"": ""oppdater"" } ] }, { ""gyldighetsperiode"": { ""startdato"": ""2020-01-30"" }, ""validering"": { ""lestFraNvdb"": ""2020-01-30T16:23:44.698"" }, ""typeId"": 57, ""nvdbId"": 846434440, ""versjon"": 2, ""overskriv"": ""JA"", ""egenskaper"": [ { ""typeId"": 11055, ""verdi"": [ ""Driftskontrakt"" ], ""operasjon"": ""oppdater"" } ], ""assosiasjoner"": [ { ""typeId"": 220122, ""tempId"": [ ""8a54b7f8-e0bc-40c3-9f7c-f26fb8329623"" ], ""nvdbId"": [], ""operasjon"": ""oppdater"" } ] } ] }
{noformat}",NVDB-6937,Datafangst,
Fjern ActivityLogger,"Vegkart, Eksport, API og NVDB logger til database. Dette ble sikkert laget fÃ¸r Splunk. 
Det er ikke noe behov for Ã¥ logge til database lengre. Fjern logging til database.",NVDB-6937,Eksport,
Fjern ActivityLogger,"Vegkart, Eksport, API og NVDB logger til database. Dette ble sikkert laget fÃ¸r Splunk. 
Det er ikke noe behov for Ã¥ logge til database lengre. Fjern logging til database.",NVDB-6937,Vegkart,
Fjern ActivityLogger,"Vegkart, Eksport, API og NVDB logger til database. Dette ble sikkert laget fÃ¸r Splunk. 
Det er ikke noe behov for Ã¥ logge til database lengre. Fjern logging til database.",NVDB-6937,NVDB-IND,
Vegnettsparametere endres i direktelenking.,"Ã…pneÂ [https://vegkart-v3.utv.atlas.vegvesen.no/#kartlag:geodata/@600000,6872424,3/vegnett:~'geometri*~()]Â og se at hashen endrer seg til Ã¥ siÂ [https://vegkart-v3.utv.atlas.vegvesen.no/#kartlag:geodata/@600000,6872424,3/vegnett:~'geometri*~(arm~'false~kryssystem~'false~sideanlegg~'false)]Â i stedet.

Forventet hash og vegnettsfilter er den/det samme som man taster inn.",NVDB-6937,Vegkart,
Endepunkt /omrader gir ikke ut geometri,"Endepunkt for fylke/kommune tilsier at en kan hente ut geometri: https://www.vegvesen.no/nvdb/api/v3/omrader/kommuner?inkluder=asdf

Ugyldig verdi for parameteren 'inkluder': 'asdf'. Gyldige verdier: [kartutsnitt, polygon, senterpunkt, vegobjekt, alle]

Men inkluder=polygon gir ikke noe polygon. 
Parameter inkluder er ikke dokumentert.

Â 

Eksempel:
[https://www.vegvesen.no/nvdb/api/v3/omrader/kommuner?inkluder=polygon]
[https://www.vegvesen.no/nvdb/api/v3/omrader/fylker?inkluder=polygon]

gir ingen geometri i responsen.

Â 

Â ",NVDB-6937,Les-API,
Endepunkt for Ã¥ hente datarettigheter,"Ã˜nske fra Per Ola Roald:

Rettigheter for Ã¥ endre: ""Det finnes ikke et offisielt endepunkt for dette, men datafangst har et internt endepunkt som bl.a Sinus har brukt. Problemet med dette er at det endrer seg uten varsel, siden det ikke er versjonert og dokumentert med tanke pÃ¥ at andre skal bruke det.

Det vi har behov for er et endepunkt i skriv som gir ut datarettigheter.

Â 

Tore skriver:

Dette er en enkel ting Ã¥ legge inn i API Skriv. Omlag et dagsverk vil jeg tro.

Informasjonen er lagret i API Skriv sin applikasjonsdatabase, ikke NVDB eller andre generelle databaser i SVV. Det mÃ¥ derfor tilgjengeliggjÃ¸res gjennom eget endepunkt i API Skriv.",NVDB-6937,Skriv-API,
Feil ved henting av barn i objektvisning,"h2. Observasjon

Hent opp
{noformat}
https://vegkart-v3.utv.atlas.vegvesen.no/#kartlag:geodata/@254273,7040564,8/hva:~(~(id~581))/valgt:85348132:581
{noformat}
Trykk pÃ¥ barn (tunnellÃ¸p). Da kastes feil
{noformat}
Uncaught (in promise) TypeError: Cannot read property 'relasjoner' of null 
at Object.t.addLoadedRelatedRoadObject (functions.ts:91) 
at t.mainReducer (reducers.ts:114) 
at v (redux.js:212) at middleware.ts:34 
at middleware.ts:22 at index.js:11 
at dispatch (redux.js:636) 
at fetchVegobjekter.ts:53
{noformat}
Â ",NVDB-6937,Vegkart,
"NVDBREF-431 - Sideanleggsdel viser feil vegsystemreferanse for ""ankerpunkt"" sideanlegg","Velger: EV6S202, Sideanlegg og Sideanleggsdel.

Sideanlegg har vegsystemreferanse EV6 S202D1 m2430, mens sideanleggsdel har ankerpunkt EV6 S202D1 m8323.

Sideanlegg har vegsystemreferanse EV6 S202D1 m5855, mens de to sideanleggsdelene har ankerpunkt EV6 S202D1 m6695. Dette er feil.

Sideanlegg har vegsystemreferanse EV6 S202D1 m9502, mens sideanleggsdelene har ankerpunkt EV6 S202D1 m21183.

Dette er feil.

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/hva:(~(farge:'0_1,id:919),(farge:'1_0,id:920))/hvor:(vegsystemreferanse:(~'EV6S202))/@812060,7788144,10/vegobjekt:1004496487:40a744:919]",NVDB-6937,NVDB-IND,
Feilmelding: Feil ved henting av vegnett da man tar vekk haken pÃ¥ Adskilte lÃ¸p,"{color:#172b4d}Har valgt EV8 og zoomer inn til stedet Breivika ved TromsÃ¸.{color}
{color:#172b4d}Velger Vegnett og slÃ¥r pÃ¥ Vis i kart og alle valg er avkrysset. ForsÃ¸ker Ã¥ ta vekk hakene for Adskilte lÃ¸p: uten, med og mot. Da kommer feilmeldingen. ""Feil ved henting av vegnett""{color}

Â ",NVDB-6937,Vegkart,
NVDBREF- 432 og  436 - Visning av retning i Vegkart er feil,"Jeg velger EV8.
Jeg ser at pÃ¥ 3 av 5 rundkjÃ¸ringer pÃ¥ strekningen 1 er det vist at metreringen gÃ¥r i motsatt retning av geometrien. Dette er feil. Det er ikke slik nÃ¥r jeg ser pÃ¥ vegsystemreferansen.

[https://www.utv.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/@654213,7734963,17/hvor:~(vegsystemreferanse~(~'EV8))/vegnett:~'metrering*~()/valgt:1125812:5:2/vegsystemreferanse:654217.101:7734984.815]

Â 
 * 
 * 
{color:#344563}Opt{color}",NVDB-6937,Vegkart,
Sjekk om segmentering av superstedfesting er kontinuerlig,"Fra @NKAmapper pÃ¥ gitter 
{quote}
""Det forekommer en god del veldig korte veibiter i det segmenterte vegnettet, bare noen centimeter lange. Eksempler: 2177784-2-3, 122395-32-9, 122632-3-2. Alle disse har overlapppende/identisk superstedfesting med naboen, som skaper en del problemer nÃ¥r vegobjekter skal flettes inn i vegnettet."" Alle disse ser ut som bugs.
{quote}

{quote}
Tja, de overlapper ikke lenger, men er ekstremt korte og lager hakk i geometrien. Her er en pÃ¥ 4 cm: 2264914-6-14
{quote}

Sjekk ogsÃ¥ steder der meterberegning feiler (NVDB-5454)",NVDB-6937,NVDB-IND,
NVDBREF-440 (C) - KjÃ¸rebanelenkene i start og slutt pÃ¥ adskilte lÃ¸p i Lierbakkene fÃ¥r feil vegref,"Fra HÃ¥vard Lerstad:Â 

KjÃ¸rebanelenkene I starten og slutten av adskilt lÃ¸p 1-2 og 1-3 fÃ¥r feil vegref I Lierbakkene.

Hovedstrekning=47, men disse segmentene fÃ¥r strekning=S46D350 og dermed meterverdier som ikke harmonerer med resten av anlegget.

Vegkart:

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/hvor:(vegsystemreferanse:(~'EV18))/@234773,6637486,17/vegnett:(trafikantgruppe:'alle,veglenketype:'alle,adskiltelop:'alle)]",NVDB-6937,NVDB-IND,
NVDBREF-439 (B) Feil metrering pÃ¥ kjÃ¸rebanenivÃ¥ for de fleste rundkjÃ¸ringer i Kongsberg,"HÃ¥vard Lerstad melder at kjÃ¸rebanelenkene inn og ut av rundkjÃ¸ringer fÃ¥r strekning =1042 for de fleste rundkjÃ¸ringer pÃ¥ hovedstrekning=42.

[https://www.vegvesen.no/nvdb/vegkart/v3/#kartlag:geodata/vegsystemreferanse:199028.00157162812:6626605.858680467/hvor:(vegsystemreferanse:(~'EV134))/@199028,6626573,18/vegnett:(trafikantgruppe:'alle,veglenketype:'alle,adskiltelop:'alle)]

Â 

Han har merket saken ""med Major priority""",NVDB-6937,Les-API,
Begrens tilgang til egenskaper basert pÃ¥ roller,"h2. Introduksjon

Det innfÃ¸res tre nye roller i LDAP for Ã¥ regulere brukeres tilgang til Ã¥ lese og skrive egenskaper pÃ¥ vegobjekter i NVDB:

nva/0_sensitive_role1
 nva/0_sensitive_role2
 nva/0_sensitive_role3

Tallet tilsvarer sensitivitetsnivÃ¥ for egenskapstypene i datakatalogen.

Lese-endepunktet til API Skriv skal maskere bort alle egenskaper som brukeren ikke har rolle for.

Endringssett skal avvises dersom det er angitt en egenskap brukeren ikke har ""tilgang"" til.
h2. LÃ¸sning

For lese-endepunktene er det endret slik at sensitive egenskaper brukeren har rolle for ikke blir filtrert bort. For oppdatering av objekter er det lagt inn et nytt filter,Â AttributeTypeAuthorizationJobFilter, som avviser skriving av sensitive egenskaper brukeren ikke har rolle for. Dette gjelder bare sensitive egenskaper, slik at det vil vÃ¦re mulig Ã¥ oppdatere egenskaper som ikke er sensitive pÃ¥ et objekt med sensitive egenskaper uten Ã¥ ha rolle for de sensitieve egenskapene.",NVDB-6937,Skriv-API,
Endringssett opprettet med v2 fÃ¥r ikke oppdatert status pÃ¥ v3,"Vi bruker URL til endringsett sÃ¥nn den ligger i databasen, men respons fra v2 og v3 er ikke helt like. Derfor vil endringsett som er opprettet med v2 feile nÃ¥r vi bruker v3.",NVDB-6937,Datafangst,
Legg til medium_nvdb,"Les gir ut medium som kortversjonen fra SOSI. Skriv tar inn tallversjonen fra enumegenskapen.
Legg til medium_nvdb som gir ut nvdb-verdien",NVDB-6937,Les-API,
Ugyldig gyldighetsperiode avdekket i SanitationJobFilter,"h2. Observasjon

Endringssett https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/6ebe5c78-fdc3-4886-b463-c35cc2aa4fd7 havner i SYSTEMFEIL etter ""validering"" i SanitationJobFilter:

{code:java}
java.lang.IllegalStateException: Detected invalid lifetime for 1 closed feature version(s):
op:CORRECT tid:616 id:86009923 v:2 sd:1997-05-27 ed:1950-01-01 - ac:UPDATE or:PrepareForRemoveEnricherFilter vr:true - [StringAttribute{typeId=5528, operation=READ, values=[1#2]}, LocationalAttribute{typeId=120616, operation=READ, values=[121369: 0.0->1.0, 121394: 0.0->0.3160925, 121746: 0.0->0.10943457]}]
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.SanitationJobFilter.ensureValidLifetime(SanitationJobFilter.java:139)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.SanitationJobFilter.doFilter(SanitationJobFilter.java:47)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:107)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateAfterLocking(DefaultValidationService.java:129)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$21(JobWorker.java:512)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$validateAfterLock$22(JobWorker.java:511)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateAfterLock(JobWorker.java:510)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:177)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
	at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1390)
	at org.apache.activemq.ActiveMQMessageConsumer.iterate(ActiveMQMessageConsumer.java:1552)
	at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:191)
	at org.apache.activemq.ActiveMQSessionExecutor.wakeup(ActiveMQSessionExecutor.java:111)
	at org.apache.activemq.ActiveMQMessageConsumer.start(ActiveMQMessageConsumer.java:1527)
	at org.apache.activemq.ActiveMQMessageConsumer$7.run(ActiveMQMessageConsumer.java:1308)
	at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)
	at java.util.TimerThread.mainLoop(Timer.java:555)
	at java.util.TimerThread.run(Timer.java:505)
{code}

h2. Analyse

I endringssettet fjernes vegobjekt 86009923v3 av type 616. Under behandling kopieres sluttdato for v3 til v2 via en korrigering (fÃ¸lgeoppdatering). I NVDB er imidlertid v3 registrert med ugyldig levetid: 2003-11-15 - 1950-01-01. Versjon 2 har gyldighetsperiode 1997-05-27 - 2003-11-15. Etter kopiering av sluttdato blir gyldighetsperioden for v2 altsÃ¥ 1997-05-27 - 1950-01-01. Dette fanges opp i SanitationJobFilter som avviser korrigeringen.

Ã…rsaken til hendelsen er altsÃ¥ datafeil i NVDB. Dette ble innfÃ¸rt av Klassisk API i 2006: https://www.vegvesen.no/nvdb/apiskriv/rest/v1/oppdrag/32669.

For Ã¥ fÃ¥ dette endringssettet gjennom kan det utvides med en eksplisitt korrigering av v2, der sluttdato settes til en gyldig dato (eller null).",NVDB-6937,Skriv-API,
Gi kun ett svar per vegreferanse i /posisjon,"Se siste kommentarer i https://github.com/nvdb-vegdata/nvdb-api-client/issues/61

LÃ¸sningsforslag: i PosistionService, ha et ekstra Set<String> der vegsystem og strekning legges. SÃ¥ dersom FV7556 S1D1 allerede er lagt inn skal ikke neste segment for denne vÃ¦re med ut.",NVDB-6937,Les-API,
/veg sÃ¸ker kun i hovedlenker,"https://www.vegvesen.no/nvdb/api/v3/veg?veglenkesekvens=0.5@181449 returnerer ingen svar, fordi veglenkesekvensen er detajert lenke. 

Sjekk om /veg burde hatt ?konnekteringslenker og ?detaljerte_lenker som /posisjon har.
",NVDB-6937,Les-API,
GUI: skille pÃ¥ Arbeid med veglister og Generere/publisere veglister,"Veglister genereres i to kontekster:
 # *Arbeide med veglister*
 Eksperimentere med ulik input - stor fleksibilitet.
 Dette er dagens lÃ¸sning ([https://nvdb-veglister.utv.atlas.vegvesen.no/]).

 # *Generere veglister for publisering*
 Streng input i henhold til gjeldende regler - liten fleksibilitet (minimere mulighet for feil).

Â Basert pÃ¥ disse to brukstilfellene foreslÃ¥r jeg at dette skillet visualiseres i front-end ved at bruker fÃ¸rst mÃ¥ ta stilling til om hvilken av disse det skal jobbes med.

For den fÃ¸rste â€œArbeid med veglisterâ€ endres fÃ¸lgende:
 * *1 a)*
 (/)Â Dagens front-end utvides med mulighet for Ã¥ velge flere fylker (pÃ¥ samme mÃ¥te som kommuner). MÃ¥ endres i REST API ogsÃ¥ (mikroskopisk endring). (NVDBREF-425,Â NVDBREF-426)
 * *1 b)*
 (/)Â Dagens front-end utvides med mulighet for Ã¥ angi flere Vegsystemreferanser (kommaseparert liste). Alt klart i REST API og backend/motor. (NVDBREF-424)
 Vegsystemreferanse er for ekspertbrukere - begrepet er ikke godt kjent i veglistemiljÃ¸et!

Â For den andre â€œGenerere veglister for publiseringâ€ endres dette:
 * *2 a)*
 (/)Â I front-end skjules feltet for Ã¥ angi Vegsystemreferanse (mindre fleksibilitet), og erstattes av en mulighet for Ã¥ velge Ã©n av: â€œRiksvegerâ€ eller â€œFylkes- og kommunale vegerâ€.
 Bak kulissene setter valg av â€œRiksvegerâ€ verdien â€œEV, RVâ€ i det skjulte feltet for Vegsystemreferanse. Valg av â€œFylkes- og kommunale vegerâ€ setter â€œFV, KVâ€ i det samme skjulte feltet.

 * *2 b)*
 (/)Â NÃ¥r bruker velger â€œRiksvegerâ€ skal alle fylker forhÃ¥ndsvelges i front-end (kan ikke endres av bruker)

 * *2 c)*
 (/)Â NÃ¥r bruker velger â€œFylkes- og kommunale vegerâ€ kan bare ett fylke velges i front-end.

 * *2 d)*
 (/)Â I front-end skjules muligheten for Ã¥ velge kommuner.",NVDB-6825,Rapportgenerator,
Word-fil formatere innhold,"Ferdigstille formatering av innhold i eksport til Word-format.

Ref. POC iÂ NVDBREF-419",NVDB-6825,Rapportgenerator,
Vegnettrapport og veglengder med stedsnavn,"Vegnettsgruppa etterspÃ¸r muligheten til Ã¥ ta ut sÃ¥kalte ""vegnettsrapporter"" og ""veglengder"" som ogsÃ¥ inkluderer stedsnavn (fra NVDB) for start- og slutt pÃ¥ hver rad i utlistingen. AltsÃ¥ 1 rad = et stykke veg, og start og slutt angis med nÃ¦rmeste innenfor sÃ¸keradius stedsnavn-forekomst fra NVDB. Stedsnavnet mÃ¥ vÃ¦re tilknyttet samme vegen (samme vegkategori og vegnummer).Â ",NVDB-6827,Rapportgenerator,
HÃ¥ndtere status UTFÃ˜RT OG ETTERBEHANDLET fra Skriv,"Det ble meldt fra bruker i Prod om at endringssett havnet i status ""ANNEN STATUS"":Â [https://datafangst.kantega.no/#!/contract/312533fe-645a-4fa2-9e63-9d139b0fde1c/export]

Dette er rett og slett fordi vi ikke mapper fra Skriv sin status UTFÃ˜RT_OG_ETTERBEHANDLET.Â 

Resultatet er at brukerens objekter nÃ¥ ligger i behandling uten at brukeren fÃ¥r gjort noe med dette.

*Oppgaver*
 * HÃ¥ndtere statusÂ UTFÃ˜RT_OG_ETTERBEHANDLET fra Skriv
 * Sjekk databasen for hvor mange dette gjelder og endre fra ""ANNEN STATUS"" tilÂ UTFÃ˜RT_OG_ETTERBEHANDLET dersom dette gjelder disse endringssettene. Verifiser at objektene blir ""lÃ¥st opp"" etterpÃ¥

Vi bÃ¸r senere - lag eventuelt en sak pÃ¥ dette - pÃ¥ Ã¥ polle Skriv _etter_ at status er UTFÃ˜RT for Ã¥ fange opp indekseringen til API Les, noe som da reflekteres gjennom statusenÂ UTFÃ˜RT_OG_ETTERBEHANDLET

Â 
h3. Notater

For Ã¥ fÃ¥ Datafangst til Ã¥ oppfÃ¸re seg konsistent, velger vi Ã¥ transformere Fremdrift.UTFÃ˜RT_OG_ETTERBEHANDLET til ChangesetProgress.COMPLETED. Dette er for Ã¥ beholde en forutsigbar sluttilstand for innsendinger i datafangst.

Dette er en banal lÃ¸sning, men det ser ut som om den skal hÃ¥ndteres rett om vi ikke gjÃ¸r forskjell pÃ¥Â  UTFÃ˜RT og UTFÃ˜RT_OG_ETTERBEHANDLET.

Det er godt mulig at ""utÃ¸frt"" og ""utfÃ¸rt og etterbehandlet"" bÃ¸r behandles ulikt for Ã¥ fÃ¸lge med pÃ¥ etterbehandlingsstatusen til en innsending, og i sÃ¥ fall mÃ¥ det vurderes om vi skal endre sluttilstand (fra COMPLETED til noe annet) eller om vi skal legge inn en tilstand _fÃ¸r_ COMPLETED som mappes fra UTFÃ˜RT, slik at UTFÃ˜RT_OG_ETTERBEHANDLET mappes til COMPLETED.",NVDB-6937,Datafangst,
To endringsset fikk opprettet samme versjon av objekt,"h2. Observasjon

Det har blitt sendt inn to identiske endringssett nesten samtidig
https://www.vegvesen.no/nvdb/apiskriv/rest/v1/oppdrag/4723942
https://www.vegvesen.no/nvdb/apiskriv/rest/v1/oppdrag/4723943

Dette fÃ¸rte til at Stikkrenne/Kulvert (79) 635163377 fikk to objekter med versjon 2. 

h2. Analyse

Endringssettet inneholder en delvis oppdatering (versjonering) av vegobjekt type 79, id 635163377.

Hendelseslogg for endringssett 1 (https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/3ff04a6f-5a20-46ad-8049-9d67f87c4ac8):

2020-01-22 14:20:26.188	JOB_PROCESSING_STARTED
2020-01-22 14:20:26.571	SYNTACTIC_VALIDATION_OK
2020-01-22 14:20:28.309	LOCKED
2020-01-22 14:20:28.425	RELATIONAL_VALIDATION_OK
2020-01-22 14:20:28.520	STORED_IN_NVDB
2020-01-22 14:20:28.574	UNLOCKED

Hendelseslogg for endringssett 2 (https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/6f0b7c6d-a472-4751-ac95-17cd277afcd2):

2020-01-22 14:20:28.269	JOB_PROCESSING_STARTED
2020-01-22 14:20:28.651	SYNTACTIC_VALIDATION_OK
2020-01-22 14:20:30.349	LOCKED
2020-01-22 14:20:30.459	RELATIONAL_VALIDATION_OK
2020-01-22 14:20:30.596	STORED_IN_NVDB
2020-01-22 14:20:30.609	UNLOCKED

Normalt ville lÃ¥semekanismene hindre at to endringssett endrer samme vegobjekt ""samtidig"". Men som vi ser av hendelsesloggene over, ble lÃ¥sen til fÃ¸rste endringssett fjernet (14:20:28.574) fÃ¸r etablering av lÃ¥s for det andre (14:20:30.349).

Endringssett 1 ble commit'et rett fÃ¸r lÃ¥sen ble fjernet (14:20:28.574). Endringssett 2 kjÃ¸rte PrepareForModifyEnricherFilter 14:20:28.434 i fÃ¸lge Splunk. Dette filteret kontrollerer bl.a. at angitt versjon for oppdatering er faktisk siste versjon i NVDB.
Det ser ut til at dette filteret ble kjÃ¸rt rett fÃ¸r endringssett 1 ble commit'et og derfor ikke oppdaget at vegobjektet allerede var versjonert.

h2. LÃ¸sning

Umiddelbart etter lÃ¥sing utfÃ¸rer API Skriv versjonssjekk pÃ¥ vegobjektene jobben er blitt beriket med, for Ã¥ kontrollere at ikke andre prosesser har endret dem (f.eks. versjonert) siden de ble lest inn fra NVDB. Dette skjer i klassen JobExtensionVersionChecker. Denne klassen endres til Ã¥ utfÃ¸re versjonssjekk pÃ¥ samtlige vegobjekter, bÃ¥de de som er beriket inn i jobben og de som har opphav i endringssettet.
",NVDB-6937,Skriv-API,
Tech Debt: TsLint er deprecated. Bytt til et annet verktÃ¸y,"TS-lint er deprecated: [https://medium.com/palantir/tslint-in-2019-1a144c2317a9]

ES-lint har god stÃ¸tte for typescript no, og er bransjestandard. Vi bÃ¸r ta det i bruk.",NVDB-6937,Vegkart,
Tech Debt: Splitte opp reducers.ts til ulike ActionType-grupperinger,,NVDB-6937,Vegkart,
Fjerning av omrÃ¥de gir feil,"h2. Observasjon

Ã…pne Vegkart. Legg til omrÃ¥de Trondheim. Fjern Trondheim. Feil
{noformat}
Uncaught TypeError: Cannot read property 'roadNetState' of undefined
{noformat}",NVDB-6937,Vegkart,
"Tech Debt: Full gjennomgang av State, uhensiktsmessig hierarki",,NVDB-6937,Vegkart,
Feiler pÃ¥ Ã¥ sette blank verdi for NVDB-objekter,"h2. Observasjon

PrÃ¸ver Ã¥ fjerne en egenskapsverdi for et importert objekt (sette verdi blank). Dette gir en feil.

PrÃ¸v Ã¥ sette f.ex Fjernavlesning blank for Elektrisk Anlegg i kontraktÂ [https://datafangst-test.kantega.no/#!/contract/997c62c8-abb7-4aa3-a069-9d77ef85fae4/features3]

Denne observasjonen kommer av en lignende observert i Prod, hvor API Skriv gir en HTTP 400 pÃ¥ valideringen. Riktignok gÃ¥r det fint Ã¥ sette en verdi blank i Prod nÃ¥ sÃ¥ usikker pÃ¥ sammenhengen, men feilmld fra Skriv pÃ¥ valideringen er lik her og i observasjonen fra ATM.

Fra prod-observasjon:
{noformat}
https://vegdata.kantega.no/kibana/app/kibana#/context/datafangst-logs-*/doc/6Tnp0W8B9qfWmpvbB0Li?_a=(columns:!(_source),filters:!(),predecessorCount:5,sort:!('@timestamp',desc),successorCount:5)&_g=(refreshInterval:(pause:!t,value:0),time:(from:now-15m,mode:quick,to:now)){noformat}
Request
{noformat}
11189 * LoggingFilter - Request received on thread http-nio-127.0.0.1-8080-exec-14 
11189 > POST https://www.vegvesen.no/nvdb/apiskriv/v3/endringssett/validator?skipLocation=true&useObjectList=true 
11189 > X-Client: Datafangst 11189 > Content-Type: application/xml 
Â 
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><endringssett xmlns=""http://nvdb.vegvesen.no/apiskriv/domain/changeset/v3""><delvisOppdater><vegobjekter><vegobjekt typeId=""461"" nvdbId=""736973415"" versjon=""2""><egenskaper><egenskap typeId=""5644"" operasjon=""oppdater""><verdi>Trafikkregistreringsstasjon</verdi></egenskap><egenskap typeId=""10032"" operasjon=""oppdater""><verdi>Cu wiret</verdi></egenskap><egenskap typeId=""10022"" operasjon=""oppdater""><verdi>Tavlenorm</verdi></egenskap><egenskap typeId=""10023"" operasjon=""oppdater""><verdi>2019</verdi></egenskap><egenskap typeId=""10038"" operasjon=""oppdater""><verdi>230</verdi></egenskap><egenskap typeId=""10039"" operasjon=""oppdater""><verdi>Forsynes fra Veglysfordeling</verdi></egenskap><egenskap typeId=""11124"" operasjon=""oppdater""><verdi>Driftskontrakt</verdi></egenskap><egenskap typeId=""10028"" operasjon=""slett""><verdi xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:nil=""true""/></egenskap><egenskap typeId=""10033"" operasjon=""oppdater""><verdi>En for hver kurs</verdi></egenskap><egenskap typeId=""10021"" operasjon=""oppdater""><verdi>NEK FEL 1998</verdi></egenskap><egenskap typeId=""10029"" operasjon=""oppdater""><verdi>IT</verdi></egenskap><egenskap typeId=""5641"" operasjon=""oppdater""><verdi>ingen mÃ¥ler</verdi></egenskap></egenskaper><gyldighetsperiode><startdato>2020-01-23</startdato></gyldighetsperiode><validering><lestFraNvdb>2019-09-27T12:27:50</lestFraNvdb></validering></vegobjekt></vegobjekter></delvisOppdater><datakatalogversjon>2.19-865</datakatalogversjon></endringssett>
{noformat}
Respons
{noformat}
<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><fault xmlns=""http://nvdb.vegvesen.no/apiskriv/fault/v1""><message>Request body unmarshalling failed at line: 1, col: 943: cvc-elt.3.1: Attribute 'http://www.w3.org/2001/XMLSchema-instance,nil' must not appear on element 'verdi', because the {nillable} property of 'verdi' is false.</message></fault>{noformat}
h2. Analyse
 * Bad request mot skriv.
 * Vi sender med verdi nÃ¥r operation = slett. det er syntax feil.Â 

h2. LÃ¸sning

- Ikke send verdi nÃ¥r operasjon = slett

Â ",NVDB-6937,Datafangst,
Misvisende farge pÃ¥ objekt far direkte url,"h2. Observasjon

Hent opp url med id for vegobjekt.
{noformat}
https://vegkart-v3.utv.atlas.vegvesen.no/#kartlag:geodata/@263412,7014284,10/hva:~(~(id~581))/valgt:85339025:581
{noformat}
Her er tunnel med i sÃ¸ket, og valgt objekt fÃ¥r annen farge enn vegobjekttypen som er med.",NVDB-6937,Vegkart,
IndexOutOfBoundsException ved restedfesting etter geometriutskiftning,"h2. Observasjon

Endringssettene

* https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/e378c3ea-0061-46ce-9962-18c1f63a3a3d
* https://www.vegvesen.no/nvdb/apiskriv/kontrollpanel/#/jobs/view/45bc5dc9-e346-4373-903e-30accf7f0c50

ender med SYSTEMFEIL pga IndexOutOfBoundsException ved utvidelse av ny stedfesting ifm. geometriutskiftning pÃ¥ vegnett:

{code:java}
java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
	at java.util.ArrayList.rangeCheck(ArrayList.java:657)
	at java.util.ArrayList.get(ArrayList.java:433)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.LocationalExtender.extendLengthOneMmIfPossible(LocationalExtender.java:26)
	at no.vegvesen.vt.nvdb.apiskriv.domain.locational.LocationCalculator.calcLocationalLine(LocationCalculator.java:135)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableLocational.relocalizeToLine(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:896)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableLocational.relocalize(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:877)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter$RelocalizableFeature.relocalizeIfOutsideDelta(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:702)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.addEnrichmentOrReportConflict(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:425)
	at no.vegvesen.vt.nvdb.apiskriv.validation.job.AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.doFilter(AdaptFeaturesToChangedRefLinkGeometryEnricherFilter.java:153)
	at no.vegvesen.vt.nvdb.apiskriv.validation.JobProcessor.process(JobProcessor.java:107)
	at no.vegvesen.vt.nvdb.apiskriv.validation.DefaultValidationService.validateBeforeLocking(DefaultValidationService.java:122)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$null$13(JobWorker.java:389)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$validateBeforeLock$14(JobWorker.java:388)
	at no.vegvesen.vt.nvdb.apiskriv.jdbc.Jdbc.readOnly(Jdbc.java:75)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.validateBeforeLock(JobWorker.java:387)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.lambda$submit$0(JobWorker.java:163)
	at no.vegvesen.vt.nvdb.apiskriv.logutils.MdcHelper.putAndRemoveJobIdMdc(MdcHelper.java:53)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobWorker.submit(JobWorker.java:137)
	at no.vegvesen.vt.nvdb.apiskriv.jobmanager.JobListener.lambda$new$0(JobListener.java:24)
	at no.vegvesen.vt.nvdb.apiskriv.jms.Subscription.onMessage(Subscription.java:138)
{code}

h2. Analyse

Vegobjektet det skal beregnes ny strekningsstedfesting for har punktgeometri. Punktet er ""bortenfor"" enden av eneste aktuelle veglenke (249130:1), slik at bÃ¥de beregnet start- og sluttposisjon (0.052273299999999995) for den nye utstrekningen blir ""nesten"" identisk med veglenkens endeposisjon (0.0522733). Siden de ikke er eksakt samme verdi, vil ikke LocationCalculator.calcRelativePosition justere posisjonen vekk fra veglenkens endeposisjon, som er ikke-inklusiv. Den beregnede utstrekningen med identisk start- og sluttposisjon forsÃ¸kes utvidet via kall til extendLengthOneMmIfPossible. Her forsÃ¸kes plukket ut en veglenke som omslutter (encloses) bÃ¥de den beregnede start- og sluttposisjonen. Siden denne posisjonen er svÃ¦rt nÃ¦r den ikke-inklusive endeposisjonen til eneste relevante veglenke vil Extent.encloses returnere false og get(0) pÃ¥ listen havarerer med IndexOutOfBoundsException.

h2. LÃ¸sning

LocationCalculator.calcRelativePosition sin logikk for Ã¥ unngÃ¥ at en ikke-inklusiv relativ posisjon returneres, forbedres ved at den reduseres med 1 mm dersom den i utgangspunktet er 1 mm eller mindre fra endeposisjonen til veglenken. Dermed unngÃ¥r vi at sammenligningstoleransen i Extent.encloses slÃ¥r til.",NVDB-6937,Skriv-API,
